<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/cookbook/optimization/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 16:01:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Recipes for optimization"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/cookbook/optimization/ rel=canonical><link href=../indicators/index.html rel=prev><link href=../persistence/index.html rel=next><link rel=icon href=../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.18+insiders-4.53.6"><title>Optimization - VectorBT PRO</title><link rel=stylesheet href=../../assets/stylesheets/main.d5b5f0fd.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><link rel=stylesheet href=../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0C5VNYCFHL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=robots content=noindex><meta property=og:title content=Optimization><meta property=og:type content=website><meta content=https://vectorbt.pro/cookbook/optimization/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_54404668/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Recipes for optimization"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=../../assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=../../assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=../../assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../assets/logo/favicon-16x16.png><link rel=manifest href=../../assets/logo/site.webmanifest><link rel=mask-icon href=../../assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=../../assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_54404668/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#optimization class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <i>New</i>: Smart Money Concepts, Hurst exponent, tasks, iterated decorator, and <a href=../../features/index.html><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.2c0 13.1 5.4 25.7 14.9 34.7l84.7 80.8c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9z"/></svg></span> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=../../index.html title="VectorBT PRO" class="md-header__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT PRO <span class=md-version> v2024.6.19 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224 64c-44.2 0-80 35.8-80 80v48h240c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16v-48C80 64.5 144.5 0 224 0c57.5 0 107 33.7 130.1 82.3 7.6 16 .8 35.1-15.2 42.6s-35.1.8-42.6-15.2C283.4 82.6 255.9 64 224 64zm32 320c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32s14.3 32 32 32h64z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Optimization </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=../../features/overview/index.html class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../tutorials/overview/index.html class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../documentation/overview/index.html class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../api/index.html class=md-tabs__link> API </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../overview/index.html class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=../../terms/terms-of-use/index.html class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title="VectorBT PRO" class="md-nav__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../assets/logo/logo.svg alt=logo class=logo> </a> VectorBT PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../index.html class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../features/overview/index.html class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tutorials/overview/index.html class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../documentation/overview/index.html class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../api/index.html class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Cookbook </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../arrays/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 2h14a2 2 0 0 1 2 2v12c0 1.11-.89 2-2 2H7a2 2 0 0 1-2-2V4c0-1.1.9-2 2-2m0 4v4h6V6H7m8 0v4h6V6h-6m-8 6v4h6v-4H7m8 0v4h6v-4h-6M3 20V6H1v14c0 1.11.89 2 2 2h16v-2H3Z"/></svg> <span class=md-ellipsis> Arrays </span> </a> </li> <li class=md-nav__item> <a href=../benchmarking/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 5a7 7 0 0 1 7 7h1v3h-1v4H9a7 7 0 0 1-7-7 7 7 0 0 1 7-7m0 3a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m8 9h5v4h-2v-2h-3v-2Z"/></svg> <span class=md-ellipsis> Benchmarking </span> </a> </li> <li class=md-nav__item> <a href=../caching/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 8-4 4h3a6 6 0 0 1-6 6c-1 0-1.97-.25-2.8-.7l-1.46 1.46A7.93 7.93 0 0 0 12 20a8 8 0 0 0 8-8h3M6 12a6 6 0 0 1 6-6c1 0 1.97.25 2.8.7l1.46-1.46A7.93 7.93 0 0 0 12 4a8 8 0 0 0-8 8H1l4 4 4-4"/></svg> <span class=md-ellipsis> Caching </span> </a> </li> <li class=md-nav__item> <a href=../compilation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41-.39.39-1.03.39-1.42.01A9.969 9.969 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13Z"/></svg> <span class=md-ellipsis> Compilation </span> </a> </li> <li class=md-nav__item> <a href=../configuration/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/></svg> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../cross-validation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Cross-validation </span> </a> </li> <li class=md-nav__item> <a href=../data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../datetime/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg> <span class=md-ellipsis> Datetime </span> </a> </li> <li class=md-nav__item> <a href=../discovery/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 3h6v4H3V3m12 7h6v4h-6v-4m0 7h6v4h-6v-4m-2-4H7v5h6v2H5V9h2v2h6v2Z"/></svg> <span class=md-ellipsis> Discovery </span> </a> </li> <li class=md-nav__item> <a href=../indexing/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 20.5c0 .8-.7 1.5-1.5 1.5H13c-.4 0-.7-.1-1-.4l-4-4.2.7-.8c.2-.2.5-.3.8-.3h.2L12 18V9c0-.6.4-1 1-1s1 .4 1 1v4.5l1.2.1 3.9 2.2c.5.2.9.8.9 1.3v3.4M20 2H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h4v-2H4V4h16v8h-2v2h2c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2Z"/></svg> <span class=md-ellipsis> Indexing </span> </a> </li> <li class=md-nav__item> <a href=../indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg> <span class=md-ellipsis> Optimization </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg> <span class=md-ellipsis> Optimization </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#parameterization class=md-nav__link> <span class=md-ellipsis> Parameterization </span> </a> <nav class=md-nav aria-label=Parameterization> <ul class=md-nav__list> <li class=md-nav__item> <a href=#decoration class=md-nav__link> <span class=md-ellipsis> Decoration </span> </a> </li> <li class=md-nav__item> <a href=#merging class=md-nav__link> <span class=md-ellipsis> Merging </span> </a> </li> <li class=md-nav__item> <a href=#generation class=md-nav__link> <span class=md-ellipsis> Generation </span> </a> <nav class=md-nav aria-label=Generation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-generation class=md-nav__link> <span class=md-ellipsis> Pre-generation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#execution class=md-nav__link> <span class=md-ellipsis> Execution </span> </a> </li> <li class=md-nav__item> <a href=#total-or-partial class=md-nav__link> <span class=md-ellipsis> Total or partial? </span> </a> </li> <li class=md-nav__item> <a href=#flat-or-nested class=md-nav__link> <span class=md-ellipsis> Flat or nested? </span> </a> </li> <li class=md-nav__item> <a href=#skipping class=md-nav__link> <span class=md-ellipsis> Skipping </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hybrid-mono-chunks class=md-nav__link> <span class=md-ellipsis> Hybrid (mono-chunks) </span> </a> </li> <li class=md-nav__item> <a href=#chunking class=md-nav__link> <span class=md-ellipsis> Chunking </span> </a> <nav class=md-nav aria-label=Chunking> <ul class=md-nav__list> <li class=md-nav__item> <a href=#decoration_1 class=md-nav__link> <span class=md-ellipsis> Decoration </span> </a> </li> <li class=md-nav__item> <a href=#specification class=md-nav__link> <span class=md-ellipsis> Specification </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hybrid-super-chunks class=md-nav__link> <span class=md-ellipsis> Hybrid (super-chunks) </span> </a> </li> <li class=md-nav__item> <a href=#raw-execution class=md-nav__link> <span class=md-ellipsis> Raw execution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../persistence/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 12h2v5h16v-5h2v5c0 1.11-.89 2-2 2H4a2 2 0 0 1-2-2v-5m10 3 5.55-5.46-1.42-1.41L13 11.25V2h-2v9.25L7.88 8.13 6.46 9.55 12 15Z"/></svg> <span class=md-ellipsis> Persistence </span> </a> </li> <li class=md-nav__item> <a href=../plotting/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2 0 1.77-1.43 3.2-3.2 3.2-1.77 0-3.2-1.43-3.2-3.2 0-1.77 1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8Z"/></svg> <span class=md-ellipsis> Plotting </span> </a> </li> <li class=md-nav__item> <a href=../portfolio/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> </li> <li class=md-nav__item> <a href=../signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Signals </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../terms/terms-of-use/index.html class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=optimization><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg></span> Optimization<a class=headerlink href=#optimization title="Permanent link">&para;</a></h1> <p>Optimization involves executing a function on a set of various configurations with an aim to optimize the performance of a strategy, and/or to optimize the CPU or RAM performance of a pipeline.</p> <div class="admonition question"> <p class=admonition-title>Question</p> <p>Learn more in <a href=../../tutorials/pairs-trading/index.html >Pairs trading tutorial</a>.</p> </div> <h2 id=parameterization>Parameterization<a class=headerlink href=#parameterization title="Permanent link">&para;</a></h2> <p>The first and easiest approach revolves around testing a single parameter combination at a time, which utilizes as little RAM as possible but may take longer to run if the function isn't written in pure Numba and has a fixed overhead (e.g., conversion from Pandas to NumPy and back) that adds to the total execution time with each run. For this, create a pipeline function that runs a set of single values and decorate it with <a href=../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized><code>@vbt.parameterized</code></a>. To test multiple parameters, wrap each parameter argument with <a href=../../api/utils/params/index.html#vectorbtpro.utils.params.Param>Param</a>. </p> <div class="admonition example"> <p class=admonition-title>Example</p> <p>See an example in <a href=../../features/optimization/index.html#parameterized-decorator>Parameterized decorator</a>.</p> </div> <h3 id=decoration>Decoration<a class=headerlink href=#decoration title="Permanent link">&para;</a></h3> <p>To parameterize any function, we have to decorate (or wrap) it with <code>@vbt.parameterized</code>. This will return a new function with the same name and arguments as the original one. The only difference: this new function will process passed arguments, build parameter combinations, call the original function on each parameter combination, and merge the results of all combinations.</p> <div class="language-python highlight"><span class=filename>Process only one parameter combination at a time</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=o>...</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=k>return</span> <span class=n>result</span>  <span class=c1># (2)!</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=n>results</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Arguments can be anything. Here we're expecting a data instance and two parameters: <code>fast_window</code> and <code>slow_window</code>, they will be passed by the decorator as single values.</li> <li>Do some calculations on the received parameter combination and return a result, which can be anything</li> <li>Run the function the same way as without the decorator</li> <li>Wrap multiple values with <code>vbt.Param</code> under each parameter</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>To keep the original function separate from the decorated one, we can decorate it after it has been defined and give the decorated function another name.</p> <div class="language-python highlight"><span class=filename>Decorate a function later</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=o>...</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=n>my_param_pipeline</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>my_pipeline</span><span class=p>)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>results</span> <span class=o>=</span> <span class=n>my_param_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></code></pre></div> <h3 id=merging>Merging<a class=headerlink href=#merging title="Permanent link">&para;</a></h3> <p>The code above returns a list of results, one per parameter combination. To return the grid of parameter combinations as well, pass <code>return_param_index=True</code> to the decorator. Alternatively, let VBT merge the results into one or more Pandas objects and attach the grid to their index or columns by specifying the merging function (see <a href=../../api/base/reshaping/index.html#vectorbtpro.base.merging.resolve_merge_func>resolve_merge_func</a>).</p> <div class="language-python highlight"><span class=filename>Various merging configurations</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>return_param_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=o>...</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=n>results</span><span class=p>,</span> <span class=n>param_index</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=o>...</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=n>sharpe_ratio</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>    <span class=o>...</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>,</span> <span class=n>pf</span><span class=o>.</span><span class=n>win_rate</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=n>sharpe_ratio</span><span class=p>,</span> <span class=n>win_rate</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>    <span class=o>...</span>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>    <span class=k>return</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;row_stack&quot;</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>    <span class=o>...</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a><span class=n>value</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=s2>&quot;column_stack&quot;</span><span class=p>))</span>  <span class=c1># (5)!</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>    <span class=o>...</span>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>,</span> <span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a><span class=n>sharpe_ratio</span><span class=p>,</span> <span class=n>value</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-2-54><a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a>
</span><span id=__span-2-55><a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a><span class=k>def</span> <span class=nf>merge_func</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>param_index</span><span class=p>):</span>
</span><span id=__span-2-56><a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=n>param_index</span><span class=p>)</span>
</span><span id=__span-2-57><a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a>
</span><span id=__span-2-58><a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span>
</span><span id=__span-2-59><a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a>    <span class=n>merge_func</span><span class=o>=</span><span class=n>merge_func</span><span class=p>,</span>  <span class=c1># (6)!</span>
</span><span id=__span-2-60><a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a>    <span class=n>merge_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>param_index</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;param_index&quot;</span><span class=p>))</span>  <span class=c1># (7)!</span>
</span><span id=__span-2-61><a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a><span class=p>)</span>
</span><span id=__span-2-62><a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-2-63><a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a>    <span class=o>...</span>
</span><span id=__span-2-64><a id=__codelineno-2-64 name=__codelineno-2-64 href=#__codelineno-2-64></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-2-65><a id=__codelineno-2-65 name=__codelineno-2-65 href=#__codelineno-2-65></a>
</span><span id=__span-2-66><a id=__codelineno-2-66 name=__codelineno-2-66 href=#__codelineno-2-66></a><span class=n>sharpe_ratio</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Return the results along with the parameter grid</li> <li>If the function returns a single number (or a tuple of such), concatenate all numbers into a Series with parameter combinations as index. Useful for returning metrics such as Sharpe ratio.</li> <li>If the function returns an array (or a tuple of such), stack all arrays along columns into a DataFrame with parameter combinations as an outermost column level. Useful for returning indicator arrays.</li> <li>If the function returns an array (or a tuple of such), stack all arrays along rows into a Series/DataFrame with parameter combinations as an outermost index level. Useful for cross-validation.</li> <li>If the function returns a number and an array, return a Series of concatenated numbers and a DataFrame of arrays stacked along columns</li> <li>Pass a custom merging function</li> <li>Use an expression template to pass the parameter index as a keyword argument</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>We can also use annotations to specify the merging function(s).</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;concat&quot;</span><span class=p>:</span>  <span class=c1># (1)!</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=o>...</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=p>(</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=s2>&quot;column_stack&quot;</span><span class=p>):</span>  <span class=c1># (2)!</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    <span class=o>...</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>    <span class=k>return</span> <span class=n>result1</span><span class=p>,</span> <span class=n>result2</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>MergeFunc</span><span class=p>(</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=n>wrap</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span> 
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>MergeFunc</span><span class=p>(</span><span class=s2>&quot;column_stack&quot;</span><span class=p>,</span> <span class=n>wrap</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=p>):</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>    <span class=o>...</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>    <span class=k>return</span> <span class=n>result1</span><span class=p>,</span> <span class=n>result2</span>
</span></code></pre></div> <ol> <li>Concatenate results</li> <li>Concatenate instances of the first result and column-stack instances of the second result</li> <li>Same as above but provide keyword arguments to each merging function</li> </ol> <h3 id=generation>Generation<a class=headerlink href=#generation title="Permanent link">&para;</a></h3> <p>The grid of parameter combinations can be controlled by individual parameters. By default, vectorbtpro will build a Cartesian product of all parameters. To avoid building the product between some parameters, they can be assigned to the same product <code>level</code>. To filter out unwanted parameter configurations, specify the <code>condition</code> as a boolean expression where variables are parameter names. Such a condition will be evaluated on each parameter combination, and if it returns True, the combination will be kept. To change the appearance of a parameter in the parameter index, <code>keys</code> with human-readable strings can be provided. A parameter can also be hidden entirely by setting <code>hide=True</code>.</p> <div class="language-python highlight"><span class=filename>Various parameter configurations</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>sma_crossover</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>fast_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>slow_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>),</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=p>)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=n>sma_crossover</span><span class=p>(</span>  <span class=c1># (2)!</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>    <span class=n>data</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>    <span class=n>fast_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>    <span class=n>slow_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>),</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=p>)</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>combinations</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=n>combinations</span><span class=p>(</span><span class=n>windows</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>  <span class=c1># (3)!</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=n>sma_crossover</span><span class=p>(</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>    <span class=n>data</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=n>fast_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>    <span class=n>slow_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=p>)</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=n>bbands_indicator</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>    <span class=n>timeperiod</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>timeperiods</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=n>upper_threshold</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>thresholds</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>thresholds</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;threshold&quot;</span><span class=p>)),</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>    <span class=n>lower_threshold</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>thresholds</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>hide</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>    <span class=n>_random_subset</span><span class=o>=</span><span class=mi>1_000</span>  <span class=c1># (5)!</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Build a product of fast and slow windows while removing those where the fast window is longer than the slow window (e.g., 20 and 50 is ok but 50 and 20 doesn't make sense)</li> <li>Same as above but test only one symbol at a time</li> <li>Same as above but build the window combinations manually. The window parameters are now on the same level and won't build another product.</li> <li>Test two parameters: time periods and thresholds. The upper and lower thresholds should both share the same values and only one <code>threshold</code> level should be displayed in the parameter index. Also, select a random subset of 1000 parameter combinations.</li> <li>Arguments that are normally passed to the decorator can be also passed to the function itself by prepending an underscore</li> </ol> <div class="admonition example"> <p class=admonition-title>Example</p> <p>See an example in <a href=../../features/optimization/index.html#conditional-parameters>Conditional parameters</a>.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Testing 6 parameters with only 10 values each would generate staggering 1 million parameter combinations, thus make sure that your grids are not too wide, otherwise the generation part alone will take forever to run. This warning doesn't apply when you use <code>random_subset</code> though; in this case, VBT won't build the full grid but select random combinations dynamically. See an example in <a href=../../features/optimization/index.html#lazy-parameter-grids>Lazy parameter grids</a>.</p> </div> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>We can also use annotations to specify which arguments are parameters and their default configuration.</p> <div class="language-python highlight"><span class=filename>Calculate the SMA crossover for one parameter combination at a time</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>def</span> <span class=nf>sma_crossover</span><span class=p>(</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>fast_window</span><span class=p>:</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>slow_window</span><span class=p>:</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>,</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;column_stack&quot;</span><span class=p>:</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib:sma&quot;</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib:sma&quot;</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>,</span> <span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=n>upper_crossover</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=n>lower_crossover</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=n>signals</span> <span class=o>=</span> <span class=n>upper_crossover</span> <span class=o>|</span> <span class=n>lower_crossover</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    <span class=k>return</span> <span class=n>signals</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=n>signals</span> <span class=o>=</span> <span class=n>sma_crossover</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>)</span>
</span></code></pre></div> <h4 id=pre-generation>Pre-generation<a class=headerlink href=#pre-generation title="Permanent link">&para;</a></h4> <p>To get the generated parameter combinations before (or without) calling the <code>@vbt.parameterized</code> decorator, we can pass the same parameters to <a href=../../api/utils/params/index.html#vectorbtpro.utils.params.combine_params>combine_params</a>.</p> <div class="language-python highlight"><span class=filename>Pre-generate parameter combinations</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>param_product</span><span class=p>,</span> <span class=n>param_index</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>combine_params</span><span class=p>(</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    <span class=n>fast_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    <span class=n>slow_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>)</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=p>)</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=n>param_product</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>combine_params</span><span class=p>(</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    <span class=n>fast_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>    <span class=n>slow_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>windows</span><span class=p>),</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>    <span class=n>build_index</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># (1)!</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Don't build the index. Return only the parameter product.</li> </ol> <h3 id=execution>Execution<a class=headerlink href=#execution title="Permanent link">&para;</a></h3> <p>Each parameter combination involves one call of the pipeline function. To perform multiple calls in parallel, pass a dictionary named <code>execute_kwargs</code> with keyword arguments that should be forwarded to the function <a href=../../api/utils/execution/index.html#vectorbtpro.utils.execution.execute>execute</a>, which takes care of chunking and executing the function calls.</p> <div class="language-python highlight"><span class=filename>Various execution configurations</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>  <span class=c1># (1)!</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=o>...</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>))</span>  <span class=c1># (2)!</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=nd>@njit</span><span class=p>(</span><span class=n>nogil</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>    <span class=o>...</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>n_chunks</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span> <span class=n>distribute</span><span class=o>=</span><span class=s2>&quot;chunks&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;pathos&quot;</span><span class=p>))</span>  <span class=c1># (3)!</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>    <span class=o>...</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>  <span class=c1># (4)!</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=nd>@njit</span><span class=p>(</span><span class=n>nogil</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>    <span class=o>...</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=n>my_pipeline</span><span class=p>(</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>    <span class=o>...</span><span class=p>,</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>    <span class=n>_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>)</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=p>)</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>show_progress</span><span class=o>=</span><span class=kc>False</span><span class=p>))</span>  <span class=c1># (5)!</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=nd>@njit</span><span class=p>(</span><span class=n>nogil</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>    <span class=o>...</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=n>my_pipeline</span><span class=p>(</span>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>    <span class=o>...</span><span class=p>,</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>    <span class=n>_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>)</span>  <span class=c1># (6)!</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=p>)</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=n>my_pipeline</span><span class=p>(</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>    <span class=o>...</span><span class=p>,</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>    <span class=n>_execute_kwargs</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>atomic_dict</span><span class=p>(</span><span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>)</span>  <span class=c1># (7)!</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Execute parameter combinations serially</li> <li>Distribute parameter combinations into chunks of an optimal length, and execute all parameter combinations <strong>within each chunk</strong> in parallel with multithreading (i.e., one parameter combination per thread) while executing chunks themselves serially</li> <li>Divide parameter combinations into an optimal number of chunks, and execute <strong>all chunks</strong> in parallel with multiprocessing (i.e., one chunk per process) while executing all parameter combinations within each chunk serially</li> <li>Parallelization can be enabled/disabled sporadically by prepending an underscore to <code>execute_kwargs</code> and passing it directly to the function</li> <li>If there's already <code>execute_kwargs</code> active in the decorator, they will be merged together. To avoid merging, wrap any of the dicts with <code>vbt.atomic_dict</code>.</li> <li><code>show_progress=False</code></li> <li><code>show_progress=True</code> (default)</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Threads are easier and faster to spawn than processes. Also, to execute a function in its own process, all the passed inputs and parameters need to be serialized and then deserialized, which takes time. Thus, multithreading is preferred, but it requires the function to release the GIL, which means either compiling the function with Numba and setting the <code>nogil</code> flag to True, or using exclusively NumPy.</p> <p>If this isn't possible, use multiprocessing but make sure that the function either doesn't take large arrays, or that one parameter combination takes a considerable amount of time to run. Otherwise, you may find parallelization making the execution even slower.</p> </div> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>To run a code before/after the entire processing or even before/after each individual chunk, <a href=../../api/utils/execution/index.html#vectorbtpro.utils.execution.execute>execute</a> offers a number of callbacks.</p> <div class="language-python highlight"><span class=filename>Clear cache and collect garbage once in 3 chunks</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>def</span> <span class=nf>post_chunk_func</span><span class=p>(</span><span class=n>chunk_idx</span><span class=p>,</span> <span class=n>flush_every</span><span class=p>):</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>    <span class=k>if</span> <span class=p>(</span><span class=n>chunk_idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>flush_every</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>        <span class=n>vbt</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>    <span class=n>post_chunk_func</span><span class=o>=</span><span class=n>post_chunk_func</span><span class=p>,</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=n>post_chunk_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>        <span class=n>chunk_idx</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;chunk_idx&quot;</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;post_chunk_kwargs&quot;</span><span class=p>),</span> 
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>        <span class=n>flush_every</span><span class=o>=</span><span class=mi>3</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>    <span class=p>),</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>    <span class=n>chunk_len</span><span class=o>=</span><span class=mi>10</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=p>)</span>  
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>    <span class=o>...</span>
</span></code></pre></div> <ol> <li>Put 10 calls into one chunk, that is, flush each 30 calls</li> </ol> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>This works not only with <code>@vbt.parameterized</code> but also with other functions that use <a href=../../api/utils/execution/index.html#vectorbtpro.utils.execution.execute>execute</a> with chunking!</p> </div> <h3 id=total-or-partial>Total or partial?<a class=headerlink href=#total-or-partial title="Permanent link">&para;</a></h3> <p>Often, you should make a decision whether your pipeline should be parameterized totally or partially. Total parameterization means running the entire pipeline on each parameter combination, which is the easiest but also the most suitable approach if you have parameters being applied across multiple components of the pipeline, and/or if you want to trade in faster processing for lower memory consumption.</p> <div class="language-python highlight"><span class=filename>Parameterize an entire MA crossover pipeline</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>  
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>def</span> <span class=nf>ma_crossover_sharpe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>fast_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>slow_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_below</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=n>ma_crossover_sharpe</span><span class=p>(</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span> 
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>)</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=p>)</span>
</span></code></pre></div> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>Partial parameterization, on the other hand, is appropriate if you have only a few components in the pipeline where parameters are being applied, and if the remaining components of the pipeline know how to work with the results from the parameterized components. This may lead to a faster execution but also a higher memory consumption.</p> <div class="language-python highlight"><span class=filename>Parameterize only the signal part of a MA crossover pipeline</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>)</span>  
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>def</span> <span class=nf>ma_crossover_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>fast_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>slow_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_below</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>    <span class=k>return</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=k>def</span> <span class=nf>ma_crossover_sharpe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>):</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>ma_crossover_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=n>ma_crossover_sharpe</span><span class=p>(</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span> 
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Parameter combinations become columns in the entry and exit arrays</li> <li>Simulator knows how to handle these additional columns</li> </ol> <h3 id=flat-or-nested>Flat or nested?<a class=headerlink href=#flat-or-nested title="Permanent link">&para;</a></h3> <p>Another decision you should make is whether to handle all parameters by one decorator (flat parameterization) or distribute parameters across multiple decorators to implement a specific parameter hierarchy (nested parameterization). The former approach should be used if you want to treat all of your parameters equally and put them into the same bucket for generation and processing. In this case, the order of the parameters in combinations is defined by the order the parameters are passed to the function. For example, while the values of the first parameter will be processed strictly from the first to the last value, the values of any other parameter will be rotated.</p> <div class="language-python highlight"><span class=filename>Process all parameters at the same time in a MA crossover pipeline</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>  
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=k>def</span> <span class=nf>ma_crossover_sharpe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>symbol</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=n>symbol_data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=n>symbol</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>symbol_data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>fast_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>symbol_data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>slow_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_below</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>symbol_data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=n>ma_crossover_sharpe</span><span class=p>(</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>symbols</span><span class=p>),</span> 
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span> 
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>),</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Symbol selection depends on the symbol only but is run for each combination of <code>symbol</code>, <code>fast_window</code>, and <code>slow_window</code> - unnecessary often!</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>The latter approach should be used if you want to define your own custom parameter hierarchy. For example, you may want to execute (such as parallelize) certain parameters differently, or you may want to reduce the number of invocations of certain parameters, or you may want to introduce special preprocessing and/or postprocessing to certain parameters.</p> <div class="language-python highlight"><span class=filename>First process symbols and then windows in a MA crossover pipeline</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;inner&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>def</span> <span class=nf>symbol_ma_crossover_sharpe</span><span class=p>(</span><span class=n>symbol_data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>symbol_data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>fast_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>symbol_data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>slow_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_below</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>symbol_data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;outer&quot;</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=k>def</span> <span class=nf>ma_crossover_sharpe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>symbol</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>):</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=n>symbol_data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=n>symbol</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=k>return</span> <span class=n>symbol_ma_crossover_sharpe</span><span class=p>(</span><span class=n>symbol_data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=n>ma_crossover_sharpe</span><span class=p>(</span>  <span class=c1># (5)!</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>symbols</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;outer&quot;</span><span class=p>),</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;inner&quot;</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;inner&quot;</span><span class=p>)</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=p>)</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;outer&quot;</span><span class=p>)</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;inner&quot;</span><span class=p>)</span>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=k>def</span> <span class=nf>ma_crossover_sharpe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>  <span class=c1># (6)!</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>fast_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;vbt:ma&quot;</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=n>slow_window</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>ma_crossed_below</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=n>ma_crossover_sharpe</span><span class=p>(</span>
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;outer&quot;</span><span class=p>),</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;inner&quot;</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;fast_window &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>,</span> <span class=n>eval_id</span><span class=o>=</span><span class=s2>&quot;inner&quot;</span><span class=p>)</span>
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Inner decorator that iterates over fast and slow windows</li> <li>Outer decorator that iterates over symbols</li> <li>The same line as in the example above is now run for each symbol only - smart!</li> <li>Call the inner function inside the outer function</li> <li>Call the outer function on all parameters. For each parameter, specify which function it should be evaluated at.</li> <li>Same function can be parameterized multiple times, where each decorator is responsible for evaluation of a subset of the passed parameters</li> </ol> <h3 id=skipping>Skipping<a class=headerlink href=#skipping title="Permanent link">&para;</a></h3> <p>Parameter combinations can be skipped dynamically by returning <a href=../../api/utils/params/index.html#vectorbtpro.utils.params.NoResult>NoResult</a> instead of the actual result.</p> <div class="language-python highlight"><span class=filename>Skip the parameter combination if an error occurred</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>        <span class=o>...</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>        <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>NoResult</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=n>results</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>),</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>)</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=p>)</span>
</span></code></pre></div> <h2 id=hybrid-mono-chunks>Hybrid (mono-chunks)<a class=headerlink href=#hybrid-mono-chunks title="Permanent link">&para;</a></h2> <p>The approach above calls the original function on each single parameter combination, which makes it slow when dealing with a large number of combinations, especially when each function call is associated with an overhead, such as when NumPy array gets converted to a Pandas object. Remember that 1 millisecond of an overhead translates into 17 minutes of additional execution time for one million of combinations. </p> <p>There's nothing (apart from parallelization) we can do to speed up functions that take only one combination at a time. But if the function can be adapted to accept multiple combinations, where each parameter argument becomes an array instead of a single value, we can instruct <code>@vbt.parameterized</code> to merge all combinations into chunks and call the function on each chunk. This way, we can reduce the number of function calls significantly.</p> <div class="language-python highlight"><span class=filename>Test a grid of parameters using mono-chunks</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>mono_n_chunks</span><span class=o>=</span><span class=err>?</span><span class=p>,</span> <span class=n>mono_chunk_len</span><span class=o>=</span><span class=err>?</span><span class=p>,</span> <span class=n>mono_chunk_meta</span><span class=o>=</span><span class=err>?</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>):</span>  <span class=c1># (2)!</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>    <span class=o>...</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>    <span class=k>return</span> <span class=n>result</span>  <span class=c1># (3)!</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=n>results</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>),</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>)</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=p>)</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>mono_n_chunks</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=o>...</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=c1># ______________________________________________________________</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>mono_chunk_len</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>  <span class=c1># (6)!</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=o>...</span>
</span></code></pre></div> <ol> <li>Instruct VBT to build chunks out of parameter combinations. You can use <code>mono_n_chunks</code> to specify the target number of chunks, or <code>mono_chunk_len</code> to specify the max number of combinations in each chunk, or <code>mono_chunk_meta</code> to specify the chunk metadata directly.</li> <li>Function now must take multiple values <code>fast_windows</code> and <code>slow_windows</code> instead of single values <code>fast_window</code> and <code>slow_window</code>. One set of values will contain combinations that belong to the same chunk.</li> <li>Do some calculations on the received parameter combinations and return a result (which should contain a result for each parameter combination)</li> <li>Run the function the same way as before</li> <li>Build the same number of chunks as there are CPU cores</li> <li>Build chunks with at most 100 combinations each</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>By default, parameter values are passed as lists to the original function. To pass them as arrays or in any other format instead, set a merging function <code>mono_merge_func</code> for each parameter.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>my_pipeline</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=n>param_a</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>param_a</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>param_b</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>param_b</span><span class=p>,</span> <span class=n>mono_reduce</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>param_c</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>param_c</span><span class=p>,</span> <span class=n>mono_merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    <span class=n>param_d</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>param_d</span><span class=p>,</span> <span class=n>mono_merge_func</span><span class=o>=</span><span class=s2>&quot;row_stack&quot;</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=n>param_e</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>param_e</span><span class=p>,</span> <span class=n>mono_merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>),</span>  <span class=c1># (5)!</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=n>param_f</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>param_f</span><span class=p>,</span> <span class=n>mono_merge_func</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>MergeFunc</span><span class=p>(</span><span class=o>...</span><span class=p>))</span>  <span class=c1># (6)!</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Will put chunk values into a list</li> <li>Same as above but will return a single value if all values in the chunk are the same</li> <li>Will concatenate values into a NumPy array or Pandas Series</li> <li>Will stack chunk values along rows into a NumPy array or Pandas Series/DataFrame</li> <li>Will stack chunk values along columns into a NumPy array or Pandas DataFrame</li> <li>Will merge chunk values using a custom merging function</li> </ol> <p>Execution is done in the same way as in <a href=#parameterization>Parameterization</a> and chunks can be easily parallelized, just keep an eye on RAM consumption since now multiple parameter combinations are executed at the same time.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p>See an example in <a href=../../features/optimization/index.html#mono-chunks>Mono-chunks</a>.</p> </div> <h2 id=chunking>Chunking<a class=headerlink href=#chunking title="Permanent link">&para;</a></h2> <p>Chunking revolves around splitting a value (such as an array) of one or more arguments into many parts (or chunks), calling the function on each part, and then merging all parts together. This way, we can instruct VBT to process only a subset of data at a time, which is helpful in both reducing RAM consumption and increasing performance by utilizing parallelization. Chunking is also highly convenient: usually, you don't have to change your function in any way, and you'll get the same results regardless of whether chunking was enabled or disabled. To use chunking, create a pipeline function, decorate it with <a href=../../api/utils/chunking/index.html#vectorbtpro.utils.chunking.chunked><code>@vbt.chunked</code></a>, and specify how exactly arguments should be chunked and results should be merged.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p>See an example in <a href=../../features/performance/index.html#chunking>Chunking</a>.</p> </div> <h3 id=decoration_1>Decoration<a class=headerlink href=#decoration_1 title="Permanent link">&para;</a></h3> <p>To make any function chunkable, we have to decorate (or wrap) it with <code>@vbt.chunked</code>. This will return a new function with the same name and arguments as the original one. The only difference: this new function will process passed arguments, chunk the arguments, call the original function on each chunk of the arguments, and merge the results of all chunks.</p> <div class="language-python highlight"><span class=filename>Process only a subset of values at a time</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>chunked</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=o>...</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=k>return</span> <span class=n>result</span>  <span class=c1># (2)!</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=n>results</span> <span class=o>=</span> <span class=n>my_pipeline</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Chunked</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Chunked</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>)</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Arguments can be anything. Here we're expecting a data instance, and already combined fast and slow windows, as in <a href=#hybrid-mono-chunks>Hybrid (mono-chunks)</a></li> <li>Do some calculations on the received chunk of values and return an result, which can be anything</li> <li>Run the function the same way as without the decorator</li> <li>Wrap any chunkable argument with <code>vbt.Chunked</code> or other class</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>To keep the original function separate from the decorated one, we can decorate it after it has been defined and give the decorated function another name.</p> <div class="language-python highlight"><span class=filename>Decorate a function later</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>):</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    <span class=o>...</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=n>my_chunked_pipeline</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>chunked</span><span class=p>(</span><span class=n>my_pipeline</span><span class=p>)</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=n>results</span> <span class=o>=</span> <span class=n>my_chunked_pipeline</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></code></pre></div> <h3 id=specification>Specification<a class=headerlink href=#specification title="Permanent link">&para;</a></h3> <p>To chunk an argument, we must provide a chunking specification for that argument. There are three main ways on how to provide such a specification.</p> <p>Approach 1: Pass a dictionary <code>arg_take_spec</code> to the decorator. The most capable approach as it allows chunking of any nested objects of arbitrary depths, such as lists inside lists.</p> <div class="language-python highlight"><span class=filename>Specify chunking rules via arg_take_spec</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>chunked</span><span class=p>(</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>    <span class=n>arg_take_spec</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>        <span class=n>array1</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>        <span class=n>array2</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>        <span class=n>combine_func</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>NotChunked</span>  <span class=c1># (3)!</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>    <span class=p>),</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>    <span class=n>size</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>ArraySizer</span><span class=p>(</span><span class=n>arg_query</span><span class=o>=</span><span class=s2>&quot;array1&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span>  <span class=c1># (5)!</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=p>)</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=k>def</span> <span class=nf>combine_arrays</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>,</span> <span class=n>combine_func</span><span class=p>):</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>    <span class=k>return</span> <span class=n>combine_func</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>)</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=n>new_array</span> <span class=o>=</span> <span class=n>combine_arrays</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Dictionary where keys are argument names and values are chunking rules for those arguments</li> <li>Split arguments <code>array1</code> and <code>array2</code> along columns. They must be multidimensional NumPy or Pandas arrays.</li> <li>Provide rules for all arguments. If any argument is missing in <code>arg_take_spec</code>, a warning will be thrown.</li> <li>Specify where the total size should be taken from. It's required to build chunks. This is mostly optional as newer versions of VBT can parse it automatically.</li> <li>Merging function must depend on the chunking arrays. Here, we should stack columns of output arrays back together.</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>Approach 2: Annotate the function. The most convenient approach as you can specify chunking rules next to their respective arguments directly in the function definition.</p> <div class="language-python highlight"><span class=filename>Specify chunking rules via annotations</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>chunked</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=k>def</span> <span class=nf>combine_arrays</span><span class=p>(</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    <span class=n>array1</span><span class=p>:</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>|</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ArraySizer</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    <span class=n>array2</span><span class=p>:</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> 
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    <span class=n>combine_func</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;column_stack&quot;</span><span class=p>:</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>    <span class=k>return</span> <span class=n>combine_func</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>)</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=n>new_array</span> <span class=o>=</span> <span class=n>combine_arrays</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Multiple VBT annotations can be combined with an <code>|</code> operator. Also, it doesn't matter whether a chunking annotation is provided as a class or an instance. Providing the sizer is mostly optional as newer versions of VBT can parse it automatically.</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>Approach 3: Wrap argument values directly. Allows switching chunking rules on the fly.</p> <div class="language-python highlight"><span class=filename>Specify chunking rules via argument values</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>chunked</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>def</span> <span class=nf>combine_arrays</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>,</span> <span class=n>combine_func</span><span class=p>):</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>    <span class=k>return</span> <span class=n>combine_func</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>array2</span><span class=p>)</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=n>new_array</span> <span class=o>=</span> <span class=n>combine_arrays</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>array1</span><span class=p>),</span> 
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>array2</span><span class=p>),</span> 
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>    <span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>,</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>    <span class=n>_size</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>array1</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>    <span class=n>_merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=p>)</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=n>new_array</span> <span class=o>=</span> <span class=n>combine_arrays</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> 
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>array2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> 
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a>    <span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>,</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>    <span class=n>_size</span><span class=o>=</span><span class=n>array1</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a>    <span class=n>_merge_func</span><span class=o>=</span><span class=s2>&quot;row_stack&quot;</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=p>)</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=n>new_array</span> <span class=o>=</span> <span class=n>combine_arrays</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>array1</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> 
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>ChunkedArray</span><span class=p>(</span><span class=n>array2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> 
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a>    <span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>,</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a>    <span class=n>_size</span><span class=o>=</span><span class=n>array1</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a>    <span class=n>_merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Split one-dimensional input arrays and concatenate output arrays back together</li> <li>Providing the total size is mostly optional as newer versions of VBT can parse it automatically</li> <li>Split two-dimensional input arrays along rows and stack rows of output arrays back together</li> <li>Split two-dimensional input arrays along columns and stack columns of output arrays back together</li> </ol> <p>Merging and execution are done in the same way as in <a href=#parameterization>Parameterization</a>.</p> <h2 id=hybrid-super-chunks>Hybrid (super-chunks)<a class=headerlink href=#hybrid-super-chunks title="Permanent link">&para;</a></h2> <p><a href=#parameterization>Parameterized decorator</a> and chunked decorator can be combined to process only a subset of parameter combinations at a time without the need of changing the function's design as in <a href=#hybrid-mono-chunks>Hybrid (mono-chunks)</a>. Even though super-chunking may not be as fast as mono-chunking, it's still beneficiary when you want to process only a subset of parameter combinations at a time (but not all, otherwise, you should just use <code>distribute="chunks"</code> in the parameterized decorator without a chunked decorator) to keep RAM consumption in check, or when you want do some preprocessing and/or postprocessing such as flushing per bunch of parameter combinations.</p> <div class="language-python highlight"><span class=filename>Execute at most n parameter combinations per process</span><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=k>def</span> <span class=nf>my_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>    <span class=o>...</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>chunked</span><span class=p>(</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>    <span class=n>chunk_len</span><span class=o>=</span><span class=err>?</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>    <span class=n>execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;pathos&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=p>)</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=k>def</span> <span class=nf>chunked_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_windows</span><span class=p>,</span> <span class=n>slow_windows</span><span class=p>):</span>  <span class=c1># (4)!</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>    <span class=k>return</span> <span class=n>my_pipeline</span><span class=p>(</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>        <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>        <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> 
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>        <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>    <span class=p>)</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=n>param_product</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>combine_params</span><span class=p>({</span>  <span class=c1># (5)!</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>    <span class=s2>&quot;fast_windows&quot;</span><span class=p>:</span> <span class=n>fast_windows</span><span class=p>,</span> 
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>    <span class=s2>&quot;slow_windows&quot;</span><span class=p>:</span> <span class=n>slow_windows</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=p>},</span> <span class=n>build_index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=n>chunked_pipeline</span><span class=p>(</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Chunked</span><span class=p>(</span><span class=n>param_product</span><span class=p>[</span><span class=s2>&quot;fast_windows&quot;</span><span class=p>]),</span> 
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Chunked</span><span class=p>(</span><span class=n>param_product</span><span class=p>[</span><span class=s2>&quot;slow_windows&quot;</span><span class=p>])</span>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Parameterized function expects a single parameter combination where each parameter argument is a single value</li> <li>Split each sequence of parameter values into chunks of n elements each</li> <li>Build super-chunks out of chunks where chunks within each super-chunk are executed in parallel and super-chunks themselves are executed serially</li> <li>Chunked function expects a grid of parameter combinations where each parameter argument is a sequence of values. All sequences must have the same length. </li> <li>Build a grid of parameter combinations</li> </ol> <h2 id=raw-execution>Raw execution<a class=headerlink href=#raw-execution title="Permanent link">&para;</a></h2> <p>Whenever VBT needs to execute one function on multiple sets of arguments, it uses the function <a href=../../api/utils/execution/index.html#vectorbtpro.utils.execution.execute>execute</a>, which takes a list of tasks (functions and their arguments) and executes them with an engine selected by the user. This function takes all the same arguments that you usually pass inside <code>execute_kwargs</code>.</p> <div class="language-python highlight"><span class=filename>Execute multiple indicator configurations in parallel</span><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=n>sma_func</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib_func</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>ema_func</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib_func</span><span class=p>(</span><span class=s2>&quot;ema&quot;</span><span class=p>)</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Task</span><span class=p>(</span><span class=n>sma_func</span><span class=p>,</span> <span class=n>arr</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Task</span><span class=p>(</span><span class=n>sma_func</span><span class=p>,</span> <span class=n>arr</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Task</span><span class=p>(</span><span class=n>ema_func</span><span class=p>,</span> <span class=n>arr</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=n>vbt</span><span class=o>.</span><span class=n>Task</span><span class=p>(</span><span class=n>ema_func</span><span class=p>,</span> <span class=n>arr</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=p>]</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=n>keys</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>MultiIndex</span><span class=o>.</span><span class=n>from_tuples</span><span class=p>([</span>  <span class=c1># (2)!</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>    <span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>    <span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>    <span class=p>(</span><span class=s2>&quot;ema&quot;</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    <span class=p>(</span><span class=s2>&quot;ema&quot;</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=p>],</span> <span class=n>names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;indicator&quot;</span><span class=p>,</span> <span class=s2>&quot;timeperiod&quot;</span><span class=p>])</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=n>indicators_df</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>    <span class=n>tasks</span><span class=p>,</span> 
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a>    <span class=n>keys</span><span class=o>=</span><span class=n>keys</span><span class=p>,</span> 
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>,</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>    <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span>
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=p>)</span>
</span></code></pre></div> <ol> <li>Each task consists of the function as well as the (positional and keyword) arguments it takes</li> <li>Keys are displayed in the progress bar as well as in the columns of our new DataFrame</li> <li>Execute tasks in separate threads and merge them into a DataFrame</li> </ol> <div class=separator-container> <hr class=separator> <span class=separator-text>/</span> <hr class=separator> </div> <p>If you want to parallelize a workflow within a for-loop, put it into a function and decorate that function with <a href=../../api/utils/execution/index.html#vectorbtpro.utils.execution.iterated>iterated</a>. Then, when executing the decorated function, pass a total number of iterations or a range in place of the argument where you expect the iteration variable.</p> <div class="language-python highlight"><span class=filename>Execute a regular for-loop in parallel</span><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># ______________________________ FROM ______________________________</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=n>keys</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=k>for</span> <span class=n>timeperiod</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>5</span><span class=p>):</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>sma_func</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>)</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>    <span class=n>keys</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>timeperiod</span><span class=p>)</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=n>keys</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>keys</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;timeperiod&quot;</span><span class=p>)</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=n>sma_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span> <span class=n>results</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>keys</span><span class=p>)</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=c1># ______________________________ TO ______________________________</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>iterated</span><span class=p>(</span><span class=n>over_arg</span><span class=o>=</span><span class=s2>&quot;timeperiod&quot;</span><span class=p>,</span> <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>)</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=k>def</span> <span class=nf>sma</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>):</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>    <span class=k>return</span> <span class=n>sma_func</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>)</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=n>sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>iterated</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>    <span class=n>sma_func</span><span class=p>,</span> 
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>    <span class=n>over_arg</span><span class=o>=</span><span class=s2>&quot;timeperiod&quot;</span><span class=p>,</span> 
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>    <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>,</span> 
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=p>)</span>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=n>sma_df</span> <span class=o>=</span> <span class=n>sma</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span></code></pre></div> <ol> <li>Another way of decorating a function</li> </ol> <div class="language-python highlight"><span class=filename>Execute a nested for-loop in parallel</span><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># ______________________________ FROM ______________________________</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=n>keys</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=k>for</span> <span class=n>fast_window</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>5</span><span class=p>):</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>    <span class=k>for</span> <span class=n>slow_window</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>5</span><span class=p>):</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>        <span class=k>if</span> <span class=n>fast_window</span> <span class=o>&lt;</span> <span class=n>slow_window</span><span class=p>:</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>            <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>sma_func</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>)</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>            <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>sma_func</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>)</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>fast_sma</span> <span class=o>-</span> <span class=n>slow_sma</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>            <span class=n>keys</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>))</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=n>keys</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>MultiIndex</span><span class=o>.</span><span class=n>from_tuples</span><span class=p>(</span><span class=n>keys</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;fast_window&quot;</span><span class=p>,</span> <span class=s2>&quot;slow_window&quot;</span><span class=p>])</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=n>sma_diff_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span> <span class=n>results</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>keys</span><span class=p>)</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=c1># ______________________________ TO ______________________________</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>iterated</span><span class=p>(</span><span class=n>over_arg</span><span class=o>=</span><span class=s2>&quot;fast_window&quot;</span><span class=p>,</span> <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;pathos&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=nd>@vbt</span><span class=o>.</span><span class=n>iterated</span><span class=p>(</span><span class=n>over_arg</span><span class=o>=</span><span class=s2>&quot;slow_window&quot;</span><span class=p>,</span> <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>,</span> <span class=n>raise_no_results</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=k>def</span> <span class=nf>sma_diff</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>    <span class=k>if</span> <span class=n>fast_window</span> <span class=o>&gt;=</span> <span class=n>slow_window</span><span class=p>:</span>
</span><span id=__span-24-22><a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>        <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>NoResult</span>
</span><span id=__span-24-23><a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>sma_func</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>)</span>
</span><span id=__span-24-24><a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>sma_func</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>)</span>
</span><span id=__span-24-25><a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>    <span class=k>return</span> <span class=n>fast_sma</span> <span class=o>-</span> <span class=n>slow_sma</span>
</span><span id=__span-24-26><a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>
</span><span id=__span-24-27><a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=n>sma_diff_df</span> <span class=o>=</span> <span class=n>sma_diff</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>5</span><span class=p>),</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span></code></pre></div> <ol> <li>Execute the outer loop in parallel using multiprocessing</li> </ol> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../indicators/index.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Indicators"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Indicators </div> </div> </a> <a href=../persistence/index.html class="md-footer__link md-footer__link--next" aria-label="Next: Persistence"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Persistence </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2024 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.sections", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.ede584c9.min.js></script> <script src=../../assets/scripts/extra.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/cookbook/optimization/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 16:01:54 GMT -->
</html>