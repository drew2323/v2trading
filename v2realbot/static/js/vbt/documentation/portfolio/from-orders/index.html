<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/documentation/portfolio/from-orders/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:50:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation on portfolio simulation based on orders"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/documentation/portfolio/from-orders/ rel=canonical><link href=../index.html rel=prev><link href=../from-signals/index.html rel=next><link rel=icon href=../../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.18+insiders-4.53.6"><title>From orders - VectorBT PRO</title><link rel=stylesheet href=../../../assets/stylesheets/main.d5b5f0fd.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><link rel=stylesheet href=../../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0C5VNYCFHL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=robots content=noindex><meta property=og:title content="From orders"><meta property=og:type content=website><meta content=https://vectorbt.pro/documentation/portfolio/from-orders/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_54404668/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Documentation on portfolio simulation based on orders"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=../../../assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=../../../assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=../../../assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../assets/logo/favicon-16x16.png><link rel=manifest href=../../../assets/logo/site.webmanifest><link rel=mask-icon href=../../../assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=../../../assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_54404668/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#from-orders class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <i>New</i>: Smart Money Concepts, Hurst exponent, tasks, iterated decorator, and <a href=../../../features/index.html><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.2c0 13.1 5.4 25.7 14.9 34.7l84.7 80.8c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9z"/></svg></span> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=../../../index.html title="VectorBT PRO" class="md-header__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../../assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT PRO <span class=md-version> v2024.6.19 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224 64c-44.2 0-80 35.8-80 80v48h240c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16v-48C80 64.5 144.5 0 224 0c57.5 0 107 33.7 130.1 82.3 7.6 16 .8 35.1-15.2 42.6s-35.1.8-42.6-15.2C283.4 82.6 255.9 64 224 64zm32 320c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32s14.3 32 32 32h64z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> From orders </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.html class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=../../../features/overview/index.html class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/overview/index.html class=md-tabs__link> Tutorials </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../overview/index.html class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../../api/index.html class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../../cookbook/overview/index.html class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=../../../terms/terms-of-use/index.html class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title="VectorBT PRO" class="md-nav__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../../assets/logo/logo.svg alt=logo class=logo> </a> VectorBT PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../features/overview/index.html class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../tutorials/overview/index.html class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../fundamentals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 7a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2H3m0 2h2v2H3m12-.5V9a2 2 0 0 0-2-2H9v10h4a2 2 0 0 0 2-2v-1.5a1.54 1.54 0 0 0-1.5-1.5 1.54 1.54 0 0 0 1.5-1.5M13 15h-2v-2h2v2m0-4h-2V9h2m6-2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-1h-2v1h-2V9h2v1h2V9a2 2 0 0 0-2-2Z"/></svg> <span class=md-ellipsis> Fundamentals </span> </a> </li> <li class=md-nav__item> <a href=../../building-blocks/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9M12 4.15 6.04 7.5 12 10.85l5.96-3.35L12 4.15M5 15.91l6 3.38v-6.71L5 9.21v6.7m14 0v-6.7l-6 3.37v6.71l6-3.38Z"/></svg> <span class=md-ellipsis> Building blocks </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../../data/local/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 20H4a2 2 0 0 1-2-2V6c0-1.11.89-2 2-2h6l2 2h7a2 2 0 0 1 2 2H4v10l2.14-8h17.07l-2.28 8.5c-.23.87-1.01 1.5-1.93 1.5Z"/></svg> <span class=md-ellipsis> Local </span> </a> </li> <li class=md-nav__item> <a href=../../data/remote/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg> <span class=md-ellipsis> Remote </span> </a> </li> <li class=md-nav__item> <a href=../../data/synthetic/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 1-1.26 2.75L15 5l2.74 1.26L19 9l1.25-2.74L23 5l-2.75-1.25M9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5M19 15l-1.26 2.74L15 19l2.74 1.25L19 23l1.25-2.75L23 19l-2.75-1.26"/></svg> <span class=md-ellipsis> Synthetic </span> </a> </li> <li class=md-nav__item> <a href=../../data/scheduling/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a7 7 0 0 1-7-7 7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7m7.03-12.61 1.42-1.42c-.45-.51-.9-.97-1.41-1.41L17.62 6c-1.55-1.26-3.5-2-5.62-2a9 9 0 0 0-9 9 9 9 0 0 0 9 9c5 0 9-4.03 9-9 0-2.12-.74-4.07-1.97-5.61M11 14h2V8h-2m4-7H9v2h6V1Z"/></svg> <span class=md-ellipsis> Scheduling </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex> <span class=md-ellipsis> Indicators </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Indicators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class=md-nav__item> <a href=../../indicators/development/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 3c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m.2 1.5 1.06 1.05L5.27 9.5 2.74 6.95 3.81 5.9l1.47 1.49M4 13c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2v-4c0-1.11-.89-2-2-2m-4 2h4v4H4m8-14h10v2H12m0 12v-2h10v2m-10-8h10v2H12Z"/></svg> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=../../indicators/analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 8c-1.5 0-2.3 1.4-1.9 2.5l-3.6 3.6c-.3-.1-.7-.1-1 0l-2.6-2.6c.4-1.1-.4-2.5-1.9-2.5-1.4 0-2.3 1.4-1.9 2.5L3.5 16c-1.1-.3-2.5.5-2.5 2 0 1.1.9 2 2 2 1.4 0 2.3-1.4 1.9-2.5l4.5-4.6c.3.1.7.1 1 0l2.6 2.6c-.3 1 .5 2.5 2 2.5s2.3-1.4 1.9-2.5l3.6-3.6c1.1.3 2.5-.5 2.5-1.9 0-1.1-.9-2-2-2m-6 1 .9-2.1L18 6l-2.1-.9L15 3l-.9 2.1L12 6l2.1.9L15 9M3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9l.5 2Z"/></svg> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../indicators/parsers/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.6 16.6 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4m-5.2 0L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4Z"/></svg> <span class=md-ellipsis> Parsers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6 checked> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex> <span class=md-ellipsis> Portfolio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=true> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Portfolio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2v20h20V2H2m18 10h-4v4h4v4h-4v-4h-4v4H8v-4H4v-4h4V8H4V4h4v4h4V4h4v4h4v4m-4-4v4h-4V8h4m-4 4v4H8v-4h4Z"/></svg> <span class=md-ellipsis> From orders </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2v20h20V2H2m18 10h-4v4h4v4h-4v-4h-4v4H8v-4H4v-4h4V8H4V4h4v4h4V4h4v4h4v4m-4-4v4h-4V8h4m-4 4v4H8v-4h4Z"/></svg> <span class=md-ellipsis> From orders </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#numba class=md-nav__link> <span class=md-ellipsis> Numba </span> </a> <nav class=md-nav aria-label=Numba> <ul class=md-nav__list> <li class=md-nav__item> <a href=#order-fields class=md-nav__link> <span class=md-ellipsis> Order fields </span> </a> </li> <li class=md-nav__item> <a href=#grouping class=md-nav__link> <span class=md-ellipsis> Grouping </span> </a> </li> <li class=md-nav__item> <a href=#call-sequence class=md-nav__link> <span class=md-ellipsis> Call sequence </span> </a> </li> <li class=md-nav__item> <a href=#filling-returns class=md-nav__link> <span class=md-ellipsis> Filling returns </span> </a> </li> <li class=md-nav__item> <a href=#initial-state class=md-nav__link> <span class=md-ellipsis> Initial state </span> </a> </li> <li class=md-nav__item> <a href=#cash-deposits class=md-nav__link> <span class=md-ellipsis> Cash deposits </span> </a> </li> <li class=md-nav__item> <a href=#cash-earnings class=md-nav__link> <span class=md-ellipsis> Cash earnings </span> </a> </li> <li class=md-nav__item> <a href=#max-record-count class=md-nav__link> <span class=md-ellipsis> Max record count </span> </a> </li> <li class=md-nav__item> <a href=#jitting class=md-nav__link> <span class=md-ellipsis> Jitting </span> </a> </li> <li class=md-nav__item> <a href=#chunking class=md-nav__link> <span class=md-ellipsis> Chunking </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#class-method class=md-nav__link> <span class=md-ellipsis> Class method </span> </a> <nav class=md-nav aria-label="Class method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#close-price class=md-nav__link> <span class=md-ellipsis> Close price </span> </a> </li> <li class=md-nav__item> <a href=#defaults class=md-nav__link> <span class=md-ellipsis> Defaults </span> </a> </li> <li class=md-nav__item> <a href=#enums class=md-nav__link> <span class=md-ellipsis> Enums </span> </a> </li> <li class=md-nav__item> <a href=#broadcasting class=md-nav__link> <span class=md-ellipsis> Broadcasting </span> </a> </li> <li class=md-nav__item> <a href=#grouping_1 class=md-nav__link> <span class=md-ellipsis> Grouping </span> </a> </li> <li class=md-nav__item> <a href=#call-sequence_1 class=md-nav__link> <span class=md-ellipsis> Call sequence </span> </a> </li> <li class=md-nav__item> <a href=#unlimited-cash class=md-nav__link> <span class=md-ellipsis> Unlimited cash </span> </a> </li> <li class=md-nav__item> <a href=#output-arrays class=md-nav__link> <span class=md-ellipsis> Output arrays </span> </a> </li> <li class=md-nav__item> <a href=#max-record-count_1 class=md-nav__link> <span class=md-ellipsis> Max record count </span> </a> </li> <li class=md-nav__item> <a href=#data-type-checks class=md-nav__link> <span class=md-ellipsis> Data type checks </span> </a> </li> <li class=md-nav__item> <a href=#jitting_1 class=md-nav__link> <span class=md-ellipsis> Jitting </span> </a> </li> <li class=md-nav__item> <a href=#chunking_1 class=md-nav__link> <span class=md-ellipsis> Chunking </span> </a> </li> <li class=md-nav__item> <a href=#use-cases class=md-nav__link> <span class=md-ellipsis> Use cases </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../from-signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> From signals </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../to-be-continued/index.html class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/index.html class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../cookbook/overview/index.html class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../terms/terms-of-use/index.html class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../../overview/index.html class=md-path__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-path__item> <a href=../index.html class=md-path__link> <span class=md-ellipsis> Portfolio </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=from-orders><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2v20h20V2H2m18 10h-4v4h4v4h-4v-4h-4v4H8v-4H4v-4h4V8H4V4h4v4h4V4h4v4h4v4m-4-4v4h-4V8h4m-4 4v4H8v-4h4Z"/></svg></span> From orders<a class=headerlink href=#from-orders title="Permanent link">&para;</a></h1> <p>Instead of building our custom simulator from scratch, we can make use of one of the preset simulation methods offered by vectorbt. There are three predominantly used methods: <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a>, <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_signals>Portfolio.from_signals</a>, and <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_order_func>Portfolio.from_order_func</a>. Each one has its own benefits and drawbacks, but all of them follow the same iteration schema that we discussed previously: iterate over the rows and columns, and at each step, convert the current element of all the input data passed by the user into an order request, and process it by updating the current simulation state and by appending the filled order record to an array. This array along with other information can later be used during the reconstruction phase to analyze the simulation.</p> <p><a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> is the most basic method out of three: it doesn't take any UDFs, and allows us to provide every bit of information on orders as separate, broadcastable arrays. Literally <strong>each</strong> element across all the passed arrays will be converted into an instance of <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.Order>Order</a> and processed as usual. Since the number of orders is limited by the number of elements in the passed arrays, we can issue <strong>and execute</strong> only one order per timestamp and asset.</p> <p>For example, passing <code>[0.1, -0.1, np.nan]</code> as the order size array and <code>[11, 10, 12]</code> as the order price array will generate three orders at three subsequent timestamps:</p> <ol> <li>Buy 0.1 shares for $11</li> <li>Sell 0.1 shares for $10</li> <li>Do nothing (size of NaN gets ignored)</li> </ol> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>This method should be used when you know exactly what to order at each timestamp. And, as practice shows, many types of signals and other inputs can be successfully converted into an order format for a nice speedup. For example, if your entries and exits are cleaned (i.e., one exit comes exactly after one entry and vice versa), you can convert them to order size using <code>entries.astype(int) - exits.astype(int)</code>, which will order 1 share once a signal is encountered, in both directions.</p> </div> <h2 id=numba>Numba<a class=headerlink href=#numba title="Permanent link">&para;</a></h2> <p>The backbone of this method is the Numba-compiled function <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>, which is the fastest simulation function out of three, but also the only one that can be (and is) safely cached in Numba because it doesn't depend on any complex or global data. It's also using flexible indexing, it's registered as a chunkable function, and it can be parallelized by Numba with a single command. </p> <p>The arguments of this simulation function include some arguments we've encountered in the documentation on simulation: target shape, group lengths, initial cash, and some others. The arguments we haven't seen before include the call sequence array, initial state arrays (such as <code>init_position</code>), continuous state change arrays (such as <code>cash_deposits</code>), order information arrays (such as <code>size</code>), and various flags for controlling the simulation process (such as <code>save_returns</code>). Also, most arguments have sensitive default values that are consistent across most Numba-compiled functions defined in <a href=../../../api/portfolio/nb/index.html >portfolio.nb</a>.</p> <h3 id=order-fields>Order fields<a class=headerlink href=#order-fields title="Permanent link">&para;</a></h3> <p>Every single field in the named tuple <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.Order>Order</a> is present as an argument in the signature of this simulation function, and can be provided in a format suitable for flexible indexing.</p> <p>Let's simulate the three orders we mentioned above:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbtpro</span> <span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mf>0.1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=mf>0.1</span><span class=p>],</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>11</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=p>[</span><span class=mi>12</span><span class=p>]])</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=go>array([(0, 0, 0, 0.1, 11., 0., 0), (1, 0, 1, 0.1, 10., 0., 1)],</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=go>      dtype={&#39;names&#39;:[&#39;id&#39;,&#39;col&#39;,&#39;idx&#39;,&#39;size&#39;,&#39;price&#39;,&#39;fees&#39;,&#39;side&#39;], ...})</span>
</span></code></pre></div> <ol> <li>Target shape must be two-dimensional, <code>3</code> and <code>(3,)</code> are not allowed</li> <li>We must provide a one-dimensional group lengths array, which without column grouping is just an array of ones (one group per column)</li> <li>Make size and price arrays of the same shape as <code>target_shape</code> for now</li> </ol> <p>The result of the simulation is an instance of the named tuple <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SimulationOutput>SimulationOutput</a>, which consists of the filled order and log records, and other supporting information for post-analysis:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>sim_out</span><span class=p>))</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=go>SimulationOutput(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=go>    order_records=&lt;numpy.ndarray object at 0x7f88606d5710 of shape (2,)&gt;,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=go>    log_records=&lt;numpy.ndarray object at 0x7f8860907fa8 of shape (0,)&gt;,</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=go>    cash_deposits=&lt;numpy.ndarray object at 0x7f8860907f50 of shape (1, 1)&gt;,</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=go>    cash_earnings=&lt;numpy.ndarray object at 0x7f8860a355b0 of shape (1, 1)&gt;,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=go>    call_seq=None,</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=go>    in_outputs=FSInOutputs(</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=go>        returns=&lt;numpy.ndarray object at 0x7f88a1976fa8 of shape (0, 0)&gt;</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=go>    )</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=go>)</span>
</span></code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Despite the fact that we didn't instruct vectorbt to create an array with log records, cash deposits, and cash earnings, we still see those arrays in the simulation output. Because Numba has difficulties in processing optional writable arrays, we cannot make those outputs <code>None</code>, but instead, we create empty arrays with ultra-small shapes to denote that they should be ignored during post-analysis.</p> </div> <p>Here's a basic helper function to pretty-print order records:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>print_orders</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>order_records</span><span class=p>):</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=gp>... </span>    <span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ArrayWrapper</span><span class=o>.</span><span class=n>from_shape</span><span class=p>(</span><span class=n>target_shape</span><span class=p>)</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Orders</span><span class=p>(</span><span class=n>wrapper</span><span class=p>,</span> <span class=n>order_records</span><span class=p>)</span><span class=o>.</span><span class=n>readable</span><span class=p>)</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees  Side</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=go>0         0       0          0   0.1   11.0   0.0   Buy</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=go>1         1       0          1   0.1   10.0   0.0  Sell</span>
</span></code></pre></div> <p>To apply any information on <strong>every</strong> element, we can provide a scalar. This works because most simulation methods convert any scalar into a two-dimensional array suitable for <a href=../index.html#flexible-indexing>flexible indexing</a> automatically! We can also provide any information that should be applied per row, such as price, as a one-dimensional array, like this:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]),</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>]),</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=mf>0.01</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=go>   Order Id  Column  Timestamp  Size  Price   Fees  Side</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=go>0         0       0          0   0.1   11.0  0.011   Buy</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=go>1         1       0          1   0.1   10.0  0.010  Sell</span>
</span></code></pre></div> <ol> <li>Apply 1% commission on all orders</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Default broadcasting rules of vectorbt are slightly different from the NumPy broadcasting rules: in NumPy, <code>(3,)</code> will broadcast along columns in the shape <code>(3, 1)</code>, but vectorbt assumes that flexible two-dimensional arrays are always time series and thus are provided per row.</p> </div> <p>If we want to provide any information per column instead, we always need wrap it into a two-dimensional array. We can additionally make this array have only one row to apply information to all rows. Let's test multiple size values by providing them per column, while the price is provided per row:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>]),</span>  <span class=c1># (4)!</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=mf>0.01</span>  <span class=c1># (5)!</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=go>   Order Id  Column  Timestamp    Size  Price      Fees  Side</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=go>0         0       0          0  9.0009   11.0  0.990099   Buy</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=go>1         0       2          0  9.0009   11.0  0.990099  Sell</span>
</span></code></pre></div> <ol> <li>Shape <code>(n, m)</code> resulting from imaginary broadcasting all the passed arrays</li> <li>Three groups, one per column</li> <li>Arrays with the shape <code>(1, m)</code> broadcast along columns. Size of <code>np.inf</code> will buy as much as possible at every timestamp, size of <code>np.nan</code> will be ignored at every timestamp, and size of <code>-np.inf</code> will short sell as much as possible at every timestamp.</li> <li>Arrays with the shape <code>(n,)</code> or <code>(n, 1)</code> broadcast along rows</li> <li>Scalars and arrays with the shape <code>(1,)</code> or <code>(1, 1)</code> broadcast along columns and rows</li> </ol> <p>This has the same effect as if we broadcasted all the arrays prior to passing.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>fees</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast_arrays</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]]),</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>]),</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span>    <span class=mf>0.01</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=go>array([[ inf,  nan, -inf],</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=go>       [ inf,  nan, -inf],</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=go>       [ inf,  nan, -inf]])</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=go>array([[11, 11, 11],</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=go>       [10, 10, 10],</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=go>       [12, 12, 12]])</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fees</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=go>array([[0.01, 0.01, 0.01],</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=go>       [0.01, 0.01, 0.01],</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=go>       [0.01, 0.01, 0.01]])</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>size</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>size</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>),</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>price</span><span class=p>,</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=n>fees</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>size</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=go>   Order Id  Column  Timestamp    Size  Price      Fees  Side</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=go>0         0       0          0  9.0009   11.0  0.990099   Buy</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=go>1         0       2          0  9.0009   11.0  0.990099  Sell</span>
</span></code></pre></div> <ol> <li>Use <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.broadcast_arrays>broadcast_arrays</a></li> <li>We can use the shape of any broadcasted array since they all now have the same size</li> </ol> <p>Notice how all the arrays have the same shape <code>(3, 3)</code>, which becomes our target shape.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>We cannot use <code>np.broadcast_arrays</code> since one-dimensional arrays will broadcast along columns.</p> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Visit the API documentation of <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.Order>Order</a> to learn more about different arguments and their meanings.</p> </div> <h3 id=grouping>Grouping<a class=headerlink href=#grouping title="Permanent link">&para;</a></h3> <p>If any element in the array <code>group_lens</code> is greater than 1, it's assumed that the columns are grouped and cash sharing is enabled by default. Let's simulate a portfolio with two assets where we try to order as many shares as possible in both assets:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>]])</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees Side</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=go>0         0       0          0  10.0   10.0   0.0  Buy</span>
</span></code></pre></div> <ol> <li>One row (bar) and two columns (assets)</li> <li>Build a group with cash sharing consisting of two columns</li> <li>Provide order information per element by creating an array of the same shape as <code>target_shape</code></li> </ol> <p>We see that the first asset used up the entire cash and left the second one without funds.</p> <h3 id=call-sequence>Call sequence<a class=headerlink href=#call-sequence title="Permanent link">&para;</a></h3> <p>One practical feature of <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a> is that we can provide our own call sequence to change the order in which columns are processed inside their groups. Without providing a call sequence, the default processing order is <em>from left to right</em>. For example, let's perform two rebalancing steps with the default call sequence: allocate 100% to the second asset at the first timestamp, and close out the position and allocate 100% to the first asset at the second timestamp.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]]),</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>4</span><span class=p>]])</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees  Side</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=go>0         0       1          0  20.0    5.0   0.0   Buy</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=go>1         1       1          1  20.0    4.0   0.0  Sell</span>
</span></code></pre></div> <p>We see that only the column <code>1</code> has been processed. This is because we attempted to allocate 100% to the first asset without first closing out the position of the second asset at the second timestamp. To account for this order, we can pass our own call sequence:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]]),</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>4</span><span class=p>]]),</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=gp>... </span>    <span class=n>call_seq</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]])</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=go>   Order Id  Column  Timestamp       Size  Price  Fees  Side</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=go>0         0       0          1   7.272727   11.0   0.0   Buy</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=go>1         0       1          0  20.000000    5.0   0.0   Buy</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=go>2         1       1          1  20.000000    4.0   0.0  Sell</span>
</span></code></pre></div> <ol> <li>First timestamp: first process the first asset then the second. Second timestamp: first process the second asset then the first. Note that a call sequence must provide exactly one position per timestamp and asset, thus its shape must follow <code>target_shape</code>.</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Order records are partitioned by column and are guaranteed to come in the order they were filled in each column. Also, order ids (the first field) are generated per column, not globally!</p> </div> <p>The first asset at the second timestamp now has the required funds to go long.</p> <p>To avoid providing the call sequence manually, we can leave it at <code>None</code> and enable <code>auto_call_seq</code> instead. In such a case, vectorbt will automatically sort the columns by their approximated order value:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]]),</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>4</span><span class=p>]]),</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=gp>... </span>    <span class=n>auto_call_seq</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (1)!</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=go>   Order Id  Column  Timestamp       Size  Price  Fees  Side</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=go>0         0       0          1   7.272727   11.0   0.0   Buy</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=go>1         0       1          0  20.000000    5.0   0.0   Buy</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=go>2         1       1          1  20.000000    4.0   0.0  Sell</span>
</span></code></pre></div> <ol> <li>Here</li> </ol> <p>Sometimes though, we would like to throw a look at the sequence in which orders were processed, which isn't reflected in the order records. For this, we can provide our own call sequence for vectorbt to change it in-place and return it as a field of the <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SimulationOutput>SimulationOutput</a> named tuple. The call sequence array must be pre-filled with indices in the strict order from 0 to <code>n</code>, where <code>n</code> is the length of the particular group of columns. We can easily build such an array using the function <a href=../../../api/portfolio/call_seq/index.html#vectorbtpro.portfolio.call_seq.build_call_seq>build_call_seq</a>, which takes the target shape, the group lengths, and the call sequence type from <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.CallSeqType>CallSeqType</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbtpro.portfolio.call_seq</span> <span class=kn>import</span> <span class=n>build_call_seq</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span> <span class=o>=</span> <span class=n>build_call_seq</span><span class=p>(</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> 
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span> 
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=gp>... </span>    <span class=n>call_seq_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>CallSeqType</span><span class=o>.</span><span class=n>Default</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]]),</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>4</span><span class=p>]]),</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=gp>... </span>    <span class=n>call_seq</span><span class=o>=</span><span class=n>call_seq</span><span class=p>,</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=gp>... </span>    <span class=n>auto_call_seq</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span><span class=o>.</span><span class=n>call_seq</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=go>array([[0, 1],</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=go>       [1, 0]])</span>
</span></code></pre></div> <ol> <li>If we want for vectorbt to sort the call sequence using <code>auto_call_seq</code>, it must be of the type <code>Default</code></li> </ol> <p>The generated and then sorted call sequence exactly follows the correct one we constructed manually before.</p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>There is usually no big reason in providing your own call sequence. Setting it to <code>None</code> (default) and turning on the flag <code>auto_call_seq</code> will derive the best call sequence in the most resource-friendly manner.</p> </div> <h3 id=filling-returns>Filling returns<a class=headerlink href=#filling-returns title="Permanent link">&para;</a></h3> <p>In addition to returning order records, we can instruct vectorbt to also fill the return based on the portfolio value at the end of each bar. The constructed series will be available under the field <code>returns</code> of <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SimulationOutput.in_outputs>SimulationOutput.in_outputs</a>, and can be used to calculate a range of metrics, such as the Sharpe ratio. Let's do the following: pull the BTC price and calculate the return of a simple buy-and-hold strategy. We'll see that the filled returns will closely match the returns calculated from the price directly:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-01-01&quot;</span><span class=p>)</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>symbol_wrapper</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get_symbol_wrapper</span><span class=p>()</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=gp>... </span>    <span class=nb>open</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=gp>... </span>    <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (3)!</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=go>Date</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=go>2014-09-17 00:00:00+00:00    0.000000</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=go>2014-09-18 00:00:00+00:00   -0.071926</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=go>2014-09-19 00:00:00+00:00   -0.069843</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=go>...                               ...</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=go>2021-12-29 00:00:00+00:00   -0.024042</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=go>2021-12-30 00:00:00+00:00    0.015791</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=go>2021-12-31 00:00:00+00:00   -0.018476</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=go>Freq: D, Name: BTC-USD, Length: 2663, dtype: float64</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_returns</span><span class=p>()</span>  <span class=c1># (5)!</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=go>Date</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=go>2014-09-17 00:00:00+00:00    0.000000</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=go>2014-09-18 00:00:00+00:00   -0.071926</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=go>2014-09-19 00:00:00+00:00   -0.069843</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=go>...                               ...</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=go>2021-12-29 00:00:00+00:00   -0.024042</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=go>2021-12-30 00:00:00+00:00    0.015791</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=go>2021-12-31 00:00:00+00:00   -0.018476</span>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=go>Freq: D, Name: Close, Length: 2663, dtype: float64</span>
</span></code></pre></div> <ol> <li>Use the shape of the data as the target shape. Make sure that the columns are symbols and the shape is two-dimensional.</li> <li>Pass OHLC data as separate arrays. Passing the open, high, and low price is optional.</li> <li>Tell vectorbt to calculate the portfolio value and return at each timestamp</li> <li>Extract the return series and convert it into a Pandas object</li> <li>Buy-and-hold produces the same returns as the close price itself</li> </ol> <p>Returns are calculated from the value of each group, thus the number of columns in the returned time series matches the number of groups in <code>group_lens</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;ETH-USD&quot;</span><span class=p>],</span> 
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-01-01&quot;</span><span class=p>,</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>... </span>    <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_symbol_wrapper</span> <span class=o>=</span> <span class=n>mult_data</span><span class=o>.</span><span class=n>get_symbol_wrapper</span><span class=p>()</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>]]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=gp>... </span>    <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span>\
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=gp>... </span>    <span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;group&quot;</span><span class=p>],</span> <span class=n>ndim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>\
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=gp>... </span>    <span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=go>Date</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=go>2017-11-09 00:00:00+00:00    0.000000</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=go>2017-11-10 00:00:00+00:00   -0.070482</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=go>2017-11-11 00:00:00+00:00    0.006159</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=go>...                               ...</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=go>2021-12-29 00:00:00+00:00   -0.034684</span>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=go>2021-12-30 00:00:00+00:00    0.019652</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=go>2021-12-31 00:00:00+00:00   -0.013406</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=go>Freq: D, Name: group, Length: 1514, dtype: float64</span>
</span></code></pre></div> <ol> <li>Fetch two columns (assets) of data</li> <li>Build a single group out of two columns</li> <li>Define an allocation per column, such that the array nicely broadcasts against the target shape</li> <li>Our wrapper holds metadata per column while the returned array is per group - replace the columns with the single group we created above</li> </ol> <h3 id=initial-state>Initial state<a class=headerlink href=#initial-state title="Permanent link">&para;</a></h3> <p>Initial state defines the starting conditions of the entire trading environment. It mainly consists of three variables: the initial cash, the initial position, and the average entry price of the initial position. Each variable has at most one dimension and is either defined per column or per group. </p> <p>The initial cash is the most important variable out of three, and can be provided as a flexible array <code>init_cash</code> with values per column or per group with cash sharing. As a rule of thumb: it must be either a scalar or one-dimensional array with the same number of elements as there are in <code>group_lens</code>.</p> <p>Let's create a group of two columns and allocate 50% to each column, and another two groups with one column and 100% allocation each. This way, we can perform two independent backtests: with grouping and without. By supplying the initial cash as a single number ($100 by default), the first group will split it among two assets, and thus the starting condition of the grouped columns will differ from that of the columns without grouping, which isn't ideal if you want to set up fair statistical experiments.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>]]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>]]),</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=go>   Order Id  Column  Timestamp       Size  Price  Fees Side</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=go>0         0       0          0   5.000000   10.0   0.0  Buy</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=go>1         0       1          0   4.545455   11.0   0.0  Buy</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=go>2         0       2          0  10.000000   10.0   0.0  Buy</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=go>3         0       3          0   9.090909   11.0   0.0  Buy</span>
</span></code></pre></div> <ol> <li>Make $100 the starting cash of all three groups</li> <li>Evenly split the cash among the two columns in the first group. Remember that size and other order information must be provided per column (asset), not per group!</li> </ol> <p>Let's fix this and provide the first group with twice as much capital:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>200</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>100</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>]]),</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>,</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>]]),</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=go>   Order Id  Column  Timestamp       Size  Price  Fees Side</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=go>0         0       0          0  10.000000   10.0   0.0  Buy</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=go>1         0       1          0   9.090909   11.0   0.0  Buy</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=go>2         0       2          0  10.000000   10.0   0.0  Buy</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=go>3         0       3          0   9.090909   11.0   0.0  Buy</span>
</span></code></pre></div> <ol> <li>Provide the initial cash as an array with values per group</li> </ol> <p>Apart from the initial cash, we can also specify the initial position of each asset to start with. Let's start the simulation with 1 BTC and 1 ETH, and calculate the returns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=gp>... </span>    <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>)</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=go>symbol                      BTC-USD   ETH-USD</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=go>Date                                         </span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=go>2017-11-09 00:00:00+00:00       NaN       NaN</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=go>2017-11-10 00:00:00+00:00 -0.073554 -0.067411</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=go>2017-11-11 00:00:00+00:00 -0.039368  0.051555</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=go>...                             ...       ...</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=go>2021-12-29 00:00:00+00:00 -0.024042 -0.045348</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=go>2021-12-30 00:00:00+00:00  0.015791  0.023514</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=go>2021-12-31 00:00:00+00:00 -0.018476 -0.008406</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=go>[1514 rows x 2 columns]</span>
</span></code></pre></div> <ol> <li>Initial position must be provided per column (asset)</li> </ol> <p>The first data point is NaN because vectorbt cannot calculate the initial value of each portfolio instance without knowing the entry price of each initial position. Let's fix this by setting the entry price to the first open price:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gp>... </span>    <span class=n>init_price</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>  <span class=c1># (1)!</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>... </span>    <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>)</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=go>symbol                      BTC-USD   ETH-USD</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=go>Date                                         </span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=go>2017-11-09 00:00:00+00:00 -0.040182  0.029950</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=go>2017-11-10 00:00:00+00:00 -0.073554 -0.067411</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=go>2017-11-11 00:00:00+00:00 -0.039368  0.051555</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=go>...                             ...       ...</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=go>2021-12-29 00:00:00+00:00 -0.024042 -0.045348</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=go>2021-12-30 00:00:00+00:00  0.015791  0.023514</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=go>2021-12-31 00:00:00+00:00 -0.018476 -0.008406</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=go>[1514 rows x 2 columns]</span>
</span></code></pre></div> <ol> <li>Entry price of the initial position must also be provided per column (asset)</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Make sure to distinguish between a column and a group!</p> <p>Columns represent individual assets, and most information in vectorbt must be supplied at this (lowest) level of granularity. Such arrays must broadcast against <code>target_shape</code>. Groups, on the other hand, represent collections of assets that share the same cash, and only some variables related to cash must be provided per group. Such arrays must broadcast against <code>group_lens.shape</code>.</p> </div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>If you're not sure whether an argument is expected as a one-dimensional or two-dimensional array, take a look into the source code of the function: one-dimensional arrays are annotated with <code>FlexArray1dLike</code> and two-dimensional with <code>FlexArray2dLike</code>. If an argument is expected as strictly one-dimensional or two-dimensional array (i.e., a scalar is not allowed), it's annotated with <code>FlexArray1d</code> and <code>FlexArray2d</code> respectively. If an argument is not flexible at all (i.e., it must have the same shape as <code>target_shape</code>), it will be just <code>Array1d</code> and <code>Array2d</code> respectively.</p> </div> <h3 id=cash-deposits>Cash deposits<a class=headerlink href=#cash-deposits title="Permanent link">&para;</a></h3> <p>In addition to providing the initial cash, we can also deposit or withdraw arbitrary cash amounts as the simulation progresses. Similar to <code>init_cash</code>, the argument <code>cash_deposits</code> must be specified per group. The only difference is that the array now should broadcast along rows and columns, and specify the deposited or withdrawn amount at each timestamp. Thanks to flexible indexing, we can specify the amount to be applied per each element, row, group, or to the entire frame. The actual operation then takes place at the beginning of each bar.</p> <p>Let's simulate a simple <a href=https://www.investopedia.com/terms/d/dollarcostaveraging.asp>DCA</a> strategy where we deposit $100 at the beginning of each year and spend it right away:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=gp>... </span>    <span class=n>cash_deposits</span><span class=o>=</span><span class=n>cash_deposits</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=go>   Order Id  Column  Timestamp      Size         Price  Fees Side</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=go>0         0       0          0  0.218659    457.334015   0.0  Buy</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=go>1         1       0        106  0.318219    314.248993   0.0  Buy</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=go>2         2       0        471  0.230238    434.334015   0.0  Buy</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=go>3         3       0        837  0.100168    998.325012   0.0  Buy</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=go>4         4       0       1202  0.007322  13657.200195   0.0  Buy</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=go>5         5       0       1567  0.026018   3843.520020   0.0  Buy</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=go>6         6       0       1932  0.013889   7200.174316   0.0  Buy</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=go>7         7       0       2298  0.003404  29374.152344   0.0  Buy</span>
</span></code></pre></div> <ol> <li>Create an array with the same shape as our data, fill it with zeros, and set the elements at an annual frequency to 100</li> </ol> <p>Below, we're doing the same but on a group with two assets and equal allocations. Since the array <code>cash_deposits</code> changes the cash balance, it must have the same number of columns as we have groups (with cash sharing).</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span>\
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>... </span>    <span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;group&quot;</span><span class=p>],</span> <span class=n>ndim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>\
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=gp>... </span>    <span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.5</span>  <span class=c1># (3)!</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>]),</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=gp>... </span>    <span class=n>cash_deposits</span><span class=o>=</span><span class=n>cash_deposits</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=go>   Order Id  Column  Timestamp      Size         Price  Fees  Side</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=go>0         0       0          0  0.006999   7143.580078   0.0   Buy</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=go>1         1       0         53  0.004569  13657.200195   0.0   Buy</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a><span class=go>2         2       0        418  0.010971   3843.520020   0.0   Buy</span>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=go>3         3       0        783  0.001263   7200.174316   0.0   Buy</span>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a><span class=go>4         4       0       1149  0.003404  29374.152344   0.0   Buy</span>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=go>5         0       1          0  0.155820    320.884003   0.0   Buy</span>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a><span class=go>6         1       1         53  0.048663    772.640991   0.0   Buy</span>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a><span class=go>7         2       1        418  0.410697    140.819412   0.0   Buy</span>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a><span class=go>8         3       1        783  0.695013    130.802002   0.0   Buy</span>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=go>9         4       1       1149  0.108007    730.367554   0.0  Sell</span>
</span></code></pre></div> <ol> <li>Create an array with one column for our group</li> <li>Create a size array to allocate 50% of the deposited cash to each asset</li> <li>We have also initial cash, thus allocate at the first timestamp too</li> </ol> <p>To withdraw cash, we need to provide a negative amount. If the amount of cash to be withdrawn exceeds the amount of cash we have in our account, only the available cash will be withdrawn. Let's start with 1 BTC, sell 10% each year, and continuously withdraw the entire cash balance:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=gp>... </span>    <span class=n>cash_deposits</span><span class=o>=-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=o>.</span><span class=n>Percent</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=gp>... </span>    <span class=n>direction</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>Direction</span><span class=o>.</span><span class=n>LongOnly</span>  <span class=c1># (4)!</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=go>   Order Id  Column  Timestamp      Size         Price  Fees  Side</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=go>0         0       0        106  0.100000    314.248993   0.0  Sell</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=go>1         1       0        471  0.090000    434.334015   0.0  Sell</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=go>2         2       0        837  0.081000    998.325012   0.0  Sell</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=go>3         3       0       1202  0.072900  13657.200195   0.0  Sell</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=go>4         4       0       1567  0.065610   3843.520020   0.0  Sell</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=go>5         5       0       1932  0.059049   7200.174316   0.0  Sell</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=go>6         6       0       2298  0.053144  29374.152344   0.0  Sell</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>cash_deposits</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>cash_deposits</span><span class=p>[</span><span class=n>cash_deposits</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>])</span>  <span class=c1># (6)!</span>
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a><span class=go>Date</span>
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=go>2014-09-17 00:00:00+00:00    -100.000000</span>
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a><span class=go>2015-01-02 00:00:00+00:00     -31.424899</span>
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=go>2016-01-02 00:00:00+00:00     -39.090061</span>
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a><span class=go>2017-01-02 00:00:00+00:00     -80.864326</span>
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a><span class=go>2018-01-02 00:00:00+00:00    -995.609894</span>
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=go>2019-01-02 00:00:00+00:00    -252.173348</span>
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a><span class=go>2020-01-02 00:00:00+00:00    -425.163093</span>
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a><span class=go>2021-01-02 00:00:00+00:00   -1561.062890</span>
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a><span class=go>Name: BTC-USD, dtype: float64</span>
</span></code></pre></div> <ol> <li>Create a size array to sell 10% of the current position at an annual frequency</li> <li>Withdraw as much as possible at each timestamp. Remember that most arrays can be provided as a scalar to be applied on each element using flexible indexing.</li> <li>Our size means the percentage of the current position</li> <li>Make each order long-only to avoid going into the short direction</li> <li>Access and wrap the cash deposits</li> <li>Positive cash deposits mean money inflow, negative cash deposits mean money outflow</li> </ol> <p>As we see, on the first date of each year, we sold 10% of our position, and since any changes related to cash are only applied at the beginning of each bar, the cash resulting from the transaction can only be withdrawn on the date that follows. Also, whenever we specify cash deposits, vectorbt will create a full-scale array <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SimulationOutput.cash_deposits>SimulationOutput.cash_deposits</a> to account for values that couldn't be satisfied, such as <code>-np.inf</code>, which was replaced by the cash balance at each timestamp. Without having this array, we wouldn't be able to properly reconstruct the simulation during the post-analysis phase.</p> <h3 id=cash-earnings>Cash earnings<a class=headerlink href=#cash-earnings title="Permanent link">&para;</a></h3> <p>In contrast to cash deposits, cash earnings (<code>cash_earnings</code>) mark cash that is either inflowing to or outflowing away from the user, and so they have a direct effect on the profitability. Also, they are applied at the end of each bar. For example, we can use (negative) cash earnings to charge some fixed commission during a pre-determined period of time, or to simulate profit taking from stacking cryptocurrency. One of the most useful applications of cash earnings are cash dividends, which are expressed by a separate argument <code>cash_dividends</code>. Cash dividends are multiplied by the current position size and added to the cash earnings. Similar to cash deposits, vectorbt creates a separate array for cash earnings once it registers any non-zero value in either cash earnings or cash dividends provided by the user, and writes final operations to this array, available under <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SimulationOutput.cash_earnings>SimulationOutput.cash_earnings</a>.</p> <p>Let's simulate investing in Apple and keeping the dividends:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>aapl_data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;AAPL&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-01-01&quot;</span><span class=p>)</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>aapl_wrapper</span> <span class=o>=</span> <span class=n>aapl_data</span><span class=o>.</span><span class=n>get_symbol_wrapper</span><span class=p>()</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>aapl_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>aapl_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>aapl_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=gp>... </span>    <span class=n>cash_dividends</span><span class=o>=</span><span class=n>aapl_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Dividends&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=o>.</span><span class=n>values</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>aapl_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=go>   Order Id  Column  Timestamp        Size     Price  Fees Side</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=go>0         0       0          0  996.754204  0.100326   0.0  Buy</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_earnings</span> <span class=o>=</span> <span class=n>aapl_wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>cash_earnings</span><span class=p>)</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>cash_earnings</span><span class=p>[</span><span class=n>cash_earnings</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>])</span>  <span class=c1># (2)!</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=go>Date</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=go>1987-05-11 00:00:00+00:00      0.534260</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=go>1987-08-10 00:00:00+00:00      0.534260</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=go>1987-11-17 00:00:00+00:00      0.711683</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=go>...                                 ...</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=go>2021-05-07 00:00:00+00:00    219.285925</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=go>2021-08-06 00:00:00+00:00    219.285925</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=go>2021-11-05 00:00:00+00:00    219.285925</span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=go>Name: AAPL, Length: 73, dtype: float64</span>
</span></code></pre></div> <ol> <li>Create a size array for buying the maximum amount at the first bar (<code>np.inf</code>) and then holding (<code>np.nan</code>)</li> <li>Positive cash earnings mean money inflow, negative cash earnings mean money outflow</li> </ol> <h3 id=max-record-count>Max record count<a class=headerlink href=#max-record-count title="Permanent link">&para;</a></h3> <p>By default, since vectorbt doesn't know the number of order records to be filled in advance, it creates an empty array of the same shape as <code>target_shape</code> and gradually "appends" new records. As soon as there are hundreds of thousands or even millions of elements in the target shape, we may run out of memory by trying to create such a huge empty array with such a complex data type. To avoid stressing our RAM too much, we can specify the maximum number of potential records to be filled in each column using <code>max_order_records</code> for order records and <code>max_log_records</code> for log records. </p> <p>For instance, if we have tick data with one million of data points, and we want to simulate a simple strategy where we buy at the first timestamp and then sell at the latest timestamp, it makes sense to limit the number of potential orders in each column to just 2:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>target_shape</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1000000</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rand_price</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>target_shape</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>target_shape</span><span class=p>,</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>rand_price</span><span class=p>,</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=gp>... </span>    <span class=n>max_order_records</span><span class=o>=</span><span class=mi>2</span>  <span class=c1># (3)!</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees  Side</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=go>0         0       0          0  10.0   10.0   0.0   Buy</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=go>1         1       0     999999  20.0    8.0   0.0  Sell</span>
</span></code></pre></div> <ol> <li>Set a seed to make the results reproducible</li> <li>Quickly generate a random time series acting as a price</li> <li>We expect to fill just two orders</li> </ol> <p>Exceeding this limit will throw an error:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>target_shape</span><span class=p>,</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>rand_price</span><span class=p>,</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=gp>... </span>    <span class=n>max_order_records</span><span class=o>=</span><span class=mi>1</span>  <span class=c1># (1)!</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=go>IndexError: order_records index out of range. Set a higher max_order_records.</span>
</span></code></pre></div> <ol> <li>Reduce the maximum count of order records to 1</li> </ol> <p>We can also completely disable filling order records by setting <code>max_order_records</code> to zero:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>(</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>target_shape</span><span class=p>,</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>rand_price</span><span class=p>,</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=gp>... </span>    <span class=n>max_order_records</span><span class=o>=</span><span class=mi>0</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=go>Empty DataFrame</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=go>Columns: [Order Id, Column, Timestamp, Size, Price, Fees, Side]</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=go>Index: []</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p><code>max_order_records</code> and <code>max_log_records</code> are effective for each column. If one column expects to generate 2 records and another one to generate 1000 records, you must use the value of 1000. Also, don't reduce the maximum number of log records (apart from setting it to zero) since logs are generated at each single timestamp.</p> </div> <h3 id=jitting>Jitting<a class=headerlink href=#jitting title="Permanent link">&para;</a></h3> <p>Every simulation function, including <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>, is registered as a jittable function in <a href=../../../api/registries/jit_registry/index.html#vectorbtpro.registries.jit_registry.JITRegistry>JITRegistry</a> once vectorbt is imported. The so-called "jitable setup" resulting from the registration contains various information on compilation and decoration, such as what arguments were passed to the Numba's <code>@njit</code> decorator. At any point in time, we can instruct the registry to redecorate the function by keeping other decoration arguments at their defaults. For example, to disable Numba and run the simulator as a regular Python function:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>f_py</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>jit_reg</span><span class=o>.</span><span class=n>resolve_option</span><span class=p>(</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>... </span>    <span class=n>task_id</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>,</span> 
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=gp>... </span>    <span class=n>option</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># (1)!</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Option gets resolved using <a href=../../../api/utils/jitting/index.html#vectorbtpro.utils.jitting.resolve_jitted_option>resolve_jitted_option</a></li> </ol> <p>To disable caching:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>f_no_cache</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>jit_reg</span><span class=o>.</span><span class=n>resolve_option</span><span class=p>(</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>... </span>    <span class=n>task_id</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>,</span> 
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=gp>... </span>    <span class=n>option</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>cache</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p>To enable automatic parallelization:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>f_parallel</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>jit_reg</span><span class=o>.</span><span class=n>resolve_option</span><span class=p>(</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=gp>... </span>    <span class=n>task_id</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>,</span> 
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>... </span>    <span class=n>option</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>parallel</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>All the returned functions can be used exactly the same way as <code>from_orders_nb</code>. The two latter functions can also be called from within Numba.</p> </div> <h3 id=chunking>Chunking<a class=headerlink href=#chunking title="Permanent link">&para;</a></h3> <p>The same goes for chunking: each simulation function is registered as a chunkable function in <a href=../../../api/registries/ch_registry/index.html#vectorbtpro.registries.ch_registry.ChunkableRegistry>ChunkableRegistry</a> and all arguments in <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a> are perfectly chunkable across <strong>groups</strong> (not rows or columns!). But since Numba-compiled functions are meant to be used by other Numba-compiled functions and Numba can't take regular Python functions, they haven't been decorated with the <a href=../../../api/utils/chunking/index.html#vectorbtpro.utils.chunking.chunked>chunked</a> decorator just yet. To decorate, we need to explicitly tell the registry to do so:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>f_chunked</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ch_reg</span><span class=o>.</span><span class=n>resolve_option</span><span class=p>(</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>... </span>    <span class=n>setup_id_or_func</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_orders_nb</span><span class=p>,</span> 
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=n>option</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (1)!</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>f_chunked</span><span class=o>.</span><span class=n>options</span><span class=p>))</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=go>Config(</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=go>    n_chunks=None,</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=go>    size=ArraySizer(</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=go>        arg_query=&#39;group_lens&#39;,</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=go>        single_type=None,</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=go>        axis=0</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=go>    ),</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=go>    min_size=None,</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=go>    chunk_len=None,</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=go>    chunk_meta=None,</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=go>    skip_single_chunk=None,</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=go>    arg_take_spec={...},</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=go>    template_context=None,</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=go>    engine=None,</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=go>    engine_config={},</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=go>    merge_func=&lt;function merge_sim_outs at 0x7f88873f1ea0&gt;,</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=go>    merge_kwargs={...},</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=go>    return_raw_chunks=False,</span>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=go>    silence_warnings=None,</span>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=go>    disable=None</span>
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=go>)</span>
</span></code></pre></div> <ol> <li>Option gets resolved using <a href=../../../api/utils/chunking/index.html#vectorbtpro.utils.chunking.resolve_chunked_option>resolve_chunked_option</a></li> </ol> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>The returned function can be used the same way as <code>from_orders_nb</code>, but not within Numba since it's now wrapped with a regular Python function that takes care of chunking.</p> </div> <p>Let's go all into BTC and ETH while utilizing chunking, which will produce two totally-isolated simulations. Internally, this will split <code>group_lens</code> into two arrays (<code>[1]</code> and <code>[1]</code>), then split each argument value into chunks such that each chunk contains information only about one of the groups, execute the same function but on different chunks using <a href=https://dask.org/ >Dask</a>, and finally, merge the results of both simulations as if they were produced by a single, monolithic simulation <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1fa84.svg title=:magic_wand:></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>f_chunked</span><span class=p>(</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=gp>... </span>    <span class=n>_n_chunks</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=gp>... </span>    <span class=n>_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>engine</span><span class=o>=</span><span class=s2>&quot;dask&quot;</span><span class=p>)</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>print_orders</span><span class=p>(</span><span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>,</span> <span class=n>sim_out</span><span class=o>.</span><span class=n>order_records</span><span class=p>)</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=go>   Order Id  Column  Timestamp      Size        Price  Fees Side</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=go>0         0       0          0  0.013999  7143.580078   0.0  Buy</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=go>1         0       1          0  0.311639   320.884003   0.0  Buy</span>
</span></code></pre></div> <ol> <li>Add an underscore to an argument to override a setting with the same name in <a href=../../../api/utils/chunking/index.html#vectorbtpro.utils.chunking.chunked>chunked</a></li> </ol> <p>Chunking even knows how to split flexible arrays!</p> <h2 id=class-method>Class method<a class=headerlink href=#class-method title="Permanent link">&para;</a></h2> <p>Often, using the Numba-compiled simulation function directly is quite cumbersome, given that many of our inputs are either scalars or Pandas objects that would have to be converted to NumPy arrays. Nevertheless, knowing how inputs are processed at the most fundamental level is very important for understanding how vectorbt works under the hood. To add another level of abstraction and to assist the user, vectorbt enhances each simulation function by wrapping it with a class method, such as <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> for <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>, that automates some input pre-processing and output post-processing.</p> <p>For example, here's how easy it is to test the three orders we mentioned at the beginning:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>],</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees  Side</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=go>0         0       0          0   0.1   11.0   0.0   Buy</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=go>1         1       0          1   0.1   10.0   0.0  Sell</span>
</span></code></pre></div> <p>But probably the simplest example involves just a single order (for $10, buy 1 share):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees Side</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=go>0         0       0          0   1.0   10.0   0.0  Buy</span>
</span></code></pre></div> <ol> <li>Any array-like argument gets converted into a NumPy array</li> </ol> <p>Each class method is basically a small pipeline that pulls default argument values from global settings, broadcasts arguments, checks whether arguments have correct data types, redecorates the simulation function by resolving jitting and chunking options, runs the simulation, and, finally, creates a new <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> instance based on the result of the simulation and ready to be analyzed. But the most important: it makes use of Pandas, including datetime indexes and column hierarchies - nobody wants to work with NumPy arrays alone!</p> <h3 id=close-price>Close price<a class=headerlink href=#close-price title="Permanent link">&para;</a></h3> <p>In contrast to their Numba-compiled functions, the class methods require the close price to be provided. This requirement is associated with the post-analysis phase: many metrics and time series such as the equity curve can only be reliably calculated using the latest price at each bar since they use information that happens somewhere during that bar, and we should avoid looking into the future by using the open price or any other intermediate data.</p> <h3 id=defaults>Defaults<a class=headerlink href=#defaults title="Permanent link">&para;</a></h3> <p>If we look at the signature of <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a>, we would notice an exceptionally high amount of <code>None</code> values. The value <code>None</code> has a special meaning and usually instructs vectorbt to replace it with the respective default value from the global settings.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>phelp</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>,</span> <span class=n>incl_doc</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=go>Portfolio.from_orders(</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=go>    close,</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=go>    size=None,</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=go>    size_type=None,</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=go>    direction=None,</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=go>    price=None,</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=go>    fees=None,</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=go>    ...</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=go>    jitted=None,</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=go>    chunked=None,</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=go>    wrapper_kwargs=None,</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=go>    freq=None,</span>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=go>    bm_close=None,</span>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=go>    **kwargs</span>
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=go>)</span>
</span></code></pre></div> <p>The global settings for <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> are stored in the config <a href=../../../api/_settings/index.html#vectorbtpro._settings.portfolio>settings.portfolio</a>. For example, by default, vectorbt uses the close price as the order price (remember how the negative infinity means the open price and the positive infinity means the close price?):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;price&quot;</span><span class=p>]</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=go>inf</span>
</span></code></pre></div> <p>To change a default, we can override it directly in the settings. For example, let's introduce a fixed commission of $1 to every order:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;fixed_fees&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>]),</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>])</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees  Side</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=go>0         0       0          0   0.1   11.0   1.0   Buy</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=go>1         1       0          1   0.1   10.0   1.0  Sell</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=go>                                               ^</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=go>                                              here</span>
</span></code></pre></div> <p>The settings can be reset as any other <a href=../../../api/utils/config/index.html#vectorbtpro.utils.config.Config>config</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;fixed_fees&quot;</span><span class=p>]</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=go>0.0</span>
</span></code></pre></div> <p>Generally, global defaults follow the same schema as keyword arguments across most simulation functions. For example, <code>price</code> defaults to <code>np.array(np.inf)</code> just about everywhere in Numba. If you cannot find an argument in the global settings, then there is no default value for that argument and <code>None</code> is a legitimate value.</p> <h3 id=enums>Enums<a class=headerlink href=#enums title="Permanent link">&para;</a></h3> <p>In the vectorbt's ecosystem, we can find a lot of arguments of an enumerated type. Enums are regular integers that act as categorical variables. Similarly to contexts, they are also represented by a named tuple, but this tuple is already initialized with values usually ranging from 0 to the total number of categories in the enum. Let's take the <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SizeType>SizeType</a> as an example:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=p>))</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=go>SizeTypeT(</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=go>    Amount=0,</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=go>    Value=1,</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=go>    Percent=2,</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=go>    TargetAmount=3,</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=go>    TargetValue=4,</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=go>    TargetPercent=5</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=go>)</span>
</span></code></pre></div> <p>Instead of requiring the user to pass any value as an integer, we can take the name of its field instead and convert it to an integer using <a href=../../../api/utils/enum_/index.html#vectorbtpro.utils.enum_.map_enum_fields>map_enum_fields</a>, which takes the field name and the enumerated type, and returns the value of that field in that type. In addition, it allows us to convert entire collections of fields, such as lists and Pandas objects.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>map_enum_fields</span><span class=p>(</span><span class=s2>&quot;targetamount&quot;</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=p>)</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=go>3</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>map_enum_fields</span><span class=p>([</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=gp>... </span>    <span class=s2>&quot;amount&quot;</span><span class=p>,</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=gp>... </span>    <span class=s2>&quot;targetamount&quot;</span><span class=p>,</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=gp>... </span>    <span class=s2>&quot;targetpercent&quot;</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=gp>... </span><span class=p>],</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=p>)</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=go>[0, 3, 5]</span>
</span></code></pre></div> <p>Internally, this function uses <a href=../../../api/utils/mapping/index.html#vectorbtpro.utils.mapping.apply_mapping>apply_mapping</a>, which enables many useful options, such as ignoring the input if it's already of an integer data type:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>map_enum_fields</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=p>)</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=go>3</span>
</span></code></pre></div> <p>Also, by default, it ignores the case and removes all non-alphanumeric characters:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>map_enum_fields</span><span class=p>(</span><span class=s2>&quot;Target Amount&quot;</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>SizeType</span><span class=p>)</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=go>3</span>
</span></code></pre></div> <p>And that's all the magic behind <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> and other simulation methods knowing how to handle string options! Let's enter a position of one share at one bar and then sell 50% of it at the next bar:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>]),</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>]),</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s2>&quot;amount&quot;</span><span class=p>,</span> <span class=s2>&quot;percent&quot;</span><span class=p>]),</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=gp>... </span>    <span class=n>direction</span><span class=o>=</span><span class=s2>&quot;longonly&quot;</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=go>   Order Id  Column  Timestamp  Size  Price  Fees  Side</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=go>0         0       0          0   1.0   10.0   0.0   Buy</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=go>1         1       0          1   0.5   11.0   0.0  Sell</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Conversion isn't vectorized - it's advisable to provide actual integers when bigger arrays are involved to avoid performance penalties.</p> </div> <h3 id=broadcasting>Broadcasting<a class=headerlink href=#broadcasting title="Permanent link">&para;</a></h3> <p>Once the argument values have been resolved, vectorbt takes all the arguments that should broadcast against the target shape, and passes them to the function <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.broadcast>broadcast</a>.</p> <p>Broadcasting is one of the most essential building blocks in vectorbt because it allows us to provide arrays with various shapes and types, including NumPy arrays, Pandas Series and DataFrames, and even regular lists. Whenever we iterate over rows (timestamps) and columns (assets), the simulator needs to know which element in each array currently to pick. Instead of providing huge arrays where each element is set, we can pass some arrays with elements per row, some with elements per column, and some as scalars, and the vectorbt's broadcaster will make sure that they perfectly align with the target shape over which the simulator iterates.</p> <p>Let's broadcast some arrays manually. Here, we have one column in the price array and want to test multiple combinations of order size by making it a DataFrame with one row and multiple columns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=gp>... </span>    <span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>],</span> 
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020-01-01&quot;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=gp>... </span>    <span class=p>[[</span><span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]],</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=gp>... </span>    <span class=n>columns</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>([</span><span class=s2>&quot;short&quot;</span><span class=p>,</span> <span class=s2>&quot;nan&quot;</span><span class=p>,</span> <span class=s2>&quot;long&quot;</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;size&quot;</span><span class=p>)</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fees</span> <span class=o>=</span> <span class=mf>0.01</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=mf>0.01</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=gp>... </span><span class=p>))</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>[</span><span class=s2>&quot;close&quot;</span><span class=p>]</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=go>size        short  nan  long</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=go>2020-01-01     11   11    11</span>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=go>2020-01-02     10   10    10</span>
</span><span id=__span-40-20><a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a><span class=go>2020-01-03     12   12    12</span>
</span><span id=__span-40-21><a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a>
</span><span id=__span-40-22><a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>[</span><span class=s2>&quot;size&quot;</span><span class=p>]</span>
</span><span id=__span-40-23><a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=go>size        short  nan  long</span>
</span><span id=__span-40-24><a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=go>2020-01-01   -inf  NaN   inf</span>
</span><span id=__span-40-25><a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a><span class=go>2020-01-02   -inf  NaN   inf</span>
</span><span id=__span-40-26><a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=go>2020-01-03   -inf  NaN   inf</span>
</span><span id=__span-40-27><a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a>
</span><span id=__span-40-28><a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>[</span><span class=s2>&quot;fees&quot;</span><span class=p>]</span>
</span><span id=__span-40-29><a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a><span class=go>size        short   nan  long</span>
</span><span id=__span-40-30><a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a><span class=go>2020-01-01   0.01  0.01  0.01</span>
</span><span id=__span-40-31><a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a><span class=go>2020-01-02   0.01  0.01  0.01</span>
</span><span id=__span-40-32><a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a><span class=go>2020-01-03   0.01  0.01  0.01</span>
</span></code></pre></div> <p>But thanks to flexible indexing, we don't have to bring each argument to the full shape and materialize it. That's why, to avoid high memory consumption, each simulation method also passes <code>keep_flex=True</code> to the broadcaster to keep all arguments in their original form suitable for flexible indexing. For them, the broadcaster will only check whether they <strong>can broadcast</strong> to the final shape. Since we not only broadcast NumPy arrays but also Pandas objects as well, we need to return the wrapper resulting from the broadcasting operation, which will contain the final shape and Pandas metadata including the index and columns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>,</span> <span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=mf>0.01</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=gp>... </span><span class=p>),</span> <span class=n>keep_flex</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>return_wrapper</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>[</span><span class=s2>&quot;close&quot;</span><span class=p>]</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=go>[[11]</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=go> [10]</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=go> [12]]</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>[</span><span class=s2>&quot;size&quot;</span><span class=p>]</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=go>[[-inf  nan  inf]]</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcasted</span><span class=p>[</span><span class=s2>&quot;fees&quot;</span><span class=p>]</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=go>[0.01]</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=go>size        short  nan  long</span>
</span><span id=__span-41-19><a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a><span class=go>2020-01-01    NaN  NaN   NaN</span>
</span><span id=__span-41-20><a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=go>2020-01-02    NaN  NaN   NaN</span>
</span><span id=__span-41-21><a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=go>2020-01-03    NaN  NaN   NaN</span>
</span></code></pre></div> <ol> <li>Create a dummy array to reveal the broadcasted Pandas metadata</li> </ol> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>Even though we passed <code>fees</code> as a scalar, the broadcaster automatically wrapped it with a NumPy array and expanded to two dimensions for Numba. For the same reason, it also converted Pandas to NumPy.</p> </div> <p>Some arrays, such as <code>init_cash</code> and <code>cash_deposits</code>, cannot broadcast together with <code>close</code> because their final shape depends on the number of groups, or they are one-dimensional by nature. Thus, after all the regular arrays were aligned, the wrapper was created, and the target shape was established, vectorbt will first create the group lengths array, and then individually broadcast all the arrays that aren't broadcastable against <code>target_shape</code>. For example, to broadcast the initial position array:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>init_position</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_init_position</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast_array_to</span><span class=p>(</span><span class=n>init_position</span><span class=p>,</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>shape_2d</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_init_position</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=go>array([1, 1, 1])</span>
</span></code></pre></div> <p>All of this is conveniently done by <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a>!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=n>fees</span><span class=p>,</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=n>init_position</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=go>   Order Id Column  Timestamp       Size  Price      Fees  Side</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=go>0         0  short 2020-01-01  10.981098   11.0  1.207921  Sell</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=go>1         0   long 2020-01-01   9.000900   11.0  0.990099   Buy</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=go>size             short    nan        long</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=go>2020-01-01  109.792079  111.0  110.009901</span>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=go>2020-01-02  119.773177  110.0  100.009001</span>
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=go>2020-01-03   99.810981  112.0  120.010801</span>
</span></code></pre></div> <p>To control the broadcasting process, we can pass additional arguments to <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.broadcast>broadcast</a> via <code>broadcast_kwargs</code>. For example, let's replace the final columns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=n>fees</span><span class=p>,</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=n>init_position</span><span class=p>,</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=gp>... </span>    <span class=n>broadcast_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>columns_from</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;a&quot;</span><span class=p>,</span> <span class=s2>&quot;b&quot;</span><span class=p>,</span> <span class=s2>&quot;c&quot;</span><span class=p>])</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=go>                     a      b           c</span>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=go>2020-01-01  109.792079  111.0  110.009901</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=go>2020-01-02  119.773177  110.0  100.009001</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=go>2020-01-03   99.810981  112.0  120.010801</span>
</span></code></pre></div> <p>We can also wrap any argument with the class <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.BCO>BCO</a> to provide broadcasting-related keyword arguments just for that particular object, or with the class <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.Param>Param</a> to mark the object as a parameter. Below, we are testing the Cartesian product of two parameters: size and fees.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>]),</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=n>init_position</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=go>size                          -inf                     inf            </span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=go>fees              0.00        0.01        0.00        0.01</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=go>2020-01-01  111.000000  109.792079  111.000000  110.009901</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=go>2020-01-02  121.090909  119.773177  100.909091  100.009001</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=go>2020-01-03  100.909091   99.810981  121.090909  120.010801</span>
</span></code></pre></div> <ol> <li>We could have also passed a regular <code>pd.Index</code> for the same effect</li> </ol> <p>Furthermore, we can broadcast differently-shaped Pandas DataFrames if their column levels overlap. Let's say we have two assets, and we want to test the open and close price as the order price. For this, we need to create a Pandas DataFrame for the order price that has 4 columns, each price type per each asset:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_close</span> <span class=o>=</span> <span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_close</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=go>symbol                          BTC-USD      ETH-USD</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=go>Date                                                </span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=go>2017-11-09 00:00:00+00:00   7143.580078   320.884003</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=go>2017-11-10 00:00:00+00:00   6618.140137   299.252991</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=go>2017-11-11 00:00:00+00:00   6357.600098   314.681000</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=go>...                                 ...          ...</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=go>2021-12-29 00:00:00+00:00  46444.710938  3628.531738</span>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=go>2021-12-30 00:00:00+00:00  47178.125000  3713.852051</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=go>2021-12-31 00:00:00+00:00  46306.445312  3682.632812</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=go>[1514 rows x 2 columns]</span>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_price</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>((</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=gp>... </span>    <span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>),</span> 
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=gp>... </span>    <span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=gp>... </span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>([</span><span class=s2>&quot;open&quot;</span><span class=p>,</span> <span class=s2>&quot;close&quot;</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;price&quot;</span><span class=p>))</span>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_price</span>
</span><span id=__span-46-20><a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=go>price                              open                      close  \</span>
</span><span id=__span-46-21><a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=go>symbol                          BTC-USD      ETH-USD       BTC-USD   </span>
</span><span id=__span-46-22><a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=go>Date                                                                 </span>
</span><span id=__span-46-23><a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a><span class=go>2017-11-09 00:00:00+00:00   7446.830078   308.644989   7143.580078   </span>
</span><span id=__span-46-24><a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a><span class=go>2017-11-10 00:00:00+00:00   7173.729980   320.670990   6618.140137   </span>
</span><span id=__span-46-25><a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a><span class=go>2017-11-11 00:00:00+00:00   6618.609863   298.585999   6357.600098   </span>
</span><span id=__span-46-26><a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a><span class=go>...                                 ...          ...           ...   </span>
</span><span id=__span-46-27><a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a><span class=go>2021-12-29 00:00:00+00:00  47623.871094  3797.436279  46444.710938   </span>
</span><span id=__span-46-28><a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a><span class=go>2021-12-30 00:00:00+00:00  46490.605469  3632.219727  47178.125000   </span>
</span><span id=__span-46-29><a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a><span class=go>2021-12-31 00:00:00+00:00  47169.371094  3713.430176  46306.445312   </span>
</span><span id=__span-46-30><a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a>
</span><span id=__span-46-31><a id=__codelineno-46-31 name=__codelineno-46-31 href=#__codelineno-46-31></a><span class=go>price                                   </span>
</span><span id=__span-46-32><a id=__codelineno-46-32 name=__codelineno-46-32 href=#__codelineno-46-32></a><span class=go>symbol                         ETH-USD  </span>
</span><span id=__span-46-33><a id=__codelineno-46-33 name=__codelineno-46-33 href=#__codelineno-46-33></a><span class=go>Date                                    </span>
</span><span id=__span-46-34><a id=__codelineno-46-34 name=__codelineno-46-34 href=#__codelineno-46-34></a><span class=go>2017-11-09 00:00:00+00:00   320.884003  </span>
</span><span id=__span-46-35><a id=__codelineno-46-35 name=__codelineno-46-35 href=#__codelineno-46-35></a><span class=go>2017-11-10 00:00:00+00:00   299.252991  </span>
</span><span id=__span-46-36><a id=__codelineno-46-36 name=__codelineno-46-36 href=#__codelineno-46-36></a><span class=go>2017-11-11 00:00:00+00:00   314.681000  </span>
</span><span id=__span-46-37><a id=__codelineno-46-37 name=__codelineno-46-37 href=#__codelineno-46-37></a><span class=go>...                                ...  </span>
</span><span id=__span-46-38><a id=__codelineno-46-38 name=__codelineno-46-38 href=#__codelineno-46-38></a><span class=go>2021-12-29 00:00:00+00:00  3628.531738  </span>
</span><span id=__span-46-39><a id=__codelineno-46-39 name=__codelineno-46-39 href=#__codelineno-46-39></a><span class=go>2021-12-30 00:00:00+00:00  3713.852051  </span>
</span><span id=__span-46-40><a id=__codelineno-46-40 name=__codelineno-46-40 href=#__codelineno-46-40></a><span class=go>2021-12-31 00:00:00+00:00  3682.632812  </span>
</span><span id=__span-46-41><a id=__codelineno-46-41 name=__codelineno-46-41 href=#__codelineno-46-41></a>
</span><span id=__span-46-42><a id=__codelineno-46-42 name=__codelineno-46-42 href=#__codelineno-46-42></a><span class=go>[1514 rows x 4 columns]</span>
</span></code></pre></div> <p>Even though both shapes (1524, 2) and (1524, 4) are <a href=https://numpy.org/doc/stable/user/basics.broadcasting.html>not broadcastable</a> (!) in NumPy, vectorbt identifies that both DataFrames share the same column level <code>symbol</code>, and aligns them based on that level using <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.align_pd_arrays>align_pd_arrays</a>, which then yields a successful simulation:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span><span class=n>close</span><span class=o>=</span><span class=n>mult_close</span><span class=p>,</span> <span class=n>price</span><span class=o>=</span><span class=n>mult_price</span><span class=p>)</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=go>price                            open                    close             </span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=go>symbol                        BTC-USD      ETH-USD     BTC-USD      ETH-USD</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=go>Date                                                                       </span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=go>2017-11-09 00:00:00+00:00   95.927798   103.965402  100.000000   100.000000</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=go>2017-11-10 00:00:00+00:00   88.871910    96.957022   92.644585    93.258931</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=go>2017-11-11 00:00:00+00:00   85.373240   101.955648   88.997394    98.066902</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=go>...                               ...          ...         ...          ...</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=go>2021-12-29 00:00:00+00:00  623.684312  1175.632804  650.160150  1130.792345</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=go>2021-12-30 00:00:00+00:00  633.532987  1203.276315  660.426908  1157.381490</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=go>2021-12-31 00:00:00+00:00  621.827608  1193.161381  648.224627  1147.652355</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=go>[1514 rows x 4 columns]</span>
</span></code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>See the API documentation of <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.broadcast>broadcast</a> for more examples on broadcasting.</p> </div> <p>Even though <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> is the most basic simulation method, it already takes dozens of broadcastable array-like arguments. So, how do we know exactly which argument is broadcastable?</p> <p>To see which arguments can broadcast, take a look either at the API documentation of the argument, or at the annotation of the argument in the source code, which has the type <code>ArrayLike</code> when it can be provided both as a scalar and as an array. You can also look at the argument annotations of the Numba-compiled simulation function (here <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>) and search for the prefix <code>FlexArray</code>. Finally, the last and probably the least underrated method is to look at the argument taking specification of the chunking decorator: arguments that are chunked using <a href=../../../api/base/chunking/index.html#vectorbtpro.base.chunking.FlexArraySlicer>FlexArraySlicer</a> or have <code>flex</code> in the specification name are broadcastable by nature. The specification also reveals against what shape the argument should broadcast.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>f_chunked</span><span class=o>.</span><span class=n>options</span><span class=p>[</span><span class=s2>&quot;arg_take_spec&quot;</span><span class=p>][</span><span class=s2>&quot;close&quot;</span><span class=p>]))</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=go>FlexArraySlicer(</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=go>    single_type=None,</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=go>    ignore_none=True,</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=go>    mapper={</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=go>        &#39;should_cache&#39;: True,</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=go>        &#39;chunk_meta_cache&#39;: {...},</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=go>        &#39;arg_query&#39;: {</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=go>            &#39;pattern&#39;: &#39;(group_lens|group_map)&#39;,</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=go>            &#39;flags&#39;: 0</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class=go>        }</span>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=go>    },</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=go>    axis=1</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=go>)</span>
</span></code></pre></div> <p>Here, the argument <code>close</code> is expected as a flexible array that is chunked along the column axis using the group lengths mapper. Since the simulation function is always chunked by its groups and columns of this argument are mapped to those groups, it should broadcast along columns in <code>target_shape</code> as opposed to groups in <code>group_lens</code>. Arguments that have no mapper, such as <code>cash_deposits</code>, always broadcast along groups:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>f_chunked</span><span class=o>.</span><span class=n>options</span><span class=p>[</span><span class=s2>&quot;arg_take_spec&quot;</span><span class=p>][</span><span class=s2>&quot;cash_deposits&quot;</span><span class=p>]))</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=go>FlexArraySlicer(</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=go>    single_type=None,</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=go>    ignore_none=True,</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=go>    mapper=None,</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=go>    axis=1</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=go>)</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>As a rule of thumb: if you take a look at the source code of <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>, only the arguments that have <code>portfolio_ch.flex_array_gl_slicer</code> as their specification broadcast together and build the target shape. All other flexible arguments broadcast individually once the target shape has been built.</p> </div> <h3 id=grouping_1>Grouping<a class=headerlink href=#grouping_1 title="Permanent link">&para;</a></h3> <p>Since the target shape is now being generated from broadcasting instead of being passed manually by the user, there is no possibility for the user to provide the group lengths either. Instead, vectorbt will take a grouping instruction and create this array for us. Grouping is performed by constructing a <a href=../../../api/base/grouping/base/index.html#vectorbtpro.base.grouping.base.Grouper>Grouper</a> instance, which takes the broadcasted columns and a group-by object (<code>group_by</code>). It then uses the group-by object to distribute the columns into groups and generate the group lengths array. See the API documentation of <a href=../../../api/base/grouping/base/index.html#vectorbtpro.base.grouping.base.Grouper>Grouper</a> to learn about various group-by options. For example, we can pass <code>group_by=True</code> to put all columns into a single group, or specify the column level by which the columns should be grouped. </p> <p>And even though <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a> automatically turns on cash sharing whenever it discovers multiple columns in a group, we must explicitly enable cash sharing with <code>cash_sharing</code> in the class method, otherwise no grouping during the simulation will be performed! This is because a <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> instance can also group its columns during the post-analysis phase, and <code>cash_sharing</code> is a special flag that tells vectorbt to perform the grouping during the simulation as well.</p> <p>Let's demonstrate what it's like to invest all the initial cash into two assets without grouping, with grouping, and with grouping and cash sharing:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>  <span class=c1># (1)!</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=go>symbol                        BTC-USD      ETH-USD</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=go>Date                                              </span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=go>2017-11-09 00:00:00+00:00  100.000000   100.000000</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=go>2017-11-10 00:00:00+00:00   92.644585    93.258931</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=go>2017-11-11 00:00:00+00:00   88.997394    98.066902</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=go>...                               ...          ...</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=go>2021-12-29 00:00:00+00:00  650.160150  1130.792345</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=go>2021-12-30 00:00:00+00:00  660.426908  1157.381490</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=go>2021-12-31 00:00:00+00:00  648.224627  1147.652355</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=go>[1514 rows x 2 columns]</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>  <span class=c1># (2)!</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class=go>Date</span>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=go>2017-11-09 00:00:00+00:00     200.000000</span>
</span><span id=__span-50-24><a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=go>2017-11-10 00:00:00+00:00     185.903516</span>
</span><span id=__span-50-25><a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a><span class=go>2017-11-11 00:00:00+00:00     187.064296</span>
</span><span id=__span-50-26><a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a><span class=go>...                                  ...</span>
</span><span id=__span-50-27><a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a><span class=go>2021-12-29 00:00:00+00:00    1780.952495</span>
</span><span id=__span-50-28><a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=go>2021-12-30 00:00:00+00:00    1817.808397</span>
</span><span id=__span-50-29><a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a><span class=go>2021-12-31 00:00:00+00:00    1795.876982</span>
</span><span id=__span-50-30><a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=go>Freq: D, Name: group, Length: 1514, dtype: float64</span>
</span><span id=__span-50-31><a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a>
</span><span id=__span-50-32><a id=__codelineno-50-32 name=__codelineno-50-32 href=#__codelineno-50-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-50-33><a id=__codelineno-50-33 name=__codelineno-50-33 href=#__codelineno-50-33></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-50-34><a id=__codelineno-50-34 name=__codelineno-50-34 href=#__codelineno-50-34></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-50-35><a id=__codelineno-50-35 name=__codelineno-50-35 href=#__codelineno-50-35></a><span class=gp>... </span>    <span class=n>cash_sharing</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-50-36><a id=__codelineno-50-36 name=__codelineno-50-36 href=#__codelineno-50-36></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-50-37><a id=__codelineno-50-37 name=__codelineno-50-37 href=#__codelineno-50-37></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>  <span class=c1># (3)!</span>
</span><span id=__span-50-38><a id=__codelineno-50-38 name=__codelineno-50-38 href=#__codelineno-50-38></a><span class=go>Date</span>
</span><span id=__span-50-39><a id=__codelineno-50-39 name=__codelineno-50-39 href=#__codelineno-50-39></a><span class=go>2017-11-09 00:00:00+00:00    100.000000</span>
</span><span id=__span-50-40><a id=__codelineno-50-40 name=__codelineno-50-40 href=#__codelineno-50-40></a><span class=go>2017-11-10 00:00:00+00:00     92.644585</span>
</span><span id=__span-50-41><a id=__codelineno-50-41 name=__codelineno-50-41 href=#__codelineno-50-41></a><span class=go>2017-11-11 00:00:00+00:00     88.997394</span>
</span><span id=__span-50-42><a id=__codelineno-50-42 name=__codelineno-50-42 href=#__codelineno-50-42></a><span class=go>...                                 ...</span>
</span><span id=__span-50-43><a id=__codelineno-50-43 name=__codelineno-50-43 href=#__codelineno-50-43></a><span class=go>2021-12-29 00:00:00+00:00    650.160150</span>
</span><span id=__span-50-44><a id=__codelineno-50-44 name=__codelineno-50-44 href=#__codelineno-50-44></a><span class=go>2021-12-30 00:00:00+00:00    660.426908</span>
</span><span id=__span-50-45><a id=__codelineno-50-45 name=__codelineno-50-45 href=#__codelineno-50-45></a><span class=go>2021-12-31 00:00:00+00:00    648.224627</span>
</span><span id=__span-50-46><a id=__codelineno-50-46 name=__codelineno-50-46 href=#__codelineno-50-46></a><span class=go>Freq: D, Name: group, Length: 1514, dtype: float64</span>
</span></code></pre></div> <ol> <li>Without grouping, each column manages its own initial cash</li> <li>With grouping but without cash sharing, each column still manages its own initial cash, but during the post-analysis phase vectorbt concatenates both columns to analyze them as a single group, thus we see the first value being $200 instead of $100</li> <li>With grouping and with cash sharing, both columns manage the same initial cash. The first column went all in and left the second column without the required funds, such that the value effectively reflects only the first asset</li> </ol> <p>Passing <code>group_by=True</code> only works when all columns are different assets and there are no parameter combinations. But how about multiple assets and parameter combinations?</p> <p>Let's play with different group-by instructions on the <code>mult_close</code> and <code>mult_price</code> arrays that we constructed earlier. The final broadcasted shape has 4 columns: each price type per each asset. What we want to do is to create two groups by putting the assets of each parameter combination into a single basket. We cannot pass <code>group_by=True</code> because it will combine all 4 columns. We also cannot pass the column level <code>symbol</code> as <code>group_by</code> because it will group by asset, that is, it will put the columns with <code>BTC-USD</code>, such as <code>(Open, BTC-USD)</code> and <code>(Close, BTC-USD)</code>, into one group and the columns with <code>ETH-USD</code> into another. What we need though is to put <code>(Open, BTC-USD)</code> and <code>(Open, ETH-USD)</code> into one group and <code>(Close, BTC-USD)</code> and <code>(Close, ETH-USD)</code> into another; that is, we need to pass all the column levels <strong>apart from symbols</strong> as <code>group_by</code>, which can be done in multiple ways:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_close</span><span class=p>,</span> 
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>mult_price</span><span class=p>,</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>([</span><span class=s2>&quot;group1&quot;</span><span class=p>,</span> <span class=s2>&quot;group1&quot;</span><span class=p>,</span> <span class=s2>&quot;group2&quot;</span><span class=p>,</span> <span class=s2>&quot;group2&quot;</span><span class=p>])</span>  <span class=c1># (1)!</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=go>                                group1       group2</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=go>Date                                               </span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=go>2017-11-09 00:00:00+00:00   199.893199   200.000000</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=go>2017-11-10 00:00:00+00:00   185.828932   185.903516</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=go>2017-11-11 00:00:00+00:00   187.328888   187.064296</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=go>...                                ...          ...</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=go>2021-12-29 00:00:00+00:00  1799.317116  1780.952495</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=go>2021-12-30 00:00:00+00:00  1836.809302  1817.808397</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=go>2021-12-31 00:00:00+00:00  1814.988988  1795.876982</span>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=go>[1514 rows x 2 columns]</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_close</span><span class=p>,</span> 
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>mult_price</span><span class=p>,</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;price&quot;</span><span class=p>]</span>  <span class=c1># (2)!</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-24><a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-51-25><a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a><span class=go>price                             open        close</span>
</span><span id=__span-51-26><a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a><span class=go>Date                                               </span>
</span><span id=__span-51-27><a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a><span class=go>2017-11-09 00:00:00+00:00   199.893199   200.000000</span>
</span><span id=__span-51-28><a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a><span class=go>2017-11-10 00:00:00+00:00   185.828932   185.903516</span>
</span><span id=__span-51-29><a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a><span class=go>2017-11-11 00:00:00+00:00   187.328888   187.064296</span>
</span><span id=__span-51-30><a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a><span class=go>...                                ...          ...</span>
</span><span id=__span-51-31><a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a><span class=go>2021-12-29 00:00:00+00:00  1799.317116  1780.952495</span>
</span><span id=__span-51-32><a id=__codelineno-51-32 name=__codelineno-51-32 href=#__codelineno-51-32></a><span class=go>2021-12-30 00:00:00+00:00  1836.809302  1817.808397</span>
</span><span id=__span-51-33><a id=__codelineno-51-33 name=__codelineno-51-33 href=#__codelineno-51-33></a><span class=go>2021-12-31 00:00:00+00:00  1814.988988  1795.876982</span>
</span><span id=__span-51-34><a id=__codelineno-51-34 name=__codelineno-51-34 href=#__codelineno-51-34></a>
</span><span id=__span-51-35><a id=__codelineno-51-35 name=__codelineno-51-35 href=#__codelineno-51-35></a><span class=go>[1514 rows x 2 columns]</span>
</span><span id=__span-51-36><a id=__codelineno-51-36 name=__codelineno-51-36 href=#__codelineno-51-36></a>
</span><span id=__span-51-37><a id=__codelineno-51-37 name=__codelineno-51-37 href=#__codelineno-51-37></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-51-38><a id=__codelineno-51-38 name=__codelineno-51-38 href=#__codelineno-51-38></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_close</span><span class=p>,</span> 
</span><span id=__span-51-39><a id=__codelineno-51-39 name=__codelineno-51-39 href=#__codelineno-51-39></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>mult_price</span><span class=p>,</span>
</span><span id=__span-51-40><a id=__codelineno-51-40 name=__codelineno-51-40 href=#__codelineno-51-40></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>ExceptLevel</span><span class=p>(</span><span class=s2>&quot;symbol&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-51-41><a id=__codelineno-51-41 name=__codelineno-51-41 href=#__codelineno-51-41></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-42><a id=__codelineno-51-42 name=__codelineno-51-42 href=#__codelineno-51-42></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-51-43><a id=__codelineno-51-43 name=__codelineno-51-43 href=#__codelineno-51-43></a><span class=go>price                             open        close</span>
</span><span id=__span-51-44><a id=__codelineno-51-44 name=__codelineno-51-44 href=#__codelineno-51-44></a><span class=go>Date                                               </span>
</span><span id=__span-51-45><a id=__codelineno-51-45 name=__codelineno-51-45 href=#__codelineno-51-45></a><span class=go>2017-11-09 00:00:00+00:00   199.893199   200.000000</span>
</span><span id=__span-51-46><a id=__codelineno-51-46 name=__codelineno-51-46 href=#__codelineno-51-46></a><span class=go>2017-11-10 00:00:00+00:00   185.828932   185.903516</span>
</span><span id=__span-51-47><a id=__codelineno-51-47 name=__codelineno-51-47 href=#__codelineno-51-47></a><span class=go>2017-11-11 00:00:00+00:00   187.328888   187.064296</span>
</span><span id=__span-51-48><a id=__codelineno-51-48 name=__codelineno-51-48 href=#__codelineno-51-48></a><span class=go>...                                ...          ...</span>
</span><span id=__span-51-49><a id=__codelineno-51-49 name=__codelineno-51-49 href=#__codelineno-51-49></a><span class=go>2021-12-29 00:00:00+00:00  1799.317116  1780.952495</span>
</span><span id=__span-51-50><a id=__codelineno-51-50 name=__codelineno-51-50 href=#__codelineno-51-50></a><span class=go>2021-12-30 00:00:00+00:00  1836.809302  1817.808397</span>
</span><span id=__span-51-51><a id=__codelineno-51-51 name=__codelineno-51-51 href=#__codelineno-51-51></a><span class=go>2021-12-31 00:00:00+00:00  1814.988988  1795.876982</span>
</span></code></pre></div> <ol> <li>Pass any collection of group labels manually, preferably a Pandas Index. This collection will be converted into a column level. Must have the same length as the number of columns in the target shape.</li> <li>Pass the names of all column levels except the one with the assets. Only works when there are multiple levels, that is, the column index is a <code>pd.MultiIndex</code>. The to-be-grouped column levels will be visible in the final column hierarchy.</li> <li>Pass the column level with the assets to <a href=../../../api/base/indexes/index.html#vectorbtpro.base.indexes.ExceptLevel>ExceptLevel</a> to group all column levels except this one. This will work with any column index - the best option!</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>To make sure that the grouping operation on assets was successful, the final column hierarchy should include all columns levels except the one with asset symbols. For example, passing <code>group_by=True</code> will hide all columns levels, while passing <code>group_by='symbol'</code> will show only the column level with asset symbols <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/274c.svg title=:x:></p> </div> <h3 id=call-sequence_1>Call sequence<a class=headerlink href=#call-sequence_1 title="Permanent link">&para;</a></h3> <p>Similarly to grouping, the class method also simplifies handling of call sequences. There is an argument <code>call_seq</code> that not only accepts a (broadcastable) array, but can also be provided as a value of the enum <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.CallSeqType>CallSeqType</a>. For example, we can pass "auto" to sort the call sequence automatically and to first execute the assets that should be sold before executing the assets that should be bought, which is an important requirement for rebalancing. Let's create an equally-weighted portfolio that is being rebalanced every month:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;M&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.5</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span> 
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=s2>&quot;targetpercent&quot;</span><span class=p>,</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>ExceptLevel</span><span class=p>(</span><span class=s2>&quot;symbol&quot;</span><span class=p>),</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=gp>... </span>    <span class=n>cash_sharing</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=gp>... </span>    <span class=n>call_seq</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>allocations</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>get_asset_value</span><span class=p>(</span><span class=n>group_by</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>/</span> <span class=n>pf</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>allocations</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=gp>... </span>   <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>stackgroup</span><span class=o>=</span><span class=s2>&quot;one&quot;</span><span class=p>),</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=gp>... </span>   <span class=n>use_gl</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Plot how much each asset contributes to the portfolio value</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/documentation/pf/from_orders_call_seq.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/documentation/pf/from_orders_call_seq.dark.svg#only-dark></p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>By the way, this is exactly the way <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_optimizer>Portfolio.from_optimizer</a> uses <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> for rebalancing!</p> </div> <p>To access the sorted call sequence after the simulation, we can pass <code>attach_call_seq</code> and then read the property <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.call_seq>Portfolio.call_seq</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span> 
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=s2>&quot;targetpercent&quot;</span><span class=p>,</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=gp>... </span>    <span class=n>group_by</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>ExceptLevel</span><span class=p>(</span><span class=s2>&quot;symbol&quot;</span><span class=p>),</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=gp>... </span>    <span class=n>cash_sharing</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=gp>... </span>    <span class=n>call_seq</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=gp>... </span>    <span class=n>attach_call_seq</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (1)!</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>call_seq</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=go>symbol                     BTC-USD  ETH-USD</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=go>Date                                       </span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=go>2017-11-09 00:00:00+00:00        0        1</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=go>2017-11-10 00:00:00+00:00        1        0</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=go>2017-11-11 00:00:00+00:00        1        0</span>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=go>...                            ...      ...</span>
</span><span id=__span-53-17><a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=go>2021-12-29 00:00:00+00:00        1        0</span>
</span><span id=__span-53-18><a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=go>2021-12-30 00:00:00+00:00        1        0</span>
</span><span id=__span-53-19><a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=go>2021-12-31 00:00:00+00:00        1        0</span>
</span><span id=__span-53-20><a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a>
</span><span id=__span-53-21><a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=go>[1514 rows x 2 columns]</span>
</span></code></pre></div> <ol> <li>Here</li> </ol> <h3 id=unlimited-cash>Unlimited cash<a class=headerlink href=#unlimited-cash title="Permanent link">&para;</a></h3> <p>When testing many trading strategies and parameter combinations, cash may quickly become a bottleneck. Also, determining the right amount of starting capital is often a challenge by itself. Gladly, there is a range of options that help us in backtesting a trading strategy without having to think about cash limits. One common approach is to pass <code>np.inf</code> as <code>init_cash</code> to simulate an unlimited cash balance. Welcome to the billionaires club <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4b8.svg title=:money_with_wings:></p> <p>But this would drive the post-analysis havoc because the portfolio value at each timestamp would be infinite as well. To account for this, we can instruct vectorbt to simulate an unlimited cash balance during the simulation, and then post-analyze the expenditures to determine the optimal starting capital. If wanted, we can then re-run the simulation but with the calculated optimal amount. To make this possible, we can pass one of the options from <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.InitCashMode>InitCashMode</a> as <code>init_cash</code>. As opposed to other enums, this enum contains only negative values such that they cannot be confused with zero or positive amounts.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>During the simulation, each group value will be infinity. Thus, we cannot use the size of (+/-) infinity, but also percentages, target percentages, and other size types that depend on the group value. We also cannot fill returns during the simulation.</p> </div> <p>Let's <a href=https://www.investopedia.com/terms/d/dollarcostaveraging.asp>DCA</a> into BTC and ETH by buying one unit each year, and then, retrospectively, find out how much capital this activity would require:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>mult_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span> 
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span>  <span class=c1># (1)!</span>
</span><span id=__span-54-9><a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-54-10><a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>init_cash</span>  <span class=c1># (2)!</span>
</span><span id=__span-54-11><a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=go>symbol</span>
</span><span id=__span-54-12><a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=go>BTC-USD    61218.626953</span>
</span><span id=__span-54-13><a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=go>ETH-USD     2095.513962</span>
</span><span id=__span-54-14><a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=go>Name: init_cash, dtype: float64</span>
</span></code></pre></div> <ol> <li>Use <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.InitCashMode.Auto>InitCashMode.Auto</a></li> <li>Calculated after the simulation</li> </ol> <p>We can then pass these amounts to a new simulation if desired:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf2</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span> 
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=n>pf</span><span class=o>.</span><span class=n>init_cash</span>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf2</span><span class=o>.</span><span class=n>cash</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=o>~</span><span class=n>size</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>all</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>  <span class=c1># (1)!</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=go>symbol                          BTC-USD      ETH-USD</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=go>Date                                                </span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=go>2017-11-09 00:00:00+00:00  54075.046875  1774.629959</span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=go>2018-01-01 00:00:00+00:00  40417.846680  1001.988968</span>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=go>2019-01-01 00:00:00+00:00  36574.326660   861.169556</span>
</span><span id=__span-55-12><a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=go>2020-01-01 00:00:00+00:00  29374.152344   730.367554</span>
</span><span id=__span-55-13><a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=go>2021-01-01 00:00:00+00:00      0.000000     0.000000</span>
</span></code></pre></div> <ol> <li>Print out the cash balance after each investment</li> </ol> <p>We can see how each investment gradually reduces the cash balance and how the final investment drains it completely, while still enabling us to order exactly one unit of each cryptocurrency:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf2</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=go>   Order Id   Column                 Timestamp  Size         Price  Fees Side</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=go>0         0  BTC-USD 2017-11-09 00:00:00+00:00   1.0   7143.580078   0.0  Buy</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=go>1         1  BTC-USD 2018-01-01 00:00:00+00:00   1.0  13657.200195   0.0  Buy</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=go>2         2  BTC-USD 2019-01-01 00:00:00+00:00   1.0   3843.520020   0.0  Buy</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=go>3         3  BTC-USD 2020-01-01 00:00:00+00:00   1.0   7200.174316   0.0  Buy</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=go>4         4  BTC-USD 2021-01-01 00:00:00+00:00   1.0  29374.152344   0.0  Buy</span>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=go>5         0  ETH-USD 2017-11-09 00:00:00+00:00   1.0    320.884003   0.0  Buy</span>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=go>6         1  ETH-USD 2018-01-01 00:00:00+00:00   1.0    772.640991   0.0  Buy</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=go>7         2  ETH-USD 2019-01-01 00:00:00+00:00   1.0    140.819412   0.0  Buy</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=go>8         3  ETH-USD 2020-01-01 00:00:00+00:00   1.0    130.802002   0.0  Buy</span>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=go>9         4  ETH-USD 2021-01-01 00:00:00+00:00   1.0    730.367554   0.0  Buy</span>
</span></code></pre></div> <h3 id=output-arrays>Output arrays<a class=headerlink href=#output-arrays title="Permanent link">&para;</a></h3> <p>All the arrays that are returned as part of <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.SimulationOutput>SimulationOutput</a>, such as <code>cash_deposits</code>, <code>cash_earnings</code>, and <code>in_outputs.returns</code>, can be accessed as an attribute with the same name of a <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> instance. Let's do the same example as we did in <a href=#cash-deposits>Cash deposits</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=s2>&quot;percent&quot;</span><span class=p>,</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=gp>... </span>    <span class=n>direction</span><span class=o>=</span><span class=s2>&quot;longonly&quot;</span><span class=p>,</span>
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=gp>... </span>    <span class=n>init_position</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=gp>... </span>    <span class=n>cash_deposits</span><span class=o>=-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-57-11><a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-57-12><a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>cash_deposits</span><span class=p>[</span><span class=n>pf</span><span class=o>.</span><span class=n>cash_deposits</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-57-13><a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=go>Date</span>
</span><span id=__span-57-14><a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=go>2014-09-17 00:00:00+00:00    -100.000000</span>
</span><span id=__span-57-15><a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=go>2015-01-02 00:00:00+00:00     -31.424899</span>
</span><span id=__span-57-16><a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a><span class=go>2016-01-02 00:00:00+00:00     -39.090061</span>
</span><span id=__span-57-17><a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a><span class=go>2017-01-02 00:00:00+00:00     -80.864326</span>
</span><span id=__span-57-18><a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a><span class=go>2018-01-02 00:00:00+00:00    -995.609894</span>
</span><span id=__span-57-19><a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a><span class=go>2019-01-02 00:00:00+00:00    -252.173348</span>
</span><span id=__span-57-20><a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a><span class=go>2020-01-02 00:00:00+00:00    -425.163093</span>
</span><span id=__span-57-21><a id=__codelineno-57-21 name=__codelineno-57-21 href=#__codelineno-57-21></a><span class=go>2021-01-02 00:00:00+00:00   -1561.062890</span>
</span><span id=__span-57-22><a id=__codelineno-57-22 name=__codelineno-57-22 href=#__codelineno-57-22></a><span class=go>dtype: float64</span>
</span></code></pre></div> <h3 id=max-record-count_1>Max record count<a class=headerlink href=#max-record-count_1 title="Permanent link">&para;</a></h3> <p>Another automation brought by <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> is touching the maximum number of order and log records. Whenever we pass <code>None</code>, <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a> will pick the maximum possible number of records. In the class method though, vectorbt will check how many non-NaN values there are in the size array, and will pick the highest number across all columns. The same goes for logs, where it determines the number of <code>True</code> values. This has almost no impact on performance because vectorbt doesn't need to fully broadcast both arrays to get these numbers. Thus, we don't have to provide <code>max_order_records</code> and <code>max_log_records</code> if we decide to represent inactive data points as NaN in a huge close array.</p> <h3 id=data-type-checks>Data type checks<a class=headerlink href=#data-type-checks title="Permanent link">&para;</a></h3> <p>Numba is the closest thing to a statically-typed code in vectorbt, and directly passing wrong data types to Numba usually leads to an ugly-formatted exception. To provide us with a bit of help in debugging, vectorbt checks all data types prior to calling <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=go>AssertionError: Data type of &#39;close&#39; must be &lt;class &#39;numpy.number&#39;&gt;, not bool</span>
</span></code></pre></div> <p>Here, the argument <code>close</code> seems to require a numeric data type <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f60c.svg title=:relieved:></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>In vectorbt, almost no function will change the data type of an array in a hidden manner because casting may be quite expensive in performance terms, especially when huge arrays are involved. It's the responsibility of the user to supply properly typed and sized data!</p> </div> <h3 id=jitting_1>Jitting<a class=headerlink href=#jitting_1 title="Permanent link">&para;</a></h3> <p>Remember how we resolved various jitting options to redecorate <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a>? Just like everywhere in vectorbt, in the class method a jitting option can be provided using the argument <code>jitted</code>. Let's test a random simulation without and with automatic parallelization with Numba:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_target_shape</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_rand_price</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>big_target_shape</span><span class=p>)</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>big_target_shape</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_size</span><span class=p>[</span><span class=mi>1</span><span class=p>::</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></code></pre></div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>big_rand_price</span><span class=p>,</span> 
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>big_size</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=go>113 ms  2.34 ms per loop (mean  std. dev. of 7 runs, 10 loops each)</span>
</span></code></pre></div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>big_rand_price</span><span class=p>,</span> 
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>big_size</span><span class=p>,</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=gp>... </span>    <span class=n>jitted</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>parallel</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=go>97 ms  3.47 ms per loop (mean  std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Preset simulators like <a href=../../../api/portfolio/nb/from_orders/index.html#vectorbtpro.portfolio.nb.from_orders.from_orders_nb>from_orders_nb</a> can only be parallelized along groups and columns, thus it would make no difference in enabling the parallel mode when there is only one group or column present. But also, it's usually a better idea to use chunking for parallelization as Numba may yield no performance benefit at all. Only certain user-crafted pipelines that make heavy use of math can be parallelized well with Numba.</p> </div> <h3 id=chunking_1>Chunking<a class=headerlink href=#chunking_1 title="Permanent link">&para;</a></h3> <p>Similarly to a jitting option, chunking can be enabled by providing an option via the argument <code>chunked</code>. Below, we do the same benchmark as above but now using Dask:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>big_rand_price</span><span class=p>,</span> 
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>big_size</span><span class=p>,</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=gp>... </span>    <span class=n>chunked</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>engine</span><span class=o>=</span><span class=s2>&quot;dask&quot;</span><span class=p>,</span> <span class=n>n_chunks</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=go>67.2 ms  3.63 ms per loop (mean  std. dev. of 7 runs, 10 loops each)</span>
</span></code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Multithreading with Dask is better suited for this job than multiprocessing with Ray because, by default, all Numba-compiled functions in vectorbt release the <a href=https://realpython.com/python-gil/ >GIL</a>, and there is a much smaller overhead when starting multiple threads than processes. Consider using multiprocessing when the function takes a considerable amount of time to run.</p> </div> <h3 id=use-cases>Use cases<a class=headerlink href=#use-cases title="Permanent link">&para;</a></h3> <p>This method is best suited for backtesting jobs where order information is known beforehand and there is no order that changes its parameters depending on changes in the environment. That is, we cannot implement SL, TP, limit, or any other complex order type using this method. It's really just a smart way of representing multiple instances of <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.Order>Order</a> in a vectorized and resource-cheap way - imagine how difficult it would be to supply a list of named tuples instead of arrays! There are two particular use cases where <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> becomes interesting: portfolio rebalancing with predefined weights, and "what-if" analysis. While we've already touched rebalancing more than enough times, the latter use case is about simulating and analyzing various hypothetical scenarios of a real-world trading activity.</p> <p>Let's say we have made 3 trades on SOL/BTC on Binance and want to analyze them in depth. Even if Binance has made some improvements in its trade analysis capabilities, doing it with vectorbt opens an entirely new dimension. First, we need to pull the close price of a granularity with which we would like the trades to be analyzed. Then, we need to convert trade information into orders. Finally, we can use <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> to see how the portfolio evolved over time!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trade1</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=gp>... </span>    <span class=n>timestamp</span><span class=o>=</span><span class=s2>&quot;2022-01-22 12:39:26&quot;</span><span class=p>,</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=mf>0.0027702</span><span class=p>,</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=mf>4.99</span><span class=p>,</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=gp>... </span>    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>1.01571e-05</span>  <span class=c1># (1)!</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trade2</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=gp>... </span>    <span class=n>timestamp</span><span class=o>=</span><span class=s2>&quot;2022-01-29 02:12:50&quot;</span><span class=p>,</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=mf>0.00243</span><span class=p>,</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=-</span><span class=mf>1.72</span><span class=p>,</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=gp>... </span>    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>3.0549e-06</span>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-13><a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trade3</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-63-14><a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a><span class=gp>... </span>    <span class=n>timestamp</span><span class=o>=</span><span class=s2>&quot;2022-01-29 02:52:54&quot;</span><span class=p>,</span>
</span><span id=__span-63-15><a id=__codelineno-63-15 name=__codelineno-63-15 href=#__codelineno-63-15></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=mf>0.0024299</span><span class=p>,</span>
</span><span id=__span-63-16><a id=__codelineno-63-16 name=__codelineno-63-16 href=#__codelineno-63-16></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=-</span><span class=mf>3.27</span><span class=p>,</span>
</span><span id=__span-63-17><a id=__codelineno-63-17 name=__codelineno-63-17 href=#__codelineno-63-17></a><span class=gp>... </span>    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>5.8102e-06</span>
</span><span id=__span-63-18><a id=__codelineno-63-18 name=__codelineno-63-18 href=#__codelineno-63-18></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-19><a id=__codelineno-63-19 name=__codelineno-63-19 href=#__codelineno-63-19></a>
</span><span id=__span-63-20><a id=__codelineno-63-20 name=__codelineno-63-20 href=#__codelineno-63-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trades</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>([</span><span class=n>trade1</span><span class=p>,</span> <span class=n>trade2</span><span class=p>,</span> <span class=n>trade3</span><span class=p>])</span>  <span class=c1># (2)!</span>
</span><span id=__span-63-21><a id=__codelineno-63-21 name=__codelineno-63-21 href=#__codelineno-63-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trades</span><span class=p>[</span><span class=s2>&quot;timestamp&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>trades</span><span class=p>[</span><span class=s2>&quot;timestamp&quot;</span><span class=p>],</span> <span class=n>utc</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-63-22><a id=__codelineno-63-22 name=__codelineno-63-22 href=#__codelineno-63-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trades</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s2>&quot;timestamp&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-63-23><a id=__codelineno-63-23 name=__codelineno-63-23 href=#__codelineno-63-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trades</span>
</span><span id=__span-63-24><a id=__codelineno-63-24 name=__codelineno-63-24 href=#__codelineno-63-24></a><span class=go>                             price  size  fixed_fees</span>
</span><span id=__span-63-25><a id=__codelineno-63-25 name=__codelineno-63-25 href=#__codelineno-63-25></a><span class=go>timestamp                                           </span>
</span><span id=__span-63-26><a id=__codelineno-63-26 name=__codelineno-63-26 href=#__codelineno-63-26></a><span class=go>2022-01-22 12:39:26+00:00  0.00277  4.99    0.000010</span>
</span><span id=__span-63-27><a id=__codelineno-63-27 name=__codelineno-63-27 href=#__codelineno-63-27></a><span class=go>2022-01-29 02:52:54+00:00  0.00243 -1.72    0.000003</span>
</span><span id=__span-63-28><a id=__codelineno-63-28 name=__codelineno-63-28 href=#__codelineno-63-28></a><span class=go>2022-01-29 02:52:54+00:00  0.00243 -3.27    0.000006</span>
</span><span id=__span-63-29><a id=__codelineno-63-29 name=__codelineno-63-29 href=#__codelineno-63-29></a>
</span><span id=__span-63-30><a id=__codelineno-63-30 name=__codelineno-63-30 href=#__codelineno-63-30></a><span class=gp>&gt;&gt;&gt; </span><span class=n>solbtc_data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>BinanceData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-63-31><a id=__codelineno-63-31 name=__codelineno-63-31 href=#__codelineno-63-31></a><span class=gp>... </span>    <span class=s2>&quot;SOLBTC&quot;</span><span class=p>,</span> 
</span><span id=__span-63-32><a id=__codelineno-63-32 name=__codelineno-63-32 href=#__codelineno-63-32></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=n>trades</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> 
</span><span id=__span-63-33><a id=__codelineno-63-33 name=__codelineno-63-33 href=#__codelineno-63-33></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=n>trades</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-63-34><a id=__codelineno-63-34 name=__codelineno-63-34 href=#__codelineno-63-34></a><span class=gp>... </span>    <span class=n>timeframe</span><span class=o>=</span><span class=s2>&quot;1h&quot;</span>
</span><span id=__span-63-35><a id=__codelineno-63-35 name=__codelineno-63-35 href=#__codelineno-63-35></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-36><a id=__codelineno-63-36 name=__codelineno-63-36 href=#__codelineno-63-36></a>
</span><span id=__span-63-37><a id=__codelineno-63-37 name=__codelineno-63-37 href=#__codelineno-63-37></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resampler</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Resampler</span><span class=p>(</span>  <span class=c1># (5)!</span>
</span><span id=__span-63-38><a id=__codelineno-63-38 name=__codelineno-63-38 href=#__codelineno-63-38></a><span class=gp>... </span>    <span class=n>source_index</span><span class=o>=</span><span class=n>trades</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-63-39><a id=__codelineno-63-39 name=__codelineno-63-39 href=#__codelineno-63-39></a><span class=gp>... </span>    <span class=n>target_index</span><span class=o>=</span><span class=n>solbtc_data</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-63-40><a id=__codelineno-63-40 name=__codelineno-63-40 href=#__codelineno-63-40></a><span class=gp>... </span>    <span class=n>source_freq</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-63-41><a id=__codelineno-63-41 name=__codelineno-63-41 href=#__codelineno-63-41></a><span class=gp>... </span>    <span class=n>target_freq</span><span class=o>=</span><span class=s2>&quot;1h&quot;</span>
</span><span id=__span-63-42><a id=__codelineno-63-42 name=__codelineno-63-42 href=#__codelineno-63-42></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-43><a id=__codelineno-63-43 name=__codelineno-63-43 href=#__codelineno-63-43></a>
</span><span id=__span-63-44><a id=__codelineno-63-44 name=__codelineno-63-44 href=#__codelineno-63-44></a><span class=gp>&gt;&gt;&gt; </span><span class=c1># (6)!</span>
</span><span id=__span-63-45><a id=__codelineno-63-45 name=__codelineno-63-45 href=#__codelineno-63-45></a>
</span><span id=__span-63-46><a id=__codelineno-63-46 name=__codelineno-63-46 href=#__codelineno-63-46></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-63-47><a id=__codelineno-63-47 name=__codelineno-63-47 href=#__codelineno-63-47></a><span class=gp>... </span><span class=k>def</span> <span class=nf>avg_price_reduce_meta_nb</span><span class=p>(</span><span class=n>from_i</span><span class=p>,</span> <span class=n>to_i</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>):</span>  <span class=c1># (7)!</span>
</span><span id=__span-63-48><a id=__codelineno-63-48 name=__codelineno-63-48 href=#__codelineno-63-48></a><span class=gp>... </span>    <span class=n>_size</span> <span class=o>=</span> <span class=n>size</span><span class=p>[</span><span class=n>from_i</span><span class=p>:</span><span class=n>to_i</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span>
</span><span id=__span-63-49><a id=__codelineno-63-49 name=__codelineno-63-49 href=#__codelineno-63-49></a><span class=gp>... </span>    <span class=n>_price</span> <span class=o>=</span> <span class=n>price</span><span class=p>[</span><span class=n>from_i</span><span class=p>:</span><span class=n>to_i</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span>
</span><span id=__span-63-50><a id=__codelineno-63-50 name=__codelineno-63-50 href=#__codelineno-63-50></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>_price</span> <span class=o>*</span> <span class=n>_size</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>_size</span><span class=p>)</span>
</span><span id=__span-63-51><a id=__codelineno-63-51 name=__codelineno-63-51 href=#__codelineno-63-51></a>
</span><span id=__span-63-52><a id=__codelineno-63-52 name=__codelineno-63-52 href=#__codelineno-63-52></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>resample_to_index</span><span class=p>(</span>  <span class=c1># (8)!</span>
</span><span id=__span-63-53><a id=__codelineno-63-53 name=__codelineno-63-53 href=#__codelineno-63-53></a><span class=gp>... </span>    <span class=n>resampler</span><span class=p>,</span> 
</span><span id=__span-63-54><a id=__codelineno-63-54 name=__codelineno-63-54 href=#__codelineno-63-54></a><span class=gp>... </span>    <span class=n>avg_price_reduce_meta_nb</span><span class=p>,</span>
</span><span id=__span-63-55><a id=__codelineno-63-55 name=__codelineno-63-55 href=#__codelineno-63-55></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>trades</span><span class=p>[</span><span class=s2>&quot;size&quot;</span><span class=p>]),</span>
</span><span id=__span-63-56><a id=__codelineno-63-56 name=__codelineno-63-56 href=#__codelineno-63-56></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>trades</span><span class=p>[</span><span class=s2>&quot;price&quot;</span><span class=p>]),</span>
</span><span id=__span-63-57><a id=__codelineno-63-57 name=__codelineno-63-57 href=#__codelineno-63-57></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>trades</span><span class=p>[</span><span class=s2>&quot;price&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>wrapper</span><span class=p>,</span>
</span><span id=__span-63-58><a id=__codelineno-63-58 name=__codelineno-63-58 href=#__codelineno-63-58></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-59><a id=__codelineno-63-59 name=__codelineno-63-59 href=#__codelineno-63-59></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=o>~</span><span class=n>price</span><span class=o>.</span><span class=n>isnull</span><span class=p>()]</span>  <span class=c1># (9)!</span>
</span><span id=__span-63-60><a id=__codelineno-63-60 name=__codelineno-63-60 href=#__codelineno-63-60></a><span class=go>Open time</span>
</span><span id=__span-63-61><a id=__codelineno-63-61 name=__codelineno-63-61 href=#__codelineno-63-61></a><span class=go>2022-01-22 12:00:00+00:00    0.00277</span>
</span><span id=__span-63-62><a id=__codelineno-63-62 name=__codelineno-63-62 href=#__codelineno-63-62></a><span class=go>2022-01-29 02:00:00+00:00    0.00243</span>
</span><span id=__span-63-63><a id=__codelineno-63-63 name=__codelineno-63-63 href=#__codelineno-63-63></a><span class=go>Freq: 158H, Name: price, dtype: float64</span>
</span><span id=__span-63-64><a id=__codelineno-63-64 name=__codelineno-63-64 href=#__codelineno-63-64></a>
</span><span id=__span-63-65><a id=__codelineno-63-65 name=__codelineno-63-65 href=#__codelineno-63-65></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>trades</span><span class=p>[</span><span class=s2>&quot;size&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>resample_to_index</span><span class=p>(</span>  <span class=c1># (10)!</span>
</span><span id=__span-63-66><a id=__codelineno-63-66 name=__codelineno-63-66 href=#__codelineno-63-66></a><span class=gp>... </span>    <span class=n>resampler</span><span class=p>,</span> 
</span><span id=__span-63-67><a id=__codelineno-63-67 name=__codelineno-63-67 href=#__codelineno-63-67></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>sum_reduce_nb</span>
</span><span id=__span-63-68><a id=__codelineno-63-68 name=__codelineno-63-68 href=#__codelineno-63-68></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-69><a id=__codelineno-63-69 name=__codelineno-63-69 href=#__codelineno-63-69></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=o>~</span><span class=n>size</span><span class=o>.</span><span class=n>isnull</span><span class=p>()]</span>
</span><span id=__span-63-70><a id=__codelineno-63-70 name=__codelineno-63-70 href=#__codelineno-63-70></a><span class=go>Open time</span>
</span><span id=__span-63-71><a id=__codelineno-63-71 name=__codelineno-63-71 href=#__codelineno-63-71></a><span class=go>2022-01-22 12:00:00+00:00    4.99</span>
</span><span id=__span-63-72><a id=__codelineno-63-72 name=__codelineno-63-72 href=#__codelineno-63-72></a><span class=go>2022-01-29 02:00:00+00:00   -4.99</span>
</span><span id=__span-63-73><a id=__codelineno-63-73 name=__codelineno-63-73 href=#__codelineno-63-73></a><span class=go>Freq: 158H, Name: size, dtype: float64</span>
</span><span id=__span-63-74><a id=__codelineno-63-74 name=__codelineno-63-74 href=#__codelineno-63-74></a>
</span><span id=__span-63-75><a id=__codelineno-63-75 name=__codelineno-63-75 href=#__codelineno-63-75></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fixed_fees</span> <span class=o>=</span> <span class=n>trades</span><span class=p>[</span><span class=s2>&quot;fixed_fees&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>resample_to_index</span><span class=p>(</span>
</span><span id=__span-63-76><a id=__codelineno-63-76 name=__codelineno-63-76 href=#__codelineno-63-76></a><span class=gp>... </span>    <span class=n>resampler</span><span class=p>,</span> 
</span><span id=__span-63-77><a id=__codelineno-63-77 name=__codelineno-63-77 href=#__codelineno-63-77></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>sum_reduce_nb</span>
</span><span id=__span-63-78><a id=__codelineno-63-78 name=__codelineno-63-78 href=#__codelineno-63-78></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-79><a id=__codelineno-63-79 name=__codelineno-63-79 href=#__codelineno-63-79></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fixed_fees</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=o>~</span><span class=n>fixed_fees</span><span class=o>.</span><span class=n>isnull</span><span class=p>()]</span>
</span><span id=__span-63-80><a id=__codelineno-63-80 name=__codelineno-63-80 href=#__codelineno-63-80></a><span class=go>Open time</span>
</span><span id=__span-63-81><a id=__codelineno-63-81 name=__codelineno-63-81 href=#__codelineno-63-81></a><span class=go>2022-01-22 12:00:00+00:00    0.000010</span>
</span><span id=__span-63-82><a id=__codelineno-63-82 name=__codelineno-63-82 href=#__codelineno-63-82></a><span class=go>2022-01-29 02:00:00+00:00    0.000009</span>
</span><span id=__span-63-83><a id=__codelineno-63-83 name=__codelineno-63-83 href=#__codelineno-63-83></a><span class=go>Freq: 158H, Name: fixed_fees, dtype: float64</span>
</span><span id=__span-63-84><a id=__codelineno-63-84 name=__codelineno-63-84 href=#__codelineno-63-84></a>
</span><span id=__span-63-85><a id=__codelineno-63-85 name=__codelineno-63-85 href=#__codelineno-63-85></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>  <span class=c1># (11)!</span>
</span><span id=__span-63-86><a id=__codelineno-63-86 name=__codelineno-63-86 href=#__codelineno-63-86></a><span class=gp>... </span>    <span class=nb>open</span><span class=o>=</span><span class=n>solbtc_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>),</span>
</span><span id=__span-63-87><a id=__codelineno-63-87 name=__codelineno-63-87 href=#__codelineno-63-87></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>solbtc_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-63-88><a id=__codelineno-63-88 name=__codelineno-63-88 href=#__codelineno-63-88></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>solbtc_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-63-89><a id=__codelineno-63-89 name=__codelineno-63-89 href=#__codelineno-63-89></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>solbtc_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-63-90><a id=__codelineno-63-90 name=__codelineno-63-90 href=#__codelineno-63-90></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>price</span><span class=p>,</span>
</span><span id=__span-63-91><a id=__codelineno-63-91 name=__codelineno-63-91 href=#__codelineno-63-91></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-63-92><a id=__codelineno-63-92 name=__codelineno-63-92 href=#__codelineno-63-92></a><span class=gp>... </span>    <span class=n>fixed_fees</span><span class=o>=</span><span class=n>fixed_fees</span><span class=p>,</span>
</span><span id=__span-63-93><a id=__codelineno-63-93 name=__codelineno-63-93 href=#__codelineno-63-93></a><span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span><span id=__span-63-94><a id=__codelineno-63-94 name=__codelineno-63-94 href=#__codelineno-63-94></a><span class=gp>... </span>    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-63-95><a id=__codelineno-63-95 name=__codelineno-63-95 href=#__codelineno-63-95></a><span class=gp>... </span>    <span class=n>skipna</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-63-96><a id=__codelineno-63-96 name=__codelineno-63-96 href=#__codelineno-63-96></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-97><a id=__codelineno-63-97 name=__codelineno-63-97 href=#__codelineno-63-97></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>  <span class=c1># (12)!</span>
</span><span id=__span-63-98><a id=__codelineno-63-98 name=__codelineno-63-98 href=#__codelineno-63-98></a><span class=go>   Order Id  Column                 Timestamp  Size    Price      Fees  Side</span>
</span><span id=__span-63-99><a id=__codelineno-63-99 name=__codelineno-63-99 href=#__codelineno-63-99></a><span class=go>0         0       0 2022-01-22 12:00:00+00:00  4.99  0.00277  0.000010   Buy</span>
</span><span id=__span-63-100><a id=__codelineno-63-100 name=__codelineno-63-100 href=#__codelineno-63-100></a><span class=go>1         1       0 2022-01-29 02:00:00+00:00  4.99  0.00243  0.000009  Sell</span>
</span><span id=__span-63-101><a id=__codelineno-63-101 name=__codelineno-63-101 href=#__codelineno-63-101></a>
</span><span id=__span-63-102><a id=__codelineno-63-102 name=__codelineno-63-102 href=#__codelineno-63-102></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (13)!</span>
</span></code></pre></div> <ol> <li>Commission paid for each trade is provided in absolute terms, thus name it "fixed fees" to avoid confusion with "fees" that are usually given in %. Also, make sure that this number is provided in the quote currency (BTC in our example).</li> <li>Put the trades into a DataFrame for easier handling</li> <li>Timezone must be the same as coming from Binance - UTC</li> <li>Pull the hourly SOL/BTC data ranging from the day before the first trade to the day after the last trade (this time buffer is optional)</li> <li>Datetime index of the pulled data acts as a backbone to our time-series analysis, thus we need to put our trades to timestamps present in this index. For this, we need to create an instance of <a href=../../../api/base/resampling/base/index.html#vectorbtpro.base.resampling.base.Resampler>Resampler</a> mapping the trade timestamps to the pulled bars.</li> <li>Since some trades (second and third in our example) may fall into the same hour and <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_orders>Portfolio.from_orders</a> cannot execute multiple orders at the same bar, we need to aggregate their information</li> <li>Implement a meta function that reduces the price of all the trades that fall into the same bar using the size-weighted average</li> <li>Pass the resampler and the meta function to <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.resample_to_index>GenericAccessor.resample_to_index</a> to resample the trade price</li> <li>Display the aggregated price points for validation</li> <li>Size and fixed fees can be easily aggregated using the sum operation</li> <li>Backtest the trades by setting the initial "cash" to 0.1 BTC and skipping missing data points</li> <li>Filled orders have the same information as our trades</li> <li>Plot the portfolio</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/documentation/pf/from_orders_pf_plot.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/documentation/pf/from_orders_pf_plot.dark.svg#only-dark></p> <p>We can now change the <code>size</code>, <code>price</code>, and <code>fixed_fees</code> arrays to our liking and re-run the simulation to see how the performance of our trading strategy has been affected <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f9ec.svg title=:dna:></p> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>As we just learned, vectorbt deploys a range of preset simulators, each consisting of a Numba-compiled core, and a class method on top of <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> that wraps that core and supports it with diverse enhancements that make it easier and user-friendlier to operate. In particular, we looked at the most primitive simulator - "from orders", which takes a shape (timestamps x assets + parameter combinations), and at each single element of that shape, puts different information pieces like puzzles together to create an order instance. For visual thinkers: you can imagine it taking all arrays together, broadcasting them on the fly against a common shape, and overlaying them on top of each other to form a cube where each element viewed from top is a vector with order information from <a href=../../../api/portfolio/enums/index.html#vectorbtpro.portfolio.enums.Order>Order</a>. </p> <p>Because of flexible indexing, we don't have to actually broadcast and materialize all those arrays - vectorbt is smart enough to project (i.e., extrapolate) smaller arrays to bigger shapes, such that we can supply incomplete information per timestamp, per asset, or per the entire matrix, as if we supplied that information per each element. This way, there is almost no additional memory footprint, which allows us to conveniently work on big data and perform hyperparameter optimization without leaving Numba, as long as all input arrays fit into RAM, of course <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f609.svg title=:wink:></p> <p>Finally, this documentation piece gave us a glimpse into how vectorbt gradually stacks various levels of abstraction to automate tasks. We started with just two commands - buy and sell, added tons of features on the way, and ended up with a Python method that makes it almost ridiculously easy to backtest things. And still, this method lies at the bottom of the food chain: it cannot backtest trading strategies where orders depend on the current simulation state, that is, we have to know all the order information prior to starting the simulation. But get ready, that's where signals and order functions come into play!</p> <p><a class=md-button href=../../../assets/jupytext/documentation/portfolio/from-orders.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5h1.18m-4.28 11.79c-.4 0-.72.3-.72.89 0 .59.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68H4.86M9.14 5.71c.4 0 .72-.3.72-.89 0-.59-.32-.71-.72-.71-.39 0-.71.12-.71.71s.32.89.71.89Z"/></svg></span> Python code</a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../index.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Portfolio"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Portfolio </div> </div> </a> <a href=../from-signals/index.html class="md-footer__link md-footer__link--next" aria-label="Next: From signals"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> From signals </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2024 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.sections", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.ede584c9.min.js></script> <script src=../../../assets/scripts/extra.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/documentation/portfolio/from-orders/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:50:45 GMT -->
</html>