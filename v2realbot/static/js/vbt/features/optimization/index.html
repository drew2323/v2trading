<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/features/optimization/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:52:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Optimization features of VectorBT PRO"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/features/optimization/ rel=canonical><link href=../portfolio/index.html rel=prev><link href=../analysis/index.html rel=next><link rel=icon href=../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.18+insiders-4.53.6"><title>Optimization - VectorBT PRO</title><link rel=stylesheet href=../../assets/stylesheets/main.d5b5f0fd.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><link rel=stylesheet href=../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0C5VNYCFHL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=robots content=noindex><meta property=og:title content=Optimization><meta property=og:type content=website><meta content=https://vectorbt.pro/features/optimization/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_54404668/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Optimization features of VectorBT PRO"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=../../assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=../../assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=../../assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../assets/logo/favicon-16x16.png><link rel=manifest href=../../assets/logo/site.webmanifest><link rel=mask-icon href=../../assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=../../assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_54404668/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#optimization class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <i>New</i>: Smart Money Concepts, Hurst exponent, tasks, iterated decorator, and <a href=../index.html><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.2c0 13.1 5.4 25.7 14.9 34.7l84.7 80.8c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9z"/></svg></span> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=../../index.html title="VectorBT PRO" class="md-header__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT PRO <span class=md-version> v2024.6.19 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224 64c-44.2 0-80 35.8-80 80v48h240c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16v-48C80 64.5 144.5 0 224 0c57.5 0 107 33.7 130.1 82.3 7.6 16 .8 35.1-15.2 42.6s-35.1.8-42.6-15.2C283.4 82.6 255.9 64 224 64zm32 320c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32s14.3 32 32 32h64z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Optimization </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> Getting started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../overview/index.html class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../tutorials/overview/index.html class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../documentation/overview/index.html class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../api/index.html class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../cookbook/overview/index.html class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=../../terms/terms-of-use/index.html class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title="VectorBT PRO" class="md-nav__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../assets/logo/logo.svg alt=logo class=logo> </a> VectorBT PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../index.html class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class=md-nav__item> <a href=../portfolio/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg> <span class=md-ellipsis> Optimization </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg> <span class=md-ellipsis> Optimization </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#purged-cv class=md-nav__link> <span class=md-ellipsis> Purged CV </span> </a> </li> <li class=md-nav__item> <a href=#paramables class=md-nav__link> <span class=md-ellipsis> Paramables </span> </a> </li> <li class=md-nav__item> <a href=#lazy-parameter-grids class=md-nav__link> <span class=md-ellipsis> Lazy parameter grids </span> </a> </li> <li class=md-nav__item> <a href=#mono-chunks class=md-nav__link> <span class=md-ellipsis> Mono-chunks </span> </a> </li> <li class=md-nav__item> <a href=#cv-decorator class=md-nav__link> <span class=md-ellipsis> CV decorator </span> </a> </li> <li class=md-nav__item> <a href=#split-decorator class=md-nav__link> <span class=md-ellipsis> Split decorator </span> </a> </li> <li class=md-nav__item> <a href=#conditional-parameters class=md-nav__link> <span class=md-ellipsis> Conditional parameters </span> </a> </li> <li class=md-nav__item> <a href=#splitter class=md-nav__link> <span class=md-ellipsis> Splitter </span> </a> </li> <li class=md-nav__item> <a href=#random-search class=md-nav__link> <span class=md-ellipsis> Random search </span> </a> </li> <li class=md-nav__item> <a href=#parameterized-decorator class=md-nav__link> <span class=md-ellipsis> Parameterized decorator </span> </a> </li> <li class=md-nav__item> <a href=#riskfolio-lib class=md-nav__link> <span class=md-ellipsis> Riskfolio-Lib </span> </a> </li> <li class=md-nav__item> <a href=#array-like-parameters class=md-nav__link> <span class=md-ellipsis> Array-like parameters </span> </a> </li> <li class=md-nav__item> <a href=#parameters class=md-nav__link> <span class=md-ellipsis> Parameters </span> </a> </li> <li class=md-nav__item> <a href=#portfolio-optimization class=md-nav__link> <span class=md-ellipsis> Portfolio optimization </span> </a> </li> <li class=md-nav__item> <a href=#pyportfolioopt class=md-nav__link> <span class=md-ellipsis> PyPortfolioOpt </span> </a> </li> <li class=md-nav__item> <a href=#universal-portfolios class=md-nav__link> <span class=md-ellipsis> Universal Portfolios </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2 0 1.77-1.43 3.2-3.2 3.2-1.77 0-3.2-1.43-3.2-3.2 0-1.77 1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8Z"/></svg> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../productivity/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9M12 7a5 5 0 0 0-5 5 5 5 0 0 0 5 5 5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg> <span class=md-ellipsis> Productivity </span> </a> </li> <li class=md-nav__item> <a href=../performance/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41-.39.39-1.03.39-1.42.01A9.969 9.969 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13Z"/></svg> <span class=md-ellipsis> Performance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tutorials/overview/index.html class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../documentation/overview/index.html class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../api/index.html class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../cookbook/overview/index.html class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../terms/terms-of-use/index.html class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=optimization><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg></span> Optimization<a class=headerlink href=#optimization title="Permanent link">&para;</a></h1> <h2 id=purged-cv>Purged CV<a class=headerlink href=#purged-cv title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/v2024_4_1.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Added support for walk-forward cross-validation (CV) with purging and combinatorial CV with purging and embargoing, as inspired by the Marcos Lopez de Prado's <a href=https://www.wiley.com/en-us/Advances+in+Financial+Machine+Learning-p-9781119482086>Advances in Financial Machine Learning</a>.</li> </ul> <div class="language-pycon highlight"><span class=filename>Create and plot a combinatorial splitter with purging and embargoing</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_purged_kfold</span><span class=p>(</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2024&quot;</span><span class=p>,</span> <span class=s2>&quot;2025&quot;</span><span class=p>),</span> 
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>... </span>    <span class=n>n_folds</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>... </span>    <span class=n>n_test_folds</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> 
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>... </span>    <span class=n>purge_td</span><span class=o>=</span><span class=s2>&quot;3 days&quot;</span><span class=p>,</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>... </span>    <span class=n>embargo_td</span><span class=o>=</span><span class=s2>&quot;3 days&quot;</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plots</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/features/purged_cv.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/purged_cv.dark.svg#only-dark></p> <h2 id=paramables>Paramables<a class=headerlink href=#paramables title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/v2024_4_1.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Each analyzable VBT object (such as data, indicator, or portfolio) can now be split into items - multiple objects of the same type with only one column/group. This enables using VBT objects as standalone parameters and processing only a subset of information, such as symbol in a data instance or parameter combination in an indicator, at a time.</li> </ul> <div class="language-pycon highlight"><span class=filename>Combine outputs of a SMA indicator combinatorially</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>get_signals</span><span class=p>(</span><span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>([</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;ETH-USD&quot;</span><span class=p>])</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib:sma&quot;</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>  <span class=c1># (2)!</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fast_sma</span> <span class=o>=</span> <span class=n>sma</span><span class=o>.</span><span class=n>rename_levels</span><span class=p>({</span><span class=s2>&quot;sma_timeperiod&quot;</span><span class=p>:</span> <span class=s2>&quot;fast&quot;</span><span class=p>})</span>  <span class=c1># (3)!</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>slow_sma</span> <span class=o>=</span> <span class=n>sma</span><span class=o>.</span><span class=n>rename_levels</span><span class=p>({</span><span class=s2>&quot;sma_timeperiod&quot;</span><span class=p>:</span> <span class=s2>&quot;slow&quot;</span><span class=p>})</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>get_signals</span><span class=p>(</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_sma</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;__fast__ &lt; __slow__&quot;</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=go>MultiIndex([(20, 22, &#39;BTC-USD&#39;),</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=go>            (20, 22, &#39;ETH-USD&#39;),</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=go>            (20, 24, &#39;BTC-USD&#39;),</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=go>            (20, 24, &#39;ETH-USD&#39;),</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=go>            (20, 26, &#39;BTC-USD&#39;),</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=go>            (20, 26, &#39;ETH-USD&#39;),</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=go>            ...</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=go>            (44, 46, &#39;BTC-USD&#39;),</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=go>            (44, 46, &#39;ETH-USD&#39;),</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=go>            (44, 48, &#39;BTC-USD&#39;),</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=go>            (44, 48, &#39;ETH-USD&#39;),</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=go>            (46, 48, &#39;BTC-USD&#39;),</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=go>            (46, 48, &#39;ETH-USD&#39;)],</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=go>           names=[&#39;fast&#39;, &#39;slow&#39;, &#39;symbol&#39;], length=210)</span>
</span></code></pre></div> <ol> <li>Regular function that takes two indicators and returns signals</li> <li>Run a SMA indicator once on all time periods</li> <li>Copy the indicator and rename the parameter level to get a distinct indicator instance</li> <li>Pass both indicator instances as parameters. This will split each instance into smaller instances with only one column. Also, remove all columns where fast window &gt;= slow window.</li> </ol> <h2 id=lazy-parameter-grids>Lazy parameter grids<a class=headerlink href=#lazy-parameter-grids title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/v2023_12_23.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <a href=#parameterized-decorator>Parameterized decorator</a> no longer necessarily materializes parameter grids if you're only interested in a subset of all parameter combinations. Consequently, this enables the generation of random parameter combinations to be almost instant, regardless of the total number of all possible parameter combinations.</li> </ul> <div class="language-pycon highlight"><span class=filename>Test a random subset of a huge number of parameter combinations</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>test_combination</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>sl_stop</span><span class=p>,</span> <span class=n>tsl_stop</span><span class=p>,</span> <span class=n>tp_stop</span><span class=p>):</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=gp>... </span>        <span class=s2>&quot;from_random_signals&quot;</span><span class=p>,</span> 
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=gp>... </span>        <span class=n>n</span><span class=o>=</span><span class=n>n</span><span class=p>,</span> 
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=gp>... </span>        <span class=n>sl_stop</span><span class=o>=</span><span class=n>sl_stop</span><span class=p>,</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=gp>... </span>        <span class=n>tsl_stop</span><span class=o>=</span><span class=n>tsl_stop</span><span class=p>,</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=gp>... </span>        <span class=n>tp_stop</span><span class=o>=</span><span class=n>tp_stop</span><span class=p>,</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=gp>... </span>    <span class=p>)</span><span class=o>.</span><span class=n>total_return</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>n</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_stop</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_stop</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_stop</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>len</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>sl_stop</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>tsl_stop</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>tp_stop</span><span class=p>)</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=go>89730269910</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_combination</span><span class=p>(</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>),</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>n</span><span class=p>),</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>sl_stop</span><span class=p>),</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=gp>... </span>    <span class=n>tsl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>tsl_stop</span><span class=p>),</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>tp_stop</span><span class=p>),</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=gp>... </span>    <span class=n>_random_subset</span><span class=o>=</span><span class=mi>10</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=go>n   sl_stop  tsl_stop  tp_stop</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=go>34  0.188    0.916     0.749       6.869901</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=go>44  0.176    0.734     0.550       6.186478</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a><span class=go>50  0.421    0.245     0.253       0.540188</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a><span class=go>51  0.033    0.951     0.344       6.514647</span>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a><span class=go>    0.915    0.461     0.322       2.915987</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=go>73  0.057    0.690     0.008      -0.204080</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=go>74  0.368    0.360     0.935      14.207262</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a><span class=go>76  0.771    0.342     0.187      -0.278499</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=go>83  0.796    0.788     0.730       6.450076</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a><span class=go>96  0.873    0.429     0.815      18.670965</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=go>dtype: float64</span>
</span></code></pre></div> <h2 id=mono-chunks>Mono-chunks<a class=headerlink href=#mono-chunks title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_13_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <a href=#parameterized-decorator>Parameterized decorator</a> has been extended to split parameter combinations into so-called "mono-chunks", merge the parameter values within each chunk into a single value, and execute the entire chunk with a single function call. This way, you are not limited by only one parameter combination being processed at a time anymore <img alt=ðŸŒª class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f32a.svg title=:cloud_tornado:> Just note: you must adapt the function to take multiple parameter values and change the merging function as appropriate.</li> </ul> <div class="language-pycon highlight"><span class=filename>Test 100 combinations of SL and TP values per thread</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span> 
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=gp>... </span>    <span class=n>mono_chunk_len</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=gp>... </span>    <span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=gp>... </span>    <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;threadpool&quot;</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=gp>... </span>    <span class=n>warmup</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (4)!</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=gp>... </span><span class=p>)</span>  
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=gp>... </span><span class=nd>@njit</span><span class=p>(</span><span class=n>nogil</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=gp>... </span><span class=k>def</span> <span class=nf>test_stops_nb</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>,</span> <span class=n>sl_stop</span><span class=p>,</span> <span class=n>tp_stop</span><span class=p>):</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=gp>... </span>    <span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_signals_nb</span><span class=p>(</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=gp>... </span>        <span class=n>target_shape</span><span class=o>=</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>sl_stop</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=gp>... </span>        <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>sl_stop</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>),</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=gp>... </span>        <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=gp>... </span>        <span class=n>long_entries</span><span class=o>=</span><span class=n>entries</span><span class=p>,</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=gp>... </span>        <span class=n>short_entries</span><span class=o>=</span><span class=n>exits</span><span class=p>,</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=gp>... </span>        <span class=n>sl_stop</span><span class=o>=</span><span class=n>sl_stop</span><span class=p>,</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=gp>... </span>        <span class=n>tp_stop</span><span class=o>=</span><span class=n>tp_stop</span><span class=p>,</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=gp>... </span>        <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ret_nb</span><span class=o>.</span><span class=n>cum_returns_final_nb</span><span class=p>(</span><span class=n>sim_out</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;randnx&quot;</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (6)!</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sharpe_ratios</span> <span class=o>=</span> <span class=n>test_stops_nb</span><span class=p>(</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>),</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>entries</span><span class=p>),</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>exits</span><span class=p>),</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>),</span> <span class=n>mono_merge_func</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>),</span>  <span class=c1># (7)!</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>),</span> <span class=n>mono_merge_func</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>)</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sharpe_ratios</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>heatmap</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>100 values will make up one array (= 1 mono-chunk)</li> <li>Execute N mono-chunks in parallel, where N is the number of cores</li> <li>Use multithreading</li> <li>Execute one mono-chunk to compile the function before distribution</li> <li>The function above works with only one symbol</li> <li>Pick 10 entries and exits randomly</li> <li>For each mono-chunk, stack all values into a two-dimensional array</li> </ol> <p><img alt class=iimg loading=lazy src=../../assets/images/features/chunked_params.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/chunked_params.dark.svg#only-dark></p> <h2 id=cv-decorator>CV decorator<a class=headerlink href=#cv-decorator title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_8_1.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Most cross-validation tasks involve testing a grid of parameter combinations on the training data, selecting the best parameter combination, and validating it on the test data. This procedure needs to be repeated on each split. The cross-validation decorator combines the parameterized and split decorators to automate such a task.</li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/cross-validation/index.html>Cross-validation</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Cross-validate a SMA crossover using random search</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>cv_split</span><span class=p>(</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>... </span>    <span class=n>splitter</span><span class=o>=</span><span class=s2>&quot;from_rolling&quot;</span><span class=p>,</span> 
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>... </span>    <span class=n>splitter_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mi>365</span><span class=p>,</span> <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>]),</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>... </span>    <span class=n>takeable_args</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>],</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=gp>... </span>    <span class=n>parameterized_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>random_subset</span><span class=o>=</span><span class=mi>100</span><span class=p>),</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=gp>... </span><span class=k>def</span> <span class=nf>sma_crossover_cv</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_period</span><span class=p>,</span> <span class=n>slow_period</span><span class=p>,</span> <span class=n>metric</span><span class=p>):</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=gp>... </span>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=n>fast_period</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=gp>... </span>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=n>slow_period</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=gp>... </span>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>,</span> <span class=n>direction</span><span class=o>=</span><span class=s2>&quot;both&quot;</span><span class=p>)</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>deep_getattr</span><span class=p>(</span><span class=n>metric</span><span class=p>)</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma_crossover_cv</span><span class=p>(</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;4 years ago&quot;</span><span class=p>),</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;x &lt; slow_period&quot;</span><span class=p>),</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>)),</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=gp>... </span>    <span class=s2>&quot;trades.expectancy&quot;</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Split 7/7</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=go>split  set    fast_period  slow_period</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=go>0      train  20           25               8.015725</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=go>       test   20           23               0.573465</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=go>1      train  40           48              -4.356317</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=go>       test   39           40               5.666271</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=go>2      train  24           45              18.253340</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=go>       test   22           36             111.202831</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=go>3      train  20           31              54.626024</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=go>       test   20           25              -1.596945</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=go>4      train  25           48              41.328588</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=go>       test   25           30               6.620254</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=go>5      train  26           32               7.178085</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=go>       test   24           29               4.087456</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=go>6      train  22           23              -0.581255</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=go>       test   22           31              -2.494519</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=go>dtype: float64</span>
</span></code></pre></div> <h2 id=split-decorator>Split decorator<a class=headerlink href=#split-decorator title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_8_1.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Normally, to run a function on each split, you need to build a splitter specifically targeted at the input data passed to the function. That is, each time the input data changes, you need to rebuild the splitter. This process is automated by the split decorator, which wraps a function and thus gets access to all the arguments the function receives to do various splitting decisions. Basically, it can "infect" any Python function with splitting functionality <img alt=ðŸ¦  class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f9a0.svg title=:microbe:></li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/cross-validation/index.html>Cross-validation</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Get total return from holding in each quarter</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>split</span><span class=p>(</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=gp>... </span>    <span class=n>splitter</span><span class=o>=</span><span class=s2>&quot;from_grouper&quot;</span><span class=p>,</span> 
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=gp>... </span>    <span class=n>splitter_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s2>&quot;Q&quot;</span><span class=p>),</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=gp>... </span>    <span class=n>takeable_args</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>],</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=gp>... </span><span class=k>def</span> <span class=nf>get_quarter_return</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_quarter_return</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2021&quot;</span><span class=p>])</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=go>Date</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=go>2021Q1    1.005805</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=go>2021Q2   -0.407050</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=go>2021Q3    0.304383</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=go>2021Q4   -0.037627</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=go>Freq: Q-DEC, dtype: float64</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_quarter_return</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2022&quot;</span><span class=p>])</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=go>Date</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=go>2022Q1   -0.045047</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=go>2022Q2   -0.572515</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=go>2022Q3    0.008429</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=go>2022Q4   -0.143154</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=go>Freq: Q-DEC, dtype: float64</span>
</span></code></pre></div> <h2 id=conditional-parameters>Conditional parameters<a class=headerlink href=#conditional-parameters title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_8_1.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Parameters can depend on each other. For instance, when testing a crossover of moving averages, it makes no sense to test a fast window that has a bigger length than the slow window. By filtering such cases out, you only need to evaluate half as many parameter combinations.</li> </ul> <div class="language-pycon highlight"><span class=filename>Test slow windows being longer than fast windows by at least 5</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>ma_crossover_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=gp>... </span>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>)</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=gp>... </span>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>,</span> <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;slow_sma&quot;</span><span class=p>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=o>.</span><span class=n>real</span><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=o>.</span><span class=n>real</span><span class=p>)</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>ma_crossover_signals</span><span class=p>(</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;one year ago UTC&quot;</span><span class=p>),</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;slow_window - fast_window &gt;= 5&quot;</span><span class=p>),</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>))</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=go>MultiIndex([( 5, 10),</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=go>            ( 5, 11),</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=go>            ( 5, 12),</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=go>            ( 5, 13),</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=go>            ( 5, 14),</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=go>            ...</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=go>            (42, 48),</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=go>            (42, 49),</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=go>            (43, 48),</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=go>            (43, 49),</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=go>            (44, 49)],</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=go>           names=[&#39;fast_window&#39;, &#39;slow_window&#39;], length=820)</span>
</span></code></pre></div> <h2 id=splitter>Splitter<a class=headerlink href=#splitter title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_8_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Splitters in <a href=https://scikit-learn.org/stable/ >scikit-learn</a> are a poor fit for validating ML-based and rule-based trading strategies; VBT has a juggernaut class that supports various splitting schemes safe for backtesting, including rolling windows, expanding windows, time-anchored windows, random windows for block bootstraps, and even Pandas-native <code>groupby</code> and <code>resample</code> instructions such as "M" for monthly frequency. As the cherry on the cake, the produced splits can be easily analyzed and visualized too! For example, you can detect any split or set overlaps, convert all the splits into a single boolean mask for custom analysis, group splits and sets, and analyze their distribution relative to each other. The class has more lines of code than the entire <a href=https://github.com/kernc/backtesting.py>backtesting.py</a> package, don't underestimate the new king in town! <img alt=ðŸ¦ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f98f.svg title=:rhinoceros:></li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/cross-validation/index.html>Cross-validation</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Roll a 360-day window and split it equally into train and test sets</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;4 years ago&quot;</span><span class=p>)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=s2>&quot;360 days&quot;</span><span class=p>,</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=gp>... </span>    <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>],</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=gp>... </span>    <span class=n>freq</span><span class=o>=</span><span class=s2>&quot;daily&quot;</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plots</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/features/splitter.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/splitter.dark.svg#only-dark></p> <h2 id=random-search>Random search<a class=headerlink href=#random-search title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_7_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> While grid search looks at every possible combination of hyperparameters, random search only selects and tests a random combination of hyperparameters. This is especially useful when the number of parameter combinations is huge. Also, random search has shown to find equal or better values than grid search within fewer function evaluations. The indicator factory, parameterized decorator, and any method that does broadcasting now supports random search out of the box.</li> </ul> <div class="language-pycon highlight"><span class=filename>Test a random subset of SL, TSL, and TP combinations</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stop_values</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span>  <span class=c1># (1)!</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> 
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>stop_values</span><span class=p>),</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=gp>... </span>    <span class=n>tsl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>stop_values</span><span class=p>),</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>stop_values</span><span class=p>),</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=gp>... </span>    <span class=n>broadcast_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>random_subset</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>total_return</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=go>sl_stop  tsl_stop  tp_stop</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=go>0.06     0.85      0.43       2.291260</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=go>         0.74      0.40       2.222212</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=go>         0.97      0.22       2.149849</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=go>0.40     0.10      0.23       2.082935</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=go>0.47     0.09      0.25       2.030105</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=go>                                   ...</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=go>0.51     0.36      0.01      -0.618805</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=go>0.53     0.37      0.01      -0.624761</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=go>0.35     0.60      0.02      -0.662992</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=go>0.29     0.13      0.02      -0.671376</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=go>0.46     0.72      0.02      -0.720024</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=go>Name: total_return, Length: 1000, dtype: float64</span>
</span></code></pre></div> <ol> <li>100 combinations of each parameter = 100 ^ 3 = 1,000,000 combinations</li> <li>Indicator factory and parameterized decorator take this argument directly</li> </ol> <h2 id=parameterized-decorator>Parameterized decorator<a class=headerlink href=#parameterized-decorator title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_7_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> There is a special decorator that can make any Python function accept multiple parameter combinations, even if the function itself can handle only one! The decorator wraps the function, thus getting access to its arguments; it then identifies all the arguments that act as parameters, builds a grid of them, and calls the underlying function on each parameter combination from that grid. The execution part can be easily parallelized. After all the outputs are ready, it merges them into a single object. Use cases are endless: from running indicators that cannot be wrapped with the indicator factory, to parameterizing entire pipelines! <img alt=ðŸª„ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1fa84.svg title=:magic_wand:></li> </ul> <div class="language-pycon highlight"><span class=filename>Example 1: Parameterize a simple SMA indicator without Indicator Factory</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>sma</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>close</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>50</span><span class=p>)))</span>
</span></code></pre></div> <ol> <li>Use <code>column_stack</code> for merging time series in form of DataFrames and complex vectorbt objects such as portfolios</li> </ol> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Combination 30/30</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=go>window                               20            21            22  \</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=go>Date                                                                  </span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=go>2014-09-17 00:00:00+00:00           NaN           NaN           NaN   </span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=go>2014-09-18 00:00:00+00:00           NaN           NaN           NaN   </span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=go>2014-09-19 00:00:00+00:00           NaN           NaN           NaN   </span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=go>...                                 ...           ...           ...   </span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=go>2024-03-07 00:00:00+00:00  57657.135156  57395.376488  57147.339134   </span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=go>2024-03-08 00:00:00+00:00  58488.990039  58163.942708  57891.045455   </span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=go>2024-03-09 00:00:00+00:00  59297.836523  58956.156064  58624.648793   </span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=go>...</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=go>window                               48            49  </span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=go>Date                                                   </span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=go>2014-09-17 00:00:00+00:00           NaN           NaN  </span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=go>2014-09-18 00:00:00+00:00           NaN           NaN  </span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=go>2014-09-19 00:00:00+00:00           NaN           NaN  </span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=go>...                                 ...           ...  </span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=go>2024-03-07 00:00:00+00:00  49928.186686  49758.599330  </span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=go>2024-03-08 00:00:00+00:00  50483.072266  50303.123565  </span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=go>2024-03-09 00:00:00+00:00  51040.440837  50846.672353  </span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=go>[3462 rows x 30 columns]</span>
</span></code></pre></div> <div class="language-pycon highlight"><span class=filename>Example 2: Parameterize an entire Bollinger Bands pipeline</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>bbands_sharpe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=mi>14</span><span class=p>,</span> <span class=n>nbdevup</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>nbdevdn</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>thup</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span> <span class=n>thdn</span><span class=o>=</span><span class=mf>0.1</span><span class=p>):</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>    <span class=n>bb</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>... </span>        <span class=s2>&quot;talib_bbands&quot;</span><span class=p>,</span> 
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=gp>... </span>        <span class=n>timeperiod</span><span class=o>=</span><span class=n>timeperiod</span><span class=p>,</span> 
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=gp>... </span>        <span class=n>nbdevup</span><span class=o>=</span><span class=n>nbdevup</span><span class=p>,</span> 
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=gp>... </span>        <span class=n>nbdevdn</span><span class=o>=</span><span class=n>nbdevdn</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=gp>... </span>    <span class=n>bandwidth</span> <span class=o>=</span> <span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>upperband</span> <span class=o>-</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>)</span> <span class=o>/</span> <span class=n>bb</span><span class=o>.</span><span class=n>middleband</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=gp>... </span>    <span class=n>cond1</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>low</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=gp>... </span>    <span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>thup</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=gp>... </span>    <span class=n>cond3</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>high</span> <span class=o>&gt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=gp>... </span>    <span class=n>cond4</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&lt;</span> <span class=n>thdn</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>cond3</span> <span class=o>&amp;</span> <span class=n>cond4</span><span class=p>)</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond4</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>cond3</span> <span class=o>&amp;</span> <span class=n>cond2</span><span class=p>)</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=gp>... </span>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bbands_sharpe</span><span class=p>(</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>),</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=gp>... </span>    <span class=n>nbdevup</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=gp>... </span>    <span class=n>nbdevdn</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]),</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=gp>... </span>    <span class=n>thup</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>]),</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=gp>... </span>    <span class=n>thdn</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>])</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Use <code>concat</code> for merging metrics in form of scalars and Series</li> <li>Build the Cartesian product of 4 parameters</li> </ol> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Combination 16/16</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=go>nbdevup  nbdevdn  thup  thdn</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=go>1        1        0.4   0.1     1.681532</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=go>                        0.2     1.617400</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=go>                  0.5   0.1     1.424175</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=go>                        0.2     1.563520</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=go>         2        0.4   0.1     1.218554</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=go>                        0.2     1.520852</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=go>                  0.5   0.1     1.242523</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=go>                        0.2     1.317883</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=go>2        1        0.4   0.1     1.174562</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=go>                        0.2     1.469828</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=go>                  0.5   0.1     1.427940</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=go>                        0.2     1.460635</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=go>         2        0.4   0.1     1.000210</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=go>                        0.2     1.378108</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=go>                  0.5   0.1     1.196087</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=go>                        0.2     1.782502</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=go>dtype: float64</span>
</span></code></pre></div> <h2 id=riskfolio-lib>Riskfolio-Lib<a class=headerlink href=#riskfolio-lib title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_7_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <a href=https://github.com/dcajasn/Riskfolio-Lib>Riskfolio-Lib</a> is another increasingly popular library for portfolio optimization that has been integrated into VBT. The integration was done by automating typical workflows inside Riskfolio-Lib and putting them into a single function, such that many portfolio optimization problems can be expressed using a single set of keyword arguments and thus parameterized easily.</li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/portfolio-optimization/index.html>Portfolio optimization</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Run Nested Clustered Optimization (NCO) on a monthly basis</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;SPY&quot;</span><span class=p>,</span> <span class=s2>&quot;TLT&quot;</span><span class=p>,</span> <span class=s2>&quot;XLF&quot;</span><span class=p>,</span> <span class=s2>&quot;XLE&quot;</span><span class=p>,</span> <span class=s2>&quot;XLU&quot;</span><span class=p>,</span> <span class=s2>&quot;XLK&quot;</span><span class=p>,</span> <span class=s2>&quot;XLB&quot;</span><span class=p>,</span> <span class=s2>&quot;XLP&quot;</span><span class=p>,</span> <span class=s2>&quot;XLY&quot;</span><span class=p>,</span> <span class=s2>&quot;XLI&quot;</span><span class=p>,</span> <span class=s2>&quot;XLV&quot;</span><span class=p>],</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2023&quot;</span><span class=p>,</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=gp>... </span>    <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PFO</span><span class=o>.</span><span class=n>from_riskfolio</span><span class=p>(</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=gp>... </span>    <span class=n>returns</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_returns</span><span class=p>(),</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=gp>... </span>    <span class=n>port_cls</span><span class=o>=</span><span class=s2>&quot;hc&quot;</span><span class=p>,</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;M&quot;</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/features/riskfolio_lib.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/riskfolio_lib.dark.svg#only-dark></p> <h2 id=array-like-parameters>Array-like parameters<a class=headerlink href=#array-like-parameters title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_5_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Broadcasting mechanism has been completely refactored and now supports parameters. Many parameters in VBT, such as SL and TP, are array-like and can be provided per row, column, and even element. Internally, even a scalar is treated like a regular time series and broadcasted along other proper time series. Thus, to test multiple parameter combinations, one had to tile other time series such that all shapes perfectly match. With this feature, the tiling procedure is performed automatically!</li> </ul> <div class="language-pycon highlight"><span class=filename>Write a steep slope indicator without indicator factory</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>steep_slope</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>up_th</span><span class=p>):</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>... </span>    <span class=n>r</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span> <span class=n>up_th</span><span class=o>=</span><span class=n>up_th</span><span class=p>))</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>r</span><span class=p>[</span><span class=s2>&quot;close&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>r</span><span class=p>[</span><span class=s2>&quot;up_th&quot;</span><span class=p>]</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022&quot;</span><span class=p>)</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;SMA&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=mi>50</span><span class=p>)</span><span class=o>.</span><span class=n>real</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;SMA&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>steep_slope</span><span class=p>(</span><span class=n>sma</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.005</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.015</span><span class=p>]))</span>  <span class=c1># (1)!</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>plot_mask_ranges</span><span class=p>(</span><span class=n>column</span><span class=p>,</span> <span class=n>color</span><span class=p>):</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=gp>... </span>    <span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>ranges</span><span class=o>.</span><span class=n>plot_shapes</span><span class=p>(</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=gp>... </span>        <span class=n>column</span><span class=o>=</span><span class=n>column</span><span class=p>,</span> 
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=gp>... </span>        <span class=n>plot_close</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=gp>... </span>        <span class=n>shape_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>fillcolor</span><span class=o>=</span><span class=n>color</span><span class=p>),</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=gp>... </span>        <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_mask_ranges</span><span class=p>(</span><span class=mf>0.005</span><span class=p>,</span> <span class=s2>&quot;orangered&quot;</span><span class=p>)</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_mask_ranges</span><span class=p>(</span><span class=mf>0.010</span><span class=p>,</span> <span class=s2>&quot;orange&quot;</span><span class=p>)</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_mask_ranges</span><span class=p>(</span><span class=mf>0.015</span><span class=p>,</span> <span class=s2>&quot;yellow&quot;</span><span class=p>)</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>update_xaxes</span><span class=p>(</span><span class=n>showgrid</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>update_yaxes</span><span class=p>(</span><span class=n>showgrid</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Test three parameters and generate a mask with three columns - one per parameter</li> </ol> <p><img alt class=iimg loading=lazy src=../../assets/images/features/steep_slope.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/steep_slope.dark.svg#only-dark></p> <h2 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_5_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> There is a new module addition for working with parameters.</li> </ul> <div class="language-pycon highlight"><span class=filename>Generate 10,000 random parameter combinations for MACD</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>combinations</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>window_space</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fastk_windows</span><span class=p>,</span> <span class=n>slowk_windows</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=n>combinations</span><span class=p>(</span><span class=n>window_space</span><span class=p>,</span> <span class=mi>2</span><span class=p>)))</span>  <span class=c1># (1)!</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>window_type_space</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>WType</span><span class=p>)</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>param_product</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>combine_params</span><span class=p>(</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>... </span>    <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=gp>... </span>        <span class=n>fast_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fastk_windows</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=gp>... </span>        <span class=n>slow_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slowk_windows</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=gp>... </span>        <span class=n>signal_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>window_space</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=gp>... </span>        <span class=n>macd_wtype</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>window_type_space</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=gp>... </span>        <span class=n>signal_wtype</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>window_type_space</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=gp>... </span>    <span class=n>random_subset</span><span class=o>=</span><span class=mi>10_000</span><span class=p>,</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=gp>... </span>    <span class=n>build_index</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>param_product</span><span class=p>)</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=go>      fast_window  slow_window  signal_window  macd_wtype  signal_wtype</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=go>0               0            1             47           3             3</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=go>1               0            2             21           2             2</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=go>2               0            2             33           1             1</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=go>3               0            2             42           1             1</span>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=go>4               0            3             52           1             1</span>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=go>...           ...          ...            ...         ...           ...</span>
</span><span id=__span-16-25><a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=go>9995           97           99             19           1             1</span>
</span><span id=__span-16-26><a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=go>9996           97           99             92           4             4</span>
</span><span id=__span-16-27><a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a><span class=go>9997           98           99              2           2             2</span>
</span><span id=__span-16-28><a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=go>9998           98           99             12           1             1</span>
</span><span id=__span-16-29><a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a><span class=go>9999           98           99             81           2             2</span>
</span><span id=__span-16-30><a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>
</span><span id=__span-16-31><a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a><span class=go>[10000 rows x 5 columns]</span>
</span></code></pre></div> <ol> <li>Fast windows should be shorter than slow windows</li> <li>We already combined fast and slow windows, thus make them share the same product level</li> <li>We don't want to combine window types, thus make them share the same product level</li> </ol> <h2 id=portfolio-optimization>Portfolio optimization<a class=headerlink href=#portfolio-optimization title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_2_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Portfolio optimization is the process of creating a portfolio of assets, for which your investment has the maximum return and minimum risk. Usually, this process is performed periodically and involves generating new weights to rebalance an existing portfolio. As most things in VBT, the weight generation step is implemented as a callback by the user while the optimizer calls that callback periodically. The final result is a collection of the returned weight allocations that can be analyzed, visualized, and used in an actual simulation <img alt=ðŸ¥§ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f967.svg title=:pie:></li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/portfolio-optimization/index.html>Portfolio optimization</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Allocate assets inversely to their total return in the last month</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>regime_change_optimize_func</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>... </span>    <span class=n>returns</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=gp>... </span>    <span class=n>total_return</span> <span class=o>=</span> <span class=n>returns</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=gp>... </span>    <span class=n>weights</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill_reduced</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=gp>... </span>    <span class=n>pos_mask</span> <span class=o>=</span> <span class=n>total_return</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>pos_mask</span><span class=o>.</span><span class=n>any</span><span class=p>():</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=gp>... </span>        <span class=n>weights</span><span class=p>[</span><span class=n>pos_mask</span><span class=p>]</span> <span class=o>=</span> <span class=n>total_return</span><span class=p>[</span><span class=n>pos_mask</span><span class=p>]</span> <span class=o>/</span> <span class=n>total_return</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=gp>... </span>    <span class=n>neg_mask</span> <span class=o>=</span> <span class=n>total_return</span> <span class=o>&lt;</span> <span class=mi>0</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>neg_mask</span><span class=o>.</span><span class=n>any</span><span class=p>():</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=gp>... </span>        <span class=n>weights</span><span class=p>[</span><span class=n>neg_mask</span><span class=p>]</span> <span class=o>=</span> <span class=n>total_return</span><span class=p>[</span><span class=n>neg_mask</span><span class=p>]</span> <span class=o>/</span> <span class=n>total_return</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span> <span class=o>*</span> <span class=n>weights</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;SPY&quot;</span><span class=p>,</span> <span class=s2>&quot;TLT&quot;</span><span class=p>,</span> <span class=s2>&quot;XLF&quot;</span><span class=p>,</span> <span class=s2>&quot;XLE&quot;</span><span class=p>,</span> <span class=s2>&quot;XLU&quot;</span><span class=p>,</span> <span class=s2>&quot;XLK&quot;</span><span class=p>,</span> <span class=s2>&quot;XLB&quot;</span><span class=p>,</span> <span class=s2>&quot;XLP&quot;</span><span class=p>,</span> <span class=s2>&quot;XLY&quot;</span><span class=p>,</span> <span class=s2>&quot;XLI&quot;</span><span class=p>,</span> <span class=s2>&quot;XLV&quot;</span><span class=p>],</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2023&quot;</span><span class=p>,</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=gp>... </span>    <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PFO</span><span class=o>.</span><span class=n>from_optimize_func</span><span class=p>(</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=p>,</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=gp>... </span>    <span class=n>regime_change_optimize_func</span><span class=p>,</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;data[index_slice]&quot;</span><span class=p>,</span> <span class=n>context</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)),</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;M&quot;</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/features/portfolio_optimization.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/portfolio_optimization.dark.svg#only-dark></p> <h2 id=pyportfolioopt>PyPortfolioOpt<a class=headerlink href=#pyportfolioopt title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_2_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <a href=https://github.com/robertmartin8/PyPortfolioOpt>PyPortfolioOpt</a> is a popular financial portfolio optimization package that includes both classical methods (Markowitz 1952 and Black-Litterman), suggested best practices (e.g covariance shrinkage), along with many recent developments and novel features, like L2 regularisation, shrunk covariance, and hierarchical risk parity.</li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/portfolio-optimization/index.html>Portfolio optimization</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Run Nested Clustered Optimization (NCO) on a monthly basis</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;SPY&quot;</span><span class=p>,</span> <span class=s2>&quot;TLT&quot;</span><span class=p>,</span> <span class=s2>&quot;XLF&quot;</span><span class=p>,</span> <span class=s2>&quot;XLE&quot;</span><span class=p>,</span> <span class=s2>&quot;XLU&quot;</span><span class=p>,</span> <span class=s2>&quot;XLK&quot;</span><span class=p>,</span> <span class=s2>&quot;XLB&quot;</span><span class=p>,</span> <span class=s2>&quot;XLP&quot;</span><span class=p>,</span> <span class=s2>&quot;XLY&quot;</span><span class=p>,</span> <span class=s2>&quot;XLI&quot;</span><span class=p>,</span> <span class=s2>&quot;XLV&quot;</span><span class=p>],</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2023&quot;</span><span class=p>,</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=gp>... </span>    <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PFO</span><span class=o>.</span><span class=n>from_pypfopt</span><span class=p>(</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=gp>... </span>    <span class=n>returns</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=p>,</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=gp>... </span>    <span class=n>optimizer</span><span class=o>=</span><span class=s2>&quot;hrp&quot;</span><span class=p>,</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=gp>... </span>    <span class=n>target</span><span class=o>=</span><span class=s2>&quot;optimize&quot;</span><span class=p>,</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;M&quot;</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/features/pyportfolioopt.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/pyportfolioopt.dark.svg#only-dark></p> <h2 id=universal-portfolios>Universal Portfolios<a class=headerlink href=#universal-portfolios title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=../../assets/badges/new-in/1_2_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <a href=https://github.com/Marigold/universal-portfolios>Universal Portfolios</a> is a package putting together different Online Portfolio Selection (OLPS) algorithms.</li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=../../tutorials/portfolio-optimization/index.html>Portfolio optimization</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Simulate an online minumum-variance portfolio on a weekly time frame</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;SPY&quot;</span><span class=p>,</span> <span class=s2>&quot;TLT&quot;</span><span class=p>,</span> <span class=s2>&quot;XLF&quot;</span><span class=p>,</span> <span class=s2>&quot;XLE&quot;</span><span class=p>,</span> <span class=s2>&quot;XLU&quot;</span><span class=p>,</span> <span class=s2>&quot;XLK&quot;</span><span class=p>,</span> <span class=s2>&quot;XLB&quot;</span><span class=p>,</span> <span class=s2>&quot;XLP&quot;</span><span class=p>,</span> <span class=s2>&quot;XLY&quot;</span><span class=p>,</span> <span class=s2>&quot;XLI&quot;</span><span class=p>,</span> <span class=s2>&quot;XLV&quot;</span><span class=p>],</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2023&quot;</span><span class=p>,</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=gp>... </span>    <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PFO</span><span class=o>.</span><span class=n>from_universal_algo</span><span class=p>(</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=gp>... </span>    <span class=s2>&quot;MPT&quot;</span><span class=p>,</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s2>&quot;W&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>52</span><span class=p>,</span> 
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=gp>... </span>    <span class=n>min_history</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> 
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=gp>... </span>    <span class=n>mu_estimator</span><span class=o>=</span><span class=s1>&#39;historical&#39;</span><span class=p>,</span> 
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=gp>... </span>    <span class=n>cov_estimator</span><span class=o>=</span><span class=s1>&#39;empirical&#39;</span><span class=p>,</span> 
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=gp>... </span>    <span class=n>method</span><span class=o>=</span><span class=s1>&#39;mpt&#39;</span><span class=p>,</span> 
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=gp>... </span>    <span class=n>q</span><span class=o>=</span><span class=mi>0</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/features/universal_portfolios.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/features/universal_portfolios.dark.svg#only-dark></p> <p><a class=md-button href=../../assets/jupytext/features/optimization.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5h1.18m-4.28 11.79c-.4 0-.72.3-.72.89 0 .59.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68H4.86M9.14 5.71c.4 0 .72-.3.72-.89 0-.59-.32-.71-.72-.71-.39 0-.71.12-.71.71s.32.89.71.89Z"/></svg></span> Python code</a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../portfolio/index.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Portfolio"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Portfolio </div> </div> </a> <a href=../analysis/index.html class="md-footer__link md-footer__link--next" aria-label="Next: Analysis"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Analysis </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2024 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.sections", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.ede584c9.min.js></script> <script src=../../assets/scripts/extra.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/features/optimization/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:52:56 GMT -->
</html>