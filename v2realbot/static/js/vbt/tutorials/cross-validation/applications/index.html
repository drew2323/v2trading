<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/tutorials/cross-validation/applications/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:59:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn about applications of a splitter"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/tutorials/cross-validation/applications/ rel=canonical><link href=../splitter/index.html rel=prev><link href=../../more-tutorials/index.html rel=next><link rel=icon href=../../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.18+insiders-4.53.6"><title>Applications - VectorBT PRO</title><link rel=stylesheet href=../../../assets/stylesheets/main.d5b5f0fd.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><link rel=stylesheet href=../../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0C5VNYCFHL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=robots content=noindex><meta property=og:title content=Applications><meta property=og:type content=website><meta content=https://vectorbt.pro/tutorials/cross-validation/applications/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_54404668/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Learn about applications of a splitter"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=../../../assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=../../../assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=../../../assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../assets/logo/favicon-16x16.png><link rel=manifest href=../../../assets/logo/site.webmanifest><link rel=mask-icon href=../../../assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=../../../assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_54404668/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#applications class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <i>New</i>: Smart Money Concepts, Hurst exponent, tasks, iterated decorator, and <a href=../../../features/index.html><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.2c0 13.1 5.4 25.7 14.9 34.7l84.7 80.8c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9z"/></svg></span> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=../../../index.html title="VectorBT PRO" class="md-header__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../../assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT PRO <span class=md-version> v2024.6.19 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224 64c-44.2 0-80 35.8-80 80v48h240c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16v-48C80 64.5 144.5 0 224 0c57.5 0 107 33.7 130.1 82.3 7.6 16 .8 35.1-15.2 42.6s-35.1.8-42.6-15.2C283.4 82.6 255.9 64 224 64zm32 320c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32s14.3 32 32 32h64z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Applications </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.html class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=../../../features/overview/index.html class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../overview/index.html class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../../documentation/overview/index.html class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../../api/index.html class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../../cookbook/overview/index.html class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=../../../terms/terms-of-use/index.html class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title="VectorBT PRO" class="md-nav__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../../assets/logo/logo.svg alt=logo class=logo> </a> VectorBT PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../features/overview/index.html class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../basic-rsi/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.5 18.5 6-6 4 4L22 6.92 20.59 5.5l-7.09 8-4-4L2 17l1.5 1.5Z"/></svg> <span class=md-ellipsis> Basic RSI strategy </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> SuperFast SuperTrend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> SuperFast SuperTrend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../superfast-supertrend/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> SuperFast SuperTrend </span> </a> </li> <li class=md-nav__item> <a href=../../superfast-supertrend/streaming/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Streaming </span> </a> </li> <li class=md-nav__item> <a href=../../superfast-supertrend/multithreading/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Multithreading </span> </a> </li> <li class=md-nav__item> <a href=../../superfast-supertrend/pipelines/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Pipelines </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Signal development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Signal development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../signal-development/generation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Generation </span> </a> </li> <li class=md-nav__item> <a href=../../signal-development/pre-analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Pre-analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../stop-signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2v22m-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4v-2M19 7v2h2V7h-2m0-2h2a2 2 0 0 0-2-2v2m2 10h-2v2h2v-2m-2-4v2h2v-2h-2m-2-8h-2v2h2V3m2 18c1.11 0 2-.89 2-2h-2v2m-2-2h-2v2h2v-2Z"/></svg> <span class=md-ellipsis> Stop signals </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> MTF analysis </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> MTF analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mtf-analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> MTF analysis </span> </a> </li> <li class=md-nav__item> <a href=../../mtf-analysis/alignment/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> Alignment </span> </a> </li> <li class=md-nav__item> <a href=../../mtf-analysis/aggregation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> Aggregation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Portfolio optimization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Portfolio optimization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../portfolio-optimization/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Portfolio optimization </span> </a> </li> <li class=md-nav__item> <a href=../../portfolio-optimization/integrations/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Integrations </span> </a> </li> <li class=md-nav__item> <a href=../../portfolio-optimization/dynamic/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Dynamic </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../pairs-trading/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 6.92 20.59 5.5l-2.85 3.22C15.68 6.4 12.83 5 9.61 5 6.72 5 4.07 6.16 2 8l1.42 1.42C5.12 7.93 7.27 7 9.61 7c2.74 0 5.09 1.26 6.77 3.24L13.5 13.5l-4-4L2 17l1.5 1.5 6-6 4 4 4.05-4.57c.75 1.35 1.25 2.9 1.45 4.57h2c-.22-2.32-.95-4.41-2.04-6.16L22 6.92Z"/></svg> <span class=md-ellipsis> Pairs trading </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Patterns and projections </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Patterns and projections </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns-and-projections/patterns/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg> <span class=md-ellipsis> Patterns </span> </a> </li> <li class=md-nav__item> <a href=../../patterns-and-projections/projections/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg> <span class=md-ellipsis> Projections </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10 checked> <label class=md-nav__link for=__nav_3_10 id=__nav_3_10_label tabindex> <span class=md-ellipsis> Cross-validation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=true> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Cross-validation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Cross-validation </span> </a> </li> <li class=md-nav__item> <a href=../splitter/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Splitter </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Applications </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Applications </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#taking class=md-nav__link> <span class=md-ellipsis> Taking </span> </a> <nav class=md-nav aria-label=Taking> <ul class=md-nav__list> <li class=md-nav__item> <a href=#without-stacking class=md-nav__link> <span class=md-ellipsis> Without stacking </span> </a> <nav class=md-nav aria-label="Without stacking"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#complex-objects class=md-nav__link> <span class=md-ellipsis> Complex objects </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#column-stacking class=md-nav__link> <span class=md-ellipsis> Column stacking </span> </a> </li> <li class=md-nav__item> <a href=#row-stacking class=md-nav__link> <span class=md-ellipsis> Row stacking </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#applying class=md-nav__link> <span class=md-ellipsis> Applying </span> </a> <nav class=md-nav aria-label=Applying> <ul class=md-nav__list> <li class=md-nav__item> <a href=#iteration-schemes class=md-nav__link> <span class=md-ellipsis> Iteration schemes </span> </a> </li> <li class=md-nav__item> <a href=#merging class=md-nav__link> <span class=md-ellipsis> Merging </span> </a> </li> <li class=md-nav__item> <a href=#decorators class=md-nav__link> <span class=md-ellipsis> Decorators </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#modeling class=md-nav__link> <span class=md-ellipsis> Modeling </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../more-tutorials/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.6 13.4a1 1 0 0 1-1.4 1.4 4.8 4.8 0 0 1 0-7l3.5-3.6a5.1 5.1 0 0 1 7.1 0 5.1 5.1 0 0 1 0 7.1l-1.5 1.5a6.4 6.4 0 0 0-.4-2.4l.5-.5a3.2 3.2 0 0 0 0-4.3 3.2 3.2 0 0 0-4.3 0l-3.5 3.6a2.9 2.9 0 0 0 0 4.2M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3m-3.8-4.3a4.8 4.8 0 0 0-1.4-4.5 1 1 0 0 0-1.4 1.4 2.9 2.9 0 0 1 0 4.2l-3.5 3.6a3.2 3.2 0 0 1-4.3 0 3.2 3.2 0 0 1 0-4.3l.5-.4a7.3 7.3 0 0 1-.4-2.5l-1.5 1.5a5.1 5.1 0 0 0 0 7.1 5.1 5.1 0 0 0 7.1 0l1.8-1.8a6 6 0 0 1 3.1-4.3Z"/></svg> <span class=md-ellipsis> More tutorials </span> </a> </li> <li class=md-nav__item> <a href=../../to-be-continued/index.html class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../documentation/overview/index.html class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/index.html class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../cookbook/overview/index.html class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../terms/terms-of-use/index.html class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../../overview/index.html class=md-path__link> <span class=md-ellipsis> Tutorials </span> </a> </li> <li class=md-path__item> <a href=../index.html class=md-path__link> <span class=md-ellipsis> Cross-validation </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=applications><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg></span> Applications<a class=headerlink href=#applications title="Permanent link">&para;</a></h1> <p>We've got a splitter instance, what's next? </p> <p>Remember that CV involves running a backtesting job on each range. Thanks to the ability of vectorbt to process two-dimensional data, we have two major ways of accomplishing that: either 1) split all arrays into chunks, merge them into two-dimensional arrays, and run one monolithic backtesting job, or 2) run a backtesting job on each chunk separately. We can also go a hybrid path: for example, build a two-dimensional array out of each set, and backtest it in isolation from other sets. Which approach to use depends on your requirements for RAM consumption and performance: two-dimensional arrays are faster to process, but there is a threshold of the number of stacked columns after which performance starts to downgrade (mostly because your system starts using swap memory).</p> <h2 id=taking>Taking<a class=headerlink href=#taking title="Permanent link">&para;</a></h2> <p>Taking is a process of extracting one or more "slices" from an array-like object, which is implemented by the method <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.take>Splitter.take</a>. This method takes an object, iterates over each range in question, and takes the range from the object using <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.take_range>Splitter.take_range</a> - a dead-simple method that does <code>arr.iloc[range_]</code> on Pandas-like arrays and <code>arr[range_]</code> on NumPy arrays. Since many vectorbt classes inherit the indexing schema of Pandas, this method can even take a slice from vectorbt objects such as <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>! Once all slices have been collected, it can either stack them by rows (<code>stack_axis=0</code>) or columns (<code>stack_axis=1</code>, which is default), stack only splits and sets, or don't stack anything at all. When some slices shouldn't be stacked, they will be returned as a single Pandas Series that holds slices as values (may sound weird to have an array as a value of another array, but it's much easier for indexing than having a list).</p> <h3 id=without-stacking>Without stacking<a class=headerlink href=#without-stacking title="Permanent link">&para;</a></h3> <p>Let's split the close price using default arguments:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_slices</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_slices</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=go>split_year  set  </span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=go>2018        train    Open time</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=go>2018-01-01 00:00:00+00:00    13380.0...</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=go>            test     Open time</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=go>2018-07-01 00:00:00+00:00    6356.81...</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=go>2019        train    Open time</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=go>2019-01-01 00:00:00+00:00     3797.1...</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=go>            test     Open time</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=go>2019-07-01 00:00:00+00:00    10624.9...</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=go>2020        train    Open time</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=go>2020-01-01 00:00:00+00:00    7200.85...</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=go>            test     Open time</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=go>2020-07-01 00:00:00+00:00     9232.0...</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=go>2021        train    Open time</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=go>2021-01-01 00:00:00+00:00    29331.6...</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=go>            test     Open time</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=go>2021-07-01 00:00:00+00:00    33504.6...</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=go>dtype: object</span>
</span></code></pre></div> <p>If you're wondering what this format is: a regular Pandas Series with the split and set labels as index and the close price slices as values - basically <code>pd.Series</code> within <code>pd.Series</code> <img alt=😛 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f61b.svg title=:stuck_out_tongue:> Remember that array values can be any complex Python objects. For example, let's get the close price corresponding to the test set in 2020:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_slices</span><span class=p>[</span><span class=mi>2020</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>]</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=go>Open time</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=go>2020-07-01 00:00:00+00:00     9232.00</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=go>2020-07-02 00:00:00+00:00     9086.54</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=go>2020-07-03 00:00:00+00:00     9058.26</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=go>                                  ...</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=go>2020-12-29 00:00:00+00:00    27385.00</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=go>2020-12-30 00:00:00+00:00    28875.54</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=go>2020-12-31 00:00:00+00:00    28923.63</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=go>Freq: D, Name: Close, Length: 184, dtype: float64</span>
</span></code></pre></div> <p>Bingo! </p> <p>And here's how simple is to apply a UDF on each range:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_total_return</span><span class=p>(</span><span class=n>sr</span><span class=p>):</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>sr</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_returns</span><span class=p>()</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_slices</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>get_total_return</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=go>split_year  set  </span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=go>            test    -0.417491</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=go>            test    -0.322797</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=go>            test     2.132976</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=go>            test     0.379417</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Using <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.apply.html>pandas.Series.apply</a></li> </ol> <h4 id=complex-objects>Complex objects<a class=headerlink href=#complex-objects title="Permanent link">&para;</a></h4> <p>One of the many unique features of vectorbt is the standardized behavior of its classes. Since this package is highly specialized on processing Pandas and NumPy arrays, most classes act as a proxy between the user and a set of such arrays; basically, each class enhances the feature set of Pandas and NumPy, and allows building connections between multiple arrays based on one common metadata stored in a <a href=../../../documentation/building-blocks/index.html#wrapping>wrapper</a>. Since such a wrapper can be sliced just like a regular Pandas array, we can slice most vectorbt objects that hold this wrapper as well, including <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter>Splitter</a>. And because we can slice them using the same indexing API as offered by Pandas arrays (thanks to <a href=../../../documentation/building-blocks/index.html#indexing>indexing</a>), we can pass most vectorbt objects directly to <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.take>Splitter.take</a>!</p> <p>For example, let's analyze the performance of a portfolio during different market regimes. First, we'll use the forward-looking label generator <a href=../../../api/labels/generators/trendlb/index.html#vectorbtpro.labels.generators.trendlb.TRENDLB>TRENDLB</a> to annotate each data point with either 1 (uptrend), 0 (downtrend), or NaN (cannot be classified). Given the volatility of our data, we'll register an uptrend once the price jumps by 100% from its previous low point, and a downtrend once the price falls by 50% from its previous high point:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trendlb</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;trendlb&quot;</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trendlb</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trendlb.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trendlb.dark.svg#only-dark></p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>If you're not sure which pair of thresholds to use, look at the plot that the labeler produces and find the thresholds that work best for you.</p> </div> <p>Then, we'll build a splitter that converts the labels into splits: </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grouper</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>trendlb</span><span class=o>.</span><span class=n>labels</span><span class=o>.</span><span class=n>map</span><span class=p>({</span><span class=mi>1</span><span class=p>:</span> <span class=s2>&quot;U&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>:</span> <span class=s2>&quot;D&quot;</span><span class=p>}),</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;trend&quot;</span><span class=p>)</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trend_splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_grouper</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>grouper</span><span class=p>)</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trend_splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trend_splitter1.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trend_splitter1.dark.svg#only-dark></p> <p>In the next step, we'll run the full grid of parameter combinations on the entire period through column stacking, and extract the returns accessor of the type <a href=../../../api/returns/accessors/index.html#vectorbtpro.returns.accessors.ReturnsAccessor>ReturnsAccessor</a>, which will enable us in analyzing the returns. To make a comparison, we'll also do the same on our baseline model.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_holding</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_returns_acc</span> <span class=o>=</span> <span class=n>hold_pf</span><span class=o>.</span><span class=n>returns_acc</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;SMA&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_combs</span><span class=p>(</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>short_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>,</span> <span class=s2>&quot;slow_sma&quot;</span><span class=p>])</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>strat_pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>,</span> <span class=n>direction</span><span class=o>=</span><span class=s2>&quot;both&quot;</span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>strat_returns_acc</span> <span class=o>=</span> <span class=n>strat_pf</span><span class=o>.</span><span class=n>returns_acc</span>
</span></code></pre></div> <p>Now, take both slices from the accessor (remember that most vectorbt objects are indexable, including accessors) and plot the Sharpe heatmap for each market regime:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_returns_acc_slices</span> <span class=o>=</span> <span class=n>trend_splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>hold_returns_acc</span><span class=p>)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>strat_returns_acc_slices</span> <span class=o>=</span> <span class=n>trend_splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>strat_returns_acc</span><span class=p>)</span>
</span></code></pre></div> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Uptrends</label><label for=__tabbed_1_2>Downtrends</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_returns_acc_slices</span><span class=p>[</span><span class=s2>&quot;U&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>()</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=go>3.4490778178230763</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>strat_returns_acc_slices</span><span class=p>[</span><span class=s2>&quot;U&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>()</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=gp>... </span>    <span class=n>x_level</span><span class=o>=</span><span class=s2>&quot;fast_sma_timeperiod&quot;</span><span class=p>,</span> 
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>... </span>    <span class=n>y_level</span><span class=o>=</span><span class=s2>&quot;slow_sma_timeperiod&quot;</span><span class=p>,</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>... </span>    <span class=n>symmetric</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/uptrend_heatmap.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/uptrend_heatmap.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_returns_acc_slices</span><span class=p>[</span><span class=s2>&quot;D&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>()</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=go>-1.329832516209626</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>strat_returns_acc_slices</span><span class=p>[</span><span class=s2>&quot;D&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>()</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=gp>... </span>    <span class=n>x_level</span><span class=o>=</span><span class=s2>&quot;fast_sma_timeperiod&quot;</span><span class=p>,</span> 
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=gp>... </span>    <span class=n>y_level</span><span class=o>=</span><span class=s2>&quot;slow_sma_timeperiod&quot;</span><span class=p>,</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=gp>... </span>    <span class=n>symmetric</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/downtrend_heatmap.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/downtrend_heatmap.dark.svg#only-dark></p> </div> </div> </div> <p>We can see that it takes a lot of effort (and some may say luck) to pick the right parameter combination and consistently beat the baseline. Since both pictures are completely different, we cannot rely on a single parameter combination; rather, we have to recognize the regime we're in and act accordingly, which is a massive challenge on its own. The above analysis should be used with caution though: there may be a position overflow from one market regime to another skewing the results since both periods are part of a single backtest. But at least we gained another bit of valuable information <img alt=🕵 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f575.svg title=:detective:></p> <p>But what if we try to take slices from the portfolio? The operation would fail because each split contains gaps, and portfolio cannot be indexed with gaps, only using non-interrupting ranges. Thus, we would need to break up each split into multiple smaller splits, also called "split parts". Luckily for us, there are two functionalities that make this possible: <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a> accepts an option "by_gap" as <code>new_split</code> to split a range by gap, while <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.break_up_splits>Splitter.break_up_splits</a> can apply this operation on each split. This way, we can flatten the splits such that only one trend period is processed at once. We'll also sort the splits by their start index such that they come in the same temporal order as the labels:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trend_splitter</span> <span class=o>=</span> <span class=n>trend_splitter</span><span class=o>.</span><span class=n>break_up_splits</span><span class=p>(</span><span class=s2>&quot;by_gap&quot;</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trend_splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trend_splitter2.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trend_splitter2.dark.svg#only-dark></p> <p>Another trick: instead of calling <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.take>Splitter.take</a>, we can call <code>split</code> on the object directly!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_slices</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>trend_splitter</span><span class=p>)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_slices</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=go>trend  split_part</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=go>U      0             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=go>D      0             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=go>U      1             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=go>D      1             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=go>U      2             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=go>D      2             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=go>U      3             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=go>D      3             Portfolio(\n    wrapper=ArrayWrapper(\n       ...</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=go>dtype: object</span>
</span></code></pre></div> <p>Let's analyze the median, that is, there are 50% of the parameter combinations with the same value or better, and, conversely, 50% with the same value or worse.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trend_range_perf</span> <span class=o>=</span> <span class=n>strat_pf_slices</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>pf</span><span class=p>:</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>)</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>median_trend_perf</span> <span class=o>=</span> <span class=n>trend_range_perf</span><span class=o>.</span><span class=n>median</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>median_trend_perf</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=go>trend  split_part</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=go>U      0             4.829429</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=go>D      0            -0.058159</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=go>U      1             2.874709</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=go>D      1            -0.510703</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=go>U      2             2.220633</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=go>D      2             0.917946</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=go>U      3            -0.736989</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=go>D      3             0.225841</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>And now visually: replace the labels in <code>trendlb</code> by the freshly-computed values.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trend_perf_ts</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;trend_perf&quot;</span><span class=p>)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>label</span><span class=p>,</span> <span class=n>sr</span> <span class=ow>in</span> <span class=n>trend_splitter</span><span class=o>.</span><span class=n>bounds</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>    <span class=n>trend_perf_ts</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>sr</span><span class=p>[</span><span class=s2>&quot;start&quot;</span><span class=p>]:</span><span class=n>sr</span><span class=p>[</span><span class=s2>&quot;end&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>median_trend_perf</span><span class=p>[</span><span class=n>label</span><span class=p>]</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>overlay_with_heatmap</span><span class=p>(</span><span class=n>trend_perf_ts</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span></code></pre></div> <ol> <li>Using <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.overlay_with_heatmap>GenericAccessor.overlay_with_heatmap</a></li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trend_perf.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/trend_perf.dark.svg#only-dark></p> <p>Can you spot something strange? Right, at least 50% of the parameter combinations during the last uptrend have a negative Sharpe <img alt=🤔 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f914.svg title=:thinking:> At least my explanation is that moving averages are lagging indicators and by the time they reacted to the previous sharp decline, we already arrived at the next top; basically, the rebound took them off-guard such that any short positions from the previous decline couldn't close out on time.</p> <h3 id=column-stacking>Column stacking<a class=headerlink href=#column-stacking title="Permanent link">&para;</a></h3> <p>This was a glimpse into the second approach that we mentioned at the beginning of this page, which involves applying a UDF on each range separately. But how about stacking all the slices into a single one and applying our <code>get_total_return</code> just once for a nice performance boost? Turns out, we can stack the slices manually using <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html>pandas.concat</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=gp>... </span>    <span class=n>close_slices</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span> 
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=gp>... </span>    <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=gp>... </span>    <span class=n>keys</span><span class=o>=</span><span class=n>close_slices</span><span class=o>.</span><span class=n>index</span>  <span class=c1># (2)!</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=go>split_year                     2018       2019       2020       2021          </span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=go>set                           train test train test train test train      test</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=go>Open time                                                                     </span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=go>2018-01-01 00:00:00+00:00  13380.00  NaN   NaN  NaN   NaN  NaN   NaN       NaN</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=go>2018-01-02 00:00:00+00:00  14675.11  NaN   NaN  NaN   NaN  NaN   NaN       NaN</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=go>2018-01-03 00:00:00+00:00  14919.51  NaN   NaN  NaN   NaN  NaN   NaN       NaN</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=go>...                             ...  ...   ...  ...   ...  ...   ...       ...</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=go>2021-12-29 00:00:00+00:00       NaN  NaN   NaN  NaN   NaN  NaN   NaN  46464.66</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=go>2021-12-30 00:00:00+00:00       NaN  NaN   NaN  NaN   NaN  NaN   NaN  47120.87</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=go>2021-12-31 00:00:00+00:00       NaN  NaN   NaN  NaN   NaN  NaN   NaN  46216.93</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=go>[1461 rows x 8 columns]</span>
</span></code></pre></div> <ol> <li>Along columns</li> <li>Slice labels become column labels</li> </ol> <p>As we can see, even though the operation produced a lot of NaNs, we now have a format that is perfectly acceptable by vectorbt. Let's apply our UDF to this array:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_total_return</span><span class=p>(</span><span class=n>close_stacked</span><span class=p>)</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=go>split_year  set  </span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=go>            test    -0.417491</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=go>            test    -0.322797</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=go>            test     2.132976</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=go>            test     0.379417</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=go>Name: total_return, dtype: float64</span>
</span></code></pre></div> <p>Pure magic <img alt=✨ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2728.svg title=:sparkles:></p> <p>But the stacking approach above works only if we're splitting Pandas objects, but what about NumPy arrays and complex vectorbt objects? We can instruct <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.take>Splitter.take</a> to do the stacking job for us. The method will use <a href=../../../api/base/merging/index.html#vectorbtpro.base.merging.column_stack_merge>column_stack_merge</a> for stacking any array-like objects in the most efficient way. For example, let's replicate the above format using a single line of code:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>into</span><span class=o>=</span><span class=s2>&quot;stacked&quot;</span><span class=p>)</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=go>(1461, 8)</span>
</span></code></pre></div> <p>To get rid of many NaNs in the stacked data, we can reset the index of each slice prior to stacking by adding a prefix "reset_" to any "stacked" option provided as <code>into</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>into</span><span class=o>=</span><span class=s2>&quot;reset_stacked&quot;</span><span class=p>)</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=go>split_year      2018               2019               2020            \</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=go>set            train     test     train      test    train      test   </span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=go>0           13380.00  6356.81   3797.14  10624.93  7200.85   9232.00   </span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=go>1           14675.11  6615.29   3858.56  10842.85  6965.71   9086.54   </span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=go>2           14919.51  6513.86   3766.78  11940.00  7344.96   9058.26   </span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=go>..               ...      ...       ...       ...      ...       ...   </span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=go>181              NaN  3695.32       NaN   7388.24  9138.55  27385.00   </span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=go>182              NaN  3801.91       NaN   7246.00      NaN  28875.54   </span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=go>183              NaN  3702.90       NaN   7195.23      NaN  28923.63   </span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=go>split_year      2021            </span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=go>set            train      test  </span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=go>0           29331.69  33504.69  </span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=go>1           32178.33  33786.55  </span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=go>2           33000.05  34669.13  </span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=go>..               ...       ...  </span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=go>181              NaN  46464.66  </span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=go>182              NaN  47120.87  </span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=go>183              NaN  46216.93  </span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=go>[184 rows x 8 columns]</span>
</span></code></pre></div> <p>We can also instruct the method to align each slice by the end point rather than the start point, which will push NaNs to the beginning of the array:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>into</span><span class=o>=</span><span class=s2>&quot;from_end_stacked&quot;</span><span class=p>)</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=go>split_year      2018               2019               2020            \</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=go>set            train     test     train      test    train      test   </span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=go>0                NaN  6356.81       NaN  10624.93      NaN   9232.00   </span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=go>1                NaN  6615.29       NaN  10842.85      NaN   9086.54   </span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=go>2                NaN  6513.86       NaN  11940.00  7200.85   9058.26   </span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=go>..               ...      ...       ...       ...      ...       ...   </span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=go>181          5853.98  3695.32  12400.63   7388.24  9116.35  27385.00   </span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=go>182          6197.92  3801.91  11903.13   7246.00  9192.56  28875.54   </span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=go>183          6390.07  3702.90  10854.10   7195.23  9138.55  28923.63   </span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=go>split_year      2021            </span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=go>set            train      test  </span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=go>0                NaN  33504.69  </span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=go>1                NaN  33786.55  </span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=go>2                NaN  34669.13  </span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=go>..               ...       ...  </span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=go>181         34494.89  46464.66  </span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=go>182         35911.73  47120.87  </span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=go>183         35045.00  46216.93  </span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=go>[184 rows x 8 columns]</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>If all slices have the same length, both alignments will produce the same array.</p> </div> <p>As we can see, there are two potential issues associated with this operation: the final array will have no datetime index, and the slices may have different lengths such that there will still be some NaNs present in the array. But also, we are rarely interested in stacking training and test sets together since they are bound to different pipelines, thus let's only stack the splits that belong to the same set, which will also produce slices of roughly the same length, by using "reset_stacked_splits" as <code>into</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>into</span><span class=o>=</span><span class=s2>&quot;reset_stacked_by_set&quot;</span><span class=p>)</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=go>set</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=go>train    split_year      2018      2019     2020      2...</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=go>test     split_year     2018      2019      2020      2...</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=go>dtype: object</span>
</span></code></pre></div> <p>We've got some weird-looking format once again, but it's nothing more than a Series with the set labels as index and the stacked close price slices as values:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>]</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=go>split_year      2018      2019     2020      2021</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=go>0           13380.00   3797.14  7200.85  29331.69</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=go>1           14675.11   3858.56  6965.71  32178.33</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=go>2           14919.51   3766.78  7344.96  33000.05</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=go>..               ...       ...      ...       ...</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=go>179          6197.92  11903.13  9116.35  35911.73</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=go>180          6390.07  10854.10  9192.56  35045.00</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=go>181              NaN       NaN  9138.55       NaN</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=go>[182 rows x 4 columns]</span>
</span></code></pre></div> <p>By resetting the index, we save a tremendous amount of RAM: our arrays hold only <code>182 * 8 = 1456</code> instead of <code>1461 * 8 = 11688</code> (i.e., 88% less) values in memory. But how do we access the index associated with each column? We can slice it as a regular array!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index_slices</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index_slices</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=go>split_year  set  </span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=go>2018        train    DatetimeIndex([&#39;2018-01-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=go>            test     DatetimeIndex([&#39;2018-07-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=go>2019        train    DatetimeIndex([&#39;2019-01-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=go>            test     DatetimeIndex([&#39;2019-07-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=go>2020        train    DatetimeIndex([&#39;2020-01-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=go>            test     DatetimeIndex([&#39;2020-07-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=go>2021        train    DatetimeIndex([&#39;2021-01-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=go>            test     DatetimeIndex([&#39;2021-07-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=go>dtype: object</span>
</span></code></pre></div> <p>Another way of getting the index information as by attaching the bounds to the range labels using <code>attach_bounds</code>, which can be <code>True</code> and "index" to attach the bounds in the integer and datetime format respectively. Let's use the latter but also enable <code>right_inclusive</code> to make the right bound inclusive if we want to use it in indexing with <code>loc</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked_wb</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> 
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>... </span>    <span class=n>into</span><span class=o>=</span><span class=s2>&quot;reset_stacked_by_set&quot;</span><span class=p>,</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>... </span>    <span class=n>attach_bounds</span><span class=o>=</span><span class=s2>&quot;index&quot;</span><span class=p>,</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>... </span>    <span class=n>right_inclusive</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close_stacked_wb</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>]</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=go>split_year                      2018                      2019  \</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=go>start      2018-01-01 00:00:00+00:00 2019-01-01 00:00:00+00:00   </span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=go>end        2018-06-30 00:00:00+00:00 2019-06-30 00:00:00+00:00   </span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=go>0                           13380.00                   3797.14   </span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=go>1                           14675.11                   3858.56   </span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=go>2                           14919.51                   3766.78   </span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=go>..                               ...                       ...   </span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=go>179                          6197.92                  11903.13   </span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=go>180                          6390.07                  10854.10   </span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=go>181                              NaN                       NaN   </span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=go>split_year                      2020                      2021  </span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=go>start      2020-01-01 00:00:00+00:00 2021-01-01 00:00:00+00:00  </span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=go>end        2020-06-30 00:00:00+00:00 2021-06-30 00:00:00+00:00  </span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=go>0                            7200.85                  29331.69  </span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a><span class=go>1                            6965.71                  32178.33  </span>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a><span class=go>2                            7344.96                  33000.05  </span>
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a><span class=go>..                               ...                       ...  </span>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a><span class=go>179                          9116.35                  35911.73  </span>
</span><span id=__span-21-27><a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a><span class=go>180                          9192.56                  35045.00  </span>
</span><span id=__span-21-28><a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a><span class=go>181                          9138.55                       NaN  </span>
</span><span id=__span-21-29><a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a>
</span><span id=__span-21-30><a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a><span class=go>[182 rows x 4 columns]</span>
</span></code></pre></div> <p>Though, to keep the index clean, we will go with the arrays without bounds first. We've established two arrays: one for training and another one for testing purposes. Let's modify our pipeline <code>sma_crossover_perf</code> from the first page to be run on a single set: replace the argument <code>data</code> with <code>close</code>, and add another argument for the frequency required by Sharpe since our index isn't datetime-like anymore.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>parameterized</span><span class=p>(</span><span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>set_sma_crossover_perf</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>,</span> <span class=n>freq</span><span class=p>):</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>... </span>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=gp>... </span>        <span class=n>close</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=gp>... </span>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=gp>... </span>        <span class=n>close</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>,</span> <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;slow_sma&quot;</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> 
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=gp>... </span>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=gp>... </span>        <span class=n>close</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=n>freq</span><span class=p>,</span> <span class=n>direction</span><span class=o>=</span><span class=s2>&quot;both&quot;</span><span class=p>)</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span></code></pre></div> <ol> <li>Do not add parameter to the index as it will be added by the <code>parameterized</code> decorator</li> </ol> <p>Apply it on the training set to get the performance per parameter combination and split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span> <span class=o>=</span> <span class=n>set_sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=gp>... </span>    <span class=n>close_stacked</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>],</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;x &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>)),</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>freq</span><span class=p>,</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=gp>... </span>    <span class=n>_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=gp>... </span>        <span class=n>clear_cache</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=gp>... </span>        <span class=n>collect_garbage</span><span class=o>=</span><span class=mi>50</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Combination 990/990</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=go>fast_window  slow_window  split_year</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=go>5            6            2018          1.158471</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=go>                          2019          1.901410</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=go>                          2020         -0.426441</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=go>                          2021          0.052654</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=go>             7            2018          2.231909</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=go>                                             ...</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=go>47           49           2021         -0.446099</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=go>48           49           2018         -1.169584</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=go>                          2019          3.727154</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=go>                          2020         -1.913321</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=go>                          2021         -0.400270</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=go>Name: sharpe_ratio, Length: 3960, dtype: float64</span>
</span></code></pre></div> <p>A total of 990 parameter combinations were run in 20 seconds, or 20ms per run <img alt=🔥 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f525.svg title=:fire:></p> <p>Let's generate the performance heatmap for each split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>... </span>    <span class=n>x_level</span><span class=o>=</span><span class=s2>&quot;fast_window&quot;</span><span class=p>,</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=gp>... </span>    <span class=n>y_level</span><span class=o>=</span><span class=s2>&quot;slow_window&quot;</span><span class=p>,</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>... </span>    <span class=n>slider_level</span><span class=o>=</span><span class=s2>&quot;split_year&quot;</span><span class=p>,</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=gp>... </span>    <span class=n>symmetric</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <div class="grid cards"> <ul> <li> <p><span class="twemoji lg middle"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16V4H3v12h18m0-14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-7v2h2v2H8v-2h2v-2H3a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2h18M5 6h9v5H5V6m10 0h4v2h-4V6m4 3v5h-4V9h4M5 12h4v2H5v-2m5 0h4v2h-4v-2Z"/></svg></span> <strong>Dashboard</strong></p> <hr> <p>Run the notebook to view the dashboard!</p> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/split_heatmap.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/split_heatmap.dark.svg#only-dark></p> </li> </ul> </div> <p>By looking at the plot above, we can identify a number of yellow points that may be good candidates for our strategy. But, in contrast to the approach from the first page where we selected the best parameter combination, let's conduct a neighborhood analysis by finding a Sharpe ratio that's surrounded by high Sharpe ratios, so that we can diminish the effect of outliers and bring in more robustness into our optimizer.</p> <p>This query can be well quantified by transforming the <code>train_perf</code> Series into a DataFrame using the accessor method <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.unstack_to_df>BaseAccessor.unstack_to_df</a> and running the accessor method <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.proximity_apply>GenericAccessor.proximity_apply</a>, which rolls a two-dimensional window over the entire matrix and reduces this window using a UDF. This mini-pipeline must be applied separately to each split. We will use a window of 2, that is, the two rows and columns that surround the central point, which yields a total of <code>(n * 2 + 1) ** 2 = 25</code> values. As a UDF we'll take the median, that is, each value will mean that 50% or more of the surrounding values are better than it. Our UDF will also filter out all the windows that have less than 20 valid values.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>prox_median_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>... </span>    <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>arr</span><span class=p>))</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=p>:</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmedian</span><span class=p>(</span><span class=n>arr</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>prox_perf_list</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>split_label</span><span class=p>,</span> <span class=n>perf_sr</span> <span class=ow>in</span> <span class=n>train_perf</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;split_year&quot;</span><span class=p>):</span>  <span class=c1># (3)!</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=gp>... </span>    <span class=n>perf_df</span> <span class=o>=</span> <span class=n>perf_sr</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>unstack_to_df</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span>  <span class=c1># (4)!</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=gp>... </span>    <span class=n>prox_perf_df</span> <span class=o>=</span> <span class=n>perf_df</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>proximity_apply</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>prox_median_nb</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=gp>... </span>    <span class=n>prox_perf_sr</span> <span class=o>=</span> <span class=n>prox_perf_df</span><span class=o>.</span><span class=n>stack</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>  <span class=c1># (6)!</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=gp>... </span>    <span class=n>prox_perf_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>prox_perf_sr</span><span class=o>.</span><span class=n>reindex</span><span class=p>(</span><span class=n>perf_sr</span><span class=o>.</span><span class=n>index</span><span class=p>))</span>  <span class=c1># (7)!</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_prox_perf</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>prox_perf_list</span><span class=p>)</span>  <span class=c1># (8)!</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_prox_perf</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=go>fast_window  slow_window  split_year</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=go>5            6            2018         NaN</span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=go>                          2019         NaN</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=go>                          2020         NaN</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=go>                          2021         NaN</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=go>             7            2018         NaN</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=go>                                       ...</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=go>47           49           2021         NaN</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=go>48           49           2018         NaN</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=go>                          2019         NaN</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=go>                          2020         NaN</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=go>                          2021         NaN</span>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=go>Length: 3960, dtype: float64</span>
</span></code></pre></div> <ol> <li>This function will take the median out of the proximity windows. Argument <code>arr</code> is a two-dimensional window flattened to one dimension.</li> <li>Since our window still may contain NaN values, use the NaN-resistant median</li> <li>Run the following per split</li> <li>Make a DataFrame with one level as rows, and two other levels as columns. We could have also used level names.</li> <li>Run our smoothing window over the entire DataFrame</li> <li>Make a Series by stacking all columns. Again, we could have also used level names.</li> <li>Reindex the Series to match the original index and append to list</li> <li>Stack all Series in the list into one big Series</li> </ol> <p>At first, it may appear that all values are NaN, but let's prove otherwise:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_prox_perf</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>... </span>    <span class=n>x_level</span><span class=o>=</span><span class=s2>&quot;fast_window&quot;</span><span class=p>,</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=n>y_level</span><span class=o>=</span><span class=s2>&quot;slow_window&quot;</span><span class=p>,</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>... </span>    <span class=n>slider_level</span><span class=o>=</span><span class=s2>&quot;split_year&quot;</span><span class=p>,</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>... </span>    <span class=n>symmetric</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <div class="grid cards"> <ul> <li> <p><span class="twemoji lg middle"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16V4H3v12h18m0-14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-7v2h2v2H8v-2h2v-2H3a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2h18M5 6h9v5H5V6m10 0h4v2h-4V6m4 3v5h-4V9h4M5 12h4v2H5v-2m5 0h4v2h-4v-2Z"/></svg></span> <strong>Dashboard</strong></p> <hr> <p>Run the notebook to view the dashboard!</p> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/split_prox_heatmap.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/split_prox_heatmap.dark.svg#only-dark></p> </li> </ul> </div> <p>Fans of <a href=https://en.wikipedia.org/wiki/Computer_vision>computer vision</a> will recognize what we did above: we used a 5x5 neighboring window acting as a <a href=https://ai.stanford.edu/~syyeung/cvweb/tutorial1.html>filter</a> that replaces each pixel with the median pixel value of it and a neighborhood window of adjacent pixels. The effect is a more smooth image with sharp features removed (in our case Sharpe outliers). For example, in the first split, the highest Sharpe fell from <code>2.5</code> to <code>1.3</code>, which is still extraordinary since it means that there are points that have at least 50% of surrounding points with a Sharpe <code>1.3</code> or higher! We can now search in each split for the parameter combination that has the highest proximity performance:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_params</span> <span class=o>=</span> <span class=n>train_prox_perf</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;split_year&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_params</span> <span class=o>=</span> <span class=n>train_prox_perf</span><span class=p>[</span><span class=n>best_params</span><span class=p>]</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_prox_perf</span><span class=p>[</span><span class=n>best_params</span><span class=p>]</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=go>fast_window  slow_window  split_year</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=go>10           24           2018          1.311910</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=go>9            39           2019          3.801643</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=go>14           19           2020          2.077684</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=go>31           41           2021          2.142695</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>What we're waiting for? Let's test those combinations on our test set! But wait, how do we apply each parameter combination on each column in the test array? Isn't each parameter combination being applied on the entire input? That's right, but there's a trick: use templates to instruct the <code>parameterized</code> decorator to pass only one column at a time, depending on the parameter combination being processed.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_perf</span> <span class=o>=</span> <span class=n>set_sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>        <span class=s2>&quot;test_close.iloc[:, [config_idx]]&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span>        <span class=n>context</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>test_close</span><span class=o>=</span><span class=n>close_stacked</span><span class=p>[</span><span class=s2>&quot;test&quot;</span><span class=p>])</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>best_params</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;fast_window&quot;</span><span class=p>),</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>best_params</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;slow_window&quot;</span><span class=p>),</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>freq</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_perf</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=go>fast_window  slow_window  split_year</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=go>10           24           2018         -0.616204</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=go>9            39           2019          0.017269</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=go>14           19           2020          4.768589</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=go>31           41           2021         -0.363900</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=go>Name: sharpe_ratio, dtype: float64</span>
</span></code></pre></div> <ol> <li>This template will be substituted during processing of each parameter combination (also called a parameter config). Here, we select the column from our test data that has the same index as the parameter config. We wrap the index with a list to run the pipeline on a DataFrame with meaningful columns.</li> <li>Extract the parameter values and assign both <code>fast_window</code> and <code>slow_window</code> the same level to avoid building a product between them</li> </ol> <p>Let's compare these values against the baseline:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_index_sharpe</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>index</span><span class=p>]</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;from_holding&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index_slices</span><span class=o>.</span><span class=n>xs</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;set&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>get_index_sharpe</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=go>split_year</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=go>2018   -1.327655</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=go>2019   -0.788038</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=go>2020    4.425057</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=go>2021    1.304871</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Each value in <code>index_slices</code> is an index, so we simply apply <code>get_index_sharpe</code> on it!</li> </ol> <p>Not bad! Our model beats the baseline for three years in a row.</p> <h3 id=row-stacking>Row stacking<a class=headerlink href=#row-stacking title="Permanent link">&para;</a></h3> <p>The same way as we stacked ranges along columns, we can stack ranges along rows. The major difference between both approaches is that column stacking is meant for producing independent tests while row stacking puts ranges into the same test and thus introduces a temporal dependency between them.</p> <p>What row stacking is perfect for is block resampling required for time-series bootstrapping. The bootstrap is a flexible and powerful statistical tool that can be used to quantify the uncertainty. Rather than repeatedly obtaining independent datasets (which are limited in finance), we instead obtain distinct datasets by repeatedly sampling observations from the original dataset. Each of these "bootstrap datasets" is created by sampling <em>with replacement</em>, and is the same size as our original dataset. As a result some observations may appear more than once and some not at all (about two-thirds of the original data points appear in each bootstrap sample). Since we're working on time series, we can't simply sample the observations with replacement; rather, we should create blocks of consecutive observations, and sample those. Then we paste together sampled blocks to obtain a bootstrap dataset (learn more <a href=https://asbates.rbind.io/2019/03/30/time-series-bootstrap-methods/ >here</a>).</p> <p>For our example, we'll use the <a href=https://en.wikipedia.org/wiki/Bootstrapping_(statistics)#Time_series:_Moving_block_bootstrap>moving block bootstrap</a>, which involves rolling a fixed-size window with an offset of just one bar:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>block_size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=mf>3.15</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>)</span> <span class=o>**</span> <span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=mi>3</span><span class=p>))</span>  <span class=c1># (1)!</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>block_size</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=go>39</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>block_splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=n>block_size</span><span class=p>,</span> 
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=gp>... </span>    <span class=n>offset</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=gp>... </span>    <span class=n>offset_anchor</span><span class=o>=</span><span class=s2>&quot;prev_start&quot;</span>  <span class=c1># (2)!</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>block_splitter</span><span class=o>.</span><span class=n>n_splits</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=go>1864</span>
</span></code></pre></div> <ol> <li>Default block length used in the R package</li> <li>By default, the anchor is the right bound of the previous window</li> </ol> <p>We've generated 1864 blocks. The next step is sampling. To generate a single sample, shuffle the blocks (i.e., splits) with replacement, which can be easily done using <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.shuffle_splits>Splitter.shuffle_splits</a>. We also need to limit the number of blocks such that they have roughly the same number of data points as our original data:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>block_splitter</span><span class=o>.</span><span class=n>n_splits</span> <span class=o>/</span> <span class=n>block_size</span><span class=p>)</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_splitter</span> <span class=o>=</span> <span class=n>block_splitter</span><span class=o>.</span><span class=n>shuffle_splits</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span> <span class=n>replace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/sample_splitter.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/sample_splitter.dark.svg#only-dark></p> <p>Let's compute the returns, "take" the slices corresponding to the blocks in the splitter, and stack them along rows:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>returns</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_rets</span> <span class=o>=</span> <span class=n>sample_splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=gp>... </span>    <span class=n>returns</span><span class=p>,</span> 
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=gp>... </span>    <span class=n>into</span><span class=o>=</span><span class=s2>&quot;stacked&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=gp>... </span>    <span class=n>stack_axis</span><span class=o>=</span><span class=mi>0</span>  <span class=c1># (2)!</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_rets</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=go>split  Open time                </span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=go>920    2020-02-23 00:00:00+00:00    0.029587</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=go>       2020-02-24 00:00:00+00:00   -0.028206</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=go>       2020-02-25 00:00:00+00:00   -0.035241</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=go>       2020-02-26 00:00:00+00:00   -0.056956</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=go>       2020-02-27 00:00:00+00:00    0.004321</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=go>                                         ...</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=go>1617   2022-02-23 00:00:00+00:00   -0.025642</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=go>       2022-02-24 00:00:00+00:00    0.028918</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=go>       2022-02-25 00:00:00+00:00    0.023272</span>
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=go>       2022-02-26 00:00:00+00:00   -0.002612</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=go>       2022-02-27 00:00:00+00:00   -0.036242</span>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=go>Name: Close, Length: 1833, dtype: float64</span>
</span></code></pre></div> <ol> <li>Stack all slices into one Series</li> <li>Along rows</li> </ol> <p>We've created a "frankenstein" price series!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_rets</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=n>sample_rets</span><span class=p>)]</span>  <span class=c1># (1)!</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_cumrets</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>sample_rets</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>cumprod</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_cumrets</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Plotting requires a proper index</li> <li>Compute the cumulative returns and project them from the start of our data</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/frankenstein.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/frankenstein.dark.svg#only-dark></p> <p>But one sample is not enough: we need to generate 100, 1000, or even 10000 samples for our estimates to be as accurate as possible.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>samples_rets_list</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ProgressBar</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>)):</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=gp>... </span>    <span class=n>sample_spl</span> <span class=o>=</span> <span class=n>block_splitter</span><span class=o>.</span><span class=n>shuffle_splits</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span> <span class=n>replace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=gp>... </span>    <span class=n>sample_rets</span> <span class=o>=</span> <span class=n>sample_spl</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>returns</span><span class=p>,</span> <span class=n>into</span><span class=o>=</span><span class=s2>&quot;stacked&quot;</span><span class=p>,</span> <span class=n>stack_axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=gp>... </span>    <span class=n>sample_rets</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=n>returns</span><span class=o>.</span><span class=n>index</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=n>sample_rets</span><span class=p>)]</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=gp>... </span>    <span class=n>sample_rets</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>i</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=gp>... </span>    <span class=n>samples_rets_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>sample_rets</span><span class=p>)</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_rets_stacked</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>samples_rets_list</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Sample 1000/1000</p> </div> </div> </p> <p>We can then analyze the distribution of a statistic of interest:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_sharpe</span> <span class=o>=</span> <span class=n>sample_rets_stacked</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>sharpe_ratio</span><span class=p>()</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_sharpe</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>boxplot</span><span class=p>(</span><span class=n>horizontal</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/sharpe_boxplot.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/sharpe_boxplot.dark.svg#only-dark></p> <p>This histogram provides an estimate of the shape of the distribution of the sample Sharpe from which we can answer questions about how much the Sharpe varies across samples. Since this particular bootstrap distribution is symmetric, we can use percentile-based confidence intervals. For example, a 95% confidence interval translates to the 2.5th and 97.5th percentiles:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_sharpe</span><span class=o>.</span><span class=n>quantile</span><span class=p>(</span><span class=mf>0.025</span><span class=p>),</span> <span class=n>sample_sharpe</span><span class=o>.</span><span class=n>quantile</span><span class=p>(</span><span class=mf>0.975</span><span class=p>)</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=go>(-0.13636235254958026, 1.726050620753774)</span>
</span></code></pre></div> <p>The method here can be applied to almost any other statistic or estimator, including more complex backtesting metrics.</p> <h2 id=applying>Applying<a class=headerlink href=#applying title="Permanent link">&para;</a></h2> <p>If the "taking" approach provides us with object slices that we can work upon, the "applying" approach using <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a> runs a UDF on each range, and can not only do the "taking" part for us, but also easily merge the outputs of the UDF. First, it resolves the ranges it needs to iterate over; similarly to other methods, it takes <code>split_group_by</code> and <code>set_group_by</code> to merge ranges, but also the arguments <code>split</code> and <code>set_</code> that can be used to select specific (merged) ranges. Then, while iterating over each range, it substitutes any templates and other instructions in the positional and keyword arguments meant to be passed to the UDF. For example, by wrapping any argument with the class <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Takeable>Takeable</a>, the method will select a slice from it and substitute the instruction with that slice. The arguments prepared in each iteration are saved in a list and passed to the executor - <a href=../../../api/utils/execution/index.html#vectorbtpro.utils.execution.execute>execute</a>, which you're probably already familiar with. The executor lazily executes all the iterations and (optionally) merges the outputs. <em>Lazily</em> here means that none of the arrays will be sliced until the range is executed - good for memory <img alt=💓 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f493.svg title=:heartbeat:></p> <p>Let's run a simple example of calculating the total return of each close slice:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>  <span class=c1># (2)!</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=go>split_year  set  </span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=go>            test    -0.417491</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=go>            test    -0.322797</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=go>            test     2.132976</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=go>            test     0.379417</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Any positional arguments passed after the function will be passed to the function. We could have also passed it as a keyword argument <code>sr=vbt.Takeable(data.close)</code>.</li> <li>See <a href=../../../api/base/merging/index.html#vectorbtpro.base.merging.resolve_merge_func>resolve_merge_func</a></li> </ol> <p>That's how easy it is! </p> <p>We could have also used templates:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=k>lambda</span> <span class=n>range_</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>[</span><span class=n>range_</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=go>split_year  set  </span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=go>            test    -0.417491</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=go>            test    -0.322797</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=go>            test     2.132976</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=go>            test     0.379417</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li><code>range_</code> will be substituted with the current range</li> </ol> <p>Or, by manually selecting the range inside the function:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_total_return</span><span class=p>(</span><span class=n>range_</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=p>[</span><span class=n>range_</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;range_&quot;</span><span class=p>),</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=go>split_year  set  </span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=go>2018        train   -0.534128</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=go>            test    -0.420523</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=go>2019        train    1.931243</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=go>            test    -0.337096</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=go>2020        train    0.270084</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=go>            test     2.165013</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=go>2021        train    0.211639</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=go>            test     0.318788</span>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=go>dtype: float64</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>Results are slightly different because slicing returns is more accurate than slicing the price.</p> </div> <p>Taking from complex vectorbt objects works too:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_total_return</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=go>split_year  set  </span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=go>            test    -0.417491</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=go>            test    -0.322797</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=go>            test     2.132976</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=go>            test     0.379417</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Splits the <a href=../../../api/data/base/index.html#vectorbtpro.data.base.Data>Data</a> instance</li> </ol> <p>Let's run the function above on the entire split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=gp>... </span>    <span class=n>set_group_by</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=go>split_year</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=go>2018   -0.723251</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=go>2019    0.894908</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=go>2020    3.016697</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=go>2021    0.575665</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>If we need to select specific ranges to run the pipeline upon, use <code>split</code> and <code>set_</code>, which can be an integer, a label, or a sequence of such:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=p>[</span><span class=mi>2020</span><span class=p>,</span> <span class=mi>2021</span><span class=p>],</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=gp>... </span>    <span class=n>set_</span><span class=o>=</span><span class=s2>&quot;train&quot;</span><span class=p>,</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=go>split_year</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=go>2020    0.270084</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=go>2021    0.211639</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>Let's apply this approach to cross-validate our SMA crossover strategy:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=gp>... </span>    <span class=n>sma_crossover_perf</span><span class=p>,</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;x &lt; slow_window&quot;</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>)),</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=gp>... </span>    <span class=n>_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (2)!</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=gp>... </span>        <span class=n>clear_cache</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=gp>... </span>        <span class=n>collect_garbage</span><span class=o>=</span><span class=mi>50</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=gp>... </span>    <span class=n>set_</span><span class=o>=</span><span class=s2>&quot;train&quot;</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Parameters are processed in <code>sma_crossover_perf</code>, not in <code>splitter.apply</code></li> <li>This dictionary is also getting passed to <code>sma_crossover_perf</code>. We'll hide the progress bar for parameter combinations and display the one for splits below.</li> <li>We could have also selected this set using <code>splitter.loc["train"]</code></li> </ol> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Split 4/4</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=go>split_year  fast_window  slow_window</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=go>2018        5            6              1.161661</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=go>                         7              2.238117</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=go>                         8              1.583246</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=go>                         9              1.369400</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=go>                         10             0.563251</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=go>                                             ...</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=go>2021        46           48            -0.238667</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=go>                         49            -0.437822</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=go>            47           48            -0.799317</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=go>                         49            -0.447324</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=go>            48           49            -0.401369</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=go>Length: 3960, dtype: float64</span>
</span></code></pre></div> <p>Let's find the best parameter combinations and pass them to the test set using templates:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_params</span> <span class=o>=</span> <span class=n>train_perf</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;split_year&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_params</span> <span class=o>=</span> <span class=n>train_perf</span><span class=p>[</span><span class=n>best_params</span><span class=p>]</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span><span class=p>[</span><span class=n>best_params</span><span class=p>]</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=go>split_year  fast_window  slow_window</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=go>2018        6            7              2.612006</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=go>2019        35           36             4.246530</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=go>2020        16           17             2.605763</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=go>2021        32           45             3.073246</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=go>dtype: float64</span>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_fast_windows</span> <span class=o>=</span> <span class=n>best_params</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;fast_window&quot;</span><span class=p>)</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_slow_windows</span> <span class=o>=</span> <span class=n>best_params</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;slow_window&quot;</span><span class=p>)</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_perf</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=gp>... </span>    <span class=n>sma_crossover_perf</span><span class=p>,</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=k>lambda</span> <span class=n>split_idx</span><span class=p>:</span> <span class=n>best_fast_windows</span><span class=p>[</span><span class=n>split_idx</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=k>lambda</span> <span class=n>split_idx</span><span class=p>:</span> <span class=n>best_slow_windows</span><span class=p>[</span><span class=n>split_idx</span><span class=p>]),</span>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=gp>... </span>    <span class=n>set_</span><span class=o>=</span><span class=s2>&quot;test&quot;</span><span class=p>,</span>
</span><span id=__span-46-20><a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-46-21><a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-46-22><a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_perf</span>
</span><span id=__span-46-23><a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a><span class=go>split_year</span>
</span><span id=__span-46-24><a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a><span class=go>2018    1.501380</span>
</span><span id=__span-46-25><a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a><span class=go>2019    0.152723</span>
</span><span id=__span-46-26><a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a><span class=go>2020    4.473387</span>
</span><span id=__span-46-27><a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a><span class=go>2021   -1.147178</span>
</span><span id=__span-46-28><a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li><code>split_idx</code> will be substituted by the split number. Make sure that the values in <code>best_fast_windows</code> and <code>best_slow_windows</code> appear in the same order as the splits in the splitter. Or, use <code>split_label</code> if the order is different.</li> </ol> <p>We've effectively outsourced the range iteration, taking, and execution steps.</p> <h3 id=iteration-schemes>Iteration schemes<a class=headerlink href=#iteration-schemes title="Permanent link">&para;</a></h3> <p>The method <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a> supports multiple iteration schemes. For instance, it can iterate over the selected ranges in the split-major or set-major order as a single sequence. It can also pack the splits/sets of the same set/split into the same bucket and run as a single iteration - split-wise and set-wise respectively. Why does it matter? Consider a scenario where a UDF needs to write the results to an object and then access these results in a specific order. For example, we may want a OOS range to read the results of the previous IS range, which is a requirement of parameterized CV; in such a case, the iteration can be in any order if the execution is sequential, in any major order if it (carefully) spans across multiple threads, and in the split-wise order if the execution spans across multiple processes since the sets need to share the same memory.</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:4><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><input id=__tabbed_2_3 name=__tabbed_2 type=radio><input id=__tabbed_2_4 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Split-major</label><label for=__tabbed_2_2>Set-major</label><label for=__tabbed_2_3>Split-wise</label><label for=__tabbed_2_4>Set-wise</label></div> <div class=tabbed-content> <div class=tabbed-block> <pre class=mermaid><code>    flowchart LR;
    subgraph 2019 [2019]
    id1["train"]
    id2["test"]

    id1 --&gt;|"parallel"| id2;
    end
    subgraph 2020 [2020]
    id3["train"]
    id4["test"]

    id2 --&gt;|"parallel"| id3;
    id3 --&gt;|"parallel"| id4;
    end</code></pre> </div> <div class=tabbed-block> <pre class=mermaid><code>    flowchart LR;
    subgraph train [train]
    id1["2019"]
    id2["2020"]

    id1 --&gt;|"parallel"| id2;
    end
    subgraph test [test]
    id3["2019"]
    id4["2020"]

    id2 --&gt;|"parallel"| id3;
    id3 --&gt;|"parallel"| id4;
    end</code></pre> </div> <div class=tabbed-block> <pre class=mermaid><code>    flowchart LR;
    subgraph 2019 [2019]
    id1["train"]
    id2["test"]

    id1 --&gt;|"sequence"| id2;
    end
    subgraph 2020 [2020]
    id3["train"]
    id4["test"]

    id3 --&gt;|"sequence"| id4;
    end
    2019 --&gt;|"parallel"| 2020;</code></pre> </div> <div class=tabbed-block> <pre class=mermaid><code>    flowchart LR;
    subgraph train [train]
    id1["2019"]
    id2["2020"]

    id1 --&gt;|"sequence"| id2;
    end
    subgraph test [test]
    id3["2019"]
    id4["2020"]

    id3 --&gt;|"sequence"| id4;
    end
    train --&gt;|"parallel"| test;</code></pre> </div> </div> </div> <p>Let's cross-validate our SMA crossover strategy using a single call! When an IS range is processed, find out the parameter combination with the highest Sharpe ratio and return it. When an OOS range is processed, access the parameter combination from the previous IS range and use it for testing. If you take a closer look at the available context at each iteration, there is no variable that holds the previous results: we need to store, write, and access the results manually. We'll iterate in a set-major order such that the splits in the training set are processed first.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>cv_sma_crossover</span><span class=p>(</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=gp>... </span>    <span class=n>fast_windows</span><span class=p>,</span> 
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=gp>... </span>    <span class=n>slow_windows</span><span class=p>,</span> 
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=gp>... </span>    <span class=n>split_idx</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=gp>... </span>    <span class=n>set_idx</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=gp>... </span>    <span class=n>train_perf_list</span>  <span class=c1># (3)!</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=gp>... </span><span class=p>):</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>set_idx</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># (4)!</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=gp>... </span>        <span class=n>train_perf</span> <span class=o>=</span> <span class=n>sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=gp>... </span>            <span class=n>data</span><span class=p>,</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>fast_windows</span><span class=p>,</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;x &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>slow_windows</span><span class=p>),</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=gp>... </span>            <span class=n>_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=gp>... </span>                <span class=n>clear_cache</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=gp>... </span>                <span class=n>collect_garbage</span><span class=o>=</span><span class=mi>50</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a><span class=gp>... </span>            <span class=p>)</span>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=gp>... </span>        <span class=n>train_perf_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>train_perf</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a><span class=gp>... </span>        <span class=n>best_params</span> <span class=o>=</span> <span class=n>train_perf</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()</span>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>train_perf</span><span class=p>[[</span><span class=n>best_params</span><span class=p>]]</span>  <span class=c1># (6)!</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=gp>... </span>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a><span class=gp>... </span>        <span class=n>train_perf</span> <span class=o>=</span> <span class=n>train_perf_list</span><span class=p>[</span><span class=n>split_idx</span><span class=p>]</span>  <span class=c1># (7)!</span>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=gp>... </span>        <span class=n>best_params</span> <span class=o>=</span> <span class=n>train_perf</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()</span>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a><span class=gp>... </span>        <span class=n>test_perf</span> <span class=o>=</span> <span class=n>sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a><span class=gp>... </span>            <span class=n>data</span><span class=p>,</span>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=n>best_params</span><span class=p>[</span><span class=mi>0</span><span class=p>]]),</span>  <span class=c1># (8)!</span>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=n>best_params</span><span class=p>[</span><span class=mi>1</span><span class=p>]]),</span>
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>test_perf</span>  <span class=c1># (9)!</span>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>
</span><span id=__span-47-32><a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf_list</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-47-33><a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_perf</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-47-34><a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a><span class=gp>... </span>    <span class=n>cv_sma_crossover</span><span class=p>,</span>
</span><span id=__span-47-35><a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-47-36><a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span><span id=__span-47-37><a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span><span id=__span-47-38><a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;split_idx&quot;</span><span class=p>),</span>
</span><span id=__span-47-39><a id=__codelineno-47-39 name=__codelineno-47-39 href=#__codelineno-47-39></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;set_idx&quot;</span><span class=p>),</span>
</span><span id=__span-47-40><a id=__codelineno-47-40 name=__codelineno-47-40 href=#__codelineno-47-40></a><span class=gp>... </span>    <span class=n>train_perf_list</span><span class=p>,</span>
</span><span id=__span-47-41><a id=__codelineno-47-41 name=__codelineno-47-41 href=#__codelineno-47-41></a><span class=gp>... </span>    <span class=n>iteration</span><span class=o>=</span><span class=s2>&quot;set_major&quot;</span><span class=p>,</span>
</span><span id=__span-47-42><a id=__codelineno-47-42 name=__codelineno-47-42 href=#__codelineno-47-42></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span>
</span><span id=__span-47-43><a id=__codelineno-47-43 name=__codelineno-47-43 href=#__codelineno-47-43></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Substituted by the current split number</li> <li>Substituted by the current set number</li> <li>List with the results from the training set</li> <li>If we're currently in the training set, run the optimization</li> <li>Append the results to the list</li> <li>Return the best result, which will be merged with the test results. Wrap with a list to return a Series rather than a single value (we want a nice index).</li> <li>Access the training results of the current split and test the best result</li> <li>Wrap with <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.Param>Param</a> for <code>sma_crossover_perf</code> to return a Series rather than a single value (we want a nice index)</li> <li>Return the test result</li> </ol> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Iteration 8/8</p> </div> </div> </p> <p>We've got 8 iterations, one per range: the first 4 iterations correspond to the training ranges, which took the most time to execute, while the last 4 iterations correspond to the test ranges, which executed almost instantly because of just one parameter combination. Let's concatenate the training results from <code>train_perf_dict</code> and see what's inside <code>cv_perf</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>train_perf_list</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>splitter</span><span class=o>.</span><span class=n>split_labels</span><span class=p>)</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=go>split_year  fast_window  slow_window</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=go>2018        5            6              1.161661</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=go>                         7              2.238117</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=go>                         8              1.583246</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=go>                         9              1.369400</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=go>                         10             0.563251</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=go>                                             ...   </span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=go>2021        46           48            -0.238667</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class=go>                         49            -0.437822</span>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=go>            47           48            -0.799317</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=go>                         49            -0.447324</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=go>            48           49            -0.401369</span>
</span><span id=__span-48-15><a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=go>Length: 3960, dtype: float64</span>
</span><span id=__span-48-16><a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a>
</span><span id=__span-48-17><a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_perf</span>
</span><span id=__span-48-18><a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=go>set    split_year  fast_window  slow_window</span>
</span><span id=__span-48-19><a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=go>train  2018        6            7              2.612006</span>
</span><span id=__span-48-20><a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a><span class=go>       2019        35           36             4.246530</span>
</span><span id=__span-48-21><a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a><span class=go>       2020        16           17             2.605763</span>
</span><span id=__span-48-22><a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a><span class=go>       2021        32           45             3.073246</span>
</span><span id=__span-48-23><a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a><span class=go>test   2018        6            7              1.501380</span>
</span><span id=__span-48-24><a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class=go>       2019        35           36             0.152723</span>
</span><span id=__span-48-25><a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a><span class=go>       2020        16           17             4.473387</span>
</span><span id=__span-48-26><a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class=go>       2021        32           45            -1.147178</span>
</span><span id=__span-48-27><a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>Same results, awesome!</p> <h3 id=merging>Merging<a class=headerlink href=#merging title="Permanent link">&para;</a></h3> <p>Another great feature of this method is that it can merge arbitrary outputs: from single values and Series, to DataFrames and even tuples of such. There are two main merging options available: merging all outputs into a single object (<code>merge_all=True</code>) and merging by the main unit of iteration (<code>merge_all=False</code>). The first option does the following: it flattens all outputs into a single sequence, resolves the merging function using <a href=../../../api/base/merging/index.html#vectorbtpro.base.merging.resolve_merge_func>resolve_merge_func</a>, and calls the merging function on that sequence. If the merging function is not specified, it wraps the sequence into a Pandas Series (even if each output is a complex object). If each output is a tuple, returns multiple of such Series. Let's illustrate this by returning entries and exits, and stacking them along columns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_entries_and_exits</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=gp>... </span>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>)</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=gp>... </span>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>,</span> <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;slow_sma&quot;</span><span class=p>)</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>real_crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=gp>... </span>    <span class=n>get_entries_and_exits</span><span class=p>,</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=gp>... </span>    <span class=mi>20</span><span class=p>,</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=gp>... </span>    <span class=mi>30</span><span class=p>,</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;column_stack&quot;</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=go>split_year                  2018       2019       2020       2021       </span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=go>set                        train test train test train test train   test</span>
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=go>Open time                                                               </span>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=go>2018-01-01 00:00:00+00:00  False  NaN   NaN  NaN   NaN  NaN   NaN    NaN</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=go>2018-01-02 00:00:00+00:00  False  NaN   NaN  NaN   NaN  NaN   NaN    NaN</span>
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=go>2018-01-03 00:00:00+00:00  False  NaN   NaN  NaN   NaN  NaN   NaN    NaN</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=go>...                          ...  ...   ...  ...   ...  ...   ...    ...</span>
</span><span id=__span-49-24><a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=go>2021-12-29 00:00:00+00:00    NaN  NaN   NaN  NaN   NaN  NaN   NaN  False</span>
</span><span id=__span-49-25><a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=go>2021-12-30 00:00:00+00:00    NaN  NaN   NaN  NaN   NaN  NaN   NaN  False</span>
</span><span id=__span-49-26><a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=go>2021-12-31 00:00:00+00:00    NaN  NaN   NaN  NaN   NaN  NaN   NaN  False</span>
</span><span id=__span-49-27><a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a>
</span><span id=__span-49-28><a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=go>[1461 rows x 8 columns]</span>
</span></code></pre></div> <p>We can then replace NaN with <code>False</code> and backtest them. If you don't want to have that many NaNs, use "reset_column_stack" as <code>merge_func</code>. We can also provide multiple merging functions (as a tuple) in case the outputs of our UDF have different formats.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Even though you can return multiple different formats, the formats must remain the same across all ranges!</p> </div> <p>As said previously, we can also merge outputs by the main unit of iteration. Let's run the same UDF but only stack the masks that belong to the same split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=gp>... </span>    <span class=n>get_entries_and_exits</span><span class=p>,</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=gp>... </span>    <span class=mi>50</span><span class=p>,</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=gp>... </span>    <span class=mi>200</span><span class=p>,</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=gp>... </span>    <span class=n>merge_all</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;row_stack&quot;</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=mi>2018</span><span class=p>]</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=go>set    Open time                </span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=go>train  2018-01-01 00:00:00+00:00    False</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=go>       2018-01-02 00:00:00+00:00    False</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=go>       2018-01-03 00:00:00+00:00    False</span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=go>       2018-01-04 00:00:00+00:00    False</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=go>       2018-01-05 00:00:00+00:00    False</span>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=go>                                      ...</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=go>test   2018-12-27 00:00:00+00:00    False</span>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=go>       2018-12-28 00:00:00+00:00    False</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=go>       2018-12-29 00:00:00+00:00    False</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=go>       2018-12-30 00:00:00+00:00    False</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class=go>       2018-12-31 00:00:00+00:00     True</span>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=go>Length: 365, dtype: bool</span>
</span></code></pre></div> <p>This way, each mask covers an entire year and can be backtested as a whole. The additional level <code>set</code> provides us with the information on which set each timestamp belongs to.</p> <p>In a case where a range's start and end date cannot be inferred from the merged data alone, we can instruct the method to attach this information. Let's get the total number of signals:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_signal_count</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>get_entries_and_exits</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>(),</span> <span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entry_count</span><span class=p>,</span> <span class=n>exit_count</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=gp>... </span>    <span class=n>get_signal_count</span><span class=p>,</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=gp>... </span>    <span class=mi>20</span><span class=p>,</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=gp>... </span>    <span class=mi>30</span><span class=p>,</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=gp>... </span>    <span class=n>attach_bounds</span><span class=o>=</span><span class=s2>&quot;index&quot;</span>  <span class=c1># (1)!</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entry_count</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=go>split_year  set    start                      end                      </span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=go>2018        train  2018-01-01 00:00:00+00:00  2018-07-01 00:00:00+00:00    2</span>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=go>            test   2018-07-01 00:00:00+00:00  2019-01-01 00:00:00+00:00    4</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=go>2019        train  2019-01-01 00:00:00+00:00  2019-07-01 00:00:00+00:00    2</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=go>            test   2019-07-01 00:00:00+00:00  2020-01-01 00:00:00+00:00    3</span>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=go>2020        train  2020-01-01 00:00:00+00:00  2020-07-01 00:00:00+00:00    1</span>
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=go>            test   2020-07-01 00:00:00+00:00  2021-01-01 00:00:00+00:00    2</span>
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=go>2021        train  2021-01-01 00:00:00+00:00  2021-07-01 00:00:00+00:00    4</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=go>            test   2021-07-01 00:00:00+00:00  2022-01-01 00:00:00+00:00    1</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Calculate the integer bounds, map them to <code>data.index</code>, and attach them to the output's index</li> </ol> <p>Finally, to demonstrate the power of merging functions, let's create our own merging function that plots the returned signals depending on the set!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>plot_entries_and_exits</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>keys</span><span class=p>):</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=gp>... </span>    <span class=n>set_labels</span> <span class=o>=</span> <span class=n>keys</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;set&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=gp>... </span>    <span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=gp>... </span>    <span class=n>train_seen</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=gp>... </span>    <span class=n>test_seen</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=gp>...</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>results</span><span class=p>)):</span>  <span class=c1># (3)!</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=gp>... </span>        <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>results</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>  <span class=c1># (4)!</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=gp>... </span>        <span class=n>set_label</span> <span class=o>=</span> <span class=n>set_labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>set_label</span> <span class=o>==</span> <span class=s2>&quot;train&quot;</span><span class=p>:</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=gp>... </span>            <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_entries</span><span class=p>(</span>  <span class=c1># (5)!</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=gp>... </span>                <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=gp>... </span>                <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (6)!</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=gp>... </span>                    <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;limegreen&quot;</span><span class=p>),</span> 
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=gp>... </span>                    <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Entries (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=gp>... </span>                    <span class=n>legendgroup</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Entries (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>  <span class=c1># (7)!</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=gp>... </span>                    <span class=n>showlegend</span><span class=o>=</span><span class=ow>not</span> <span class=n>train_seen</span>  <span class=c1># (8)!</span>
</span><span id=__span-52-18><a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a><span class=gp>... </span>                <span class=p>),</span>
</span><span id=__span-52-19><a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=gp>... </span>                <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-52-20><a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=gp>... </span>            <span class=p>),</span>
</span><span id=__span-52-21><a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a><span class=gp>... </span>            <span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span>
</span><span id=__span-52-22><a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=gp>... </span>                <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-52-23><a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class=gp>... </span>                <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-52-24><a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class=gp>... </span>                    <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=p>),</span> 
</span><span id=__span-52-25><a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a><span class=gp>... </span>                    <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Exits (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-26><a id=__codelineno-52-26 name=__codelineno-52-26 href=#__codelineno-52-26></a><span class=gp>... </span>                    <span class=n>legendgroup</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Exits (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-27><a id=__codelineno-52-27 name=__codelineno-52-27 href=#__codelineno-52-27></a><span class=gp>... </span>                    <span class=n>showlegend</span><span class=o>=</span><span class=ow>not</span> <span class=n>train_seen</span>
</span><span id=__span-52-28><a id=__codelineno-52-28 name=__codelineno-52-28 href=#__codelineno-52-28></a><span class=gp>... </span>                <span class=p>),</span>
</span><span id=__span-52-29><a id=__codelineno-52-29 name=__codelineno-52-29 href=#__codelineno-52-29></a><span class=gp>... </span>                <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-52-30><a id=__codelineno-52-30 name=__codelineno-52-30 href=#__codelineno-52-30></a><span class=gp>... </span>            <span class=p>)</span>
</span><span id=__span-52-31><a id=__codelineno-52-31 name=__codelineno-52-31 href=#__codelineno-52-31></a><span class=gp>... </span>            <span class=n>train_seen</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-52-32><a id=__codelineno-52-32 name=__codelineno-52-32 href=#__codelineno-52-32></a><span class=gp>... </span>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-52-33><a id=__codelineno-52-33 name=__codelineno-52-33 href=#__codelineno-52-33></a><span class=gp>... </span>            <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_entries</span><span class=p>(</span>
</span><span id=__span-52-34><a id=__codelineno-52-34 name=__codelineno-52-34 href=#__codelineno-52-34></a><span class=gp>... </span>                <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-52-35><a id=__codelineno-52-35 name=__codelineno-52-35 href=#__codelineno-52-35></a><span class=gp>... </span>                <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-52-36><a id=__codelineno-52-36 name=__codelineno-52-36 href=#__codelineno-52-36></a><span class=gp>... </span>                    <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;skyblue&quot;</span><span class=p>),</span> 
</span><span id=__span-52-37><a id=__codelineno-52-37 name=__codelineno-52-37 href=#__codelineno-52-37></a><span class=gp>... </span>                    <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Entries (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-38><a id=__codelineno-52-38 name=__codelineno-52-38 href=#__codelineno-52-38></a><span class=gp>... </span>                    <span class=n>legendgroup</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Entries (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-39><a id=__codelineno-52-39 name=__codelineno-52-39 href=#__codelineno-52-39></a><span class=gp>... </span>                    <span class=n>showlegend</span><span class=o>=</span><span class=ow>not</span> <span class=n>test_seen</span>
</span><span id=__span-52-40><a id=__codelineno-52-40 name=__codelineno-52-40 href=#__codelineno-52-40></a><span class=gp>... </span>                <span class=p>),</span>
</span><span id=__span-52-41><a id=__codelineno-52-41 name=__codelineno-52-41 href=#__codelineno-52-41></a><span class=gp>... </span>                <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-52-42><a id=__codelineno-52-42 name=__codelineno-52-42 href=#__codelineno-52-42></a><span class=gp>... </span>            <span class=p>),</span>
</span><span id=__span-52-43><a id=__codelineno-52-43 name=__codelineno-52-43 href=#__codelineno-52-43></a><span class=gp>... </span>            <span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span>
</span><span id=__span-52-44><a id=__codelineno-52-44 name=__codelineno-52-44 href=#__codelineno-52-44></a><span class=gp>... </span>                <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-52-45><a id=__codelineno-52-45 name=__codelineno-52-45 href=#__codelineno-52-45></a><span class=gp>... </span>                <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-52-46><a id=__codelineno-52-46 name=__codelineno-52-46 href=#__codelineno-52-46></a><span class=gp>... </span>                    <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;magenta&quot;</span><span class=p>),</span> 
</span><span id=__span-52-47><a id=__codelineno-52-47 name=__codelineno-52-47 href=#__codelineno-52-47></a><span class=gp>... </span>                    <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Exits (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-48><a id=__codelineno-52-48 name=__codelineno-52-48 href=#__codelineno-52-48></a><span class=gp>... </span>                    <span class=n>legendgroup</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Entries (</span><span class=si>{</span><span class=n>set_label</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-52-49><a id=__codelineno-52-49 name=__codelineno-52-49 href=#__codelineno-52-49></a><span class=gp>... </span>                    <span class=n>showlegend</span><span class=o>=</span><span class=ow>not</span> <span class=n>test_seen</span>
</span><span id=__span-52-50><a id=__codelineno-52-50 name=__codelineno-52-50 href=#__codelineno-52-50></a><span class=gp>... </span>                <span class=p>),</span>
</span><span id=__span-52-51><a id=__codelineno-52-51 name=__codelineno-52-51 href=#__codelineno-52-51></a><span class=gp>... </span>                <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-52-52><a id=__codelineno-52-52 name=__codelineno-52-52 href=#__codelineno-52-52></a><span class=gp>... </span>            <span class=p>)</span>
</span><span id=__span-52-53><a id=__codelineno-52-53 name=__codelineno-52-53 href=#__codelineno-52-53></a><span class=gp>... </span>            <span class=n>test_seen</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-52-54><a id=__codelineno-52-54 name=__codelineno-52-54 href=#__codelineno-52-54></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>fig</span>  <span class=c1># (9)!</span>
</span><span id=__span-52-55><a id=__codelineno-52-55 name=__codelineno-52-55 href=#__codelineno-52-55></a>
</span><span id=__span-52-56><a id=__codelineno-52-56 name=__codelineno-52-56 href=#__codelineno-52-56></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span><span id=__span-52-57><a id=__codelineno-52-57 name=__codelineno-52-57 href=#__codelineno-52-57></a><span class=gp>... </span>    <span class=n>get_entries_and_exits</span><span class=p>,</span>
</span><span id=__span-52-58><a id=__codelineno-52-58 name=__codelineno-52-58 href=#__codelineno-52-58></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span>
</span><span id=__span-52-59><a id=__codelineno-52-59 name=__codelineno-52-59 href=#__codelineno-52-59></a><span class=gp>... </span>    <span class=mi>20</span><span class=p>,</span>
</span><span id=__span-52-60><a id=__codelineno-52-60 name=__codelineno-52-60 href=#__codelineno-52-60></a><span class=gp>... </span>    <span class=mi>30</span><span class=p>,</span>
</span><span id=__span-52-61><a id=__codelineno-52-61 name=__codelineno-52-61 href=#__codelineno-52-61></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=n>plot_entries_and_exits</span><span class=p>,</span>
</span><span id=__span-52-62><a id=__codelineno-52-62 name=__codelineno-52-62 href=#__codelineno-52-62></a><span class=gp>... </span>    <span class=n>merge_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;keys&quot;</span><span class=p>)),</span>
</span><span id=__span-52-63><a id=__codelineno-52-63 name=__codelineno-52-63 href=#__codelineno-52-63></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li><code>keys</code> is a multi-index for <code>results</code> that contains split labels, set labels, and (optionally) bounds</li> <li>Plot OHLC</li> <li>Whenever <code>merge_all</code> is <code>True</code>, the results are flattened into a single list. To figure out which results belong to which set, we can read <code>keys</code>.</li> <li>Each result is a tuple of entries and exits, exactly how returned by <code>get_entries_and_exits</code></li> <li>Use <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.plot_as_entries>SignalsAccessor.plot_as_entries</a> and <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.plot_as_exits>SignalsAccessor.plot_as_exits</a> to plot the signals as entry and exit markers respectively</li> <li>Change the appearance of the markers depending on the signal type and set</li> <li>By making the legend group the same for multiple traces, we can make them react to any user interactions in the same way</li> <li>Show the legend only if there isn't any trace with the same name already plotted, otherwise there will be duplicates</li> <li>Our merging function returns a Plotly figure</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/plot_entries_and_exits.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/plot_entries_and_exits.dark.svg#only-dark></p> <p>As we can see, <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a> is a flexible method that can execute any UDF on each range in the splitter. Not only it can return arrays in an analysis-friendly format, but it can also post-process and merge the outputs using another UDF, which makes it ideal for quick CV.</p> <h3 id=decorators>Decorators<a class=headerlink href=#decorators title="Permanent link">&para;</a></h3> <p>But even the method above isn't the end of automation that vectorbt offers: similarly to the decorator <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a>, which can enhance any function with a parameter processing logic, there is a decorator <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> that can enhance just about any function with a split processing logic. The workings of this decorator are dead-simple: wrap a function, resolve a splitting specification into a splitter, and forward all arguments down to <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a>. This way, we're making CV pipeline-centric and not splitter-centric. </p> <p>There are several ways how to make a function splittable:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>splitter</span><span class=o>=</span><span class=n>splitter</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>get_split_total_return</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_split_total_return</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=go>split_year  set  </span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=go>            test    -0.417491</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=go>            test    -0.322797</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=go>            test     2.132976</span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=go>            test     0.379417</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=go>dtype: float64</span>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a>
</span><span id=__span-53-17><a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_total_return</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-53-18><a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-53-19><a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a>
</span><span id=__span-53-20><a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_split_total_return</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>split</span><span class=p>(</span>  <span class=c1># (2)!</span>
</span><span id=__span-53-21><a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span> 
</span><span id=__span-53-22><a id=__codelineno-53-22 name=__codelineno-53-22 href=#__codelineno-53-22></a><span class=gp>... </span>    <span class=n>splitter</span><span class=o>=</span><span class=n>splitter</span>
</span><span id=__span-53-23><a id=__codelineno-53-23 name=__codelineno-53-23 href=#__codelineno-53-23></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-53-24><a id=__codelineno-53-24 name=__codelineno-53-24 href=#__codelineno-53-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_split_total_return</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span><span id=__span-53-25><a id=__codelineno-53-25 name=__codelineno-53-25 href=#__codelineno-53-25></a><span class=go>split_year  set  </span>
</span><span id=__span-53-26><a id=__codelineno-53-26 name=__codelineno-53-26 href=#__codelineno-53-26></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-53-27><a id=__codelineno-53-27 name=__codelineno-53-27 href=#__codelineno-53-27></a><span class=go>            test    -0.417491</span>
</span><span id=__span-53-28><a id=__codelineno-53-28 name=__codelineno-53-28 href=#__codelineno-53-28></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-53-29><a id=__codelineno-53-29 name=__codelineno-53-29 href=#__codelineno-53-29></a><span class=go>            test    -0.322797</span>
</span><span id=__span-53-30><a id=__codelineno-53-30 name=__codelineno-53-30 href=#__codelineno-53-30></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-53-31><a id=__codelineno-53-31 name=__codelineno-53-31 href=#__codelineno-53-31></a><span class=go>            test     2.132976</span>
</span><span id=__span-53-32><a id=__codelineno-53-32 name=__codelineno-53-32 href=#__codelineno-53-32></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-53-33><a id=__codelineno-53-33 name=__codelineno-53-33 href=#__codelineno-53-33></a><span class=go>            test     0.379417</span>
</span><span id=__span-53-34><a id=__codelineno-53-34 name=__codelineno-53-34 href=#__codelineno-53-34></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Through decoration</li> <li>Through passing the function as the first argument</li> </ol> <p>If we didn't pass any argument to the decorator, or if we want to override some argument, we can add a prefix <code>_</code> to an argument to pass it to <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> rather than to the function itself:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@vbt</span><span class=o>.</span><span class=n>split</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>get_split_total_return</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>returns</span><span class=o>.</span><span class=n>total</span><span class=p>()</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_split_total_return</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>_splitter</span><span class=o>=</span><span class=n>splitter</span><span class=p>)</span>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=go>split_year  set  </span>
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=go>2018        train   -0.522416</span>
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=go>            test    -0.417491</span>
</span><span id=__span-54-9><a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=go>2019        train    1.858493</span>
</span><span id=__span-54-10><a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=go>            test    -0.322797</span>
</span><span id=__span-54-11><a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=go>2020        train    0.269093</span>
</span><span id=__span-54-12><a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=go>            test     2.132976</span>
</span><span id=__span-54-13><a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=go>2021        train    0.194783</span>
</span><span id=__span-54-14><a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=go>            test     0.379417</span>
</span><span id=__span-54-15><a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>A potential inconvenience of the approach above is that for each data we pass, we need to separately construct a splitter using the index of the same data. To solve this, the decorator can also take an instruction on how to create a splitter from the passed data. The instruction consists of a method name (or the actual callable) provided as <code>splitter</code>, such as "from_rolling", and keyword arguments passed to this method as <code>splitter_kwargs</code>. Let's roll a window of 30 days of the year 2020:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_split_total_return</span><span class=p>(</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Takeable</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2020&quot;</span><span class=p>:</span><span class=s2>&quot;2020&quot;</span><span class=p>]),</span> 
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=gp>... </span>    <span class=n>_splitter</span><span class=o>=</span><span class=s2>&quot;from_rolling&quot;</span><span class=p>,</span> 
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=gp>... </span>    <span class=n>_splitter_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=s2>&quot;30d&quot;</span><span class=p>)</span>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=go>split</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=go>0     0.321123</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=go>1    -0.088666</span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=go>2    -0.250531</span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=go>3     0.369418</span>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=go>4     0.093628</span>
</span><span id=__span-55-12><a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=go>5    -0.059949</span>
</span><span id=__span-55-13><a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=go>6     0.186424</span>
</span><span id=__span-55-14><a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=go>7     0.020706</span>
</span><span id=__span-55-15><a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=go>8    -0.069256</span>
</span><span id=__span-55-16><a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=go>9     0.211424</span>
</span><span id=__span-55-17><a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=go>10    0.372754</span>
</span><span id=__span-55-18><a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=go>11    0.441005</span>
</span><span id=__span-55-19><a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>To avoid wrapping each object to take slices from with <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Takeable>Takeable</a>, we can also specify a list of such arguments as <code>takeable_args</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_total_return_by_month</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>split</span><span class=p>(</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=gp>... </span>    <span class=n>get_total_return</span><span class=p>,</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=gp>... </span>    <span class=n>splitter</span><span class=o>=</span><span class=s2>&quot;from_grouper&quot;</span><span class=p>,</span> 
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=gp>... </span>    <span class=n>splitter_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;index.to_period(&#39;M&#39;)&quot;</span><span class=p>)),</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=gp>... </span>    <span class=n>takeable_args</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>get_total_return_by_month</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2020&quot;</span><span class=p>:</span><span class=s2>&quot;2020&quot;</span><span class=p>])</span>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=go>Open time</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=go>2020-01    0.298859</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=go>2020-02   -0.091746</span>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=go>2020-03   -0.248649</span>
</span><span id=__span-56-13><a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=go>2020-04    0.297622</span>
</span><span id=__span-56-14><a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=go>2020-05    0.070388</span>
</span><span id=__span-56-15><a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=go>2020-06   -0.104131</span>
</span><span id=__span-56-16><a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=go>2020-07    0.227844</span>
</span><span id=__span-56-17><a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a><span class=go>2020-08   -0.012851</span>
</span><span id=__span-56-18><a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=go>2020-09   -0.096073</span>
</span><span id=__span-56-19><a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a><span class=go>2020-10    0.298694</span>
</span><span id=__span-56-20><a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a><span class=go>2020-11    0.431230</span>
</span><span id=__span-56-21><a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a><span class=go>2020-12    0.541364</span>
</span><span id=__span-56-22><a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a><span class=go>Freq: M, dtype: float64</span>
</span></code></pre></div> <p>In the example above, a new splitter is built from every instance of data that we pass.</p> <p>Furthermore, we can combine multiple decorators. For example, let's decorate the function <code>sma_crossover_perf</code> from the first page that we've already decorated with <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a>, and make it split the entire period into 60% for the training set and 40% for the test set:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_sma_crossover_perf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>split</span><span class=p>(</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=gp>... </span>    <span class=n>sma_crossover_perf</span><span class=p>,</span> 
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=gp>... </span>    <span class=n>splitter</span><span class=o>=</span><span class=s2>&quot;from_single&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=gp>... </span>    <span class=n>splitter_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>split</span><span class=o>=</span><span class=mf>0.6</span><span class=p>,</span> <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>]),</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=gp>... </span>    <span class=n>takeable_args</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>],</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Use <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.from_single>Splitter.from_single</a> to build a single split</li> <li>Any other argument passed to <code>@split</code> will be forwarded down to <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a></li> </ol> <p>We'll run the full parameter grid on the training set only:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span> <span class=o>=</span> <span class=n>cv_sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2020&quot;</span><span class=p>:</span><span class=s2>&quot;2021&quot;</span><span class=p>],</span>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;x &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>)),</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=gp>... </span>    <span class=n>p_execute_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=gp>... </span>        <span class=n>clear_cache</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=gp>... </span>        <span class=n>collect_garbage</span><span class=o>=</span><span class=mi>50</span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=gp>... </span>    <span class=n>_forward_kwargs_as</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=gp>... </span>        <span class=s2>&quot;p_execute_kwargs&quot;</span><span class=p>:</span> <span class=s2>&quot;_execute_kwargs&quot;</span>  <span class=c1># (1)!</span>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=gp>... </span>    <span class=p>},</span>
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=gp>... </span>    <span class=n>_apply_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>set_</span><span class=o>=</span><span class=s2>&quot;train&quot;</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Both <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> and <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a> take <code>execute_kwargs</code>. To differentiate between them, we'll pass <code>p_execute_kwargs</code>, let <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> rename it to <code>_execute_kwargs</code> using <code>forward_kwargs_as</code>, and forward the argument down to <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a></li> <li>If we need to change any argument related to <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a>, we can pass it directly to <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a>, or include it in <code>_apply_kwargs</code> when passed to an already decorated function</li> </ol> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Split 1/1</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>train_perf</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=go>fast_window  slow_window</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=go>5            6              1.160003</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=go>             7              1.122994</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=go>             8              2.054193</span>
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=go>             9              1.880043</span>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=go>             10             1.632951</span>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=go>                                 ...</span>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=go>46           48             1.362618</span>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=go>             49             1.415010</span>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=go>47           48             1.317795</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=go>             49             1.250835</span>
</span><span id=__span-59-13><a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=go>48           49             0.160916</span>
</span><span id=__span-59-14><a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=go>Length: 990, dtype: float64</span>
</span></code></pre></div> <p>We can then validate the optimization performance on the test set:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_perf</span> <span class=o>=</span> <span class=n>cv_sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2020&quot;</span><span class=p>:</span><span class=s2>&quot;2021&quot;</span><span class=p>],</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=gp>... </span>    <span class=n>train_perf</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()[</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=gp>... </span>    <span class=n>train_perf</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()[</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=gp>... </span>    <span class=n>_apply_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>set_</span><span class=o>=</span><span class=s2>&quot;test&quot;</span><span class=p>)</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Split 1/1</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_perf</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=go>1.2596407796960982</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>If you want to have a proper Series instead of a single value returned, disable <code>squeeze_one_split</code> and <code>squeeze_one_set</code> in <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter.apply>Splitter.apply</a> using <code>_apply_kwargs</code>.</p> </div> <p>But even this decorator isn't the final form of automation: there's a special decorator <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.cv_split>@cv_split</a> that combines <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> and <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a> to run the full parameter grid on the first set and the best parameter combination on the remaining sets. How is the best parameter combination defined? There's an argument <code>selection</code> that can be a template taking the previous results (available as <code>grid_results</code> in the context) and returning the integer position of the parameter combination that the user defines as the best. Moreover, the decorator can either return the best results only (<code>return_grid=False</code>), or additionally include the grid results from the training set (<code>return_grid=True</code>) or even the grid run on all sets (<code>return_grid="all"</code>).</p> <p>Since we're waiting too much time for the entire grid of parameter combinations to complete, let's rewrite our pipeline with Numba to return the Sharpe ratio of a single parameter combination:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span><span class=p>(</span><span class=n>nogil</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>sma_crossover_perf_nb</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>,</span> <span class=n>ann_factor</span><span class=p>):</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=gp>... </span>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>ma_nb</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=gp>... </span>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>ma_nb</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>)</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>,</span> <span class=n>fast_sma</span><span class=p>)</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=gp>... </span>    <span class=n>sim_out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>from_signals_nb</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=gp>... </span>        <span class=n>target_shape</span><span class=o>=</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=gp>... </span>        <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>),</span>
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=gp>... </span>        <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=gp>... </span>        <span class=n>long_entries</span><span class=o>=</span><span class=n>entries</span><span class=p>,</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=gp>... </span>        <span class=n>short_entries</span><span class=o>=</span><span class=n>exits</span><span class=p>,</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=gp>... </span>        <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-62-14><a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-62-15><a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ret_nb</span><span class=o>.</span><span class=n>sharpe_ratio_nb</span><span class=p>(</span>  <span class=c1># (5)!</span>
</span><span id=__span-62-16><a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a><span class=gp>... </span>        <span class=n>sim_out</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>,</span> 
</span><span id=__span-62-17><a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=gp>... </span>        <span class=n>ann_factor</span>
</span><span id=__span-62-18><a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a><span class=gp>... </span>    <span class=p>)</span>
</span></code></pre></div> <ol> <li>Disable <a href=https://realpython.com/python-gil/ >GIL</a> for multithreading</li> <li>Use <a href=../../../api/generic/nb/rolling/index.html#vectorbtpro.generic.nb.rolling.ma_nb>ma_nb</a></li> <li>Use <a href=../../../api/generic/nb/base/index.html#vectorbtpro.generic.nb.base.crossed_above_nb>crossed_above_nb</a></li> <li>Use <a href=../../../api/portfolio/nb/from_signals/index.html#vectorbtpro.portfolio.nb.from_signals.from_signals_nb>from_signals_nb</a></li> <li>Use <a href=../../../api/returns/nb/index.html#vectorbtpro.returns.nb.sharpe_ratio_nb>sharpe_ratio_nb</a></li> </ol> <p>Test the function on the full history:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma_crossover_perf_nb</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>),</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>365</span><span class=p>)</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=go>array([1.04969317])</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>All Numba functions that we use are expecting a two-dimensional NumPy array as input.</p> </div> <p>Finally, let's define and run CV in a parallel manner:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_sma_crossover_perf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>cv_split</span><span class=p>(</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=gp>... </span>    <span class=n>sma_crossover_perf_nb</span><span class=p>,</span>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=gp>... </span>    <span class=n>splitter</span><span class=o>=</span><span class=s2>&quot;from_rolling&quot;</span><span class=p>,</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=gp>... </span>    <span class=n>splitter_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=gp>... </span>        <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span> 
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=gp>... </span>        <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> 
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=gp>... </span>        <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>]</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=gp>... </span>    <span class=n>takeable_args</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;close&quot;</span><span class=p>],</span>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=gp>... </span>    <span class=n>merge_func</span><span class=o>=</span><span class=s2>&quot;concat&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-64-11><a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=gp>... </span>    <span class=n>parameterized_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (2)!</span>
</span><span id=__span-64-12><a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a><span class=gp>... </span>        <span class=n>engine</span><span class=o>=</span><span class=s2>&quot;dask&quot;</span><span class=p>,</span> 
</span><span id=__span-64-13><a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a><span class=gp>... </span>        <span class=n>chunk_len</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span>
</span><span id=__span-64-14><a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-64-15><a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-64-16><a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a>
</span><span id=__span-64-17><a id=__codelineno-64-17 name=__codelineno-64-17 href=#__codelineno-64-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_perf</span><span class=p>,</span> <span class=n>best_perf</span> <span class=o>=</span> <span class=n>cv_sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-64-18><a id=__codelineno-64-18 name=__codelineno-64-18 href=#__codelineno-64-18></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>),</span>
</span><span id=__span-64-19><a id=__codelineno-64-19 name=__codelineno-64-19 href=#__codelineno-64-19></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>condition</span><span class=o>=</span><span class=s2>&quot;x &lt; slow_window&quot;</span><span class=p>),</span>
</span><span id=__span-64-20><a id=__codelineno-64-20 name=__codelineno-64-20 href=#__codelineno-64-20></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>)),</span>
</span><span id=__span-64-21><a id=__codelineno-64-21 name=__codelineno-64-21 href=#__codelineno-64-21></a><span class=gp>... </span>    <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>365</span><span class=p>)</span> <span class=o>//</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>freq</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-64-22><a id=__codelineno-64-22 name=__codelineno-64-22 href=#__codelineno-64-22></a><span class=gp>... </span>    <span class=n>_merge_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>wrapper</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-64-23><a id=__codelineno-64-23 name=__codelineno-64-23 href=#__codelineno-64-23></a><span class=gp>... </span>    <span class=n>_index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>  <span class=c1># (5)!</span>
</span><span id=__span-64-24><a id=__codelineno-64-24 name=__codelineno-64-24 href=#__codelineno-64-24></a><span class=gp>... </span>    <span class=n>_return_grid</span><span class=o>=</span><span class=s2>&quot;all&quot;</span>  <span class=c1># (6)!</span>
</span><span id=__span-64-25><a id=__codelineno-64-25 name=__codelineno-64-25 href=#__codelineno-64-25></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Keyword arguments passed to <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a></li> <li>Chunk length will be based on the number of CPUs</li> <li>The merging function passed to <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a>, will be automatically passed to <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.parameterized>@parameterized</a> as well (and yes, both decorators can have different merging functions)</li> <li>Get the annualization factor by dividing the year frequency by the data frequency</li> <li>Our Numba function returns a one-dimensional NumPy array (i.e., one value per column in the data), thus we need to pass the wrapper to assign each value in the returned array with the corresponding column name</li> <li><code>index</code> is an argument of <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> and can be used to pass an index if no index can be extracted from the "takeable" arrays</li> <li>Run the entire grid on each set. Will return both the grid results and the best results. Note that the test set will still use the previous grid, not its own.</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>By default, the highest value is selected. To select the lowest value, set <code>selection="min"</code> in <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a>. Also, make sure to change the selection template if any other merging function is being used.</p> </div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Split 9/9</p> </div> </div> </p> <p>That was fast! <img alt=💨 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a8.svg title=:dash:></p> <div class="admonition question"> <p class=admonition-title>Question</p> <p>Why is the performance so different compared to the previous version, which, by the way, uses the same Numba functions under the hood? Remember that when running one function a thousand of times, even a 1-millisecond longer execution time translates into a 1-second longer <strong>total</strong> execution time.</p> </div> <p>Let's take a look at the CV results:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_perf</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=go>split  set    fast_window  slow_window  symbol </span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=go>0      train  5            6            BTCUSDT    1.771782</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=go>                           7            BTCUSDT    2.206458</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=go>                           8            BTCUSDT    2.705892</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=go>                           9            BTCUSDT    1.430768</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=go>                           10           BTCUSDT    0.851692</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=go>                                                        ...   </span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=go>8      test   46           48           BTCUSDT    0.637332</span>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=go>                           49           BTCUSDT   -0.424650</span>
</span><span id=__span-65-11><a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=go>              47           48           BTCUSDT   -0.214946</span>
</span><span id=__span-65-12><a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a><span class=go>                           49           BTCUSDT    0.231712</span>
</span><span id=__span-65-13><a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a><span class=go>              48           49           BTCUSDT   -0.351245</span>
</span><span id=__span-65-14><a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a><span class=go>Length: 17820, dtype: float64</span>
</span><span id=__span-65-15><a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a>
</span><span id=__span-65-16><a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_perf</span>
</span><span id=__span-65-17><a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a><span class=go>split  set    fast_window  slow_window  symbol </span>
</span><span id=__span-65-18><a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a><span class=go>0      train  19           34           BTCUSDT    4.392966</span>
</span><span id=__span-65-19><a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a><span class=go>       test   19           34           BTCUSDT    0.535497</span>
</span><span id=__span-65-20><a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a><span class=go>1      train  6            7            BTCUSDT    2.545991</span>
</span><span id=__span-65-21><a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a><span class=go>       test   6            7            BTCUSDT   -1.101692</span>
</span><span id=__span-65-22><a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a><span class=go>2      train  18           20           BTCUSDT    4.363491</span>
</span><span id=__span-65-23><a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a><span class=go>       test   18           20           BTCUSDT    1.692070</span>
</span><span id=__span-65-24><a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a><span class=go>3      train  14           18           BTCUSDT    3.615833</span>
</span><span id=__span-65-25><a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a><span class=go>       test   14           18           BTCUSDT    0.035444</span>
</span><span id=__span-65-26><a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a><span class=go>4      train  18           21           BTCUSDT    3.236440</span>
</span><span id=__span-65-27><a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a><span class=go>       test   18           21           BTCUSDT    1.882290</span>
</span><span id=__span-65-28><a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a><span class=go>5      train  20           27           BTCUSDT    3.371474</span>
</span><span id=__span-65-29><a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a><span class=go>       test   20           27           BTCUSDT    2.574914</span>
</span><span id=__span-65-30><a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a><span class=go>6      train  11           18           BTCUSDT    4.657549</span>
</span><span id=__span-65-31><a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a><span class=go>       test   11           18           BTCUSDT   -2.067505</span>
</span><span id=__span-65-32><a id=__codelineno-65-32 name=__codelineno-65-32 href=#__codelineno-65-32></a><span class=go>7      train  29           30           BTCUSDT    3.388797</span>
</span><span id=__span-65-33><a id=__codelineno-65-33 name=__codelineno-65-33 href=#__codelineno-65-33></a><span class=go>       test   29           30           BTCUSDT    0.968127</span>
</span><span id=__span-65-34><a id=__codelineno-65-34 name=__codelineno-65-34 href=#__codelineno-65-34></a><span class=go>8      train  25           28           BTCUSDT    2.149624</span>
</span><span id=__span-65-35><a id=__codelineno-65-35 name=__codelineno-65-35 href=#__codelineno-65-35></a><span class=go>       test   25           28           BTCUSDT    1.256857</span>
</span><span id=__span-65-36><a id=__codelineno-65-36 name=__codelineno-65-36 href=#__codelineno-65-36></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>For instance, the test results negatively correlate with the training results, meaning that the parameter combinations with the highest Sharpe tend to underperform when they overperformed previously. This actually makes sense because BTC market regimes tend to switch frequently.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_train_perf</span> <span class=o>=</span> <span class=n>best_perf</span><span class=o>.</span><span class=n>xs</span><span class=p>(</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;set&quot;</span><span class=p>)</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_test_perf</span> <span class=o>=</span> <span class=n>best_perf</span><span class=o>.</span><span class=n>xs</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;set&quot;</span><span class=p>)</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_train_perf</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=n>best_test_perf</span><span class=p>)</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=go>-0.21641517083891232</span>
</span></code></pre></div> <p>To dig deeper, let's analyze the cross-set correlation of each parameter combination, that is, how the performance of a parameter combination in the training set correlates with the performance of the same parameter combination in the test set:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>param_cross_set_corr</span> <span class=o>=</span> <span class=n>grid_perf</span>\
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=gp>... </span>    <span class=o>.</span><span class=n>unstack</span><span class=p>(</span><span class=s2>&quot;set&quot;</span><span class=p>)</span>\
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=gp>... </span>    <span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s2>&quot;fast_window&quot;</span><span class=p>,</span> <span class=s2>&quot;slow_window&quot;</span><span class=p>])</span>\
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=gp>... </span>    <span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=s2>&quot;test&quot;</span><span class=p>]))</span>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>param_cross_set_corr</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span><span class=n>symmetric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/param_cross_set_corr.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/param_cross_set_corr.dark.svg#only-dark></p> <p>Another perspective can be added by analyzing the test performance of the best parameter combinations in relation to the test performance of all parameter combinations. Let's get the relative number of parameter combinations that are better than the selected one in each split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_test_perf</span> <span class=o>=</span> <span class=n>grid_perf</span><span class=o>.</span><span class=n>xs</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;set&quot;</span><span class=p>)</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_df</span> <span class=o>=</span> <span class=n>grid_test_perf</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;grid&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>grid_df</span><span class=p>[</span><span class=s2>&quot;fast_window&quot;</span><span class=p>]</span>  <span class=c1># (2)!</span>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>grid_df</span><span class=p>[</span><span class=s2>&quot;slow_window&quot;</span><span class=p>]</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>best_df</span> <span class=o>=</span> <span class=n>best_test_perf</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;best&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>best_df</span><span class=p>[</span><span class=s2>&quot;fast_window&quot;</span><span class=p>]</span>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>best_df</span><span class=p>[</span><span class=s2>&quot;slow_window&quot;</span><span class=p>]</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>merged_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>grid_df</span><span class=p>,</span> <span class=n>best_df</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;split&quot;</span><span class=p>,</span> <span class=s2>&quot;symbol&quot;</span><span class=p>])</span>  <span class=c1># (3)!</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_better_mask</span> <span class=o>=</span> <span class=n>merged_df</span><span class=p>[</span><span class=s2>&quot;grid&quot;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>merged_df</span><span class=p>[</span><span class=s2>&quot;best&quot;</span><span class=p>]</span>  <span class=c1># (4)!</span>
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_better_mask</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=n>grid_test_perf</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_better_cnt</span> <span class=o>=</span> <span class=n>grid_better_mask</span><span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s2>&quot;split&quot;</span><span class=p>,</span> <span class=s2>&quot;symbol&quot;</span><span class=p>])</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>  <span class=c1># (5)!</span>
</span><span id=__span-68-12><a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>grid_better_cnt</span>
</span><span id=__span-68-13><a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a><span class=go>split  symbol </span>
</span><span id=__span-68-14><a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a><span class=go>0      BTCUSDT    0.242424</span>
</span><span id=__span-68-15><a id=__codelineno-68-15 name=__codelineno-68-15 href=#__codelineno-68-15></a><span class=go>1      BTCUSDT    0.988889</span>
</span><span id=__span-68-16><a id=__codelineno-68-16 name=__codelineno-68-16 href=#__codelineno-68-16></a><span class=go>2      BTCUSDT    0.214141</span>
</span><span id=__span-68-17><a id=__codelineno-68-17 name=__codelineno-68-17 href=#__codelineno-68-17></a><span class=go>3      BTCUSDT    0.404040</span>
</span><span id=__span-68-18><a id=__codelineno-68-18 name=__codelineno-68-18 href=#__codelineno-68-18></a><span class=go>4      BTCUSDT    0.359596</span>
</span><span id=__span-68-19><a id=__codelineno-68-19 name=__codelineno-68-19 href=#__codelineno-68-19></a><span class=go>5      BTCUSDT    0.963636</span>
</span><span id=__span-68-20><a id=__codelineno-68-20 name=__codelineno-68-20 href=#__codelineno-68-20></a><span class=go>6      BTCUSDT    0.908081</span>
</span><span id=__span-68-21><a id=__codelineno-68-21 name=__codelineno-68-21 href=#__codelineno-68-21></a><span class=go>7      BTCUSDT    0.342424</span>
</span><span id=__span-68-22><a id=__codelineno-68-22 name=__codelineno-68-22 href=#__codelineno-68-22></a><span class=go>8      BTCUSDT    0.250505</span>
</span><span id=__span-68-23><a id=__codelineno-68-23 name=__codelineno-68-23 href=#__codelineno-68-23></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Make columns out of the index</li> <li>Remove the columns that we don't want to merge by</li> <li>Merge both DataFrames by split and symbol</li> <li>Get the mask of the grid results being better than the best results</li> <li>Use <code>sum()</code> to get the absolute count and <code>mean()</code> to get the relative count</li> </ol> <p>The selected parameter combinations seam to beat the most other parameter combinations tested during the same time period, but some results are particularly disappointing: in the splits <code>1</code>, <code>5</code>, and <code>6</code>, the selected parameter combination performed worse than other 90%. </p> <p>Finally, let's compare the results against our buy-and-hold baseline. For this, we need to extract the price that belongs to each split, but how do we do that without a splitter? Believe it or not, <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.split>@split</a> has an argument to return the splitter without running the pipeline <img alt=😛 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f61b.svg title=:stuck_out_tongue:></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_splitter</span> <span class=o>=</span> <span class=n>cv_sma_crossover_perf</span><span class=p>(</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=gp>... </span>    <span class=n>_index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=gp>... </span>    <span class=n>_return_splitter</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-69-4><a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-69-5><a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stacked_close</span> <span class=o>=</span> <span class=n>cv_splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span>
</span><span id=__span-69-6><a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> 
</span><span id=__span-69-7><a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a><span class=gp>... </span>    <span class=n>into</span><span class=o>=</span><span class=s2>&quot;reset_stacked&quot;</span><span class=p>,</span>
</span><span id=__span-69-8><a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a><span class=gp>... </span>    <span class=n>set_</span><span class=o>=</span><span class=s2>&quot;test&quot;</span>  <span class=c1># (2)!</span>
</span><span id=__span-69-9><a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-69-10><a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_holding</span><span class=p>(</span><span class=n>stacked_close</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s2>&quot;daily&quot;</span><span class=p>)</span>
</span><span id=__span-69-11><a id=__codelineno-69-11 name=__codelineno-69-11 href=#__codelineno-69-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_perf</span> <span class=o>=</span> <span class=n>hold_pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-69-12><a id=__codelineno-69-12 name=__codelineno-69-12 href=#__codelineno-69-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_perf</span>
</span><span id=__span-69-13><a id=__codelineno-69-13 name=__codelineno-69-13 href=#__codelineno-69-13></a><span class=go>split</span>
</span><span id=__span-69-14><a id=__codelineno-69-14 name=__codelineno-69-14 href=#__codelineno-69-14></a><span class=go>0   -0.430642</span>
</span><span id=__span-69-15><a id=__codelineno-69-15 name=__codelineno-69-15 href=#__codelineno-69-15></a><span class=go>1   -1.741407</span>
</span><span id=__span-69-16><a id=__codelineno-69-16 name=__codelineno-69-16 href=#__codelineno-69-16></a><span class=go>2    3.408079</span>
</span><span id=__span-69-17><a id=__codelineno-69-17 name=__codelineno-69-17 href=#__codelineno-69-17></a><span class=go>3   -0.556471</span>
</span><span id=__span-69-18><a id=__codelineno-69-18 name=__codelineno-69-18 href=#__codelineno-69-18></a><span class=go>4    0.954291</span>
</span><span id=__span-69-19><a id=__codelineno-69-19 name=__codelineno-69-19 href=#__codelineno-69-19></a><span class=go>5    3.241618</span>
</span><span id=__span-69-20><a id=__codelineno-69-20 name=__codelineno-69-20 href=#__codelineno-69-20></a><span class=go>6    0.686198</span>
</span><span id=__span-69-21><a id=__codelineno-69-21 name=__codelineno-69-21 href=#__codelineno-69-21></a><span class=go>7   -0.038013</span>
</span><span id=__span-69-22><a id=__codelineno-69-22 name=__codelineno-69-22 href=#__codelineno-69-22></a><span class=go>8   -0.917722</span>
</span><span id=__span-69-23><a id=__codelineno-69-23 name=__codelineno-69-23 href=#__codelineno-69-23></a><span class=go>Name: sharpe_ratio, dtype: float64</span>
</span></code></pre></div> <ol> <li>We either need to pass the index or all arguments for parsing</li> <li>Select the test set only</li> </ol> <p>As we can see, the "taking" and "applying" approaches can be safely combined since the underlying splitter is guaranteed to be built in the same way and thus produce the same results (unless the splitter method has some random component and hasn't been provided with a seed).</p> <h2 id=modeling>Modeling<a class=headerlink href=#modeling title="Permanent link">&para;</a></h2> <p>The class <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> can also be helpful in cross-validating ML models. In particular, you can casually step upon a class <a href=../../../api/generic/splitting/sklearn_/index.html#vectorbtpro.generic.splitting.sklearn_.SplitterCV>SplitterCV</a> that acts as a regular cross-validator from scikit-learn by subclassing <code>BaseCrossValidator</code>. We'll demonstrate its usage on a simple classification problem of predicting the best entry and exit timings.</p> <p>Before we start, we need to decide on features and labels that should act as predictor and response variables respectively. Features are usually multi-columnar time-series DataFrames where each row contains multiple data points (one per column) that should predict the same row in labels. Labels are usually a single-columnar time-series Series that should be predicted. Ask yourself the following questions to easily come up with a decision:</p> <ol> <li><em>"How can the future performance be represented, preferably as a single number? Should it be the price at the next bar, the average price change over the next week, a vector of weights for rebalancing, a boolean containing a signal, or something else?"</em></li> <li><em>"What kind of data that encompasses the past performance is likely to predict the future performance? Should it be indicators, news sentiment index, past backtesting results, or something else?"</em></li> <li><em>"Which ML model can handle such a task?"</em> (remember that most models are limited to just a couple of specific feature and label formats!)</li> </ol> <p>For the sake of an example, we'll fit a <a href=https://en.wikipedia.org/wiki/Random_forest>random forest classifier</a> on all <a href=https://github.com/mrjbq7/ta-lib>TA-Lib</a> indicators stacked along columns to predict the binary labels generated by the label generator <a href=../../../api/labels/generators/trendlb/index.html#vectorbtpro.labels.generators.trendlb.TRENDLB>TRENDLB</a>, where 1 means an uptrend and 0 means a downtrend. Sounds like fun <img alt=😌 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f60c.svg title=:relieved:></p> <p>First, run all the TA-Lib indicators on the entire data to get the feature set <code>X</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib&quot;</span><span class=p>)</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=go>(1902, 174)</span>
</span></code></pre></div> <p>We've got 1902 rows (dates) and 174 columns (features).</p> <p>Next, generate the labels <code>y</code> (we'll use the same configuration as previously):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>trendlb</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;trendlb&quot;</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;binary&quot;</span><span class=p>)</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>y</span> <span class=o>=</span> <span class=n>trendlb</span><span class=o>.</span><span class=n>labels</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>y</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=go>(1902,)</span>
</span></code></pre></div> <p>Both the features and the labels contain NaNs, which we need to carefully take care of. If we remove the rows with at least one NaN, we'll remove all the data. Instead, we'll first remove the columns that consist entirely of NaNs or a single unique value. Also, because <code>X</code> and <code>y</code> should have the same length, we need to do the row-filtering operation on both datasets simultaneously:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>replace</span><span class=p>([</span><span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>invalid_column_mask</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>all</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>nunique</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=o>~</span><span class=n>invalid_column_mask</span><span class=p>]</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>invalid_row_mask</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>|</span> <span class=n>y</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=o>~</span><span class=n>invalid_row_mask</span><span class=p>]</span>
</span><span id=__span-72-6><a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=o>~</span><span class=n>invalid_row_mask</span><span class=p>]</span>
</span><span id=__span-72-7><a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>y</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-72-8><a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a><span class=go>((1773, 144), (1773,))</span>
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If you worked with ML before, you'll quickly feel the danger coming from the logical operation in the first cell: we're checking for a condition across the entire column, thus potentially catching the <a href=https://www.investopedia.com/terms/l/lookaheadbias.asp>look-ahead bias</a>. Even though our operation isn't too dangerous because we remove only the columns that are likely to stay irrelevant in the future, other transformations such as data normalization should always be included in a <a href=https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html>Pipeline</a> that's executed per split rather than once and globally.</p> </div> <p>We've successfully removed a total of 129 rows and 30 columns.</p> <p>Next, we'll establish our classifier that will learn <code>X</code> to predict <code>y</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>sklearn.ensemble</span> <span class=kn>import</span> <span class=n>RandomForestClassifier</span>  <span class=c1># (1)!</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>clf</span> <span class=o>=</span> <span class=n>RandomForestClassifier</span><span class=p>(</span><span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Use <a href=https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html>RandomForestClassifier</a></li> </ol> <div class="admonition question"> <p class=admonition-title>Question</p> <p>Why haven't we rescaled, normalized, or reduced the dimensionality of the features? Random forests are very robust modeling techniques and can handle high noise levels as well as a high number of features.</p> </div> <p>To cross-validate the classifier, let's create an <a href=../../../api/generic/splitting/sklearn_/index.html#vectorbtpro.generic.splitting.sklearn_.SplitterCV>SplitterCV</a> instance that splits the entire period into expanding windows with non-overlapping test periods of 180 bars:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>SplitterCV</span><span class=p>(</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=gp>... </span>    <span class=s2>&quot;from_expanding&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=gp>... </span>    <span class=n>min_length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-74-4><a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=gp>... </span>    <span class=n>offset</span><span class=o>=</span><span class=mi>180</span><span class=p>,</span> 
</span><span id=__span-74-5><a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=-</span><span class=mi>180</span><span class=p>,</span>
</span><span id=__span-74-6><a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=gp>... </span>    <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>]</span>
</span><span id=__span-74-7><a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-74-8><a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a>
</span><span id=__span-74-9><a id=__codelineno-74-9 name=__codelineno-74-9 href=#__codelineno-74-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_splitter</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>get_splitter</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-74-10><a id=__codelineno-74-10 name=__codelineno-74-10 href=#__codelineno-74-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cv_splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Method of <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter>Splitter</a></li> <li>Other keyword arguments are forwarded down to this method</li> <li>Get the actual splitter for plotting</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/sklsplitter.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/sklsplitter.dark.svg#only-dark></p> <p>Finally, run the classifier on each training period and check the accuracy of its predictions on the respective test period. Even though the accuracy score is the most basic of all classification scores and has its own flaws, we'll keep things simplified for now:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>cross_val_score</span>  <span class=c1># (1)!</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_val_score</span><span class=p>(</span><span class=n>clf</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>cv</span><span class=o>=</span><span class=n>cv</span><span class=p>,</span> <span class=n>scoring</span><span class=o>=</span><span class=s2>&quot;accuracy&quot;</span><span class=p>)</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=go>array([1.        , 0.20555556, 0.88333333, 0.72777778, 1.        ,</span>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=go>       0.92777778, 0.53333333, 0.30555556])</span>
</span></code></pre></div> <ol> <li>Use <a href=https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html>cross_val_score</a></li> </ol> <p>We can see that there are only two underperforming splits, and even two splits with 100% accuracy, how is this possible? Let's find out! What we need are raw predictions: we'll use the actual splitter to take the slices from <code>X</code> and <code>y</code>, generate the predictions on each test set using our classifier, and concatenate all the predictions into a single Series.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>X_slices</span> <span class=o>=</span> <span class=n>cv_splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>y_slices</span> <span class=o>=</span> <span class=n>cv_splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_labels</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_preds</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>split</span> <span class=ow>in</span> <span class=n>X_slices</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=s2>&quot;split&quot;</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=gp>... </span>    <span class=n>X_train_slice</span> <span class=o>=</span> <span class=n>X_slices</span><span class=p>[(</span><span class=n>split</span><span class=p>,</span> <span class=s2>&quot;train&quot;</span><span class=p>)]</span>  <span class=c1># (2)!</span>
</span><span id=__span-76-8><a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a><span class=gp>... </span>    <span class=n>y_train_slice</span> <span class=o>=</span> <span class=n>y_slices</span><span class=p>[(</span><span class=n>split</span><span class=p>,</span> <span class=s2>&quot;train&quot;</span><span class=p>)]</span>
</span><span id=__span-76-9><a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a><span class=gp>... </span>    <span class=n>X_test_slice</span> <span class=o>=</span> <span class=n>X_slices</span><span class=p>[(</span><span class=n>split</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>)]</span>
</span><span id=__span-76-10><a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a><span class=gp>... </span>    <span class=n>y_test_slice</span> <span class=o>=</span> <span class=n>y_slices</span><span class=p>[(</span><span class=n>split</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>)]</span>
</span><span id=__span-76-11><a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a><span class=gp>... </span>    <span class=n>slice_clf</span> <span class=o>=</span> <span class=n>clf</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train_slice</span><span class=p>,</span> <span class=n>y_train_slice</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-76-12><a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a><span class=gp>... </span>    <span class=n>test_pred</span> <span class=o>=</span> <span class=n>slice_clf</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>X_test_slice</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-76-13><a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a><span class=gp>... </span>    <span class=n>test_pred</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>test_pred</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=n>y_test_slice</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-76-14><a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a><span class=gp>... </span>    <span class=n>test_labels</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>y_test_slice</span><span class=p>)</span>
</span><span id=__span-76-15><a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a><span class=gp>... </span>    <span class=n>test_preds</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>test_pred</span><span class=p>)</span>
</span><span id=__span-76-16><a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a>
</span><span id=__span-76-17><a id=__codelineno-76-17 name=__codelineno-76-17 href=#__codelineno-76-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_labels</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>test_labels</span><span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;labels&quot;</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-76-18><a id=__codelineno-76-18 name=__codelineno-76-18 href=#__codelineno-76-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>test_preds</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>test_preds</span><span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;preds&quot;</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Iterate over the split labels</li> <li>Get the arrays under the current split</li> <li>Fit the classifier to the training data</li> <li>Generate the predictions and wrap into Series</li> <li>Concatenate all the prediction Series along rows</li> </ol> <p>Let's compare the actual labels (left tab) to the predictions (right tab):</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Labels</label><label for=__tabbed_3_2>Predictions</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>overlay_with_heatmap</span><span class=p>(</span><span class=n>test_labels</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/test_labels.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/test_labels.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>overlay_with_heatmap</span><span class=p>(</span><span class=n>test_preds</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/test_preds.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/cv/test_preds.dark.svg#only-dark></p> </div> </div> </div> <p>The model seems to correctly classify many bigger uptrends and even issue an exit signal at the latest peak on time! Nevertheless, we shouldn't just rely on our visual intuition: let's backtest the predictions.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-79-2><a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>[</span><span class=n>test_preds</span><span class=o>.</span><span class=n>index</span><span class=p>],</span> 
</span><span id=__span-79-3><a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=gp>... </span>    <span class=n>test_preds</span> <span class=o>==</span> <span class=mi>1</span><span class=p>,</span> 
</span><span id=__span-79-4><a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a><span class=gp>... </span>    <span class=n>test_preds</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span> 
</span><span id=__span-79-5><a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a><span class=gp>... </span>    <span class=n>direction</span><span class=o>=</span><span class=s2>&quot;both&quot;</span>  <span class=c1># (1)!</span>
</span><span id=__span-79-6><a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-79-7><a id=__codelineno-79-7 name=__codelineno-79-7 href=#__codelineno-79-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>stats</span><span class=p>()</span>
</span><span id=__span-79-8><a id=__codelineno-79-8 name=__codelineno-79-8 href=#__codelineno-79-8></a><span class=go>Start                         2018-05-12 00:00:00+00:00</span>
</span><span id=__span-79-9><a id=__codelineno-79-9 name=__codelineno-79-9 href=#__codelineno-79-9></a><span class=go>End                           2022-04-20 00:00:00+00:00</span>
</span><span id=__span-79-10><a id=__codelineno-79-10 name=__codelineno-79-10 href=#__codelineno-79-10></a><span class=go>Period                               1440 days 00:00:00</span>
</span><span id=__span-79-11><a id=__codelineno-79-11 name=__codelineno-79-11 href=#__codelineno-79-11></a><span class=go>Start Value                                       100.0</span>
</span><span id=__span-79-12><a id=__codelineno-79-12 name=__codelineno-79-12 href=#__codelineno-79-12></a><span class=go>Min Value                                     55.079685</span>
</span><span id=__span-79-13><a id=__codelineno-79-13 name=__codelineno-79-13 href=#__codelineno-79-13></a><span class=go>Max Value                                   1238.365833</span>
</span><span id=__span-79-14><a id=__codelineno-79-14 name=__codelineno-79-14 href=#__codelineno-79-14></a><span class=go>End Value                                    719.483655</span>
</span><span id=__span-79-15><a id=__codelineno-79-15 name=__codelineno-79-15 href=#__codelineno-79-15></a><span class=go>Total Return [%]                             619.483655</span>
</span><span id=__span-79-16><a id=__codelineno-79-16 name=__codelineno-79-16 href=#__codelineno-79-16></a><span class=go>Benchmark Return [%]                         388.524488</span>
</span><span id=__span-79-17><a id=__codelineno-79-17 name=__codelineno-79-17 href=#__codelineno-79-17></a><span class=go>Total Time Exposure [%]                           100.0</span>
</span><span id=__span-79-18><a id=__codelineno-79-18 name=__codelineno-79-18 href=#__codelineno-79-18></a><span class=go>Max Gross Exposure [%]                       532.441444</span>
</span><span id=__span-79-19><a id=__codelineno-79-19 name=__codelineno-79-19 href=#__codelineno-79-19></a><span class=go>Max Drawdown [%]                              71.915142</span>
</span><span id=__span-79-20><a id=__codelineno-79-20 name=__codelineno-79-20 href=#__codelineno-79-20></a><span class=go>Max Drawdown Duration                 244 days 00:00:00</span>
</span><span id=__span-79-21><a id=__codelineno-79-21 name=__codelineno-79-21 href=#__codelineno-79-21></a><span class=go>Total Orders                                         20</span>
</span><span id=__span-79-22><a id=__codelineno-79-22 name=__codelineno-79-22 href=#__codelineno-79-22></a><span class=go>Total Fees Paid                                     0.0</span>
</span><span id=__span-79-23><a id=__codelineno-79-23 name=__codelineno-79-23 href=#__codelineno-79-23></a><span class=go>Total Trades                                         20</span>
</span><span id=__span-79-24><a id=__codelineno-79-24 name=__codelineno-79-24 href=#__codelineno-79-24></a><span class=go>Win Rate [%]                                  52.631579</span>
</span><span id=__span-79-25><a id=__codelineno-79-25 name=__codelineno-79-25 href=#__codelineno-79-25></a><span class=go>Best Trade [%]                               511.777894</span>
</span><span id=__span-79-26><a id=__codelineno-79-26 name=__codelineno-79-26 href=#__codelineno-79-26></a><span class=go>Worst Trade [%]                              -27.856728</span>
</span><span id=__span-79-27><a id=__codelineno-79-27 name=__codelineno-79-27 href=#__codelineno-79-27></a><span class=go>Avg Winning Trade [%]                          66.38609</span>
</span><span id=__span-79-28><a id=__codelineno-79-28 name=__codelineno-79-28 href=#__codelineno-79-28></a><span class=go>Avg Losing Trade [%]                         -11.704147</span>
</span><span id=__span-79-29><a id=__codelineno-79-29 name=__codelineno-79-29 href=#__codelineno-79-29></a><span class=go>Avg Winning Trade Duration            104 days 16:48:00</span>
</span><span id=__span-79-30><a id=__codelineno-79-30 name=__codelineno-79-30 href=#__codelineno-79-30></a><span class=go>Avg Losing Trade Duration              35 days 05:20:00</span>
</span><span id=__span-79-31><a id=__codelineno-79-31 name=__codelineno-79-31 href=#__codelineno-79-31></a><span class=go>Profit Factor                                  1.999834</span>
</span><span id=__span-79-32><a id=__codelineno-79-32 name=__codelineno-79-32 href=#__codelineno-79-32></a><span class=go>Expectancy                                    32.802227</span>
</span><span id=__span-79-33><a id=__codelineno-79-33 name=__codelineno-79-33 href=#__codelineno-79-33></a><span class=go>Sharpe Ratio                                   0.983656</span>
</span><span id=__span-79-34><a id=__codelineno-79-34 name=__codelineno-79-34 href=#__codelineno-79-34></a><span class=go>Calmar Ratio                                   0.902507</span>
</span><span id=__span-79-35><a id=__codelineno-79-35 name=__codelineno-79-35 href=#__codelineno-79-35></a><span class=go>Omega Ratio                                    1.202685</span>
</span><span id=__span-79-36><a id=__codelineno-79-36 name=__codelineno-79-36 href=#__codelineno-79-36></a><span class=go>Sortino Ratio                                  1.627438</span>
</span><span id=__span-79-37><a id=__codelineno-79-37 name=__codelineno-79-37 href=#__codelineno-79-37></a><span class=go>dtype: object</span>
</span></code></pre></div> <ol> <li>It's important to have any false-positive exit signals be as painful as false-positive entry signals</li> </ol> <p>We've got some pretty solid statistics <img alt=🌟 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f31f.svg title=:star2:> </p> <p>If you're willing to accept a challenge: build a pipeline to impute and (standard-)normalize the data, <a href=https://scikit-learn.org/stable/auto_examples/compose/plot_digits_pipe.html>reduce the dimensionality</a> of the features, as well as fit one of the <a href=https://scikit-learn.org/stable/modules/linear_model.html>linear models</a> to predict the average price change over the next <code>n</code> bars (i.e., regression task!). Based on each prediction, you can then decide whether a position is worth opening or closing out.</p> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>Backtesting requires an overhaul of traditional cross-validation schemes centered around ML, and vectorbt offers the needed toolset. The heart of the new functionality is the juggernaut class <a href=../../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter>Splitter</a>; it not only provides time-series-safe splitting schemes but also enables us to thoroughly analyze the generated splits and apply them to data of arbitrary complexity efficiently. For instance, we can enjoy the offered flexibility to either split data into slices and perform CV on them manually or construct a pipeline and let the splitter do the slicing and execution parts for us. There's even a decorator for parameterizing and cross-validating any Python function - <a href=../../../api/generic/splitting/decorators/index.html#vectorbtpro.generic.splitting.decorators.cv_split>@cv_split</a>. And for any ML-related tasks, the class <a href=../../../api/generic/splitting/sklearn_/index.html#vectorbtpro.generic.splitting.sklearn_.SplitterCV>SplitterCV</a> offers a splitter-enhanced interface well understood by scikit-learn and many other packages, such as by the scikit-learn compatible neural network library <a href=https://github.com/skorch-dev/skorch>skorch</a> wrapping PyTorch. As a result, validation of rule-based and ML-based models has become as easy as ever <img alt=🦋 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f98b.svg title=:butterfly:></p> <p><a class=md-button href=../../../assets/jupytext/tutorials/cross-validation/applications.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5h1.18m-4.28 11.79c-.4 0-.72.3-.72.89 0 .59.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68H4.86M9.14 5.71c.4 0 .72-.3.72-.89 0-.59-.32-.71-.72-.71-.39 0-.71.12-.71.71s.32.89.71.89Z"/></svg></span> Python code</a> <a class=md-button href=https://github.com/polakowo/vectorbt.pro/blob/main/notebooks/CrossValidation.ipynb target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2Z"/></svg></span> Notebook</a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../splitter/index.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Splitter"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Splitter </div> </div> </a> <a href=../../more-tutorials/index.html class="md-footer__link md-footer__link--next" aria-label="Next: More tutorials"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> More tutorials </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2024 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.sections", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.ede584c9.min.js></script> <script src=../../../assets/scripts/extra.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/tutorials/cross-validation/applications/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:59:36 GMT -->
</html>