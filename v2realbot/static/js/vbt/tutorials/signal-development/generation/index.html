<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_321460c7/tutorials/signal-development/generation/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 05 Mar 2024 10:49:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn about signal generation"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/tutorials/signal-development/generation/ rel=canonical><link href=../../superfast-supertrend/pipelines/index.html rel=prev><link href=../pre-analysis/index.html rel=next><link rel=icon href=../../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.2+insiders-4.47.1"><title>Generation - VectorBT PRO</title><link rel=stylesheet href=../../../assets/stylesheets/main.78d85e4f.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><link rel=stylesheet href=../../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0C5VNYCFHL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=robots content=noindex><meta property=og:title content=Generation><meta property=og:type content=website><meta content=https://vectorbt.pro/tutorials/signal-development/generation/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_321460c7/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Learn about signal generation"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=../../../assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=../../../assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=../../../assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../assets/logo/favicon-16x16.png><link rel=manifest href=../../../assets/logo/site.webmanifest><link rel=mask-icon href=../../../assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=../../../assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_321460c7/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#generation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <i>New</i>: Star-import, signal unraveling, Python 3.12 support, and <a href=../../../features/index.html><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.2c0 13.1 5.4 25.7 14.9 34.7l84.7 80.8c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9z"/></svg></span> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=../../../index.html title="VectorBT PRO" class="md-header__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../../assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT PRO <span class=md-version> v2024.2.22 </span> <a href=https://vectorbt.pro/ > <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224 64c-44.2 0-80 35.8-80 80v48h240c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16v-48C80 64.5 144.5 0 224 0c57.5 0 107 33.7 130.1 82.3 7.6 16 .8 35.1-15.2 42.6s-35.1.8-42.6-15.2C283.4 82.6 255.9 64 224 64zm32 320c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32s14.3 32 32 32h64z"/></svg></span> </a> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Generation </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.html class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=../../../features/overview/index.html class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../basic-rsi/index.html class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../../documentation/fundamentals/index.html class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../../api/index.html class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../../cookbook/overview/index.html class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=../../../terms/terms-of-use/index.html class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title="VectorBT PRO" class="md-nav__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../../assets/logo/logo.svg alt=logo class=logo> </a> VectorBT PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/installation/index.html class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex> <span class=md-ellipsis> Release notes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Release notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting-started/release-notes/index.html class=md-nav__link> <span class=md-ellipsis> Latest </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/release-notes/2023/index.html class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/release-notes/2022/index.html class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/release-notes/2021/index.html class=md-nav__link> <span class=md-ellipsis> 2021 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features/overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../features/data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../../../features/indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class=md-nav__item> <a href=../../../features/portfolio/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> </li> <li class=md-nav__item> <a href=../../../features/optimization/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg> <span class=md-ellipsis> Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../../features/analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2 0 1.77-1.43 3.2-3.2 3.2-1.77 0-3.2-1.43-3.2-3.2 0-1.77 1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8Z"/></svg> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../features/productivity/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9M12 7a5 5 0 0 0-5 5 5 5 0 0 0 5 5 5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg> <span class=md-ellipsis> Productivity </span> </a> </li> <li class=md-nav__item> <a href=../../../features/performance/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41-.39.39-1.03.39-1.42.01A9.969 9.969 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13Z"/></svg> <span class=md-ellipsis> Performance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic-rsi/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.5 18.5 6-6 4 4L22 6.92 20.59 5.5l-7.09 8-4-4L2 17l1.5 1.5Z"/></svg> <span class=md-ellipsis> Basic RSI strategy </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> SuperFast SuperTrend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> SuperFast SuperTrend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../superfast-supertrend/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> SuperFast SuperTrend </span> </a> </li> <li class=md-nav__item> <a href=../../superfast-supertrend/streaming/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Streaming </span> </a> </li> <li class=md-nav__item> <a href=../../superfast-supertrend/multithreading/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Multithreading </span> </a> </li> <li class=md-nav__item> <a href=../../superfast-supertrend/pipelines/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Pipelines </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Signal development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Signal development </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Generation </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Generation </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#comparison class=md-nav__link> <span class=md-ellipsis> Comparison </span> </a> <nav class=md-nav aria-label=Comparison> <ul class=md-nav__list> <li class=md-nav__item> <a href=#thresholds class=md-nav__link> <span class=md-ellipsis> Thresholds </span> </a> </li> <li class=md-nav__item> <a href=#crossovers class=md-nav__link> <span class=md-ellipsis> Crossovers </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#logical-operators class=md-nav__link> <span class=md-ellipsis> Logical operators </span> </a> <nav class=md-nav aria-label="Logical operators"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cartesian-product class=md-nav__link> <span class=md-ellipsis> Cartesian product </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#shifting class=md-nav__link> <span class=md-ellipsis> Shifting </span> </a> </li> <li class=md-nav__item> <a href=#truth-value-testing class=md-nav__link> <span class=md-ellipsis> Truth value testing </span> </a> </li> <li class=md-nav__item> <a href=#periodically class=md-nav__link> <span class=md-ellipsis> Periodically </span> </a> </li> <li class=md-nav__item> <a href=#iteratively class=md-nav__link> <span class=md-ellipsis> Iteratively </span> </a> </li> <li class=md-nav__item> <a href=#generators class=md-nav__link> <span class=md-ellipsis> Generators </span> </a> <nav class=md-nav aria-label=Generators> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exits class=md-nav__link> <span class=md-ellipsis> Exits </span> </a> </li> <li class=md-nav__item> <a href=#both class=md-nav__link> <span class=md-ellipsis> Both </span> </a> </li> <li class=md-nav__item> <a href=#chained-exits class=md-nav__link> <span class=md-ellipsis> Chained exits </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preset-generators class=md-nav__link> <span class=md-ellipsis> Preset generators </span> </a> <nav class=md-nav aria-label="Preset generators"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#random class=md-nav__link> <span class=md-ellipsis> Random </span> </a> </li> <li class=md-nav__item> <a href=#stops class=md-nav__link> <span class=md-ellipsis> Stops </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../pre-analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Pre-analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../stop-signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2v22m-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4v-2M19 7v2h2V7h-2m0-2h2a2 2 0 0 0-2-2v2m2 10h-2v2h2v-2m-2-4v2h2v-2h-2m-2-8h-2v2h2V3m2 18c1.11 0 2-.89 2-2h-2v2m-2-2h-2v2h2v-2Z"/></svg> <span class=md-ellipsis> Stop signals </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> MTF analysis </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> MTF analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mtf-analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> MTF analysis </span> </a> </li> <li class=md-nav__item> <a href=../../mtf-analysis/alignment/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> Alignment </span> </a> </li> <li class=md-nav__item> <a href=../../mtf-analysis/aggregation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> Aggregation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> Portfolio optimization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Portfolio optimization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../portfolio-optimization/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Portfolio optimization </span> </a> </li> <li class=md-nav__item> <a href=../../portfolio-optimization/integrations/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Integrations </span> </a> </li> <li class=md-nav__item> <a href=../../portfolio-optimization/dynamic/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Dynamic </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../pairs-trading/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 6.92 20.59 5.5l-2.85 3.22C15.68 6.4 12.83 5 9.61 5 6.72 5 4.07 6.16 2 8l1.42 1.42C5.12 7.93 7.27 7 9.61 7c2.74 0 5.09 1.26 6.77 3.24L13.5 13.5l-4-4L2 17l1.5 1.5 6-6 4 4 4.05-4.57c.75 1.35 1.25 2.9 1.45 4.57h2c-.22-2.32-.95-4.41-2.04-6.16L22 6.92Z"/></svg> <span class=md-ellipsis> Pairs trading </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex> <span class=md-ellipsis> Patterns and projections </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Patterns and projections </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns-and-projections/patterns/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg> <span class=md-ellipsis> Patterns </span> </a> </li> <li class=md-nav__item> <a href=../../patterns-and-projections/projections/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg> <span class=md-ellipsis> Projections </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Cross-validation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Cross-validation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cross-validation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Cross-validation </span> </a> </li> <li class=md-nav__item> <a href=../../cross-validation/splitter/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Splitter </span> </a> </li> <li class=md-nav__item> <a href=../../cross-validation/applications/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Applications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../more-tutorials/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.6 13.4a1 1 0 0 1-1.4 1.4 4.8 4.8 0 0 1 0-7l3.5-3.6a5.1 5.1 0 0 1 7.1 0 5.1 5.1 0 0 1 0 7.1l-1.5 1.5a6.4 6.4 0 0 0-.4-2.4l.5-.5a3.2 3.2 0 0 0 0-4.3 3.2 3.2 0 0 0-4.3 0l-3.5 3.6a2.9 2.9 0 0 0 0 4.2M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3m-3.8-4.3a4.8 4.8 0 0 0-1.4-4.5 1 1 0 0 0-1.4 1.4 2.9 2.9 0 0 1 0 4.2l-3.5 3.6a3.2 3.2 0 0 1-4.3 0 3.2 3.2 0 0 1 0-4.3l.5-.4a7.3 7.3 0 0 1-.4-2.5l-1.5 1.5a5.1 5.1 0 0 0 0 7.1 5.1 5.1 0 0 0 7.1 0l1.8-1.8a6 6 0 0 1 3.1-4.3Z"/></svg> <span class=md-ellipsis> More tutorials </span> </a> </li> <li class=md-nav__item> <a href=../../to-be-continued/index.html class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../documentation/fundamentals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 7a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2H3m0 2h2v2H3m12-.5V9a2 2 0 0 0-2-2H9v10h4a2 2 0 0 0 2-2v-1.5a1.54 1.54 0 0 0-1.5-1.5 1.54 1.54 0 0 0 1.5-1.5M13 15h-2v-2h2v2m0-4h-2V9h2m6-2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-1h-2v1h-2V9h2v1h2V9a2 2 0 0 0-2-2Z"/></svg> <span class=md-ellipsis> Fundamentals </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/building-blocks/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9M12 4.15 6.04 7.5 12 10.85l5.96-3.35L12 4.15M5 15.91l6 3.38v-6.71L5 9.21v6.7m14 0v-6.7l-6 3.37v6.71l6-3.38Z"/></svg> <span class=md-ellipsis> Building blocks </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../documentation/data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/data/local/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 20H4a2 2 0 0 1-2-2V6c0-1.11.89-2 2-2h6l2 2h7a2 2 0 0 1 2 2H4v10l2.14-8h17.07l-2.28 8.5c-.23.87-1.01 1.5-1.93 1.5Z"/></svg> <span class=md-ellipsis> Local </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/data/remote/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg> <span class=md-ellipsis> Remote </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/data/synthetic/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 1-1.26 2.75L15 5l2.74 1.26L19 9l1.25-2.74L23 5l-2.75-1.25M9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5M19 15l-1.26 2.74L15 19l2.74 1.25L19 23l1.25-2.75L23 19l-2.75-1.26"/></svg> <span class=md-ellipsis> Synthetic </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/data/scheduling/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a7 7 0 0 1-7-7 7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7m7.03-12.61 1.42-1.42c-.45-.51-.9-.97-1.41-1.41L17.62 6c-1.55-1.26-3.5-2-5.62-2a9 9 0 0 0-9 9 9 9 0 0 0 9 9c5 0 9-4.03 9-9 0-2.12-.74-4.07-1.97-5.61M11 14h2V8h-2m4-7H9v2h6V1Z"/></svg> <span class=md-ellipsis> Scheduling </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex> <span class=md-ellipsis> Indicators </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Indicators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../documentation/indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/indicators/development/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 3c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m.2 1.5 1.06 1.05L5.27 9.5 2.74 6.95 3.81 5.9l1.47 1.49M4 13c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2v-4c0-1.11-.89-2-2-2m-4 2h4v4H4m8-14h10v2H12m0 12v-2h10v2m-10-8h10v2H12Z"/></svg> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/indicators/analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 8c-1.5 0-2.3 1.4-1.9 2.5l-3.6 3.6c-.3-.1-.7-.1-1 0l-2.6-2.6c.4-1.1-.4-2.5-1.9-2.5-1.4 0-2.3 1.4-1.9 2.5L3.5 16c-1.1-.3-2.5.5-2.5 2 0 1.1.9 2 2 2 1.4 0 2.3-1.4 1.9-2.5l4.5-4.6c.3.1.7.1 1 0l2.6 2.6c-.3 1 .5 2.5 2 2.5s2.3-1.4 1.9-2.5l3.6-3.6c1.1.3 2.5-.5 2.5-1.9 0-1.1-.9-2-2-2m-6 1 .9-2.1L18 6l-2.1-.9L15 3l-.9 2.1L12 6l2.1.9L15 9M3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9l.5 2Z"/></svg> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/indicators/parsers/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.6 16.6 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4m-5.2 0L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4Z"/></svg> <span class=md-ellipsis> Parsers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex> <span class=md-ellipsis> Portfolio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Portfolio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../documentation/portfolio/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/portfolio/from-orders/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2v20h20V2H2m18 10h-4v4h4v4h-4v-4h-4v4H8v-4H4v-4h4V8H4V4h4v4h4V4h4v4h4v4m-4-4v4h-4V8h4m-4 4v4H8v-4h4Z"/></svg> <span class=md-ellipsis> From orders </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation/portfolio/from-signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> From signals </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../documentation/to-be-continued/index.html class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/index.html class=md-nav__link> <span class=md-ellipsis> API </span> </a> </li> <li class=md-nav__item> <a href=../../../api/_settings/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h6.68a7 7 0 0 1-.68-3 7 7 0 0 1 7-7 7 7 0 0 1 1 .08V8l-6-6H6m7 1.5L18.5 9H13V3.5M18 14a.26.26 0 0 0-.26.21l-.19 1.32c-.3.13-.59.29-.85.47l-1.24-.5c-.11 0-.24 0-.31.13l-1 1.73c-.06.11-.04.24.06.32l1.06.82a4.193 4.193 0 0 0 0 1l-1.06.82a.26.26 0 0 0-.06.32l1 1.73c.06.13.19.13.31.13l1.24-.5c.26.18.54.35.85.47l.19 1.32c.02.12.12.21.26.21h2c.11 0 .22-.09.24-.21l.19-1.32c.3-.13.57-.29.84-.47l1.23.5c.13 0 .26 0 .33-.13l1-1.73a.26.26 0 0 0-.06-.32l-1.07-.82c.02-.17.04-.33.04-.5 0-.17-.01-.33-.04-.5l1.06-.82a.26.26 0 0 0 .06-.32l-1-1.73c-.06-.13-.19-.13-.32-.13l-1.23.5c-.27-.18-.54-.35-.85-.47l-.19-1.32A.236.236 0 0 0 20 14h-2m1 3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.84 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5Z"/></svg> <span class=md-ellipsis> _settings </span> </a> </li> <li class=md-nav__item> <a href=../../../api/_opt_deps/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h6.68a7 7 0 0 1-.68-3 7 7 0 0 1 7-7 7 7 0 0 1 1 .08V8l-6-6H6m7 1.5L18.5 9H13V3.5M18 14a.26.26 0 0 0-.26.21l-.19 1.32c-.3.13-.59.29-.85.47l-1.24-.5c-.11 0-.24 0-.31.13l-1 1.73c-.06.11-.04.24.06.32l1.06.82a4.193 4.193 0 0 0 0 1l-1.06.82a.26.26 0 0 0-.06.32l1 1.73c.06.13.19.13.31.13l1.24-.5c.26.18.54.35.85.47l.19 1.32c.02.12.12.21.26.21h2c.11 0 .22-.09.24-.21l.19-1.32c.3-.13.57-.29.84-.47l1.23.5c.13 0 .26 0 .33-.13l1-1.73a.26.26 0 0 0-.06-.32l-1.07-.82c.02-.17.04-.33.04-.5 0-.17-.01-.33-.04-.5l1.06-.82a.26.26 0 0 0 .06-.32l-1-1.73c-.06-.13-.19-.13-.32-.13l-1.23.5c-.27-.18-.54-.35-.85-.47l-.19-1.32A.236.236 0 0 0 20 14h-2m1 3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.84 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5Z"/></svg> <span class=md-ellipsis> _opt_deps </span> </a> </li> <li class=md-nav__item> <a href=../../../api/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex> <span class=md-ellipsis> base </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> base </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/base/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3M4 5h2v2H4m14 0h2v2h-2M8 17h2v2H8Z"/></svg> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/chunking/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16v-3h-3v9h-2V2h2v9h3V8l4 4-4 4M2 12l4 4v-3h3v9h2V2H9v9H6V8l-4 4Z"/></svg> <span class=md-ellipsis> chunking </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/combining/index.html class=md-nav__link> <span class=md-ellipsis> combining </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/flex_indexing/index.html class=md-nav__link> <span class=md-ellipsis> flex_indexing </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/indexes/index.html class=md-nav__link> <span class=md-ellipsis> indexes <span class=dobjtype>module</span><a class=githublink href=https://github.com/drew2323/vbtpro/blob/main/vectorbtpro/base/indexes.py target=_blank title="Jump to source"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></a> </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/indexing/index.html class=md-nav__link> <span class=md-ellipsis> indexing </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/merging/index.html class=md-nav__link> <span class=md-ellipsis> merging </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/preparing/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 4V3a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V6h1v4H9v11a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-9h8V4h-3Z"/></svg> <span class=md-ellipsis> preparing </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/reshaping/index.html class=md-nav__link> <span class=md-ellipsis> reshaping </span> </a> </li> <li class=md-nav__item> <a href=../../../api/base/wrapping/index.html class=md-nav__link> <span class=md-ellipsis> wrapping </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/base/grouping/index.html class=md-nav__link> <span class=md-ellipsis> grouping </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/base/resampling/index.html class=md-nav__link> <span class=md-ellipsis> resampling </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex> <span class=md-ellipsis> data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> data </span> </a> </li> <li class=md-nav__item> <a href=../../../api/data/base/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3M4 5h2v2H4m14 0h2v2h-2M8 17h2v2H8Z"/></svg> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../../../api/data/decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/data/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> <li class=md-nav__item> <a href=../../../api/data/saver/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a7 7 0 0 1-7-7 7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7m7.03-12.61 1.42-1.42c-.45-.51-.9-.97-1.41-1.41L17.62 6c-1.55-1.26-3.5-2-5.62-2a9 9 0 0 0-9 9 9 9 0 0 0 9 9c5 0 9-4.03 9-9 0-2.12-.74-4.07-1.97-5.61M11 14h2V8h-2m4-7H9v2h6V1Z"/></svg> <span class=md-ellipsis> saver </span> </a> </li> <li class=md-nav__item> <a href=../../../api/data/updater/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a7 7 0 0 1-7-7 7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7m7.03-12.61 1.42-1.42c-.45-.51-.9-.97-1.41-1.41L17.62 6c-1.55-1.26-3.5-2-5.62-2a9 9 0 0 0-9 9 9 9 0 0 0 9 9c5 0 9-4.03 9-9 0-2.12-.74-4.07-1.97-5.61M11 14h2V8h-2m4-7H9v2h6V1Z"/></svg> <span class=md-ellipsis> updater </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/data/custom/index.html class=md-nav__link> <span class=md-ellipsis> custom </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex> <span class=md-ellipsis> generic </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> generic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/generic/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h4v2H4v16h2v2H2V2m18 2h-2V2h4v20h-4v-2h2V4M9 5h1v5h1v1H8v-1h1V6l-1 .5v-1L9 5m6 8h1v5h1v1h-3v-1h1v-4l-1 .5v-1l1-.5m-6 0c1.1 0 2 1.34 2 3s-.9 3-2 3-2-1.34-2-3 .9-3 2-3m0 1c-.55 0-1 .9-1 2s.45 2 1 2 1-.9 1-2-.45-2-1-2m6-9c1.1 0 2 1.34 2 3s-.9 3-2 3-2-1.34-2-3 .9-3 2-3m0 1c-.55 0-1 .9-1 2s.45 2 1 2 1-.9 1-2-.45-2-1-2Z"/></svg> <span class=md-ellipsis> generic </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/analyzable/index.html class=md-nav__link> <span class=md-ellipsis> analyzable </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/drawdowns/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> drawdowns </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/enums/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/></svg> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/plots_builder/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.04 19.61a2.682 2.682 0 0 0-2.54-1.81c-1.5 0-2.7 1.2-2.7 2.7V22H4a2 2 0 0 1-2-2v-3.8h1.5c1.5 0 2.7-1.2 2.7-2.7S5 10.8 3.5 10.8H2V7c0-1.1.9-2 2-2h4V3.5a2.5 2.5 0 0 1 5 0V5h4a2 2 0 0 1 2 2v4h1.5a2.5 2.5 0 0 1 2.5 2.5c0 .32-.06.62-.17.89A5.991 5.991 0 0 0 19 13c-3.31 0-6 2.69-6 6 0 .2 0 .41.04.61M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> <span class=md-ellipsis> plots_builder </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/plotting/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2 0 1.77-1.43 3.2-3.2 3.2-1.77 0-3.2-1.43-3.2-3.2 0-1.77 1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8Z"/></svg> <span class=md-ellipsis> plotting </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/price_records/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> price_records </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/ranges/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> ranges </span> </a> </li> <li class=md-nav__item> <a href=../../../api/generic/stats_builder/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.04 19.61a2.682 2.682 0 0 0-2.54-1.81c-1.5 0-2.7 1.2-2.7 2.7V22H4a2 2 0 0 1-2-2v-3.8h1.5c1.5 0 2.7-1.2 2.7-2.7S5 10.8 3.5 10.8H2V7c0-1.1.9-2 2-2h4V3.5a2.5 2.5 0 0 1 5 0V5h4a2 2 0 0 1 2 2v4h1.5a2.5 2.5 0 0 1 2.5 2.5c0 .32-.06.62-.17.89A5.991 5.991 0 0 0 19 13c-3.31 0-6 2.69-6 6 0 .2 0 .41.04.61M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> <span class=md-ellipsis> stats_builder </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/generic/nb/index.html class=md-nav__link> <span class=md-ellipsis> nb </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/generic/splitting/index.html class=md-nav__link> <span class=md-ellipsis> splitting </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex> <span class=md-ellipsis> indicators </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> indicators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> indicators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/indicators/configs/index.html class=md-nav__link> <span class=md-ellipsis> configs </span> </a> </li> <li class=md-nav__item> <a href=../../../api/indicators/enums/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/></svg> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../../api/indicators/expr/index.html class=md-nav__link> <span class=md-ellipsis> expr </span> </a> </li> <li class=md-nav__item> <a href=../../../api/indicators/factory/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 18v2h4v-2H4m0-4v2h10v-2H4m6 4v2h4v-2h-4m6-4v2h4v-2h-4m0 4v2h4v-2h-4M2 22V8l5 4V8l5 4V8l5 4 1-10h3l1 10v10H2Z"/></svg> <span class=md-ellipsis> factory </span> </a> </li> <li class=md-nav__item> <a href=../../../api/indicators/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> <li class=md-nav__item> <a href=../../../api/indicators/talib_/index.html class=md-nav__link> <span class=md-ellipsis> talib_ </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/indicators/custom/index.html class=md-nav__link> <span class=md-ellipsis> custom </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex> <span class=md-ellipsis> labels </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> labels </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/labels/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 18h9l-2 2H4c-.5 0-1.03-.21-1.41-.59C2.21 19.03 2 18.5 2 18V8h2v10M17.63 4.84C17.27 4.33 16.67 4 16 4H8c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h8c.67 0 1.27-.34 1.63-.85L22 10l-4.37-5.16M16 14H8V6h8l3.55 4Z"/></svg> <span class=md-ellipsis> labels </span> </a> </li> <li class=md-nav__item> <a href=../../../api/labels/enums/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/></svg> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../../api/labels/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/labels/generators/index.html class=md-nav__link> <span class=md-ellipsis> generators </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex> <span class=md-ellipsis> messaging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> messaging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/messaging/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h16M4 4v13.17L5.17 16H20V4H4m2 3h12v2H6V7m0 4h9v2H6v-2Z"/></svg> <span class=md-ellipsis> messaging </span> </a> </li> <li class=md-nav__item> <a href=../../../api/messaging/telegram/index.html class=md-nav__link> <span class=md-ellipsis> telegram </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex> <span class=md-ellipsis> ohlcv </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> ohlcv </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/ohlcv/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2v3h2v14H8v3H6v-3H4V5h2V2h2m8 0v5h-2v10h2v5h2v-5h2V7h-2V2h-2Z"/></svg> <span class=md-ellipsis> ohlcv </span> </a> </li> <li class=md-nav__item> <a href=../../../api/ohlcv/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../../api/ohlcv/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex> <span class=md-ellipsis> portfolio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> portfolio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/portfolio/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> portfolio </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/base/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3M4 5h2v2H4m14 0h2v2h-2M8 17h2v2H8Z"/></svg> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/call_seq/index.html class=md-nav__link> <span class=md-ellipsis> call_seq </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/chunking/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16v-3h-3v9h-2V2h2v9h3V8l4 4-4 4M2 12l4 4v-3h3v9h2V2H9v9H6V8l-4 4Z"/></svg> <span class=md-ellipsis> chunking </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/enums/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/></svg> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/logs/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> logs </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/orders/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> orders </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/preparing/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 4V3a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V6h1v4H9v11a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-9h8V4h-3Z"/></svg> <span class=md-ellipsis> preparing </span> </a> </li> <li class=md-nav__item> <a href=../../../api/portfolio/trades/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> trades </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/portfolio/nb/index.html class=md-nav__link> <span class=md-ellipsis> nb </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/portfolio/pfopt/index.html class=md-nav__link> <span class=md-ellipsis> pfopt </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_13> <label class=md-nav__link for=__nav_5_13 id=__nav_5_13_label tabindex> <span class=md-ellipsis> px </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_13_label aria-expanded=false> <label class=md-nav__title for=__nav_5_13> <span class="md-nav__icon md-icon"></span> px </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/px/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2 0 1.77-1.43 3.2-3.2 3.2-1.77 0-3.2-1.43-3.2-3.2 0-1.77 1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8Z"/></svg> <span class=md-ellipsis> px </span> </a> </li> <li class=md-nav__item> <a href=../../../api/px/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_14> <label class=md-nav__link for=__nav_5_14 id=__nav_5_14_label tabindex> <span class=md-ellipsis> records </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_14_label aria-expanded=false> <label class=md-nav__title for=__nav_5_14> <span class="md-nav__icon md-icon"></span> records </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/records/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h8v-4H8m0 6v4h8v-4H8M8 4v4h8V4H8Z"/></svg> <span class=md-ellipsis> records </span> </a> </li> <li class=md-nav__item> <a href=../../../api/records/base/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3M4 5h2v2H4m14 0h2v2h-2M8 17h2v2H8Z"/></svg> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../../../api/records/chunking/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16v-3h-3v9h-2V2h2v9h3V8l4 4-4 4M2 12l4 4v-3h3v9h2V2H9v9H6V8l-4 4Z"/></svg> <span class=md-ellipsis> chunking </span> </a> </li> <li class=md-nav__item> <a href=../../../api/records/col_mapper/index.html class=md-nav__link> <span class=md-ellipsis> col_mapper </span> </a> </li> <li class=md-nav__item> <a href=../../../api/records/decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/records/mapped_array/index.html class=md-nav__link> <span class=md-ellipsis> mapped_array </span> </a> </li> <li class=md-nav__item> <a href=../../../api/records/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_15> <label class=md-nav__link for=__nav_5_15 id=__nav_5_15_label tabindex> <span class=md-ellipsis> registries </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_15_label aria-expanded=false> <label class=md-nav__title for=__nav_5_15> <span class="md-nav__icon md-icon"></span> registries </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/registries/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17 21-2.75-3 1.16-1.16L17 18.43l3.59-3.59 1.16 1.41M12.8 21H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h14a2 2 0 0 1 2 2v7.8c-.88-.51-1.91-.8-3-.8l-1 .08V11H7v2h7.69A5.983 5.983 0 0 0 12 18c0 1.09.29 2.12.8 3m-.8-6H7v2h5m5-10H7v2h10"/></svg> <span class=md-ellipsis> registries </span> </a> </li> <li class=md-nav__item> <a href=../../../api/registries/ca_registry/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 8-4 4h3a6 6 0 0 1-6 6c-1 0-1.97-.25-2.8-.7l-1.46 1.46A7.93 7.93 0 0 0 12 20a8 8 0 0 0 8-8h3M6 12a6 6 0 0 1 6-6c1 0 1.97.25 2.8.7l1.46-1.46A7.93 7.93 0 0 0 12 4a8 8 0 0 0-8 8H1l4 4 4-4"/></svg> <span class=md-ellipsis> ca_registry </span> </a> </li> <li class=md-nav__item> <a href=../../../api/registries/ch_registry/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16v-3h-3v9h-2V2h2v9h3V8l4 4-4 4M2 12l4 4v-3h3v9h2V2H9v9H6V8l-4 4Z"/></svg> <span class=md-ellipsis> ch_registry </span> </a> </li> <li class=md-nav__item> <a href=../../../api/registries/jit_registry/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41-.39.39-1.03.39-1.42.01A9.969 9.969 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13Z"/></svg> <span class=md-ellipsis> jit_registry </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_16> <label class=md-nav__link for=__nav_5_16 id=__nav_5_16_label tabindex> <span class=md-ellipsis> returns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_16_label aria-expanded=false> <label class=md-nav__title for=__nav_5_16> <span class="md-nav__icon md-icon"></span> returns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/returns/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m16 11.78 4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L5.46 19H22v2H2V3h2v14.54L9.5 8l6.5 3.78Z"/></svg> <span class=md-ellipsis> returns </span> </a> </li> <li class=md-nav__item> <a href=../../../api/returns/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../../api/returns/enums/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/></svg> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../../api/returns/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> <li class=md-nav__item> <a href=../../../api/returns/qs_adapter/index.html class=md-nav__link> <span class=md-ellipsis> qs_adapter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_17> <label class=md-nav__link for=__nav_5_17 id=__nav_5_17_label tabindex> <span class=md-ellipsis> signals </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_17_label aria-expanded=false> <label class=md-nav__title for=__nav_5_17> <span class="md-nav__icon md-icon"></span> signals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> signals </span> </a> </li> <li class=md-nav__item> <a href=../../../api/signals/accessors/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 5H8l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69V5m11 6-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 9.17 20 3.006 3.006 0 0 0 13 21.83 3.01 3.01 0 0 0 14.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3L22 11m-11.37.59A7.632 7.632 0 0 0 6 10V7l-4 4 4 4v-3c1.34.03 2.63.5 3.64 1.4.25-.64.58-1.25.99-1.81Z"/></svg> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../../api/signals/enums/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/></svg> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../../api/signals/factory/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 18v2h4v-2H4m0-4v2h10v-2H4m6 4v2h4v-2h-4m6-4v2h4v-2h-4m0 4v2h4v-2h-4M2 22V8l5 4V8l5 4V8l5 4 1-10h3l1 10v10H2Z"/></svg> <span class=md-ellipsis> factory </span> </a> </li> <li class=md-nav__item> <a href=../../../api/signals/nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m6 20 4.16-12.09L9.34 6H8V4h2c.42 0 .78.26.93.63L16.66 18H18v2h-2c-.43 0-.79-.27-.93-.64l-3.74-8.71L8.12 20H6Z"/></svg> <span class=md-ellipsis> nb </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/signals/generators/index.html class=md-nav__link> <span class=md-ellipsis> generators </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_18> <label class=md-nav__link for=__nav_5_18 id=__nav_5_18_label tabindex> <span class=md-ellipsis> utils </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_18_label aria-expanded=false> <label class=md-nav__title for=__nav_5_18> <span class="md-nav__icon md-icon"></span> utils </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/utils/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m21.71 20.29-1.42 1.42a1 1 0 0 1-1.41 0L7 9.85A3.81 3.81 0 0 1 6 10a4 4 0 0 1-3.78-5.3l2.54 2.54.53-.53 1.42-1.42.53-.53L4.7 2.22A4 4 0 0 1 10 6a3.81 3.81 0 0 1-.15 1l11.86 11.88a1 1 0 0 1 0 1.41M2.29 18.88a1 1 0 0 0 0 1.41l1.42 1.42a1 1 0 0 0 1.41 0l5.47-5.46-2.83-2.83M20 2l-4 2v2l-2.17 2.17 2 2L18 8h2l2-4Z"/></svg> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/annotations/index.html class=md-nav__link> <span class=md-ellipsis> annotations </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/array_/index.html class=md-nav__link> <span class=md-ellipsis> array_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/attr_/index.html class=md-nav__link> <span class=md-ellipsis> attr_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/caching/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 8-4 4h3a6 6 0 0 1-6 6c-1 0-1.97-.25-2.8-.7l-1.46 1.46A7.93 7.93 0 0 0 12 20a8 8 0 0 0 8-8h3M6 12a6 6 0 0 1 6-6c1 0 1.97.25 2.8.7l1.46-1.46A7.93 7.93 0 0 0 12 4a8 8 0 0 0-8 8H1l4 4 4-4"/></svg> <span class=md-ellipsis> caching </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/chaining/index.html class=md-nav__link> <span class=md-ellipsis> chaining </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/checks/index.html class=md-nav__link> <span class=md-ellipsis> checks </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/chunking/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16v-3h-3v9h-2V2h2v9h3V8l4 4-4 4M2 12l4 4v-3h3v9h2V2H9v9H6V8l-4 4Z"/></svg> <span class=md-ellipsis> chunking </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/colors/index.html class=md-nav__link> <span class=md-ellipsis> colors </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/config/index.html class=md-nav__link> <span class=md-ellipsis> config </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/cutting/index.html class=md-nav__link> <span class=md-ellipsis> cutting </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/datetime_/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg> <span class=md-ellipsis> datetime_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/datetime_nb/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg> <span class=md-ellipsis> datetime_nb </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/enum_/index.html class=md-nav__link> <span class=md-ellipsis> enum_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/eval_/index.html class=md-nav__link> <span class=md-ellipsis> eval_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/execution/index.html class=md-nav__link> <span class=md-ellipsis> execution </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/figure/index.html class=md-nav__link> <span class=md-ellipsis> figure </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/formatting/index.html class=md-nav__link> <span class=md-ellipsis> formatting </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/hashing/index.html class=md-nav__link> <span class=md-ellipsis> hashing </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/image_/index.html class=md-nav__link> <span class=md-ellipsis> image_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/jitting/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41-.39.39-1.03.39-1.42.01A9.969 9.969 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13Z"/></svg> <span class=md-ellipsis> jitting </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/magic_decorators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 3v6h2.95l2 6H6v6h6v-4.59L17.41 11H22V5h-6v4.57L10.59 15H9.06l-2-6H8V3H2m2 2h2v2H4V5m14 2h2v2h-2V7m0 8v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2M8 17h2v2H8v-2Z"/></svg> <span class=md-ellipsis> magic_decorators </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/mapping/index.html class=md-nav__link> <span class=md-ellipsis> mapping </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/math_/index.html class=md-nav__link> <span class=md-ellipsis> math_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/merging/index.html class=md-nav__link> <span class=md-ellipsis> merging </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/module_/index.html class=md-nav__link> <span class=md-ellipsis> module_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/path_/index.html class=md-nav__link> <span class=md-ellipsis> path_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/params/index.html class=md-nav__link> <span class=md-ellipsis> params </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/parsing/index.html class=md-nav__link> <span class=md-ellipsis> parsing </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/pbar/index.html class=md-nav__link> <span class=md-ellipsis> pbar </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/pickling/index.html class=md-nav__link> <span class=md-ellipsis> pickling </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/profiling/index.html class=md-nav__link> <span class=md-ellipsis> profiling </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/random_/index.html class=md-nav__link> <span class=md-ellipsis> random_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/requests_/index.html class=md-nav__link> <span class=md-ellipsis> requests_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/schedule_/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a7 7 0 0 1-7-7 7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7m7.03-12.61 1.42-1.42c-.45-.51-.9-.97-1.41-1.41L17.62 6c-1.55-1.26-3.5-2-5.62-2a9 9 0 0 0-9 9 9 9 0 0 0 9 9c5 0 9-4.03 9-9 0-2.12-.74-4.07-1.97-5.61M11 14h2V8h-2m4-7H9v2h6V1Z"/></svg> <span class=md-ellipsis> schedule_ </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/search/index.html class=md-nav__link> <span class=md-ellipsis> search </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/selection/index.html class=md-nav__link> <span class=md-ellipsis> selection </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/tagging/index.html class=md-nav__link> <span class=md-ellipsis> tagging </span> </a> </li> <li class=md-nav__item> <a href=../../../api/utils/template/index.html class=md-nav__link> <span class=md-ellipsis> template </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Cookbook </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cookbook/overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/discovery/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 3h6v4H3V3m12 7h6v4h-6v-4m0 7h6v4h-6v-4m-2-4H7v5h6v2H5V9h2v2h6v2Z"/></svg> <span class=md-ellipsis> Discovery </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/configuration/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/></svg> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/persistence/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 12h2v5h16v-5h2v5c0 1.11-.89 2-2 2H4a2 2 0 0 1-2-2v-5m10 3 5.55-5.46-1.42-1.41L13 11.25V2h-2v9.25L7.88 8.13 6.46 9.55 12 15Z"/></svg> <span class=md-ellipsis> Persistence </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/caching/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 8-4 4h3a6 6 0 0 1-6 6c-1 0-1.97-.25-2.8-.7l-1.46 1.46A7.93 7.93 0 0 0 12 20a8 8 0 0 0 8-8h3M6 12a6 6 0 0 1 6-6c1 0 1.97.25 2.8.7l1.46-1.46A7.93 7.93 0 0 0 12 4a8 8 0 0 0-8 8H1l4 4 4-4"/></svg> <span class=md-ellipsis> Caching </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/plotting/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2 0 1.77-1.43 3.2-3.2 3.2-1.77 0-3.2-1.43-3.2-3.2 0-1.77 1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8Z"/></svg> <span class=md-ellipsis> Plotting </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/compilation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41-.39.39-1.03.39-1.42.01A9.969 9.969 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13Z"/></svg> <span class=md-ellipsis> Compilation </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/data/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4Z"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/arrays/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 2h14a2 2 0 0 1 2 2v12c0 1.11-.89 2-2 2H7a2 2 0 0 1-2-2V4c0-1.1.9-2 2-2m0 4v4h6V6H7m8 0v4h6V6h-6m-8 6v4h6v-4H7m8 0v4h6v-4h-6M3 20V6H1v14c0 1.11.89 2 2 2h16v-2H3Z"/></svg> <span class=md-ellipsis> Arrays </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/indexing/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 20.5c0 .8-.7 1.5-1.5 1.5H13c-.4 0-.7-.1-1-.4l-4-4.2.7-.8c.2-.2.5-.3.8-.3h.2L12 18V9c0-.6.4-1 1-1s1 .4 1 1v4.5l1.2.1 3.9 2.2c.5.2.9.8.9 1.3v3.4M20 2H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h4v-2H4V4h16v8h-2v2h2c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2Z"/></svg> <span class=md-ellipsis> Indexing </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/indicators/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2Z"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/signals/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Signals </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/portfolio/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56 6.49 3.74Z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/optimization/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8 2.32 3.09 6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2-5-5m-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3v3m18-5v7l-2-2V3h-3l-2-2h7M6 19l2 2H1v-7l2 2v3h3Z"/></svg> <span class=md-ellipsis> Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/cross-validation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Cross-validation </span> </a> </li> <li class=md-nav__item> <a href=../../../cookbook/benchmarking/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 5a7 7 0 0 1 7 7h1v3h-1v4H9a7 7 0 0 1-7-7 7 7 0 0 1 7-7m0 3a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m8 9h5v4h-2v-2h-3v-2Z"/></svg> <span class=md-ellipsis> Benchmarking </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Terms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../terms/terms-of-use/index.html class=md-nav__link> <span class=md-ellipsis> Terms of Use </span> </a> </li> <li class=md-nav__item> <a href=../../../terms/software-license/index.html class=md-nav__link> <span class=md-ellipsis> Software License </span> </a> </li> <li class=md-nav__item> <a href=../../../terms/remarks/index.html class=md-nav__link> <span class=md-ellipsis> Remarks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../../basic-rsi/index.html class=md-path__link> <span class=md-ellipsis> Tutorials </span> </a> </li> <li class=md-path__item> <a href=index.html class=md-path__link> <span class=md-ellipsis> Signal development </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=generation><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg></span> Generation<a class=headerlink href=#generation title="Permanent link">&para;</a></h1> <p>Signals are an additional level of abstraction added on top of orders: instead of specifying every bit of information on what needs to be ordered at each timestamp, we can first decide on what a typical order should look like, and then choose the timing of issuing such an order. The latter decision process can be realized through signals, which in the vectorbt's world are represented by a boolean mask where <code>True</code> means "order" and <code>False</code> means "no order". Additionally, we can change the meaning of each signal statically, or dynamically based on the current simulation state; for example, we can instruct the simulator to ignore an "order" signal if we're already in the market, which cannot be done by using the "from-orders" method alone. Finally, vectorbt loves data science, and so comparing multiple strategies with the same trading conditions but different signal permutations (i.e., order timings and directions) is much easier, less error-prone, and generally leads to fairer experiments.</p> <p>Since we constantly buy and sell things, the ideal scenario would be to incorporate an order direction into each signal as well. But we cannot represent three states ("order to buy", "order to sell", and "no order") by using booleans - a data type with just two values. Thus, signals are usually distributed across two or more boolean arrays, where each array represents a different decision dimension. The most popular way to define signals is by using two direction-unaware arrays: <img alt=1 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/31-20e3.svg title=:one:> entries and <img alt=2 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/32-20e3.svg title=:two:> exits. Those two arrays have a different meaning based on the direction specified using a separate variable. For instance, when only the long direction is enabled, an entry signal opens a new long position and an exit signal closes it; when both directions are enabled, an entry signal opens a new long position and an exit signal reverses it to open a short one. To better control the decision on whether to reverse the current position or just close it out, we can define four direction-aware arrays: <img alt=1 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/31-20e3.svg title=:one:> long entries, <img alt=2 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/32-20e3.svg title=:two:> long exits, <img alt=3 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/33-20e3.svg title=:three:> short entries, and <img alt=4 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/34-20e3.svg title=:four:> short exits, which guarantees the most flexibility.</p> <p>For example, to open a long position, close it, open a short position, and reverse it, the signals would look like this:</p> <table> <thead> <tr> <th>Long entry</th> <th>Long exit</th> <th>Short entry</th> <th>Short exit</th> </tr> </thead> <tbody> <tr> <td>True</td> <td>False</td> <td>False</td> <td>False</td> </tr> <tr> <td>False</td> <td>True</td> <td>False</td> <td>False</td> </tr> <tr> <td>False</td> <td>False</td> <td>True</td> <td>False</td> </tr> <tr> <td>True</td> <td>False</td> <td>False</td> <td>False</td> </tr> </tbody> </table> <p>The same strategy can be also defined using an entry signal, an exit signal, and a direction:</p> <table> <thead> <tr> <th>Entry</th> <th>Exit</th> <th>Direction</th> </tr> </thead> <tbody> <tr> <td>True</td> <td>False</td> <td>Long only</td> </tr> <tr> <td>False</td> <td>True</td> <td>Long only</td> </tr> <tr> <td>True/False</td> <td>False/True</td> <td>Short only/Both</td> </tr> <tr> <td>True</td> <td>False</td> <td>Long only/Both</td> </tr> </tbody> </table> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Direction-unaware signals can be easily translated into direction-aware signals:</p> <ul> <li>True, True, Long only <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> True, True, False, False</li> <li>True, True, Short only <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> False, False, True, True</li> <li>True, True, Both <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> True, False, True, False</li> </ul> <p>But direction-aware signals cannot be translated into direction-unaware signals if both directions are enabled and there is an exit signal present:</p> <ul> <li>False, True, False, True <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2753.svg title=:question:></li> </ul> <p>Thus, we need to evaluate in detail which conditions we're interested in before generating signals.</p> </div> <p>But why not choosing an integer data type where a positive number means "order to buy", negative number means "order to sell", and zero means "no order", like done in backtrader, for example? Boolean arrays are much easier to generate and maintain by the user, but also, a boolean NumPy array requires 8x less memory than a 64-bit signed integer NumPy array. Furthermore, it's so much more convenient to combine and analyze masks than integer arrays! For example, we can use the <em>logical OR</em> (<code>|</code> in NumPy) operation to combine two masks, or sum the elements in a mask to get the number of signals since booleans are a subtype of integers and behave just like regular integers in most math expressions.</p> <h2 id=comparison>Comparison<a class=headerlink href=#comparison title="Permanent link">&para;</a></h2> <p>Generating signals properly can sometimes be orders of magnitude more difficult than simulating them. This is because we have to take into account not only their distribution, but also how they interact across multiple boolean arrays. For example, setting both an entry and an exit at the same timestamp will effectively eliminate both. That's why vectorbt deploys numerous functions and techniques to support us in this regard.</p> <p>Signal generation usually starts with comparing two or more numeric arrays. Remember that by comparing entire arrays, we're iterating over each row and column (= element) in a vectorized manner, and compare their scalar values at that one element. So, essentially, we're just running the same comparison operation on each single element across all the arrays that are being compared together. Let's start our first example with Bollinger Bands run on two separate assets. At each timestamp, we'll place a signal whenever the low price is below the lower band, with an expectation that the price will reverse back to its rolling mean:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbtpro</span> <span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>BinanceData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> <span class=s2>&quot;ETHUSDT&quot;</span><span class=p>],</span> 
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2021-01-01&quot;</span><span class=p>,</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-01-01&quot;</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=go>symbol                      BTCUSDT  ETHUSDT</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=go>Open time                                   </span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=go>2021-01-01 00:00:00+00:00  28624.57   714.29</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=go>2021-01-02 00:00:00+00:00  28946.53   714.91</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=go>2021-01-03 00:00:00+00:00  31962.99   768.71</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=go>...                             ...      ...</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=go>2021-12-29 00:00:00+00:00  46096.99  3604.20</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=go>2021-12-30 00:00:00+00:00  45900.00  3585.00</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=go>2021-12-31 00:00:00+00:00  45678.00  3622.29</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=go>[365 rows x 2 columns]</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bb</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;BBANDS&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=gp>... </span>    <span class=n>timeperiod</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=gp>... </span>    <span class=n>nbdevup</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=gp>... </span>    <span class=n>nbdevdn</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>  <span class=c1># (2)!</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=go>symbol                          BTC-USD      ETH-USD</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=go>Date                                                </span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=go>2021-04-23 00:00:00+00:00           NaN          NaN</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=go>2021-04-24 00:00:00+00:00           NaN          NaN</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=go>2021-04-25 00:00:00+00:00           NaN          NaN</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=go>...                                 ...          ...</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=go>2022-04-21 00:00:00+00:00  38987.326323  2912.894415</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=go>2022-04-22 00:00:00+00:00  38874.059308  2898.681307</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=go>2022-04-23 00:00:00+00:00  38915.417003  2903.756905</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=go>[366 rows x 2 columns]</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>  <span class=c1># (3)!</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=go>symbol                     BTCUSDT  ETHUSDT</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=go>Open time                                  </span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=go>2021-01-01 00:00:00+00:00    False    False</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=go>2021-01-02 00:00:00+00:00    False    False</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=go>2021-01-03 00:00:00+00:00    False    False</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=go>...                            ...      ...</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=go>2021-12-29 00:00:00+00:00    False     True</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=go>2021-12-30 00:00:00+00:00    False     True</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=go>2021-12-31 00:00:00+00:00    False    False</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=go>[365 rows x 2 columns]</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>  <span class=c1># (4)!</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a><span class=go>symbol</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a><span class=go>BTCUSDT    36</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a><span class=go>ETHUSDT    28</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Wrap each parameter with <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.Default>Default</a> to hide its column level. Alternatively, we can pass a list of the parameters to hide with <code>hide_params</code>.</li> <li>Get the lower band as a Pandas object. We can list all the output names of an indicator using <code>bb.output_names</code>.</li> <li>Compare two numeric arrays element-wise</li> <li>Get the number of signals in each column for a better overview</li> </ol> <p>This operation has generated a mask that has a true value whenever the low price dips below the lower band. Such an array can already be used in simulation! But let's see what happens when we try to compare the lower band that has been generated for multiple combinations of the (upper and lower) multiplier:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bb_mult</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;BBANDS&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=gp>... </span>    <span class=n>timeperiod</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=gp>... </span>    <span class=n>nbdevup</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=gp>... </span>    <span class=n>nbdevdn</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>  <span class=c1># (1)!</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>bb_mult</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=go>ValueError: Can only compare identically-labeled DataFrame objects</span>
</span></code></pre></div> <ol> <li>Two parameter combinations: (14, 2, 2) and (14, 3, 3)</li> </ol> <p>The problem lies in Pandas being unable to compare DataFrames with different columns - the left DataFrame contains the columns <code>BTCUSDT</code> and <code>ETHUSDT</code> while the right DataFrame coming from the Bollinger Bands indicator now contains the columns <code>(2, 2, BTCUSDT)</code>, <code>(2, 2, ETHUSDT)</code>, <code>(3, 3, BTCUSDT)</code>, and <code>(3, 3, ETHUSDT)</code>. So, what's the solution? Right - vectorbt! By appending <code>vbt</code> to the <em>left</em> operand, we are comparing the accessor object of type <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor>BaseAccessor</a> instead of the DataFrame itself. This will trigger the so-called <a href=https://rszalski.github.io/magicmethods/ >magic method</a> <code>__lt__</code> of that accessor, which takes the DataFrame under the accessor and the DataFrame on the right, and combines them with <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.combine>BaseAccessor.combine</a> and <a href=https://numpy.org/doc/stable/reference/generated/numpy.less.html>numpy.less</a> as <code>combine_func</code>. This, in turn, will broadcast the shapes and indexes of both DataFrames using the vectorbt's powerful broadcasting mechanism, effectively circumventing the limitation of Pandas.</p> <p>As the result, vectorbt will compare <code>(2, 2, BTCUSDT)</code> and <code>(3, 3, BTCUSDT)</code> only with <code>BTCUSDT</code> and <code>(2, 2, ETHSDT)</code> and <code>(3, 3, ETHSDT)</code> only with <code>ETHSDT</code>, and this using NumPy - faster!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>bb_mult</span><span class=o>.</span><span class=n>lowerband</span>  <span class=c1># (1)!</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=go>bbands_nbdevup                          2               3</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=go>bbands_nbdevdn                          2               3</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=go>symbol                    BTCUSDT ETHUSDT BTCUSDT ETHUSDT</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=go>Open time                                                </span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=go>2021-01-01 00:00:00+00:00   False   False   False   False</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=go>2021-01-02 00:00:00+00:00   False   False   False   False</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=go>2021-01-03 00:00:00+00:00   False   False   False   False</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=go>...                           ...     ...     ...     ...</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=go>2021-12-29 00:00:00+00:00   False    True   False   False</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=go>2021-12-30 00:00:00+00:00   False    True   False   False</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=go>2021-12-31 00:00:00+00:00   False   False   False   False</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=go>[365 rows x 4 columns]</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=go>bbands_nbdevup  bbands_nbdevdn  symbol </span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=go>2               2               BTCUSDT    53</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=go>                                ETHUSDT    48</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=go>3               3               BTCUSDT    10</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=go>                                ETHUSDT     9</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li><code>vbt</code> must be always called on the left operand</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>For vectorbt to be able to compare shapes that are not broadcastable, both DataFrames must have at least one column level in common, such as <code>symbol</code> that we had above.</p> </div> <p>As you might have recalled from the documentation on indicators, each indicator attaches a couple of helper methods for comparison - <code>{name}_above</code>, <code>{name}_equal</code>, and <code>{name}_below</code>, which do basically the same as we did above:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>bb_mult</span><span class=o>.</span><span class=n>lowerband_above</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>))</span>  <span class=c1># (1)!</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=go>bbands_nbdevup  bbands_nbdevdn  symbol </span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=go>2               2               BTCUSDT    53</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=go>                                ETHUSDT    48</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=go>3               3               BTCUSDT    10</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=go>                                ETHUSDT     9</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Our indicator doesn't have an input or output for the low price, thus we need to reverse the comparison order and return whether the lower band is above the low price</li> </ol> <h3 id=thresholds>Thresholds<a class=headerlink href=#thresholds title="Permanent link">&para;</a></h3> <p>To compare a numeric array against two or more scalar thresholds (making them parameter combinations), we can use the same approach by either appending <code>vbt</code>, or by calling the method <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.combine>BaseAccessor.combine</a>. Let's calculate the bandwidth of our single-combination indicator, which is the upper band minus the lower band divided by the middle band, and check whether it's higher than two different thresholds:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bandwidth</span> <span class=o>=</span> <span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>upperband</span> <span class=o>-</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>)</span> <span class=o>/</span> <span class=n>bb</span><span class=o>.</span><span class=n>middleband</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.15</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;threshold&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=go>threshold  symbol </span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=go>0.15       BTCUSDT    253</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=go>           ETHUSDT    316</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=go>0.30       BTCUSDT     65</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=go>           ETHUSDT    136</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=go>dtype: int64</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>combine</span><span class=p>(</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=gp>... </span>    <span class=p>[</span><span class=mf>0.15</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span>  <span class=c1># (2)!</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=gp>... </span>    <span class=n>combine_func</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>greater</span><span class=p>,</span> 
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=gp>... </span>    <span class=n>keys</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>([</span><span class=mf>0.15</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;threshold&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=go>threshold  symbol </span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=go>0.15       BTCUSDT    253</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=go>           ETHUSDT    316</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=go>0.30       BTCUSDT     65</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=go>           ETHUSDT    136</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Passes both objects to <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.combine>BaseAccessor.combine</a>, broadcasts them using <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.broadcast>broadcast</a>, and combines them using <a href=https://numpy.org/doc/stable/reference/generated/numpy.greater.html>numpy.greater</a>. Thanks to broadcasting, each value in <code>vbt.Param</code> is combined with each column in the array. This works only for scalars!</li> <li>When passing a list, the DataFrame gets compared to each item in the list</li> <li>Argument <code>keys</code> is used to append a column level describing the items in the list</li> </ol> <p>The latest example works also on arrays instead of scalars. Or, we can use <a href=https://pandas.pydata.org/docs/reference/api/pandas.concat.html>pandas.concat</a> to manually stack the results of any comparison to treat them as separate combinations:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>... </span>    <span class=p>(</span><span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=mf>0.15</span><span class=p>,</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>),</span> 
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>    <span class=n>keys</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>([</span><span class=mf>0.15</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;threshold&quot;</span><span class=p>),</span> 
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span>    <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=go>threshold  symbol </span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=go>0.15       BTCUSDT    253</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=go>           ETHUSDT    316</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=go>0.30       BTCUSDT     65</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=go>           ETHUSDT    136</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=go>dtype: int64</span>
</span></code></pre></div> <h3 id=crossovers>Crossovers<a class=headerlink href=#crossovers title="Permanent link">&para;</a></h3> <p>So far we have touched basic vectorized comparison operations, but there is one operation that comes disproportionally often in technical analysis: crossovers. A crossover refers to a situation where two time series cross each other. There are two ways of finding the crossovers: naive and native. The naive approach compares both time series in a vectorized manner and then selects the first <code>True</code> value out of each "partition" of <code>True</code> values. A partition in the vectorbt's vocabulary for signal processing is just a bulk of consecutive <code>True</code> values produced by the comparison. While we already know how to do the first operation, the second one can be achieved with the help of the accessor for signals - <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor>SignalsAccessor</a>, accessible via the attribute <code>vbt.signals</code> on any Pandas object.</p> <p>In particular, we will be using the method <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.first>SignalsAccessor.first</a>, which takes a mask, assigns a rank to each <code>True</code> value in each partition using <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.pos_rank>SignalsAccessor.pos_rank</a> (enumerated from 0 to the length of the respective partition), and then keeps only those <code>True</code> values that have the rank 0. Let's get the crossovers of the lower price dipping below the lower band:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>low_below_lband</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>low_below_lband</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=go>symbol</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=go>BTCUSDT    21</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=go>ETHUSDT    20</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=go>dtype: int64</span>
</span></code></pre></div> <p>To make sure that the operation was successful, let's plot the <code>BTCUSDT</code> column of both time series using <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.plot>GenericAccessor.plot</a> and the generated signals using <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsSRAccessor.plot_as_markers>SignalsSRAccessor.plot_as_markers</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>btc_low</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>btc_lowerband</span> <span class=o>=</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Lower Band&quot;</span><span class=p>)</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>btc_mask</span> <span class=o>=</span> <span class=n>mask</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Signals&quot;</span><span class=p>)</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>btc_low</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>btc_lowerband</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>btc_mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_markers</span><span class=p>(</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=gp>... </span>    <span class=n>y</span><span class=o>=</span><span class=n>btc_low</span><span class=p>,</span> 
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=gp>... </span>        <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=gp>... </span>            <span class=n>color</span><span class=o>=</span><span class=s2>&quot;#DFFF00&quot;</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=gp>... </span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Give the column another name for the legend</li> <li>First plotting method returns a figure, which needs to be passed to each subsequent plotting method</li> <li>We're using <code>btc_low</code> as the Y-values at which to place the markers</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/crossovers.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/crossovers.dark.svg#only-dark></p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>To wait for a confirmation, use <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.nth>SignalsAccessor.nth</a> to select the n-th signal in each partition.</p> </div> <p>But here's the catch: if the first low value is already below the first lower band value, it will also yield a crossover signal. To fix that, we need to pass <code>after_false=True</code>, which will discard the first partition if there is no <code>False</code> value before it.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>low_below_lband</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>(</span><span class=n>after_false</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=go>symbol</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=go>BTCUSDT    21</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=go>ETHUSDT    20</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=go>dtype: int64</span>
</span></code></pre></div> <p>And here's another catch: if the first bunch of values in the indicator are NaN, which results in <code>False</code> values in the mask, and the first value after the last NaN yields <code>True</code>, then the <code>after_false</code> argument becomes ineffective. To account for this, we need to manually set those values in the mask to <code>True</code>. Let's illustrate this issue on sample data:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_low</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>10</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>8</span><span class=p>])</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_lband</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>])</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span> <span class=o>=</span> <span class=n>sample_low</span> <span class=o>&lt;</span> <span class=n>sample_lband</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>(</span><span class=n>after_false</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=go>0    False</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=go>1    False</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=go>2     True</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=go>3    False</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=go>4     True</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=go>dtype: bool</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span><span class=p>[</span><span class=n>sample_lband</span><span class=o>.</span><span class=n>ffill</span><span class=p>()</span><span class=o>.</span><span class=n>isnull</span><span class=p>()]</span> <span class=o>=</span> <span class=kc>True</span>  <span class=c1># (2)!</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>(</span><span class=n>after_false</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=go>0    False</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=go>1    False</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=go>2    False</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=go>3    False</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=go>4     True</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=go>dtype: bool</span>
</span></code></pre></div> <ol> <li>The first crossover shouldn't happen because we don't know what happens at those NaN, while the second crossover is perfectly valid</li> <li>Forward fill the indicator values to keep only the first NaN values, and set the mask to <code>True</code> at those positions to make <code>after_false</code> effective again</li> </ol> <p>Or, we can remove the buffer, do the operation, and then add the buffer back:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>buffer</span> <span class=o>=</span> <span class=n>sample_lband</span><span class=o>.</span><span class=n>ffill</span><span class=p>()</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>buffer</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=go>2</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_buf_mask</span> <span class=o>=</span> <span class=n>sample_low</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>buffer</span><span class=p>:]</span> <span class=o>&lt;</span> <span class=n>sample_lband</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>buffer</span><span class=p>:]</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_buf_mask</span> <span class=o>=</span> <span class=n>sample_buf_mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>(</span><span class=n>after_false</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span> <span class=o>=</span> <span class=n>sample_low</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>sample_buf_mask</span><span class=o>.</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=n>sample_buf_mask</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sample_mask</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=go>0    False</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=go>1    False</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=go>2    False</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=go>3    False</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=go>4     True</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=go>dtype: bool</span>
</span></code></pre></div> <ol> <li>Find the maximum length of each first consecutive series of NaN values across all columns</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>We can apply the buffer-exclusive approach introduced above to basically any operation in vectorbt.</p> </div> <p>But here comes another issue: what happens if our data contains gaps and we encounter a NaN in the middle of a partition? We should make the second part of the partition <code>False</code> as forward-filling that NaN value would make waiting for a confirmation problematic. But also, doing so many operations on bigger arrays just for getting the crossovers is quite resource-expensive. Gladly, vectorbt deploys its own Numba-compiled function <a href=../../../api/generic/nb/base/index.html#vectorbtpro.generic.nb.base.crossed_above_nb>crossed_above_nb</a> for finding the crossovers in an iterative manner, which is the second, native way. To use this function, we can use the methods <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.crossed_above>GenericAccessor.crossed_above</a> and <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.crossed_below>GenericAccessor.crossed_below</a>, accessible via the attribute <code>vbt</code> on any Pandas object:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>,</span> <span class=n>wait</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=go>symbol</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=go>BTCUSDT    15</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=go>ETHUSDT    11</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Wait one bar for confirmation</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If the time series crosses back during the confirmation period <code>wait</code>, the signal won't be set. To set the signal anyway, use forward shifting.</p> </div> <p>As with other comparison methods, each indicator has the helper methods <code>{name}_crossed_above</code> and <code>{name}_crossed_below</code> for generating the crossover masks:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband_crossed_above</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span> <span class=n>wait</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=go>symbol</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=go>BTCUSDT    15</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=go>ETHUSDT    11</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=go>dtype: int64</span>
</span></code></pre></div> <h2 id=logical-operators>Logical operators<a class=headerlink href=#logical-operators title="Permanent link">&para;</a></h2> <p>Once we've generated two or more masks (conditions), we can combine them into a single mask using logical operators. Common logical operators include </p> <ul> <li><em>AND</em> (<code>&amp;</code> or <a href=https://numpy.org/doc/stable/reference/generated/numpy.logical_and.html>numpy.logical_and</a>): for each element, returns True whenever all the conditions are True</li> <li><em>OR</em> (<code>|</code> or <a href=https://numpy.org/doc/stable/reference/generated/numpy.logical_or.html>numpy.logical_or</a>): for each element, returns True whenever any of the conditions are True</li> <li><em>NOT</em> (<code>~</code> or <a href=https://numpy.org/doc/stable/reference/generated/numpy.logical_not.html>numpy.logical_not</a>): for each element, returns True whenever the condition is False</li> <li><em>XOR</em> (<code>^</code> or <a href=https://numpy.org/doc/stable/reference/generated/numpy.logical_xor.html>numpy.logical_xor</a>): for each element, returns True whenever only one of the conditions is True</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Do not use <code>and</code>, <code>or</code>, or <code>not</code> on arrays - they only work on single boolean values! For example, instead of <code>mask1 and mask2</code> use <code>mask1 &amp; mask2</code>, instead of <code>mask1 or mask2</code> use <code>mask1 | mask2</code>, and instead of <code>not mask</code> use <code>~mask</code>.</p> </div> <p>For example, let's combine four conditions for a signal: the low price dips below the lower band <em>AND</em> the bandwidth is above some threshold (= a downward breakout while expanding), <em>OR</em>, the high price rises above the upper band <em>AND</em> the bandwidth is below some threshold (= an upward breakout while squeezing):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=mf>0.3</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond3</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond4</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&lt;</span> <span class=mf>0.15</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>cond3</span> <span class=o>&amp;</span> <span class=n>cond4</span><span class=p>)</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=go>symbol</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=go>BTCUSDT    25</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=go>ETHUSDT    13</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=go>dtype: int64</span>
</span></code></pre></div> <p>To test multiple thresholds and to broadcast exclusively using vectorbt:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;cond2_th&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond3</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond4</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;cond4_th&quot;</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>cond2</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>|</span> <span class=p>(</span><span class=n>cond3</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>cond4</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=go>cond2_th  cond4_th  symbol </span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=go>0.3       0.1       BTCUSDT    11</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=go>                    ETHUSDT    10</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=go>          0.2       BTCUSDT    28</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=go>                    ETHUSDT    27</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=go>0.4       0.1       BTCUSDT     9</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=go>                    ETHUSDT     5</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=go>          0.2       BTCUSDT    26</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=go>                    ETHUSDT    22</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Test two thresholds in the second condition, and repeat them to compare each one to both thresholds in the fourth condition</li> <li>Test two thresholds in the fourth condition, and tile them to compare each one to both thresholds in the second condition</li> <li>Notice how <code>vbt</code> is appended to each operand on the left. Adding it to any operand on the right is redundant.</li> </ol> <h3 id=cartesian-product>Cartesian product<a class=headerlink href=#cartesian-product title="Permanent link">&para;</a></h3> <p>Combining two or more arrays using a Cartesian product is a bit more complex since every array has the column level <code>symbol</code> that shouldn't be combined with itself. But here's the trick. First, convert the columns of each array into their integer positions. Then, split each position array into "blocks" (smaller arrays). Blocks will be combined with each other, but the positions within each block won't; that is, each block acts as a parameter combination. Combine then all blocks using a combinatorial function of choice (see <a href=https://docs.python.org/3/library/itertools.html>itertools</a> for various options, or <a href=../../../api/utils/params/index.html#vectorbtpro.utils.params.generate_param_combs>generate_param_combs</a>), and finally, flatten each array with blocks and use it for column selection. Sounds complex? Yes. Difficult to implement? No!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;cond2_th&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond3</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond4</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;cond4_th&quot;</span><span class=p>)</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>cond1</span><span class=o>.</span><span class=n>columns</span><span class=p>)),</span> <span class=nb>len</span><span class=p>(</span><span class=n>cond1</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>cond2</span><span class=o>.</span><span class=n>columns</span><span class=p>)),</span> <span class=nb>len</span><span class=p>(</span><span class=n>cond2</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i3</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>cond3</span><span class=o>.</span><span class=n>columns</span><span class=p>)),</span> <span class=nb>len</span><span class=p>(</span><span class=n>cond3</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i4</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>cond4</span><span class=o>.</span><span class=n>columns</span><span class=p>)),</span> <span class=nb>len</span><span class=p>(</span><span class=n>cond4</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i1</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=go>[array([0, 1])]</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i2</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=go>[array([0, 1]), array([2, 3])]</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i3</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=go>[array([0, 1])]</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i4</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=go>[array([0, 1]), array([2, 3])]</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i1</span><span class=p>,</span> <span class=n>i2</span><span class=p>,</span> <span class=n>i3</span><span class=p>,</span> <span class=n>i4</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=n>product</span><span class=p>(</span><span class=n>i1</span><span class=p>,</span> <span class=n>i2</span><span class=p>,</span> <span class=n>i3</span><span class=p>,</span> <span class=n>i4</span><span class=p>))</span>  <span class=c1># (3)!</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i1</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=go>(array([0, 1]), array([0, 1]), array([0, 1]), array([0, 1]))</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i2</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=go>(array([0, 1]), array([0, 1]), array([2, 3]), array([2, 3]))</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i3</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=go>(array([0, 1]), array([0, 1]), array([0, 1]), array([0, 1]))</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i4</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=go>(array([0, 1]), array([2, 3]), array([0, 1]), array([2, 3]))</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>i1</span><span class=p>)</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>  <span class=c1># (4)!</span>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>i2</span><span class=p>)</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span><span id=__span-15-33><a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i3</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>i3</span><span class=p>)</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span><span id=__span-15-34><a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i4</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>i4</span><span class=p>)</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span><span id=__span-15-35><a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a>
</span><span id=__span-15-36><a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i1</span>
</span><span id=__span-15-37><a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a><span class=go>[0 1 0 1 0 1 0 1]</span>
</span><span id=__span-15-38><a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i2</span>
</span><span id=__span-15-39><a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a><span class=go>[0 1 0 1 2 3 2 3]</span>
</span><span id=__span-15-40><a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i3</span>
</span><span id=__span-15-41><a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a><span class=go>[0 1 0 1 0 1 0 1]</span>
</span><span id=__span-15-42><a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=gp>&gt;&gt;&gt; </span><span class=n>i4</span>
</span><span id=__span-15-43><a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a><span class=go>[0 1 2 3 0 1 2 3]</span>
</span><span id=__span-15-44><a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a>
</span><span id=__span-15-45><a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=n>cond1</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=n>i1</span><span class=p>]</span>  <span class=c1># (5)!</span>
</span><span id=__span-15-46><a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>cond2</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=n>i2</span><span class=p>]</span>
</span><span id=__span-15-47><a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond3</span> <span class=o>=</span> <span class=n>cond3</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=n>i3</span><span class=p>]</span>
</span><span id=__span-15-48><a id=__codelineno-15-48 name=__codelineno-15-48 href=#__codelineno-15-48></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond4</span> <span class=o>=</span> <span class=n>cond4</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=n>i4</span><span class=p>]</span>
</span><span id=__span-15-49><a id=__codelineno-15-49 name=__codelineno-15-49 href=#__codelineno-15-49></a>
</span><span id=__span-15-50><a id=__codelineno-15-50 name=__codelineno-15-50 href=#__codelineno-15-50></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>cond2</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>|</span> <span class=p>(</span><span class=n>cond3</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>cond4</span><span class=p>)</span>  <span class=c1># (6)!</span>
</span><span id=__span-15-51><a id=__codelineno-15-51 name=__codelineno-15-51 href=#__codelineno-15-51></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-15-52><a id=__codelineno-15-52 name=__codelineno-15-52 href=#__codelineno-15-52></a><span class=go>cond2_th  cond4_th  symbol </span>
</span><span id=__span-15-53><a id=__codelineno-15-53 name=__codelineno-15-53 href=#__codelineno-15-53></a><span class=go>0.3       0.1       BTCUSDT    11</span>
</span><span id=__span-15-54><a id=__codelineno-15-54 name=__codelineno-15-54 href=#__codelineno-15-54></a><span class=go>                    ETHUSDT    10</span>
</span><span id=__span-15-55><a id=__codelineno-15-55 name=__codelineno-15-55 href=#__codelineno-15-55></a><span class=go>          0.2       BTCUSDT    28</span>
</span><span id=__span-15-56><a id=__codelineno-15-56 name=__codelineno-15-56 href=#__codelineno-15-56></a><span class=go>                    ETHUSDT    27</span>
</span><span id=__span-15-57><a id=__codelineno-15-57 name=__codelineno-15-57 href=#__codelineno-15-57></a><span class=go>0.4       0.1       BTCUSDT     9</span>
</span><span id=__span-15-58><a id=__codelineno-15-58 name=__codelineno-15-58 href=#__codelineno-15-58></a><span class=go>                    ETHUSDT     5</span>
</span><span id=__span-15-59><a id=__codelineno-15-59 name=__codelineno-15-59 href=#__codelineno-15-59></a><span class=go>          0.2       BTCUSDT    26</span>
</span><span id=__span-15-60><a id=__codelineno-15-60 name=__codelineno-15-60 href=#__codelineno-15-60></a><span class=go>                    ETHUSDT    22</span>
</span><span id=__span-15-61><a id=__codelineno-15-61 name=__codelineno-15-61 href=#__codelineno-15-61></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Each DataFrame should contain only unique parameter combinations (and columns in general)</li> <li>Split each position array into blocks with symbols</li> <li>Combine all blocks (= parameter combinations) using the Cartesian product</li> <li>Flatten each array with blocks to get an array that can be used in indexing</li> <li>Using the final positions, select the columns from each DataFrame, which will make each DataFrame have the same number of columns</li> <li>All columns have the same length but still different labels <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> let the vectorbt's broadcaster do the alignment job</li> </ol> <p>In newer versions of VBT the same effect can be achieved with a single call of <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.cross>BaseAccessor.cross</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;cond2_th&quot;</span><span class=p>)</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond3</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&gt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond4</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&lt;</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;cond4_th&quot;</span><span class=p>)</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span><span class=p>,</span> <span class=n>cond2</span><span class=p>,</span> <span class=n>cond3</span><span class=p>,</span> <span class=n>cond4</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>x</span><span class=p>(</span><span class=n>cond1</span><span class=p>,</span> <span class=n>cond2</span><span class=p>,</span> <span class=n>cond3</span><span class=p>,</span> <span class=n>cond4</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>cond2</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span> <span class=o>|</span> <span class=p>(</span><span class=n>cond3</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>cond4</span><span class=p>)</span>
</span></code></pre></div> <ol> <li><code>x</code> is an alias method for <code>cross</code>. Another way: <code>cond1.vbt.x(cond2, cond3, cond4)</code>.</li> </ol> <p>But probably an easier and less error-prone approach would be to build an indicator that would handle parameter combinations for us <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f601.svg title=:grin:> </p> <p>For this, we will write an indicator expression similar to the code we wrote for a single parameter combination, and use <a href=../../../api/indicators/factory/index.html#vectorbtpro.indicators.factory.IndicatorFactory.from_expr>IndicatorFactory.from_expr</a> to auto-build an indicator by parsing that expression. The entire logic including the specification of all inputs, parameters, and outputs is encapsulated in the expression itself. We'll use the annotation <code>@res_talib_bbands</code> to resolve the specification of the inputs and parameters expected by the TA-Lib's <code>BBANDS</code> indicator and "copy" them over to our indicator by also prepending the prefix <code>talib</code> to the parameter names. Then, we will perform our usual signal generation logic by substituting the custom parameters <code>cond2_th</code> and <code>cond4_th</code> with their single values, and return the whole thing as an output <code>mask</code> annotated accordingly.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>MaskGenerator</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=o>.</span><span class=n>from_expr</span><span class=p>(</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>... </span><span class=s2>upperband, middleband, lowerband = @res_talib_bbands</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=gp>... </span><span class=s2>bandwidth = (upperband - lowerband) / middleband</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=gp>... </span><span class=s2>cond1 = low &lt; lowerband</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=gp>... </span><span class=s2>cond2 = bandwidth &gt; @p_cond2_th</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=gp>... </span><span class=s2>cond3 = high &gt; upperband</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=gp>... </span><span class=s2>cond4 = bandwidth &lt; @p_cond4_th</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=gp>... </span><span class=s2>@out_mask:(cond1 &amp; cond2) | (cond3 &amp; cond4)</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=gp>... </span><span class=s2>&quot;&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>phelp</span><span class=p>(</span><span class=n>MaskGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>,</span> <span class=n>incl_doc</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=go>Indicator.run(</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=go>    high,</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=go>    low,</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=go>    close,</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=go>    cond2_th,</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=go>    cond4_th,</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=go>    bbands_timeperiod=Default(value=5),</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=go>    bbands_nbdevup=Default(value=2),</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=go>    bbands_nbdevdn=Default(value=2),</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=go>    bbands_matype=Default(value=0),</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=go>    bbands_timeframe=Default(value=None),</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=go>    short_name=&#39;custom&#39;,</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=go>    hide_params=None,</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=go>    hide_default=True,</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a><span class=go>    **kwargs</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=go>)</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_generator</span> <span class=o>=</span> <span class=n>MaskGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=gp>... </span>    <span class=n>cond2_th</span><span class=o>=</span><span class=p>[</span><span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>],</span>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=gp>... </span>    <span class=n>cond4_th</span><span class=o>=</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=gp>... </span>    <span class=n>bbands_timeperiod</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a><span class=gp>... </span>    <span class=n>param_product</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a><span class=gp>... </span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38 href=#__codelineno-17-38></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_generator</span><span class=o>.</span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39 href=#__codelineno-17-39></a><span class=go>custom_cond2_th  custom_cond4_th  symbol </span>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40 href=#__codelineno-17-40></a><span class=go>0.3              0.1              BTCUSDT    11</span>
</span><span id=__span-17-41><a id=__codelineno-17-41 name=__codelineno-17-41 href=#__codelineno-17-41></a><span class=go>                                  ETHUSDT    10</span>
</span><span id=__span-17-42><a id=__codelineno-17-42 name=__codelineno-17-42 href=#__codelineno-17-42></a><span class=go>                 0.2              BTCUSDT    28</span>
</span><span id=__span-17-43><a id=__codelineno-17-43 name=__codelineno-17-43 href=#__codelineno-17-43></a><span class=go>                                  ETHUSDT    27</span>
</span><span id=__span-17-44><a id=__codelineno-17-44 name=__codelineno-17-44 href=#__codelineno-17-44></a><span class=go>0.4              0.1              BTCUSDT     9</span>
</span><span id=__span-17-45><a id=__codelineno-17-45 name=__codelineno-17-45 href=#__codelineno-17-45></a><span class=go>                                  ETHUSDT     5</span>
</span><span id=__span-17-46><a id=__codelineno-17-46 name=__codelineno-17-46 href=#__codelineno-17-46></a><span class=go>                 0.2              BTCUSDT    26</span>
</span><span id=__span-17-47><a id=__codelineno-17-47 name=__codelineno-17-47 href=#__codelineno-17-47></a><span class=go>                                  ETHUSDT    22</span>
</span><span id=__span-17-48><a id=__codelineno-17-48 name=__codelineno-17-48 href=#__codelineno-17-48></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Take a look at the arguments that the run method expects</li> <li>Run the indicator on the Cartesian product of all parameters</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Even though the indicator factory has "indicator" in its name, we can use it to generate signals just as well. This is because signals are just boolean arrays that also guarantee to be of the input shape.</p> </div> <h2 id=shifting>Shifting<a class=headerlink href=#shifting title="Permanent link">&para;</a></h2> <p>To compare the current value to any previous (not future!) value, we can use forward shifting. Also, we can use it to shift the final mask to postpone the order execution. For example, let's generate a signal whenever the low price dips below the lower band <em>AND</em> the bandwidth change (i.e., the difference between the current and the previous bandwidth) is positive:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=go>symbol</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=go>BTCUSDT    42</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=go>ETHUSDT    39</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>The shifted array holds the previous values</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Never attempt to shift backwards to avoid the look-ahead bias! Use either a positive number in <a href=https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.shift.html>DataFrame.shift</a>, or the vectorbt's accessor method <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.fshift>GenericAccessor.fshift</a>.</p> </div> <p>Another way to shift observations is by selecting the first observation in a rolling window. This is particularly useful when the rolling window has a variable size, for example, based on a frequency. Let's do the same as above but determine the change in the bandwidth in relation to one week ago instead of yesterday:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=go>symbol</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=go>BTCUSDT    33</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=go>ETHUSDT    28</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=go>dtype: int64</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>Using variable windows instead of fixed ones should be preferred if your data has gaps.</p> </div> <p>The approach above is a move in the right direction, but it introduces two potential issues: all windows will be either 6 days long or less, while the performance of rolling and applying such a custom Python function using Pandas is not satisfactory, to say the least. The first issue can be solved by rolling a window of 8 days, and checking the timestamp of the first observation being exactly 7 days behind the current timestamp:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>exactly_ago</span><span class=p>(</span><span class=n>sr</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>sr</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>sr</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>):</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>sr</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond_7d_ago</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=s2>&quot;8d&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>exactly_ago</span><span class=p>,</span> <span class=n>raw</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>cond_7d_ago</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=go>symbol</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=go>BTCUSDT    29</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=go>ETHUSDT    26</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>By passing <code>raw=False</code>, the input will be a Pandas Series</li> </ol> <p>The second issue can be solved by looping with Numba. However, the main challenge lies in solving those two issues simultaneously because we want to access the timestamp of the first observation, which requires us to work on a Pandas Series instead of a NumPy array, and Numba cannot work on Pandas Series <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f611.svg title=:expressionless:></p> <p>Thus, we will use the vectorbt's accessor method <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.rolling_apply>GenericAccessor.rolling_apply</a>, which offers two modes: regular and meta. The regular mode rolls over the data of a Pandas object just like Pandas does it, and does not give us any information about the current window <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f645.svg title=:no_good:> The meta mode rolls over the <strong>metadata</strong> of a Pandas object, so we can easily select the data from any array corresponding to the current window <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f44c.svg title=:ok_hand:></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>exactly_ago_meta_nb</span><span class=p>(</span><span class=n>from_i</span><span class=p>,</span> <span class=n>to_i</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>freq</span><span class=p>,</span> <span class=n>arr</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>index</span><span class=p>[</span><span class=n>from_i</span><span class=p>]</span> <span class=o>==</span> <span class=n>index</span><span class=p>[</span><span class=n>to_i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>freq</span><span class=p>:</span>  <span class=c1># (2)!</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>arr</span><span class=p>[</span><span class=n>from_i</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span>  <span class=c1># (3)!</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond_7d_ago</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>rolling_apply</span><span class=p>(</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=gp>... </span>    <span class=s2>&quot;8d&quot;</span><span class=p>,</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=gp>... </span>    <span class=n>exactly_ago_meta_nb</span><span class=p>,</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=gp>... </span>    <span class=n>bandwidth</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>  <span class=c1># (4)!</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=gp>... </span>    <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>to_timedelta64</span><span class=p>(),</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>),</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>wrapper</span>  <span class=c1># (5)!</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>cond_7d_ago</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=go>symbol</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=go>BTCUSDT    29</span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=go>ETHUSDT    26</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>The meta function must take three arguments: the current window start index, window end index, and column</li> <li>Window end index is exclusive, thus use <code>to_i - 1</code> to get the last index in the window</li> <li>Use the current column index to select the column. Remember to make all arrays two-dimensional.</li> <li>Here come our three user-defined arguments</li> <li>Wrapper contains the metadata we want to iterate over and to construct the final Pandas object</li> </ol> <p>And if this approach (rightfully) intimidates you, there is a dead simple method <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.ago>GenericAccessor.ago</a>, which is capable of forward-shifting the array using any delta:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>ago</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=go>symbol</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=go>BTCUSDT    29</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=go>ETHUSDT    26</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=go>dtype: int64</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bandwidth</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>8</span><span class=p>]</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=go>symbol</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=go>BTCUSDT    0.125477</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=go>ETHUSDT    0.096458</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=go>Name: 2021-12-24 00:00:00+00:00, dtype: float64</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bandwidth</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>ago</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=go>symbol</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=go>BTCUSDT    0.125477</span>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=go>ETHUSDT    0.096458</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=go>Name: 2021-12-31 00:00:00+00:00, dtype: float64</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>This method returns exact matches. In a case where the is no exact match, the value will be NaN. To return the previous index value instead, pass <code>method="ffill"</code>. The method also accepts a sequence of deltas that will be applied on the per-element basis.</p> </div> <h2 id=truth-value-testing>Truth value testing<a class=headerlink href=#truth-value-testing title="Permanent link">&para;</a></h2> <p>But what if we want to test whether a certain condition was met during a certain period of time in the past? For this, we need to create an expanding or a rolling window, and do truth value testing using <a href=https://numpy.org/doc/stable/reference/generated/numpy.any.html>numpy.any</a> or <a href=https://numpy.org/doc/stable/reference/generated/numpy.all.html>numpy.all</a> within this window. But since Pandas doesn't implement the rolling aggregation using <code>any</code> and <code>all</code>, we need to be more creative and treat booleans as integers: use <code>max</code> for a logical <em>OR</em> and <code>min</code> for a logical <em>AND</em>. Also, don't forget to cast the resulting array to a boolean data type to generate a valid mask.</p> <p>Let's place a signal whenever the low price goes below the lower band <em>AND</em> there was a downward crossover of the close price with the middle band in the past 5 candles:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>middleband</span><span class=p>)</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>cond2</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>min_periods</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>max</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>bool</span><span class=p>)</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=go>symbol</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=go>BTCUSDT    36</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=go>ETHUSDT    28</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=go>dtype: int64</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Be cautious when setting <code>min_periods</code> to a higher number and converting to a boolean data type: each NaN will become <code>True</code>. Thus, at least replace NaNs with zeros before casting.</p> </div> <p>If the window size is fixed, we can also use <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.rolling_any>GenericAccessor.rolling_any</a> and <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.rolling_all>GenericAccessor.rolling_all</a>, which are tailored for computing rolling truth testing operations:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>middleband</span><span class=p>)</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>cond2</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rolling_any</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=go>symbol</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=go>BTCUSDT    36</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=go>ETHUSDT    28</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=go>dtype: int64</span>
</span></code></pre></div> <p>Another way of doing the same rolling operations is by using the accessor method <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.rolling_apply>GenericAccessor.rolling_apply</a> and specifying <code>reduce_func_nb</code> as "any" or "all" string. We should use the argument <code>wrap_kwargs</code> to instruct vectorbt to fill NaNs with <code>False</code> and change the data type. This method allows flexible windows to be passed. Again, let's roll a window of 5 days:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>middleband</span><span class=p>)</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=n>cond2</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rolling_apply</span><span class=p>(</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=gp>... </span>    <span class=s2>&quot;5d&quot;</span><span class=p>,</span> <span class=s2>&quot;any&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>... </span>    <span class=n>minp</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> 
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=gp>... </span>    <span class=n>wrap_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>fillna</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>bool</span><span class=p>)</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=go>symbol</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=go>BTCUSDT    36</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=go>ETHUSDT    28</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>"any" translates to <a href=../../../api/generic/nb/apply_reduce/index.html#vectorbtpro.generic.nb.apply_reduce.any_reduce_nb>any_reduce_nb</a></li> </ol> <p>Let's do something more complex: check whether the bandwidth contracted to 10% or less at any point during a month using an expanding window, and reset the window at the beginning of the next month; this way, we make the first timestamp of the month a time anchor for our condition. For this, we'll overload the vectorbt's resampling logic, which allows aggregating values by mapping any source index (anchor points in our example) to any target index (our index).</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>anchor_points</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>get_index_points</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;MS&quot;</span><span class=p>,</span> 
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span>    <span class=n>exact_start</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>anchor_points</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=go>array([  0,  31,  59,  90, 120, 151, 181, 212, 243, 273, 304, 334])</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>left_bound</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>left_bound</span><span class=p>[</span><span class=n>anchor_points</span><span class=p>]</span> <span class=o>=</span> <span class=n>anchor_points</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>left_bound</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>ffill_1d_nb</span><span class=p>(</span><span class=n>left_bound</span><span class=p>))</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>left_bound</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>left_bound</span><span class=p>]</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>left_bound</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=go>DatetimeIndex([&#39;2021-01-01 00:00:00+00:00&#39;, &#39;2021-01-01 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=go>               &#39;2021-01-01 00:00:00+00:00&#39;, &#39;2021-01-01 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=go>               &#39;2021-01-01 00:00:00+00:00&#39;, &#39;2021-01-01 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=go>               ...</span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=go>               &#39;2021-12-01 00:00:00+00:00&#39;, &#39;2021-12-01 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=go>               &#39;2021-12-01 00:00:00+00:00&#39;, &#39;2021-12-01 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=go>               &#39;2021-12-01 00:00:00+00:00&#39;, &#39;2021-12-01 00:00:00+00:00&#39;],</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, ...)</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>right_bound</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span>  <span class=c1># (4)!</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>right_bound</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=go>DatetimeIndex([&#39;2021-01-01 00:00:00+00:00&#39;, &#39;2021-01-02 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=go>               &#39;2021-01-03 00:00:00+00:00&#39;, &#39;2021-01-04 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=go>               &#39;2021-01-05 00:00:00+00:00&#39;, &#39;2021-01-06 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=go>               ...</span>
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=go>               &#39;2021-12-26 00:00:00+00:00&#39;, &#39;2021-12-27 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=go>               &#39;2021-12-28 00:00:00+00:00&#39;, &#39;2021-12-29 00:00:00+00:00&#39;,</span>
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=go>               &#39;2021-12-30 00:00:00+00:00&#39;, &#39;2021-12-31 00:00:00+00:00&#39;],</span>
</span><span id=__span-26-32><a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, ...)</span>
</span><span id=__span-26-33><a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a>
</span><span id=__span-26-34><a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>bandwidth</span> <span class=o>&lt;=</span> <span class=mf>0.1</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>resample_between_bounds</span><span class=p>(</span>  <span class=c1># (5)!</span>
</span><span id=__span-26-35><a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a><span class=gp>... </span>    <span class=n>left_bound</span><span class=p>,</span> 
</span><span id=__span-26-36><a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a><span class=gp>... </span>    <span class=n>right_bound</span><span class=p>,</span>
</span><span id=__span-26-37><a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a><span class=gp>... </span>    <span class=s2>&quot;any&quot;</span><span class=p>,</span>
</span><span id=__span-26-38><a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a><span class=gp>... </span>    <span class=n>closed_lbound</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># (6)!</span>
</span><span id=__span-26-39><a id=__codelineno-26-39 name=__codelineno-26-39 href=#__codelineno-26-39></a><span class=gp>... </span>    <span class=n>closed_rbound</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-26-40><a id=__codelineno-26-40 name=__codelineno-26-40 href=#__codelineno-26-40></a><span class=gp>... </span>    <span class=n>wrap_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>fillna</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>bool</span><span class=p>)</span>
</span><span id=__span-26-41><a id=__codelineno-26-41 name=__codelineno-26-41 href=#__codelineno-26-41></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-26-42><a id=__codelineno-26-42 name=__codelineno-26-42 href=#__codelineno-26-42></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=n>right_bound</span>
</span><span id=__span-26-43><a id=__codelineno-26-43 name=__codelineno-26-43 href=#__codelineno-26-43></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>ts_heatmap</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Find the position of the first timestamp in each month using <a href=../../../api/base/wrapping/index.html#vectorbtpro.base.wrapping.ArrayWrapper.get_index_ranges>ArrayWrapper.get_index_ranges</a></li> <li>Remove this and the next line to not include the first month if it's incomplete</li> <li>The left bound of each window will be the respective anchor point (month start). Create an integer array of the same size as our index, fill the anchor points at their positions, and forward fill them.</li> <li>The right bound of each window is the current index</li> <li>Use <a href=../../../api/generic/accessors/index.html#vectorbtpro.generic.accessors.GenericAccessor.resample_between_bounds>GenericAccessor.resample_between_bounds</a> to map the mask values to their windows, and aggregate each window using the "any" operation</li> <li>Make both bounds inclusive to include every single timestamp in a month</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ts_heatmap.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ts_heatmap.dark.svg#only-dark></p> <p>We can observe how the signal for the bandwidth touching the 10% mark propagates through each month, and then the calculation gets reset and repeated.</p> <h2 id=periodically>Periodically<a class=headerlink href=#periodically title="Permanent link">&para;</a></h2> <p>To set signals periodically, such as at 18:00 of each Tuesday, we have multiple options. The first approach involves comparing various attributes of the source and target datetime. For example, to get the timestamps that correspond to each Tuesday, we can compare <a href=https://pandas.pydata.org/docs/reference/api/pandas.DatetimeIndex.weekday.html#pandas.DatetimeIndex.weekday>pandas.DatetimeIndex.weekday</a> to 1 (Monday is 0 and Sunday is 6):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>min_data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>BinanceData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> <span class=s2>&quot;ETHUSDT&quot;</span><span class=p>],</span> 
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2021-01-01 UTC&quot;</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2021-02-01 UTC&quot;</span><span class=p>,</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>... </span>    <span class=n>timeframe</span><span class=o>=</span><span class=s2>&quot;1h&quot;</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span> <span class=o>=</span> <span class=n>min_data</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_index</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>index</span><span class=o>.</span><span class=n>weekday</span> <span class=o>==</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_index</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=go>DatetimeIndex([&#39;2021-01-05 00:00:00+00:00&#39;, &#39;2021-01-05 01:00:00+00:00&#39;,</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=go>               &#39;2021-01-05 02:00:00+00:00&#39;, &#39;2021-01-05 03:00:00+00:00&#39;,</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=go>               &#39;2021-01-05 04:00:00+00:00&#39;, &#39;2021-01-05 05:00:00+00:00&#39;,</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=go>               ...</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=go>               &#39;2021-01-26 18:00:00+00:00&#39;, &#39;2021-01-26 19:00:00+00:00&#39;,</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=go>               &#39;2021-01-26 20:00:00+00:00&#39;, &#39;2021-01-26 21:00:00+00:00&#39;,</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=go>               &#39;2021-01-26 22:00:00+00:00&#39;, &#39;2021-01-26 23:00:00+00:00&#39;],</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <ol> <li>Fetch hourly data for a better illustration</li> <li>Don't forget about the UTC timezone for crypto</li> </ol> <p>Now, we need to select only those timestamps that happen at one specific time:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_1800_index</span> <span class=o>=</span> <span class=n>tuesday_index</span><span class=p>[</span><span class=n>tuesday_index</span><span class=o>.</span><span class=n>hour</span> <span class=o>==</span> <span class=mi>18</span><span class=p>]</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_1800_index</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=go>DatetimeIndex([&#39;2021-01-05 18:00:00+00:00&#39;, &#39;2021-01-12 18:00:00+00:00&#39;,</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=go>               &#39;2021-01-19 18:00:00+00:00&#39;, &#39;2021-01-26 18:00:00+00:00&#39;],</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <p>Since each attribute comparison produces a mask, we can get our signals by pure logical operations. Let's get the timestamps that correspond to each Tuesday 17:30 by comparing the weekday of each timestamp to Tuesday <em>AND</em> the hour of each timestamp to 17 <em>AND</em> the minute of each timestamp to 30:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_1730_index</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>weekday</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> 
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>hour</span> <span class=o>==</span> <span class=mi>17</span><span class=p>)</span> <span class=o>&amp;</span> 
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span>    <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>minute</span> <span class=o>==</span> <span class=mi>30</span><span class=p>)</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>... </span><span class=p>]</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_1730_index</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=go>DatetimeIndex([], dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=&#39;H&#39;)</span>
</span></code></pre></div> <p>As we see, both conditions combined produced no exact matches because our index is hourly. But what if we wanted to get the previous or next timestamp if there was no exact match? Clearly, the approach above wouldn't work. Instead, we'll use the function <a href=https://pandas.pydata.org/docs/reference/api/pandas.Index.get_indexer.html>pandas.Index.get_indexer</a>, which takes an array with index labels, and searches for their corresponding positions in the index. For example, let's get the position of August 7th in our index:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>([</span><span class=n>pd</span><span class=o>.</span><span class=n>Timestamp</span><span class=p>(</span><span class=s2>&quot;2021-01-07&quot;</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=n>index</span><span class=o>.</span><span class=n>tz</span><span class=p>)])</span>  <span class=c1># (1)!</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=go>array([144])</span>
</span></code></pre></div> <ol> <li>Don't forget to provide the timezone if the index is timezone-aware!</li> </ol> <p>But looking for an index that doesn't exist will return <code>-1</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>([</span><span class=n>pd</span><span class=o>.</span><span class=n>Timestamp</span><span class=p>(</span><span class=s2>&quot;2021-01-07 17:30:00&quot;</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=n>index</span><span class=o>.</span><span class=n>tz</span><span class=p>)])</span> 
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=go>array([-1])</span>
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Do not pass the result for indexing if there is a possibility of no match. For example, if any of the returned positions is <code>-1</code> and it's used in timestamp selection, the position will be replaced by the latest timestamp in the index.</p> </div> <p>To get either the exact match or the previous one, we can pass <code>method='ffill'</code>. Conversely, to get the next one, we can pass <code>method='bfill'</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span><span class=p>[</span><span class=n>index</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>(</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=gp>... </span>    <span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>Timestamp</span><span class=p>(</span><span class=s2>&quot;2021-01-07 17:30:00&quot;</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=n>index</span><span class=o>.</span><span class=n>tz</span><span class=p>)],</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=gp>... </span>    <span class=n>method</span><span class=o>=</span><span class=s2>&quot;ffill&quot;</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=gp>... </span><span class=p>)]</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=go>DatetimeIndex([&#39;2021-01-07 17:00:00+00:00&#39;], ...)</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span><span class=p>[</span><span class=n>index</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>(</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=gp>... </span>    <span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>Timestamp</span><span class=p>(</span><span class=s2>&quot;2021-01-07 17:30:00&quot;</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=n>index</span><span class=o>.</span><span class=n>tz</span><span class=p>)],</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=gp>... </span>    <span class=n>method</span><span class=o>=</span><span class=s2>&quot;bfill&quot;</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=gp>... </span><span class=p>)]</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=go>DatetimeIndex([&#39;2021-01-07 18:00:00+00:00&#39;], ...)</span>
</span></code></pre></div> <p>Returning to our example, we need first to generate the target index for our query, which we're about to search in the source index: use the function <a href=https://pandas.pydata.org/docs/reference/api/pandas.date_range.html>pandas.date_range</a> to get the timestamp of each Tuesday midnight, and then add a timedelta of 17 hours and 30 minutes. Next, transform the target index into positions (row indices) at which our signals will be placed. Then, we extract the Pandas symbol wrapper from our data instance and use it to fill a new mask that has the same number of columns as we have symbols. Finally, set <code>True</code> at the generated positions of that mask:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>each_tuesday</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>index</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>freq</span><span class=o>=</span><span class=s2>&quot;W-TUE&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>each_tuesday_1730</span> <span class=o>=</span> <span class=n>each_tuesday</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>17</span><span class=p>,</span> <span class=n>minutes</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>each_tuesday_1730</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=go>DatetimeIndex([&#39;2021-01-05 17:30:00+00:00&#39;, &#39;2021-01-12 17:30:00+00:00&#39;,</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=go>               &#39;2021-01-19 17:30:00+00:00&#39;, &#39;2021-01-26 17:30:00+00:00&#39;],</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, freq=None)</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>positions</span> <span class=o>=</span> <span class=n>index</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>(</span><span class=n>each_tuesday_1730</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=s2>&quot;bfill&quot;</span><span class=p>)</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>min_symbol_wrapper</span> <span class=o>=</span> <span class=n>min_data</span><span class=o>.</span><span class=n>get_symbol_wrapper</span><span class=p>()</span>  <span class=c1># (3)!</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>positions</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>  <span class=c1># (5)!</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=go>symbol</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=go>BTCUSDT    4</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=go>ETHUSDT    4</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Timezone is embedded into both timestamps and will be used by <code>pd.date_range</code> automatically</li> <li>Adding a timedelta to a datetime will produce a new datetime</li> <li>Use <a href=../../../api/data/base/index.html#vectorbtpro.data.base.Data.get_symbol_wrapper>Data.get_symbol_wrapper</a> to get a Pandas wrapper where columns are symbols</li> <li>Use <a href=../../../api/base/wrapping/index.html#vectorbtpro.base.wrapping.ArrayWrapper.fill>ArrayWrapper.fill</a> to create an array with the same shape as the wrapper, and fill it with <code>False</code> values</li> <li>Positions are integer indices of rows, thus use <code>iloc</code> to select the elements at those rows</li> </ol> <p>Let's make sure that all signals match 18:00 on Tuesday, which is the first date after the requested 17:30 on Tuesday in an hourly index:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%A %T&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=go>Index([&#39;Tuesday 18:00:00&#39;, &#39;Tuesday 18:00:00&#39;, &#39;Tuesday 18:00:00&#39;,</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=go>       &#39;Tuesday 18:00:00&#39;],</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;)</span>
</span></code></pre></div> <ol> <li>Details of the string format can be found <a href=https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior>here</a></li> </ol> <p>The above solution is only required when only a single time boundary is known. For example, if we want 17:30 on Tuesday or later, we know only the left boundary while the right boundary is infinity (or we might get no data point after this datetime at all). When both time boundaries are known, we can easily use the first approach and combine it with the vectorbt's signal selection mechanism. For example, let's place a signal at 17:00 on Tuesday or later, but not later than 17:00 on Wednesday. This would require us placing signals from the left boundary all the way to the right boundary, and then selecting the first signal out of that partition:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tuesday_after_1700</span> <span class=o>=</span> <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>weekday</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>hour</span> <span class=o>&gt;=</span> <span class=mi>17</span><span class=p>)</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>wednesday_before_1700</span> <span class=o>=</span> <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>weekday</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>hour</span> <span class=o>&lt;</span> <span class=mi>17</span><span class=p>)</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>main_cond</span> <span class=o>=</span> <span class=n>tuesday_after_1700</span> <span class=o>|</span> <span class=n>wednesday_before_1700</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>main_cond</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%A %T&quot;</span><span class=p>)</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=go>Index([&#39;Tuesday 17:00:00&#39;, &#39;Tuesday 17:00:00&#39;, &#39;Tuesday 17:00:00&#39;,</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=go>       &#39;Tuesday 17:00:00&#39;],</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;)</span>
</span></code></pre></div> <p>The third and final approach is the vectorbt's one <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2764-fe0f-200d-1f525.svg title=:heart_on_fire:></p> <p>It's relying on the two accessor methods <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.set>BaseAccessor.set</a> and <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.set_between>BaseAccessor.set_between</a>, which allow us to conditionally set elements of an array in a more intuitive manner.</p> <p>Place a signal at 17:30 each Tuesday or later:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=gp>... </span>    <span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;W-TUE&quot;</span><span class=p>,</span> 
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=gp>... </span>    <span class=n>at_time</span><span class=o>=</span><span class=s2>&quot;17:30&quot;</span><span class=p>,</span> 
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=gp>... </span>    <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%A %T&quot;</span><span class=p>)</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=go>Index([&#39;Tuesday 18:00:00&#39;, &#39;Tuesday 18:00:00&#39;, &#39;Tuesday 18:00:00&#39;,</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=go>       &#39;Tuesday 18:00:00&#39;],</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;)</span>
</span></code></pre></div> <p>Place a signal after 18:00 each Tuesday (exclusive):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=gp>... </span>    <span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;W-TUE&quot;</span><span class=p>,</span> 
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=gp>... </span>    <span class=n>at_time</span><span class=o>=</span><span class=s2>&quot;18:00&quot;</span><span class=p>,</span> 
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=gp>... </span>    <span class=n>add_delta</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;ns&quot;</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=gp>... </span>    <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%A %T&quot;</span><span class=p>)</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=go>Index([&#39;Tuesday 19:00:00&#39;, &#39;Tuesday 19:00:00&#39;, &#39;Tuesday 19:00:00&#39;,</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=go>       &#39;Tuesday 19:00:00&#39;],</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;)</span>
</span></code></pre></div> <ol> <li>Add a nanosecond to exclude 18:00</li> </ol> <p>Fill signals between 12:00 each Monday and 17:00 each Tuesday:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set_between</span><span class=p>(</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=gp>... </span>    <span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;W-MON&quot;</span><span class=p>,</span> 
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=gp>... </span>    <span class=n>start_time</span><span class=o>=</span><span class=s2>&quot;12:00&quot;</span><span class=p>,</span> 
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=gp>... </span>    <span class=n>end_time</span><span class=o>=</span><span class=s2>&quot;17:00&quot;</span><span class=p>,</span> 
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=gp>... </span>    <span class=n>add_end_delta</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=gp>... </span>    <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%A %T&quot;</span><span class=p>)</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=go>Index([&#39;Monday 12:00:00&#39;, &#39;Monday 13:00:00&#39;, &#39;Monday 14:00:00&#39;,</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=go>       &#39;Monday 15:00:00&#39;, &#39;Monday 16:00:00&#39;, &#39;Monday 17:00:00&#39;,</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=go>       &#39;Monday 18:00:00&#39;, &#39;Monday 19:00:00&#39;, &#39;Monday 20:00:00&#39;,</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=go>       ...</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=go>       &#39;Tuesday 10:00:00&#39;, &#39;Tuesday 11:00:00&#39;, &#39;Tuesday 12:00:00&#39;,</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=go>       &#39;Tuesday 13:00:00&#39;, &#39;Tuesday 14:00:00&#39;, &#39;Tuesday 15:00:00&#39;,</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=go>       &#39;Tuesday 16:00:00&#39;],</span>
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;, length=116)</span>
</span></code></pre></div> <ol> <li>Add a day to get Wednesday</li> </ol> <p>Place a signal exactly at the midnight of January 7th, 2021:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=gp>... </span>    <span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=gp>... </span>    <span class=n>on</span><span class=o>=</span><span class=s2>&quot;January 7th 2021 UTC&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=gp>... </span>    <span class=n>indexer_method</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=gp>... </span>    <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=go>DatetimeIndex([&#39;2021-01-07 00:00:00+00:00&#39;], ...)</span>
</span></code></pre></div> <ol> <li>Human-readable datetime strings are accepted</li> <li>The default method is <code>bfill</code>, which takes the next timestamp if there was no exact match</li> </ol> <p>Fill signals between 12:00 on January 1st/7th and 12:00 on January 2nd/8th, 2021:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set_between</span><span class=p>(</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=gp>... </span>    <span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;2021-01-01 12:00:00&quot;</span><span class=p>,</span> <span class=s2>&quot;2021-01-07 12:00:00&quot;</span><span class=p>],</span>  <span class=c1># (1)!</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;2021-01-02 12:00:00&quot;</span><span class=p>,</span> <span class=s2>&quot;2021-01-08 12:00:00&quot;</span><span class=p>],</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=gp>... </span>    <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=go>DatetimeIndex([&#39;2021-01-01 12:00:00+00:00&#39;, &#39;2021-01-01 13:00:00+00:00&#39;,</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=go>               &#39;2021-01-01 14:00:00+00:00&#39;, &#39;2021-01-01 15:00:00+00:00&#39;,</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=go>               &#39;2021-01-01 16:00:00+00:00&#39;, &#39;2021-01-01 17:00:00+00:00&#39;,</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=go>               ...</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=go>               &#39;2021-01-08 06:00:00+00:00&#39;, &#39;2021-01-08 07:00:00+00:00&#39;,</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=go>               &#39;2021-01-08 08:00:00+00:00&#39;, &#39;2021-01-08 09:00:00+00:00&#39;,</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=go>               &#39;2021-01-08 10:00:00+00:00&#39;, &#39;2021-01-08 11:00:00+00:00&#39;],</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <ol> <li>The first range is built from the first element in <code>start</code> and <code>end</code>, and the second range is built from the second element. We could have also used human-readable datetime strings but those take time to map (to enable, see <a href=../../../api/_settings/index.html#vectorbtpro._settings.datetime>settings.datetime</a>).</li> </ol> <p>Fill signals in the first 2 hours of each week:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>min_symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set_between</span><span class=p>(</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=gp>... </span>    <span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;W-MON&quot;</span><span class=p>,</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=gp>... </span>    <span class=n>split_every</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=gp>... </span>    <span class=n>add_end_delta</span><span class=o>=</span><span class=s2>&quot;2h&quot;</span><span class=p>,</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=gp>... </span>    <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=go>DatetimeIndex([&#39;2021-01-04 00:00:00+00:00&#39;, &#39;2021-01-04 01:00:00+00:00&#39;,</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=go>               &#39;2021-01-11 00:00:00+00:00&#39;, &#39;2021-01-11 01:00:00+00:00&#39;,</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=go>               &#39;2021-01-18 00:00:00+00:00&#39;, &#39;2021-01-18 01:00:00+00:00&#39;,</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=go>               &#39;2021-01-25 00:00:00+00:00&#39;, &#39;2021-01-25 01:00:00+00:00&#39;],</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <ol> <li>Otherwise, ranges will be built from each pair of week starts</li> </ol> <p>See the API documentation for more examples.</p> <h2 id=iteratively>Iteratively<a class=headerlink href=#iteratively title="Permanent link">&para;</a></h2> <p>With Numba, we can write an iterative logic that performs just as well as its vectorized counterparts. But which approach is better? There is no clear winner, although using vectors is an overall more effective and user-friendlier approach because it abstracts away looping over data and automates various mechanisms associated with index and columns. Just think about how powerful the concept of broadcasting is, and how many more lines of code it would require implementing something similar iteratively. Numba also doesn't allow us to work with labels and complex data types, only with numeric data, which requires skills and creativity in designing (efficient!) algorithms. </p> <p>Moreover, most vectorized and also non-vectorized but compiled functions are specifically tailored at one specific task and perform it reliably, while writing an own loop makes <strong>you</strong> responsible to implement every bit of the logic correctly. Vectors are like Lego bricks that require almost zero effort to construct even the most breathtaking castles, while custom loops require learning how to design each Lego brick first <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f9f1.svg title=:bricks:></p> <p>Nevertheless, the most functionality in vectorbt is powered by loops, not vectors - we should rename vectorbt to loopbt, really <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f62c.svg title=:grimacing:> The main reason is plain and simple: most of the operations cannot be realized through vectors because they either introduce path dependencies, require complex data structures, use intermediate calculations or data buffers, periodically need to call a third-party function, or all of these together. Another reason is certainly efficiency: we can design algorithms that loop of the data <a href=https://en.wikipedia.org/wiki/One-pass_algorithm>only once</a>, while performing the same logic using vectors would read the whole data sometimes a dozen of times. The same goes for memory consumption! Finally, defining and running a strategy at each time step is exactly how we would proceed in the real world (and in any other backtesting framework too), and we as traders should strive to mimic the real world as closely as possible.</p> <p>Enough talking! Let's implement the first example from <a href=#logical-operators>Logical operators</a> using a custom loop. Unless our signals are based on multiple assets or some other column grouping, we should always start with one column only:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>  <span class=c1># (1)!</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>generate_mask_1d_nb</span><span class=p>(</span>  <span class=c1># (2)!</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=gp>... </span>    <span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=gp>... </span>    <span class=n>uband</span><span class=p>,</span> <span class=n>mband</span><span class=p>,</span> <span class=n>lband</span><span class=p>,</span>  <span class=c1># (4)!</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=gp>... </span>    <span class=n>cond2_th</span><span class=p>,</span> <span class=n>cond4_th</span>  <span class=c1># (5)!</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=gp>... </span><span class=p>):</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>high</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>  <span class=c1># (6)!</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=gp>... </span>    
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>high</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>  <span class=c1># (7)!</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=gp>... </span>        <span class=c1># (8)!</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=gp>... </span>        <span class=n>bandwidth</span> <span class=o>=</span> <span class=p>(</span><span class=n>uband</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>lband</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>/</span> <span class=n>mband</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=gp>... </span>        <span class=n>cond1</span> <span class=o>=</span> <span class=n>low</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>lband</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=gp>... </span>        <span class=n>cond2</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&gt;</span> <span class=n>cond2_th</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a><span class=gp>... </span>        <span class=n>cond3</span> <span class=o>=</span> <span class=n>high</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>uband</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=gp>... </span>        <span class=n>cond4</span> <span class=o>=</span> <span class=n>bandwidth</span> <span class=o>&lt;</span> <span class=n>cond4_th</span>
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=gp>... </span>        <span class=n>signal</span> <span class=o>=</span> <span class=p>(</span><span class=n>cond1</span> <span class=ow>and</span> <span class=n>cond2</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>cond3</span> <span class=ow>and</span> <span class=n>cond4</span><span class=p>)</span>  <span class=c1># (9)!</span>
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=gp>... </span>        <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>signal</span>  <span class=c1># (10)!</span>
</span><span id=__span-42-18><a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a><span class=gp>... </span>        
</span><span id=__span-42-19><a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-42-20><a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a>
</span><span id=__span-42-21><a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>generate_mask_1d_nb</span><span class=p>(</span>
</span><span id=__span-42-22><a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>  <span class=c1># (11)!</span>
</span><span id=__span-42-23><a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-42-24><a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a><span class=gp>... </span>    <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-42-25><a id=__codelineno-42-25 name=__codelineno-42-25 href=#__codelineno-42-25></a><span class=gp>... </span>    <span class=n>bb</span><span class=o>.</span><span class=n>middleband</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-42-26><a id=__codelineno-42-26 name=__codelineno-42-26 href=#__codelineno-42-26></a><span class=gp>... </span>    <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span><span id=__span-42-27><a id=__codelineno-42-27 name=__codelineno-42-27 href=#__codelineno-42-27></a><span class=gp>... </span>    <span class=mf>0.30</span><span class=p>,</span>
</span><span id=__span-42-28><a id=__codelineno-42-28 name=__codelineno-42-28 href=#__codelineno-42-28></a><span class=gp>... </span>    <span class=mf>0.15</span>
</span><span id=__span-42-29><a id=__codelineno-42-29 name=__codelineno-42-29 href=#__codelineno-42-29></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-42-30><a id=__codelineno-42-30 name=__codelineno-42-30 href=#__codelineno-42-30></a><span class=gp>&gt;&gt;&gt; </span><span class=n>symbol_wrapper</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get_symbol_wrapper</span><span class=p>()</span>
</span><span id=__span-42-31><a id=__codelineno-42-31 name=__codelineno-42-31 href=#__codelineno-42-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>mask</span><span class=p>)</span>  <span class=c1># (12)!</span>
</span><span id=__span-42-32><a id=__codelineno-42-32 name=__codelineno-42-32 href=#__codelineno-42-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-42-33><a id=__codelineno-42-33 name=__codelineno-42-33 href=#__codelineno-42-33></a><span class=go>25</span>
</span></code></pre></div> <ol> <li>Don't forget to decorate with <code>@njit</code> to make the function Numba-compiled</li> <li>Good convention is to append a suffix <code>nb</code> to Numba-compiled functions and <code>1d_nb</code> to those that work only on one column of data</li> <li>Data arrays required by our logic</li> <li>Bollinger Bands arrays required by our logic</li> <li>Thresholds. Can be also defined as keyword arguments with default values.</li> <li>Create a boolean array of the same shape as each of our arrays, and fill it with the default value <code>False</code> (no signal)</li> <li>Iterate over the rows (= timestamps)</li> <li>Here comes the main logic. We perform all operations on one element at a time instead of arrays, which is great for memory.</li> <li>When working with single values, we need to replace <code>&amp;</code> with <code>and</code>, <code>|</code> with <code>or</code>, and <code>~</code> with <code>not</code></li> <li>Write the current signal to the array</li> <li>Since we're working with a one-dimensional Numba-compiled function, we must pass one-dimensional NumPy arrays</li> <li>Since we generated the mask for the symbol <code>BTCUSDT</code> only, select the same column from the wrapper and wrap the array</li> </ol> <p>We've got the same number of signals as previously - magic!</p> <p>To make the function work on multiple columns, we can then write another Numba-compiled function that iterates over columns and calls <code>generate_mask_1d_nb</code> on each:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>generate_mask_nb</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=gp>... </span>    <span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=gp>... </span>    <span class=n>uband</span><span class=p>,</span> <span class=n>mband</span><span class=p>,</span> <span class=n>lband</span><span class=p>,</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=gp>... </span>    <span class=n>cond2_th</span><span class=p>,</span> <span class=n>cond4_th</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=gp>... </span><span class=p>):</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>high</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool_</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=gp>... </span>    
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>high</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>  <span class=c1># (3)!</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=gp>... </span>        <span class=n>out</span><span class=p>[:,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>generate_mask_1d_nb</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=gp>... </span>            <span class=n>high</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span> <span class=n>low</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=gp>... </span>            <span class=n>uband</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span> <span class=n>mband</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span> <span class=n>lband</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=gp>... </span>            <span class=n>cond2_th</span><span class=p>,</span> <span class=n>cond4_th</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=gp>... </span>        
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-43-17><a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>
</span><span id=__span-43-18><a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>generate_mask_nb</span><span class=p>(</span>
</span><span id=__span-43-19><a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>)),</span>  <span class=c1># (5)!</span>
</span><span id=__span-43-20><a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>)),</span>
</span><span id=__span-43-21><a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>upperband</span><span class=p>),</span>
</span><span id=__span-43-22><a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>middleband</span><span class=p>),</span>
</span><span id=__span-43-23><a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>),</span>
</span><span id=__span-43-24><a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=gp>... </span>    <span class=mf>0.30</span><span class=p>,</span>
</span><span id=__span-43-25><a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a><span class=gp>... </span>    <span class=mf>0.15</span>
</span><span id=__span-43-26><a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-43-27><a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>mask</span><span class=p>)</span>
</span><span id=__span-43-28><a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-43-29><a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a><span class=go>symbol</span>
</span><span id=__span-43-30><a id=__codelineno-43-30 name=__codelineno-43-30 href=#__codelineno-43-30></a><span class=go>BTCUSDT    25</span>
</span><span id=__span-43-31><a id=__codelineno-43-31 name=__codelineno-43-31 href=#__codelineno-43-31></a><span class=go>ETHUSDT    13</span>
</span><span id=__span-43-32><a id=__codelineno-43-32 name=__codelineno-43-32 href=#__codelineno-43-32></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Remove <code>1d</code> from the name if the function takes two-dimensional arrays</li> <li>Create an empty boolean array that will be gradually filled with results from <code>generate_mask_1d_nb</code>. When using <code>np.empty</code> instead of <code>np.full</code>, make sure to override each single value, otherwise the elements that haven't been overridden will remain uninitialized and basically garbage.</li> <li>Iterate over the columns (= assets)</li> <li>Select the current column from each array and call our one-dimensional function</li> <li>Use <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.to_2d_array>to_2d_array</a> to cast any array to two dimensions and convert to NumPy</li> </ol> <p>Probably a more "vectorbtonic" way is to create a stand-alone indicator where we can specify the function and what data it expects and returns, and the indicator factory will take care of everything else for us!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>MaskGenerator</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;high&quot;</span><span class=p>,</span> <span class=s2>&quot;low&quot;</span><span class=p>,</span> <span class=s2>&quot;uband&quot;</span><span class=p>,</span> <span class=s2>&quot;mband&quot;</span><span class=p>,</span> <span class=s2>&quot;lband&quot;</span><span class=p>],</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;cond2_th&quot;</span><span class=p>,</span> <span class=s2>&quot;cond4_th&quot;</span><span class=p>],</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;mask&quot;</span><span class=p>]</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>generate_mask_1d_nb</span><span class=p>,</span> <span class=n>takes_1d</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_generator</span> <span class=o>=</span> <span class=n>MaskGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=gp>... </span>    <span class=n>bb</span><span class=o>.</span><span class=n>upperband</span><span class=p>,</span>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=gp>... </span>    <span class=n>bb</span><span class=o>.</span><span class=n>middleband</span><span class=p>,</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=gp>... </span>    <span class=n>bb</span><span class=o>.</span><span class=n>lowerband</span><span class=p>,</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=gp>... </span>    <span class=p>[</span><span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>],</span>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=gp>... </span>    <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span>
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=gp>... </span>    <span class=n>param_product</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (4)!</span>
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-44-16><a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_generator</span><span class=o>.</span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-44-17><a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a><span class=go>custom_cond2_th  custom_cond4_th  symbol </span>
</span><span id=__span-44-18><a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=go>0.3              0.1              BTCUSDT    11</span>
</span><span id=__span-44-19><a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=go>                                  ETHUSDT    10</span>
</span><span id=__span-44-20><a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a><span class=go>                 0.2              BTCUSDT    28</span>
</span><span id=__span-44-21><a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a><span class=go>                                  ETHUSDT    27</span>
</span><span id=__span-44-22><a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a><span class=go>0.4              0.1              BTCUSDT     9</span>
</span><span id=__span-44-23><a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a><span class=go>                                  ETHUSDT     5</span>
</span><span id=__span-44-24><a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a><span class=go>                 0.2              BTCUSDT    26</span>
</span><span id=__span-44-25><a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a><span class=go>                                  ETHUSDT    22</span>
</span><span id=__span-44-26><a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Create the facade of the indicator and specify the apply function</li> <li>We could have also used <code>generate_mask_nb</code> and <code>takes_1d=False</code> </li> <li>Run the indicator. Notice that we don't have care about the proper type and shape of each array!</li> <li>Test the Cartesian product of various threshold combinations</li> </ol> <p>But what about shifting and truth value testing? Simple use cases such as fixed shifts and windows can be implemented quite easily. Below, we're comparing the current value to the value some number of ticks before:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>value_ago_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>ago</span><span class=p>):</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>arr</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float_</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>i</span> <span class=o>-</span> <span class=n>ago</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># (2)!</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=gp>... </span>            <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>arr</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=n>ago</span><span class=p>]</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=gp>... </span>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=gp>... </span>            <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>  <span class=c1># (3)!</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>value_ago_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=go>array([nan, 1., 2.])</span>
</span></code></pre></div> <ol> <li>Use <code>np.empty</code> if we can guarantee to override each element in the array. Also remember to set the data type of the array to floating as soon as NaN values are involved!</li> <li>Before accessing the previous element, make sure that it's within the bounds of the array</li> <li>If the previous element is outside the bounds, set it to NaN</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Don't forget to check whether the element you query is within the bounds of the array. Unless you turned on the <code>NUMBA_BOUNDSCHECK</code> mode, Numba won't raise an error if you accessed an element that does not exist. Instead, it will quietly proceed with the calculation, and at some point your kernel will probably die. In such a case, just restart the kernel, disable Numba or enable the bounds check, and re-run the function to identify the bug.</p> </div> <p>And here's how to test if any condition was true inside a fixed window (= variable time interval):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>any_in_window_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>arr</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool_</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=gp>... </span>        <span class=n>from_i</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>window</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=gp>... </span>        <span class=n>to_i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>  <span class=c1># (3)!</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=gp>... </span>        <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>from_i</span><span class=p>:</span><span class=n>to_i</span><span class=p>])</span>  <span class=c1># (4)!</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>])</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>any_in_window_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=go>array([False, True, True, True, False])</span>
</span></code></pre></div> <ol> <li>We can make the empty array boolean because there are no NaN values involved</li> <li>Get the left bound of the window</li> <li>Get the right bound of the window</li> <li>Use the bounds to select all elements in the window and test whether there is a <code>True</code> value among them</li> </ol> <p>As soon as dates and time are involved, such as to compare the current value to the value exactly 5 days ago, a better approach is to pre-calculate as many intermediate steps as possible. But there is also a possibility to work with a datetime-like index in Numba directly. Here's how to test if any condition was true inside a variable window (= fixed time interval):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>any_in_var_window_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>freq</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>arr</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool_</span><span class=p>)</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=gp>... </span>    <span class=n>from_i</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>index</span><span class=p>[</span><span class=n>from_i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>freq</span><span class=p>:</span>  <span class=c1># (2)!</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=gp>... </span>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>from_i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>index</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>  <span class=c1># (3)!</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=gp>... </span>                <span class=k>if</span> <span class=n>index</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>freq</span><span class=p>:</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=gp>... </span>                    <span class=n>from_i</span> <span class=o>=</span> <span class=n>j</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=gp>... </span>                    <span class=k>break</span>  <span class=c1># (4)!</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=gp>... </span>        <span class=n>to_i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=gp>... </span>        <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>from_i</span><span class=p>:</span><span class=n>to_i</span><span class=p>])</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>])</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s2>&quot;5min&quot;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>arr</span><span class=p>))</span><span class=o>.</span><span class=n>values</span>  <span class=c1># (5)!</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>freq</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;10min&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>to_timedelta64</span><span class=p>()</span>  <span class=c1># (6)!</span>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>any_in_var_window_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>freq</span><span class=p>)</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=go>array([False, True, True, True, False])</span>
</span></code></pre></div> <ol> <li>Take an array of the data type <code>np.datetime64</code> as index and a constant of the type <code>np.timedelta64</code> as frequency</li> <li>Test whether the previous left bound is still valid, that is, inside the current time interval</li> <li>If not, search for the current left bound using another loop that iterates over index</li> <li>Once found, set the left bound to <code>from_i</code> and abort the second loop</li> <li>Define an index with the 5-minute timeframe and convert it to a NumPy datetime array</li> <li>Define a frequency of 10 minutes and convert it to a NumPy timedelta value</li> </ol> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>Generally, it's easier to design iterative functions using regular Python and only compile them with Numba if they were sufficiently tested, because it's easier to debug things in Python than in Numba.</p> </div> <p>Remember that Numba (and thus vectorbt) has far more features for processing numeric data than datetime/timedelta data. But gladly, datetime/timedelta data can be safely converted into integer data outside Numba, and many functions will continue to work just as before:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>any_in_var_window_1d_nb</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>index</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>freq</span><span class=p>))</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=go>array([False, True, True, True, False])</span>
</span></code></pre></div> <p>Why so? By converting a datetime/timedelta into an integer, we're extracting the total number of nanoseconds representing that object. For a datetime, the integer value becomes the number of nanoseconds after the <a href=https://en.wikipedia.org/wiki/Unix_time>Unix Epoch</a>, which is 00:00:00 UTC on 1 January 1970:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=go>array([1577836800000000000, 1577837100000000000, 1577837400000000000,</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=go>       1577837700000000000, 1577838000000000000])</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>index</span> <span class=o>-</span> <span class=n>np</span><span class=o>.</span><span class=n>datetime64</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;ns&quot;</span><span class=p>))</span> <span class=c1># (2)!</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=go>array([1577836800000000000, 1577837100000000000, 1577837400000000000,</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=go>       1577837700000000000, 1577838000000000000])</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>freq</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=go>600000000000</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>freq</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000</span> <span class=o>/</span> <span class=mi>1000</span> <span class=o>/</span> <span class=mi>1000</span> <span class=o>/</span> <span class=mi>60</span>  <span class=c1># (4)!</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=go>10.0</span>
</span></code></pre></div> <ol> <li>Index as timedelta in nanoseconds after 1970</li> <li>This is the same as converting datetime into timedelta by subtracting the Unix Epoch</li> <li>Frequency as timedelta in nanoseconds</li> <li>Convert nanoseconds into minutes</li> </ol> <h2 id=generators>Generators<a class=headerlink href=#generators title="Permanent link">&para;</a></h2> <p>Writing own loops is powerful and makes fun, but even here vectorbt has functions that may make our life easier, especially for generating signals. The most flexible out of all helper functions is the Numba-compiled function <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.generate_nb>generate_nb</a> and its accessor class method <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate>SignalsAccessor.generate</a>, which takes a target shape, initializes a boolean output array of that shape and fills it with <code>False</code>values, then iterates over the columns, and for each column, it calls a so-called "placement function" - a regular UDF that changes the mask in place. After the change, the placement function should return either the position of the last placed signal or <code>-1</code> for no signal.</p> <p>All the information about the current iteration is being passed via a context of the type <a href=../../../api/signals/enums/index.html#vectorbtpro.signals.enums.GenEnContext>GenEnContext</a>, which contains the current segment of the output mask that can be modified in place, the range start (inclusive) that corresponds to that segment, the range end (exclusive), column, but also the full output mask for the user to be able to make patches wherever they want. This way, vectorbt abstracts away both preparing the array and looping over the columns, and assists the user in selecting the right subset of the output data to modify.</p> <p>Let's place a signal at 17:00 (UTC) of each Tuesday:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=gp>... </span>    <span class=n>last_i</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>  <span class=c1># (2)!</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>  <span class=c1># (3)!</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>  <span class=c1># (4)!</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=gp>... </span>        <span class=n>weekday</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>weekday_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>  <span class=c1># (5)!</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=gp>... </span>        <span class=n>hour</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>hour_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>weekday</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>hour</span> <span class=o>==</span> <span class=mi>17</span><span class=p>:</span>  <span class=c1># (6)!</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=gp>... </span>            <span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>[</span><span class=n>out_i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>  <span class=c1># (7)!</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=gp>... </span>            <span class=n>last_i</span> <span class=o>=</span> <span class=n>out_i</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>last_i</span>  <span class=c1># (8)!</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span>  <span class=c1># (9)!</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>  <span class=c1># (10)!</span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=gp>... </span>    <span class=n>place_func_nb</span><span class=p>,</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>  <span class=c1># (11)!</span>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>symbol_wrapper</span>  <span class=c1># (12)!</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=go>symbol</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=go>BTCUSDT    0</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class=go>ETHUSDT    0</span>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>A placement function takes a context and optionally other user-defined arguments</li> <li>Create a variable to track the position of the last placed signal (if any)</li> <li>Iterate over the output array with a local index</li> <li>Get the global index that we'll use to get the current timestamp. For example, if the array segment has 3 elements (<code>len(out)</code>) and the start index of the segment is 2 (<code>from_i</code>), then the first element corresponds to the position 2 (<code>i</code>) and the last element to the position 5.</li> <li><a href=../../../api/utils/datetime_nb/index.html >dt_nb</a> contains Numba-compiled functions for working datetimes and timedeltas, but mostly requiring them to have the integer representation!</li> <li>Check whether the current timestamp is 17:00 on Tuesday</li> <li>If yes, place a signal using the local index, otherwise continue with the next timestamp</li> <li>Make sure that the returned index is local, not global!</li> <li>Call <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate>SignalsAccessor.generate</a> as a class method of the accessor <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor>SignalsAccessor</a></li> <li>Provide the shape to iterate over</li> <li>Provide the index in the integer representation (= the total number of nanoseconds)</li> <li>Provide the wrapper to wrap the final NumPy array</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Segments in <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.generate_nb>generate_nb</a> are always the entire columns.</p> </div> <p>But our index is a daily index, thus there can't be any signal. Instead, let's place a signal at the next possible timestamp:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=gp>... </span>    <span class=n>last_i</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=gp>... </span>        <span class=n>weekday</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>weekday_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=gp>... </span>        <span class=n>hour</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>hour_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>weekday</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>hour</span> <span class=o>==</span> <span class=mi>17</span><span class=p>:</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=gp>... </span>            <span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>[</span><span class=n>out_i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=gp>... </span>            <span class=n>last_i</span> <span class=o>=</span> <span class=n>out_i</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=gp>... </span>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=gp>... </span>            <span class=n>past_target_midnight</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>past_weekday_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=gp>... </span>            <span class=n>past_target</span> <span class=o>=</span> <span class=n>past_target_midnight</span> <span class=o>+</span> <span class=mi>17</span> <span class=o>*</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>h_ns</span>  <span class=c1># (2)!</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=gp>... </span>            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>past_target</span><span class=p>)</span> <span class=ow>and</span> \
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=gp>... </span>                <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>past_target</span><span class=p>:</span>  <span class=c1># (3)!</span>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=gp>... </span>                <span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>[</span><span class=n>out_i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=gp>... </span>                <span class=n>last_i</span> <span class=o>=</span> <span class=n>out_i</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>last_i</span>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a>
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span>
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=gp>... </span>    <span class=n>place_func_nb</span><span class=p>,</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>
</span><span id=__span-51-24><a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>symbol_wrapper</span>
</span><span id=__span-51-25><a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-26><a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-51-27><a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a><span class=go>symbol</span>
</span><span id=__span-51-28><a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a><span class=go>BTCUSDT    52</span>
</span><span id=__span-51-29><a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a><span class=go>ETHUSDT    52</span>
</span><span id=__span-51-30><a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a><span class=go>dtype: int64</span>
</span><span id=__span-51-31><a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a>
</span><span id=__span-51-32><a id=__codelineno-51-32 name=__codelineno-51-32 href=#__codelineno-51-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%A %m/</span><span class=si>%d</span><span class=s1>/%Y&#39;</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-51-33><a id=__codelineno-51-33 name=__codelineno-51-33 href=#__codelineno-51-33></a><span class=go>Index([&#39;Wednesday 01/06/2021&#39;, ..., &#39;Wednesday 12/29/2021&#39;],</span>
</span><span id=__span-51-34><a id=__codelineno-51-34 name=__codelineno-51-34 href=#__codelineno-51-34></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;)</span>
</span></code></pre></div> <ol> <li>Get the timestamp of the midnight on the previous Tuesday</li> <li>Get the timestamp of 17:00 on the previous Tuesday</li> <li>Check if the previous timestamp was before and the current timestamp is after the target time</li> <li>All the generated signals must be on Wednesdays</li> </ol> <p>The most fascinating part about the snippet above is that the entire datetime logic is being performed using just regular integers!</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>When being converted into the integer format, the timezone of each datetime object is effectively converted to UTC, thus make sure that any value compared to the UTC timestamp is also in UTC.</p> </div> <p>But what about multiple parameter combinations? We cannot pass the function above to the indicator factory because it doesn't look like an apply function. But vectorbt's got our back! There is an entire subclass of the indicator factory tailed at signal generation - <a href=../../../api/signals/factory/index.html#vectorbtpro.signals.factory.SignalFactory>SignalFactory</a>. This class supports multiple generation modes that can be specified using the argument <code>mode</code> of the type <a href=../../../api/signals/enums/index.html#vectorbtpro.signals.enums.FactoryMode>FactoryMode</a>. In our case, the mode is <code>FactoryMode.Entries</code> because our function generates signals based on the target shape only, and not based on other signal arrays. Furthermore, the signal factory accepts any additional inputs, parameters, and in-outputs to build the skeleton of our future indicator class.</p> <p>The signal factory has the class method <a href=../../../api/signals/factory/index.html#vectorbtpro.signals.factory.SignalFactory.with_place_func>SignalFactory.with_place_func</a> comparable to <code>from_apply_func</code> we've got used to. In fact, it takes a placement function and generates a custom function that does all the pre- and post-processing around <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.generate_nb>generate_nb</a> (note that other modes have other generation functions). This custom function, for example, prepares the arguments and assigns them to their correct positions in the placement function call. It's then forwarded down to <a href=../../../api/indicators/factory/index.html#vectorbtpro.indicators.factory.IndicatorFactory.with_custom_func>IndicatorFactory.with_custom_func</a>. As a result, we receive an indicator class with a <code>run</code> method that can be applied on any user-defined shape and any grid of parameter combinations. Sounds handy, right?</p> <p>Let's parametrize our exact-match placement function with two parameters: weekday and hour.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>weekday</span><span class=p>,</span> <span class=n>hour</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=gp>... </span>    <span class=n>last_i</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=gp>... </span>        <span class=n>weekday_now</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>weekday_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=gp>... </span>        <span class=n>hour_now</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>hour_nb</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>weekday_now</span> <span class=o>==</span> <span class=n>weekday</span> <span class=ow>and</span> <span class=n>hour_now</span> <span class=o>==</span> <span class=n>hour</span><span class=p>:</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=gp>... </span>            <span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>[</span><span class=n>out_i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=gp>... </span>            <span class=n>last_i</span> <span class=o>=</span> <span class=n>out_i</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>last_i</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>EntryGenerator</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>SignalFactory</span><span class=p>(</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=gp>... </span>    <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;entries&quot;</span><span class=p>,</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;weekday&quot;</span><span class=p>,</span> <span class=s2>&quot;hour&quot;</span><span class=p>]</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_place_func</span><span class=p>(</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=gp>... </span>    <span class=n>entry_place_func_nb</span><span class=o>=</span><span class=n>place_func_nb</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-52-18><a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a><span class=gp>... </span>    <span class=n>entry_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-52-19><a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=gp>... </span>        <span class=n>pass_params</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;weekday&quot;</span><span class=p>,</span> <span class=s2>&quot;hour&quot;</span><span class=p>],</span>
</span><span id=__span-52-20><a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-52-21><a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a><span class=gp>... </span>    <span class=n>var_args</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (4)!</span>
</span><span id=__span-52-22><a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-52-23><a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entry_generator</span> <span class=o>=</span> <span class=n>EntryGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-52-24><a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>  <span class=c1># (5)!</span>
</span><span id=__span-52-25><a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a><span class=gp>... </span>    <span class=mi>1</span><span class=p>,</span> 
</span><span id=__span-52-26><a id=__codelineno-52-26 name=__codelineno-52-26 href=#__codelineno-52-26></a><span class=gp>... </span>    <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>17</span><span class=p>],</span>  <span class=c1># (6)!</span>
</span><span id=__span-52-27><a id=__codelineno-52-27 name=__codelineno-52-27 href=#__codelineno-52-27></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>  <span class=c1># (7)!</span>
</span><span id=__span-52-28><a id=__codelineno-52-28 name=__codelineno-52-28 href=#__codelineno-52-28></a><span class=gp>... </span>    <span class=n>input_index</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>  <span class=c1># (8)!</span>
</span><span id=__span-52-29><a id=__codelineno-52-29 name=__codelineno-52-29 href=#__codelineno-52-29></a><span class=gp>... </span>    <span class=n>input_columns</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-52-30><a id=__codelineno-52-30 name=__codelineno-52-30 href=#__codelineno-52-30></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-52-31><a id=__codelineno-52-31 name=__codelineno-52-31 href=#__codelineno-52-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entry_generator</span><span class=o>.</span><span class=n>entries</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-52-32><a id=__codelineno-52-32 name=__codelineno-52-32 href=#__codelineno-52-32></a><span class=go>custom_weekday  custom_hour   </span>
</span><span id=__span-52-33><a id=__codelineno-52-33 name=__codelineno-52-33 href=#__codelineno-52-33></a><span class=go>1               0            0    52</span>
</span><span id=__span-52-34><a id=__codelineno-52-34 name=__codelineno-52-34 href=#__codelineno-52-34></a><span class=go>                             1    52</span>
</span><span id=__span-52-35><a id=__codelineno-52-35 name=__codelineno-52-35 href=#__codelineno-52-35></a><span class=go>                17           0     0</span>
</span><span id=__span-52-36><a id=__codelineno-52-36 name=__codelineno-52-36 href=#__codelineno-52-36></a><span class=go>                             1     0</span>
</span><span id=__span-52-37><a id=__codelineno-52-37 name=__codelineno-52-37 href=#__codelineno-52-37></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Each indicator function must first accept the input shape, then (optionally) any inputs, in-outputs, parameters, and only then additional arguments</li> <li>When in the mode <code>FactoryMode.Entries</code>, we need to pass the placement function as <code>entry_place_func_nb</code></li> <li>Additionally, we need to provide settings to instruct the custom function to pass specific inputs, in-outputs, and parameters to the placement function. Without it, it will pass nothing!</li> <li>Enable variable arguments to be able to pass our index as an additional positional argument</li> <li>Input shape is required if there are no inputs or in-outputs to determine it from</li> <li>Test two time combinations: 00:00 and 17:00</li> <li>Can be passed thanks to <code>var_args</code></li> <li>Pass Pandas metadata for wrapping output arrays</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The mode <code>FactoryMode.Entries</code> doesn't mean that we are forced to generate signals that must strictly act as entries during the simulation - we can generate any mask, also exits if they don't depend on entries.</p> </div> <p>The indicator function was able to match all midnight times but none afternoon times, which makes sense because our index is daily and thus contains midnight times only. We can easily plot the indicator using the attached <code>plot</code> method, which knows how to visualize each mode:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entry_generator</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/signal_factory.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/signal_factory.dark.svg#only-dark></p> <h3 id=exits>Exits<a class=headerlink href=#exits title="Permanent link">&para;</a></h3> <p>After populating the position entry mask, we should decide on the position exit mask. When exits do not rely on entries, we can use the generator introduced above. In other cases though, we might have a logic that makes an exit signal fully depend on the entry signal. For example, an exit signal representing a stop loss exists solely because of the entry signal that defined that stop loss condition. There is also no guarantee that an exit can be found for an entry at all. Thus, this mode should only be used for cases where entries do not depend on exits, but exits depend on entries. The generation is then done using the Numba-compiled function <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.generate_ex_nb>generate_ex_nb</a> and its accessor instance method <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_exits>SignalsAccessor.generate_exits</a>. The passed context is now of the type <a href=../../../api/signals/enums/index.html#vectorbtpro.signals.enums.GenExContext>GenExContext</a> and also includes the input mask and various generator-related arguments.</p> <p>The generator takes an entry mask array, and in each column, it visits each entry signal and calls a UDF to place one or more exit signals succeeding it. Do you recall how we had to accept <code>from_i</code> and <code>to_i</code> in the placement functions above? The previous mode always passed <code>0</code> as <code>from_i</code> and <code>len(index)</code> as <code>to_i</code> because we had all the freedom to define our signals across the entire column. Here, the passed <code>from_i</code> will usually be the next index after the previous entry, while the passed <code>to_i</code> will usually be the index of the next entry, thus effectively limiting our decision field to the space between each pair of entries.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Beware that knowing the position of the next entry signal may introduce the look-ahead bias. Thus, use it only for iteration purposes, and never set data based on <code>to_i</code>!</p> </div> <p>Let's generate an entry each quarter and an exit at the next date:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>exit_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=gp>... </span>    <span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>  <span class=c1># (1)!</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=mi>0</span>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Q&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>entries</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-54-9><a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=go>DatetimeIndex([&#39;2021-03-31 00:00:00+00:00&#39;, &#39;2021-06-30 00:00:00+00:00&#39;,</span>
</span><span id=__span-54-10><a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=go>               &#39;2021-09-30 00:00:00+00:00&#39;, &#39;2021-12-31 00:00:00+00:00&#39;],</span>
</span><span id=__span-54-11><a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span><span id=__span-54-12><a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a>
</span><span id=__span-54-13><a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_exits</span><span class=p>(</span><span class=n>exit_place_func_nb</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-54-14><a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-54-15><a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=go>DatetimeIndex([&#39;2021-04-01 00:00:00+00:00&#39;, &#39;2021-07-01 00:00:00+00:00&#39;,</span>
</span><span id=__span-54-16><a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=go>               &#39;2021-10-01 00:00:00+00:00&#39;],</span>
</span><span id=__span-54-17><a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <ol> <li>Place an exit at the first position in the segment</li> <li>In contrast to <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate>SignalsAccessor.generate</a>, this method is bound to a Pandas object with entries and is using its metadata</li> </ol> <p>We can control the distance to the entry signal using <code>wait</code>, which defaults to 1. Let's instruct vectorbt to start each segment at the same timestamp as the entry:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_exits</span><span class=p>(</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=go>DatetimeIndex([&#39;2021-03-31 00:00:00+00:00&#39;, &#39;2021-06-30 00:00:00+00:00&#39;,</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=go>               &#39;2021-09-30 00:00:00+00:00&#39;, &#39;2021-12-31 00:00:00+00:00&#39;],</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <p>And below is how to implement a variable waiting time based on a frequency. Let's wait exactly 7 days before placing an exit:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>exit_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>wait_td</span><span class=p>):</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>index</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>from_i</span><span class=p>]</span> <span class=o>+</span> <span class=n>wait_td</span><span class=p>:</span>  <span class=c1># (1)!</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>out_i</span>  <span class=c1># (2)!</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_exits</span><span class=p>(</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>entries</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)),</span>
</span><span id=__span-56-13><a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span>
</span><span id=__span-56-14><a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-56-15><a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-56-16><a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=go>DatetimeIndex([&#39;2021-04-07 00:00:00+00:00&#39;, &#39;2021-07-07 00:00:00+00:00&#39;,</span>
</span><span id=__span-56-17><a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a><span class=go>               &#39;2021-10-07 00:00:00+00:00&#39;],</span>
</span><span id=__span-56-18><a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <ol> <li>Check whether a sufficient amount of time has passed since the entry. For <code>c.from_i</code> to be the index of the entry, we must set <code>wait</code> to zero.</li> <li>When returning the index, the generator will set the respective element to True automatically</li> <li>Our additional arguments come here</li> </ol> <p>But what happens with the exit condition for the previous entry if the next entry is less than 7 days away? Will the exit still be placed? No!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;5d&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_exits</span><span class=p>(</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>entries</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)),</span>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=go>DatetimeIndex([], dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=&#39;D&#39;)</span>
</span></code></pre></div> <p>By default, each segment is limited by the two entries surrounding it. To make it infinite, we can disable <code>until_next</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_exits</span><span class=p>(</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>entries</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)),</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=gp>... </span>    <span class=n>until_next</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=go>DatetimeIndex([&#39;2021-01-08 00:00:00+00:00&#39;, &#39;2021-01-13 00:00:00+00:00&#39;,</span>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=go>               &#39;2021-01-18 00:00:00+00:00&#39;, &#39;2021-01-23 00:00:00+00:00&#39;,</span>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=go>               &#39;2021-01-28 00:00:00+00:00&#39;, &#39;2021-02-02 00:00:00+00:00&#39;,</span>
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=go>               ...</span>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=go>               &#39;2021-12-04 00:00:00+00:00&#39;, &#39;2021-12-09 00:00:00+00:00&#39;,</span>
</span><span id=__span-58-14><a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a><span class=go>               &#39;2021-12-14 00:00:00+00:00&#39;, &#39;2021-12-19 00:00:00+00:00&#39;,</span>
</span><span id=__span-58-15><a id=__codelineno-58-15 name=__codelineno-58-15 href=#__codelineno-58-15></a><span class=go>               &#39;2021-12-24 00:00:00+00:00&#39;, &#39;2021-12-29 00:00:00+00:00&#39;],</span>
</span><span id=__span-58-16><a id=__codelineno-58-16 name=__codelineno-58-16 href=#__codelineno-58-16></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>In such a case, we might be unable to identify which exit belongs to which entry. Moreover, two or more entries may generate an exit at the same timestamp, so beware!</p> </div> <p>In the case above, the generated signals follow the following schema: <code>entry1</code>, <code>entry2</code>, <code>exit1</code>, <code>entry3</code>, <code>exit2</code>, and so on. Whenever those signals are passed to the simulator, it will execute <code>entry1</code> and ignore <code>entry2</code> because there was no exit prior to it - we're still in the market. It will then rightfully execute <code>exit1</code>. But then, it will open a new position with <code>entry3</code> and close it with <code>exit2</code> right after, which was originally designed for <code>entry2</code> (that has been ignored). To avoid this mistake, we should enable <code>skip_until_exit</code> to avoid processing any future entry signal that comes before an exit for any past entry signal. This would match the simulation order.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_exits</span><span class=p>(</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>entries</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)),</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=gp>... </span>    <span class=n>until_next</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=gp>... </span>    <span class=n>skip_until_exit</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=go>DatetimeIndex([&#39;2021-01-08 00:00:00+00:00&#39;, &#39;2021-01-18 00:00:00+00:00&#39;,</span>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=go>               &#39;2021-01-28 00:00:00+00:00&#39;, &#39;2021-02-07 00:00:00+00:00&#39;,</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=go>               &#39;2021-02-17 00:00:00+00:00&#39;, &#39;2021-02-27 00:00:00+00:00&#39;,</span>
</span><span id=__span-59-13><a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=go>               ...</span>
</span><span id=__span-59-14><a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=go>               &#39;2021-11-04 00:00:00+00:00&#39;, &#39;2021-11-14 00:00:00+00:00&#39;,</span>
</span><span id=__span-59-15><a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=go>               &#39;2021-11-24 00:00:00+00:00&#39;, &#39;2021-12-04 00:00:00+00:00&#39;,</span>
</span><span id=__span-59-16><a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=go>               &#39;2021-12-14 00:00:00+00:00&#39;, &#39;2021-12-24 00:00:00+00:00&#39;],</span>
</span><span id=__span-59-17><a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Make sure to use <code>skip_until_exit</code> always in conjunction with disabled <code>until_next</code>.</p> </div> <p>Finally, to make the thing parametrizable, we should use the mode <code>FactoryMode.Exits</code> and provide any supporting information with the prefix <code>exit</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>exit_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>wait_td</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>index</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>from_i</span><span class=p>]</span> <span class=o>+</span> <span class=n>wait_td</span><span class=p>:</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>out_i</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ExitGenerator</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>SignalFactory</span><span class=p>(</span>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=gp>... </span>    <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;exits&quot;</span><span class=p>,</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;wait_td&quot;</span><span class=p>]</span>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_place_func</span><span class=p>(</span>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=o>=</span><span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=gp>... </span>    <span class=n>exit_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=gp>... </span>        <span class=n>pass_params</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;wait_td&quot;</span><span class=p>],</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-60-17><a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a><span class=gp>... </span>    <span class=n>var_args</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-60-18><a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-60-19><a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a><span class=gp>... </span>    <span class=n>until_next</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-60-20><a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a><span class=gp>... </span>    <span class=n>skip_until_exit</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-60-21><a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a><span class=gp>... </span>    <span class=n>param_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-60-22><a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a><span class=gp>... </span>        <span class=n>wait_td</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-60-23><a id=__codelineno-60-23 name=__codelineno-60-23 href=#__codelineno-60-23></a><span class=gp>... </span>            <span class=n>post_index_func</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>y</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>y</span><span class=p>)))</span>
</span><span id=__span-60-24><a id=__codelineno-60-24 name=__codelineno-60-24 href=#__codelineno-60-24></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-60-25><a id=__codelineno-60-25 name=__codelineno-60-25 href=#__codelineno-60-25></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-60-26><a id=__codelineno-60-26 name=__codelineno-60-26 href=#__codelineno-60-26></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-60-27><a id=__codelineno-60-27 name=__codelineno-60-27 href=#__codelineno-60-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exit_generator</span> <span class=o>=</span> <span class=n>ExitGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-60-28><a id=__codelineno-60-28 name=__codelineno-60-28 href=#__codelineno-60-28></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>  <span class=c1># (4)!</span>
</span><span id=__span-60-29><a id=__codelineno-60-29 name=__codelineno-60-29 href=#__codelineno-60-29></a><span class=gp>... </span>    <span class=p>[</span>
</span><span id=__span-60-30><a id=__codelineno-60-30 name=__codelineno-60-30 href=#__codelineno-60-30></a><span class=gp>... </span>        <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;3d&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>to_timedelta64</span><span class=p>(),</span>  <span class=c1># (5)!</span>
</span><span id=__span-60-31><a id=__codelineno-60-31 name=__codelineno-60-31 href=#__codelineno-60-31></a><span class=gp>... </span>        <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=s2>&quot;7d&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>to_timedelta64</span><span class=p>()</span>
</span><span id=__span-60-32><a id=__codelineno-60-32 name=__codelineno-60-32 href=#__codelineno-60-32></a><span class=gp>... </span>    <span class=p>],</span>
</span><span id=__span-60-33><a id=__codelineno-60-33 name=__codelineno-60-33 href=#__codelineno-60-33></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
</span><span id=__span-60-34><a id=__codelineno-60-34 name=__codelineno-60-34 href=#__codelineno-60-34></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-60-35><a id=__codelineno-60-35 name=__codelineno-60-35 href=#__codelineno-60-35></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exit_generator</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-60-36><a id=__codelineno-60-36 name=__codelineno-60-36 href=#__codelineno-60-36></a><span class=go>custom_wait_td   symbol </span>
</span><span id=__span-60-37><a id=__codelineno-60-37 name=__codelineno-60-37 href=#__codelineno-60-37></a><span class=go>3 days 00:00:00  BTCUSDT    73</span>
</span><span id=__span-60-38><a id=__codelineno-60-38 name=__codelineno-60-38 href=#__codelineno-60-38></a><span class=go>                 ETHUSDT    73</span>
</span><span id=__span-60-39><a id=__codelineno-60-39 name=__codelineno-60-39 href=#__codelineno-60-39></a><span class=go>7 days 00:00:00  BTCUSDT    36</span>
</span><span id=__span-60-40><a id=__codelineno-60-40 name=__codelineno-60-40 href=#__codelineno-60-40></a><span class=go>                 ETHUSDT    36</span>
</span><span id=__span-60-41><a id=__codelineno-60-41 name=__codelineno-60-41 href=#__codelineno-60-41></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Don't forget to switch the order of parameters and user-defined arguments</li> <li>Parameters for the generator can be passed as regular keyword arguments, also to the <code>run</code> method</li> <li>Convert the index level with timedeltas to strings to be able to select each value easily. Function <code>post_index_func</code> must take an original index and return a new index.</li> <li>There is no need to provide the input shape and Pandas metadata because both can be derived from the array with entries</li> <li>Test two timedelta combinations. The index and timedeltas must be converted to NumPy prior to passing. Here, we can use datetimes and timedeltas directly, that is, without converting them to integers.</li> </ol> <p>We can then remove redundant entries if wanted:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_entries</span> <span class=o>=</span> <span class=n>exit_generator</span><span class=o>.</span><span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=gp>... </span>    <span class=n>reset_by</span><span class=o>=</span><span class=n>exit_generator</span><span class=o>.</span><span class=n>exits</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=gp>... </span>    <span class=n>allow_gaps</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_entries</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>new_entries</span><span class=p>[(</span><span class=s2>&quot;7 days 00:00:00&quot;</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>)]]</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=go>DatetimeIndex([&#39;2021-01-01 00:00:00+00:00&#39;, &#39;2021-01-11 00:00:00+00:00&#39;,</span>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=go>               &#39;2021-01-21 00:00:00+00:00&#39;, &#39;2021-01-31 00:00:00+00:00&#39;,</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=go>               &#39;2021-02-10 00:00:00+00:00&#39;, &#39;2021-02-20 00:00:00+00:00&#39;,</span>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=go>               ...</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=go>               &#39;2021-11-17 00:00:00+00:00&#39;, &#39;2021-11-27 00:00:00+00:00&#39;,</span>
</span><span id=__span-61-11><a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=go>               &#39;2021-12-07 00:00:00+00:00&#39;, &#39;2021-12-17 00:00:00+00:00&#39;,</span>
</span><span id=__span-61-12><a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=go>               &#39;2021-12-27 00:00:00+00:00&#39;],</span>
</span><span id=__span-61-13><a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, freq=None)</span>
</span></code></pre></div> <ol> <li>Use <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.first>SignalsAccessor.first</a> to select the first <code>True</code> in each partition</li> <li>The partition should reset if an exit signal is spotted</li> <li>The partition is allowed to have <code>False</code> values</li> </ol> <p>After that, each exit is guaranteed to come after the entry it was generated for.</p> <h3 id=both>Both<a class=headerlink href=#both title="Permanent link">&para;</a></h3> <p>Instead of dividing the entry and exit signal generation parts, we can merge them. This is particularly well-suited for a scenario where an exit depends on an entry but also an entry depends on an exit. This kind of logic can be realized through the Numba-compiled function <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.generate_enex_nb>generate_enex_nb</a> and its accessor class method <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_both>SignalsAccessor.generate_both</a>. The generation proceeds as follows. First, two empty output masks are created: entries and exits. Then, for each column, the entry placement function is called to place one or more entry signals. The generator then searches for the position of the last generated entry signal, and calls the exit placement function on the segment right after that entry signal. Then, it's the entry placement function's turn again. This process repeats until the column has been traversed completely. The passed context is of the type <a href=../../../api/signals/enums/index.html#vectorbtpro.signals.enums.GenEnExContext>GenEnExContext</a> and contains all the interesting information related to the current turn and iteration.</p> <p>Let's demonstrate the full power of this method by placing an entry once the price dips below one threshold, and an exit once the price tops another threshold. The signals will be generated strictly one after another, and the entry/exit price will be the close price.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>entry_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>close</span><span class=p>,</span> <span class=n>th</span><span class=p>):</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># (1)!</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=gp>... </span>        <span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=gp>... </span>        <span class=k>return</span> <span class=mi>0</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=gp>... </span>    <span class=n>exit_i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>wait</span>  <span class=c1># (2)!</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=gp>... </span>    <span class=n>exit_price</span> <span class=o>=</span> <span class=n>close</span><span class=p>[</span><span class=n>exit_i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span>  <span class=c1># (3)!</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=gp>... </span>    <span class=n>hit_price</span> <span class=o>=</span> <span class=n>exit_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>th</span><span class=p>)</span>
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>low</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>hit_price</span><span class=p>:</span>  <span class=c1># (4)!</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>out_i</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-62-14><a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a>
</span><span id=__span-62-15><a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-62-16><a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a><span class=gp>... </span><span class=k>def</span> <span class=nf>exit_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>high</span><span class=p>,</span> <span class=n>close</span><span class=p>,</span> <span class=n>th</span><span class=p>):</span>  <span class=c1># (5)!</span>
</span><span id=__span-62-17><a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=gp>... </span>    <span class=n>entry_i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>wait</span>
</span><span id=__span-62-18><a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a><span class=gp>... </span>    <span class=n>entry_price</span> <span class=o>=</span> <span class=n>close</span><span class=p>[</span><span class=n>entry_i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span>
</span><span id=__span-62-19><a id=__codelineno-62-19 name=__codelineno-62-19 href=#__codelineno-62-19></a><span class=gp>... </span>    <span class=n>hit_price</span> <span class=o>=</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>th</span><span class=p>)</span>
</span><span id=__span-62-20><a id=__codelineno-62-20 name=__codelineno-62-20 href=#__codelineno-62-20></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-62-21><a id=__codelineno-62-21 name=__codelineno-62-21 href=#__codelineno-62-21></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-62-22><a id=__codelineno-62-22 name=__codelineno-62-22 href=#__codelineno-62-22></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>high</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>hit_price</span><span class=p>:</span>
</span><span id=__span-62-23><a id=__codelineno-62-23 name=__codelineno-62-23 href=#__codelineno-62-23></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>out_i</span>
</span><span id=__span-62-24><a id=__codelineno-62-24 name=__codelineno-62-24 href=#__codelineno-62-24></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-62-25><a id=__codelineno-62-25 name=__codelineno-62-25 href=#__codelineno-62-25></a>
</span><span id=__span-62-26><a id=__codelineno-62-26 name=__codelineno-62-26 href=#__codelineno-62-26></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_both</span><span class=p>(</span>  <span class=c1># (6)!</span>
</span><span id=__span-62-27><a id=__codelineno-62-27 name=__codelineno-62-27 href=#__codelineno-62-27></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
</span><span id=__span-62-28><a id=__codelineno-62-28 name=__codelineno-62-28 href=#__codelineno-62-28></a><span class=gp>... </span>    <span class=n>entry_place_func_nb</span><span class=o>=</span><span class=n>entry_place_func_nb</span><span class=p>,</span>
</span><span id=__span-62-29><a id=__codelineno-62-29 name=__codelineno-62-29 href=#__codelineno-62-29></a><span class=gp>... </span>    <span class=n>entry_place_args</span><span class=o>=</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;low&quot;</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;close&quot;</span><span class=p>),</span> <span class=mf>0.1</span><span class=p>),</span>  <span class=c1># (7)!</span>
</span><span id=__span-62-30><a id=__codelineno-62-30 name=__codelineno-62-30 href=#__codelineno-62-30></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=o>=</span><span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-62-31><a id=__codelineno-62-31 name=__codelineno-62-31 href=#__codelineno-62-31></a><span class=gp>... </span>    <span class=n>exit_place_args</span><span class=o>=</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;high&quot;</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;close&quot;</span><span class=p>),</span> <span class=mf>0.2</span><span class=p>),</span>
</span><span id=__span-62-32><a id=__codelineno-62-32 name=__codelineno-62-32 href=#__codelineno-62-32></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=p>,</span>
</span><span id=__span-62-33><a id=__codelineno-62-33 name=__codelineno-62-33 href=#__codelineno-62-33></a><span class=gp>... </span>    <span class=n>broadcast_named_args</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>  <span class=c1># (8)!</span>
</span><span id=__span-62-34><a id=__codelineno-62-34 name=__codelineno-62-34 href=#__codelineno-62-34></a><span class=gp>... </span>        <span class=n>high</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-62-35><a id=__codelineno-62-35 name=__codelineno-62-35 href=#__codelineno-62-35></a><span class=gp>... </span>        <span class=n>low</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-62-36><a id=__codelineno-62-36 name=__codelineno-62-36 href=#__codelineno-62-36></a><span class=gp>... </span>        <span class=n>close</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span>
</span><span id=__span-62-37><a id=__codelineno-62-37 name=__codelineno-62-37 href=#__codelineno-62-37></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-62-38><a id=__codelineno-62-38 name=__codelineno-62-38 href=#__codelineno-62-38></a><span class=gp>... </span>    <span class=n>broadcast_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>post_func</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>)</span>  <span class=c1># (9)!</span>
</span><span id=__span-62-39><a id=__codelineno-62-39 name=__codelineno-62-39 href=#__codelineno-62-39></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-62-40><a id=__codelineno-62-40 name=__codelineno-62-40 href=#__codelineno-62-40></a>
</span><span id=__span-62-41><a id=__codelineno-62-41 name=__codelineno-62-41 href=#__codelineno-62-41></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-62-42><a id=__codelineno-62-42 name=__codelineno-62-42 href=#__codelineno-62-42></a><span class=gp>... </span>    <span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> 
</span><span id=__span-62-43><a id=__codelineno-62-43 name=__codelineno-62-43 href=#__codelineno-62-43></a><span class=gp>... </span>    <span class=n>ohlc_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>opacity</span><span class=o>=</span><span class=mf>0.5</span><span class=p>),</span> 
</span><span id=__span-62-44><a id=__codelineno-62-44 name=__codelineno-62-44 href=#__codelineno-62-44></a><span class=gp>... </span>    <span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-62-45><a id=__codelineno-62-45 name=__codelineno-62-45 href=#__codelineno-62-45></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-62-46><a id=__codelineno-62-46 name=__codelineno-62-46 href=#__codelineno-62-46></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_entries</span><span class=p>(</span>
</span><span id=__span-62-47><a id=__codelineno-62-47 name=__codelineno-62-47 href=#__codelineno-62-47></a><span class=gp>... </span>    <span class=n>y</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>),</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-62-48><a id=__codelineno-62-48 name=__codelineno-62-48 href=#__codelineno-62-48></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span>
</span><span id=__span-62-49><a id=__codelineno-62-49 name=__codelineno-62-49 href=#__codelineno-62-49></a><span class=gp>... </span>    <span class=n>y</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>),</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-62-50><a id=__codelineno-62-50 name=__codelineno-62-50 href=#__codelineno-62-50></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (10)!</span>
</span></code></pre></div> <ol> <li>Place the first entry signal at the first timestamp since there is no prior signal to run the threshold comparison against</li> <li>Get the (global) index of the latest opposite signal using <code>c.from_i - c.wait</code></li> <li>Apply the percentage threshold to the initial close price</li> <li>Place an entry signal if the threshold has been crossed downward by the low price</li> <li>The same goes for the exit placement function, but with two differences: an exit is guaranteed to have an entry preceding it, and the threshold is now above the initial close price and should be crossed upward by the high price</li> <li>The accessor method is a class method because it isn't based on any other array and requires only the target shape</li> <li>We need to distribute three price arrays across two functions: high, low, and close. Use the vectorbt's <a href=../../../api/utils/template/index.html#vectorbtpro.utils.template.Rep>Rep</a> template to substitute names by their broadcasted arrays</li> <li>Broadcast all arrays to the target shape</li> <li>Don't forget to convert the broadcasted arrays to NumPy</li> <li>Plot the OHLC price data, entries, and exits. Make the OHLC graph more transparent to make the signals clearly visible.</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/both.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/both.dark.svg#only-dark></p> <p>To parametrize this logic, we need to use the mode <code>FactoryMode.Both</code>. And because our functions require input arrays that broadcast against the input shape, vectorbt won't ask us to provide the input shape but rather determine it from the input arrays automatically:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>BothGenerator</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>SignalFactory</span><span class=p>(</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=gp>... </span>    <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;both&quot;</span><span class=p>,</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;high&quot;</span><span class=p>,</span> <span class=s2>&quot;low&quot;</span><span class=p>,</span> <span class=s2>&quot;close&quot;</span><span class=p>],</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;entry_th&quot;</span><span class=p>,</span> <span class=s2>&quot;exit_th&quot;</span><span class=p>]</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_place_func</span><span class=p>(</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=gp>... </span>    <span class=n>entry_place_func_nb</span><span class=o>=</span><span class=n>entry_place_func_nb</span><span class=p>,</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=gp>... </span>    <span class=n>entry_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=gp>... </span>        <span class=n>pass_inputs</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;low&quot;</span><span class=p>,</span> <span class=s2>&quot;close&quot;</span><span class=p>],</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=gp>... </span>        <span class=n>pass_params</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;entry_th&quot;</span><span class=p>],</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=o>=</span><span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=gp>... </span>    <span class=n>exit_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-63-13><a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a><span class=gp>... </span>        <span class=n>pass_inputs</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;high&quot;</span><span class=p>,</span> <span class=s2>&quot;close&quot;</span><span class=p>],</span>
</span><span id=__span-63-14><a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a><span class=gp>... </span>        <span class=n>pass_params</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;exit_th&quot;</span><span class=p>],</span>
</span><span id=__span-63-15><a id=__codelineno-63-15 name=__codelineno-63-15 href=#__codelineno-63-15></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-63-16><a id=__codelineno-63-16 name=__codelineno-63-16 href=#__codelineno-63-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-17><a id=__codelineno-63-17 name=__codelineno-63-17 href=#__codelineno-63-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>both_generator</span> <span class=o>=</span> <span class=n>BothGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-63-18><a id=__codelineno-63-18 name=__codelineno-63-18 href=#__codelineno-63-18></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-63-19><a id=__codelineno-63-19 name=__codelineno-63-19 href=#__codelineno-63-19></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-63-20><a id=__codelineno-63-20 name=__codelineno-63-20 href=#__codelineno-63-20></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-63-21><a id=__codelineno-63-21 name=__codelineno-63-21 href=#__codelineno-63-21></a><span class=gp>... </span>    <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span>
</span><span id=__span-63-22><a id=__codelineno-63-22 name=__codelineno-63-22 href=#__codelineno-63-22></a><span class=gp>... </span>    <span class=p>[</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span>
</span><span id=__span-63-23><a id=__codelineno-63-23 name=__codelineno-63-23 href=#__codelineno-63-23></a><span class=gp>... </span>    <span class=n>param_product</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-63-24><a id=__codelineno-63-24 name=__codelineno-63-24 href=#__codelineno-63-24></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-25><a id=__codelineno-63-25 name=__codelineno-63-25 href=#__codelineno-63-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-63-26><a id=__codelineno-63-26 name=__codelineno-63-26 href=#__codelineno-63-26></a><span class=gp>... </span>    <span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> 
</span><span id=__span-63-27><a id=__codelineno-63-27 name=__codelineno-63-27 href=#__codelineno-63-27></a><span class=gp>... </span>    <span class=n>ohlc_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>opacity</span><span class=o>=</span><span class=mf>0.5</span><span class=p>),</span> 
</span><span id=__span-63-28><a id=__codelineno-63-28 name=__codelineno-63-28 href=#__codelineno-63-28></a><span class=gp>... </span>    <span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-63-29><a id=__codelineno-63-29 name=__codelineno-63-29 href=#__codelineno-63-29></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-30><a id=__codelineno-63-30 name=__codelineno-63-30 href=#__codelineno-63-30></a><span class=gp>&gt;&gt;&gt; </span><span class=n>both_generator</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-63-31><a id=__codelineno-63-31 name=__codelineno-63-31 href=#__codelineno-63-31></a><span class=gp>... </span>    <span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>),</span> 
</span><span id=__span-63-32><a id=__codelineno-63-32 name=__codelineno-63-32 href=#__codelineno-63-32></a><span class=gp>... </span>    <span class=n>entry_y</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>),</span> 
</span><span id=__span-63-33><a id=__codelineno-63-33 name=__codelineno-63-33 href=#__codelineno-63-33></a><span class=gp>... </span>    <span class=n>exit_y</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>),</span> 
</span><span id=__span-63-34><a id=__codelineno-63-34 name=__codelineno-63-34 href=#__codelineno-63-34></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-63-35><a id=__codelineno-63-35 name=__codelineno-63-35 href=#__codelineno-63-35></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-63-36><a id=__codelineno-63-36 name=__codelineno-63-36 href=#__codelineno-63-36></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/both2.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/both2.dark.svg#only-dark></p> <h3 id=chained-exits>Chained exits<a class=headerlink href=#chained-exits title="Permanent link">&para;</a></h3> <p>A chain in the vectorbt's vocabulary is a special ordering of entry and exit signals where each exit comes after exactly one entry and each entry (apart from the first one) comes after exactly one exit. Thus, we can easily identify which exit belongs to which entry and vice versa. The example above is actually a perfect example of a chain because each signal from crossing a threshold is based solely on the latest opposite signal. Now, imagine that we have already generated an array with entries, and each of those entries should exist only if there was an exit before, otherwise it should be ignored. This use case is very similar to <code>FactoryMode.Exits</code> with enabled <code>skip_until_exit</code> and disabled <code>until_next</code>.</p> <p>But what the mode <code>FactoryMode.Chain</code> proposes is the following: use the generator <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.generate_enex_nb>generate_enex_nb</a> with the entry placement function <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.first_place_nb>first_place_nb</a> to select only the first entry signal after each exit, and any user-defined exit placement function. In the end, we will get two arrays: cleaned entries (often <code>new_entries</code>) and exits (<code>exits</code>).</p> <p>What we should always keep in mind is that entries and exits during the generation phase aren't forced to be used as entries and exits respectively during the simulation. Let's generate entry signals from a moving average crossover each mimicing a limit order, and use an exit placement function to generate signals for executing those limit orders. As a result, we can use those newly generated signals as actual entries during the simulation! If any new "entry" signal comes before the previous "exit" signal, it will be ignored. We'll also track the fill price with another array.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=gp>... </span><span class=k>def</span> <span class=nf>exit_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>request_price</span><span class=p>,</span> <span class=n>fill_price_out</span><span class=p>):</span>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=gp>... </span>    <span class=n>entry_req_price</span> <span class=o>=</span> <span class=n>request_price</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>wait</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span>  <span class=c1># (1)!</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>out_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>out</span><span class=p>)):</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=gp>... </span>        <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span> <span class=o>+</span> <span class=n>out_i</span>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>low</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>entry_req_price</span><span class=p>:</span>  <span class=c1># (2)!</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=gp>... </span>            <span class=n>fill_price_out</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>entry_req_price</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>out_i</span>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a>
</span><span id=__span-64-11><a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ChainGenerator</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>SignalFactory</span><span class=p>(</span>
</span><span id=__span-64-12><a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a><span class=gp>... </span>    <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;chain&quot;</span><span class=p>,</span>
</span><span id=__span-64-13><a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;low&quot;</span><span class=p>,</span> <span class=s2>&quot;request_price&quot;</span><span class=p>],</span>
</span><span id=__span-64-14><a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a><span class=gp>... </span>    <span class=n>in_output_names</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;fill_price_out&quot;</span><span class=p>]</span>
</span><span id=__span-64-15><a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_place_func</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-64-16><a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=o>=</span><span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-64-17><a id=__codelineno-64-17 name=__codelineno-64-17 href=#__codelineno-64-17></a><span class=gp>... </span>    <span class=n>exit_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-64-18><a id=__codelineno-64-18 name=__codelineno-64-18 href=#__codelineno-64-18></a><span class=gp>... </span>        <span class=n>pass_inputs</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;low&quot;</span><span class=p>,</span> <span class=s2>&quot;request_price&quot;</span><span class=p>],</span>
</span><span id=__span-64-19><a id=__codelineno-64-19 name=__codelineno-64-19 href=#__codelineno-64-19></a><span class=gp>... </span>        <span class=n>pass_in_outputs</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;fill_price_out&quot;</span><span class=p>],</span>
</span><span id=__span-64-20><a id=__codelineno-64-20 name=__codelineno-64-20 href=#__codelineno-64-20></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-64-21><a id=__codelineno-64-21 name=__codelineno-64-21 href=#__codelineno-64-21></a><span class=gp>... </span>    <span class=n>fill_price_out</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span>  <span class=c1># (4)!</span>
</span><span id=__span-64-22><a id=__codelineno-64-22 name=__codelineno-64-22 href=#__codelineno-64-22></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-64-23><a id=__codelineno-64-23 name=__codelineno-64-23 href=#__codelineno-64-23></a>
</span><span id=__span-64-24><a id=__codelineno-64-24 name=__codelineno-64-24 href=#__codelineno-64-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fast_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;SMA&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-64-25><a id=__codelineno-64-25 name=__codelineno-64-25 href=#__codelineno-64-25></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span> 
</span><span id=__span-64-26><a id=__codelineno-64-26 name=__codelineno-64-26 href=#__codelineno-64-26></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span> 
</span><span id=__span-64-27><a id=__codelineno-64-27 name=__codelineno-64-27 href=#__codelineno-64-27></a><span class=gp>... </span>    <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;fast_ma&quot;</span>
</span><span id=__span-64-28><a id=__codelineno-64-28 name=__codelineno-64-28 href=#__codelineno-64-28></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-64-29><a id=__codelineno-64-29 name=__codelineno-64-29 href=#__codelineno-64-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>slow_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;SMA&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-64-30><a id=__codelineno-64-30 name=__codelineno-64-30 href=#__codelineno-64-30></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span> 
</span><span id=__span-64-31><a id=__codelineno-64-31 name=__codelineno-64-31 href=#__codelineno-64-31></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span> 
</span><span id=__span-64-32><a id=__codelineno-64-32 name=__codelineno-64-32 href=#__codelineno-64-32></a><span class=gp>... </span>    <span class=n>short_name</span><span class=o>=</span><span class=s2>&quot;slow_ma&quot;</span>
</span><span id=__span-64-33><a id=__codelineno-64-33 name=__codelineno-64-33 href=#__codelineno-64-33></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-64-34><a id=__codelineno-64-34 name=__codelineno-64-34 href=#__codelineno-64-34></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-64-35><a id=__codelineno-64-35 name=__codelineno-64-35 href=#__codelineno-64-35></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-64-36><a id=__codelineno-64-36 name=__codelineno-64-36 href=#__codelineno-64-36></a><span class=go>symbol</span>
</span><span id=__span-64-37><a id=__codelineno-64-37 name=__codelineno-64-37 href=#__codelineno-64-37></a><span class=go>BTCUSDT    10</span>
</span><span id=__span-64-38><a id=__codelineno-64-38 name=__codelineno-64-38 href=#__codelineno-64-38></a><span class=go>ETHUSDT     8</span>
</span><span id=__span-64-39><a id=__codelineno-64-39 name=__codelineno-64-39 href=#__codelineno-64-39></a><span class=go>dtype: int64</span>
</span><span id=__span-64-40><a id=__codelineno-64-40 name=__codelineno-64-40 href=#__codelineno-64-40></a>
</span><span id=__span-64-41><a id=__codelineno-64-41 name=__codelineno-64-41 href=#__codelineno-64-41></a><span class=gp>&gt;&gt;&gt; </span><span class=n>chain_generator</span> <span class=o>=</span> <span class=n>ChainGenerator</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-64-42><a id=__codelineno-64-42 name=__codelineno-64-42 href=#__codelineno-64-42></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>
</span><span id=__span-64-43><a id=__codelineno-64-43 name=__codelineno-64-43 href=#__codelineno-64-43></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-64-44><a id=__codelineno-64-44 name=__codelineno-64-44 href=#__codelineno-64-44></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=mf>0.1</span><span class=p>)</span>  <span class=c1># (6)!</span>
</span><span id=__span-64-45><a id=__codelineno-64-45 name=__codelineno-64-45 href=#__codelineno-64-45></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-64-46><a id=__codelineno-64-46 name=__codelineno-64-46 href=#__codelineno-64-46></a><span class=gp>&gt;&gt;&gt; </span><span class=n>request_mask</span> <span class=o>=</span> <span class=n>chain_generator</span><span class=o>.</span><span class=n>new_entries</span>  <span class=c1># (7)!</span>
</span><span id=__span-64-47><a id=__codelineno-64-47 name=__codelineno-64-47 href=#__codelineno-64-47></a><span class=gp>&gt;&gt;&gt; </span><span class=n>request_mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-64-48><a id=__codelineno-64-48 name=__codelineno-64-48 href=#__codelineno-64-48></a><span class=go>symbol</span>
</span><span id=__span-64-49><a id=__codelineno-64-49 name=__codelineno-64-49 href=#__codelineno-64-49></a><span class=go>BTCUSDT    4</span>
</span><span id=__span-64-50><a id=__codelineno-64-50 name=__codelineno-64-50 href=#__codelineno-64-50></a><span class=go>ETHUSDT    5</span>
</span><span id=__span-64-51><a id=__codelineno-64-51 name=__codelineno-64-51 href=#__codelineno-64-51></a><span class=go>dtype: int64</span>
</span><span id=__span-64-52><a id=__codelineno-64-52 name=__codelineno-64-52 href=#__codelineno-64-52></a>
</span><span id=__span-64-53><a id=__codelineno-64-53 name=__codelineno-64-53 href=#__codelineno-64-53></a><span class=gp>&gt;&gt;&gt; </span><span class=n>request_price</span> <span class=o>=</span> <span class=n>chain_generator</span><span class=o>.</span><span class=n>request_price</span>  <span class=c1># (8)!</span>
</span><span id=__span-64-54><a id=__codelineno-64-54 name=__codelineno-64-54 href=#__codelineno-64-54></a><span class=gp>&gt;&gt;&gt; </span><span class=n>request_price</span><span class=p>[</span><span class=n>request_mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-64-55><a id=__codelineno-64-55 name=__codelineno-64-55 href=#__codelineno-64-55></a><span class=go>symbol                       BTCUSDT   ETHUSDT</span>
</span><span id=__span-64-56><a id=__codelineno-64-56 name=__codelineno-64-56 href=#__codelineno-64-56></a><span class=go>Open time                                     </span>
</span><span id=__span-64-57><a id=__codelineno-64-57 name=__codelineno-64-57 href=#__codelineno-64-57></a><span class=go>2021-02-04 00:00:00+00:00  33242.994  1436.103</span>
</span><span id=__span-64-58><a id=__codelineno-64-58 name=__codelineno-64-58 href=#__codelineno-64-58></a><span class=go>2021-03-11 00:00:00+00:00  51995.844  1643.202</span>
</span><span id=__span-64-59><a id=__codelineno-64-59 name=__codelineno-64-59 href=#__codelineno-64-59></a><span class=go>2021-04-02 00:00:00+00:00  53055.009  1920.321</span>
</span><span id=__span-64-60><a id=__codelineno-64-60 name=__codelineno-64-60 href=#__codelineno-64-60></a><span class=go>2021-06-07 00:00:00+00:00  30197.511  2332.845</span>
</span><span id=__span-64-61><a id=__codelineno-64-61 name=__codelineno-64-61 href=#__codelineno-64-61></a><span class=go>2021-06-15 00:00:00+00:00  36129.636  2289.186</span>
</span><span id=__span-64-62><a id=__codelineno-64-62 name=__codelineno-64-62 href=#__codelineno-64-62></a><span class=go>2021-07-05 00:00:00+00:00  30321.126  1976.877</span>
</span><span id=__span-64-63><a id=__codelineno-64-63 name=__codelineno-64-63 href=#__codelineno-64-63></a><span class=go>2021-07-06 00:00:00+00:00  30798.009  2090.250</span>
</span><span id=__span-64-64><a id=__codelineno-64-64 name=__codelineno-64-64 href=#__codelineno-64-64></a><span class=go>2021-07-27 00:00:00+00:00  35512.083  2069.541</span>
</span><span id=__span-64-65><a id=__codelineno-64-65 name=__codelineno-64-65 href=#__codelineno-64-65></a>
</span><span id=__span-64-66><a id=__codelineno-64-66 name=__codelineno-64-66 href=#__codelineno-64-66></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fill_mask</span> <span class=o>=</span> <span class=n>chain_generator</span><span class=o>.</span><span class=n>exits</span>  <span class=c1># (9)!</span>
</span><span id=__span-64-67><a id=__codelineno-64-67 name=__codelineno-64-67 href=#__codelineno-64-67></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fill_mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-64-68><a id=__codelineno-64-68 name=__codelineno-64-68 href=#__codelineno-64-68></a><span class=go>symbol</span>
</span><span id=__span-64-69><a id=__codelineno-64-69 name=__codelineno-64-69 href=#__codelineno-64-69></a><span class=go>BTCUSDT    3</span>
</span><span id=__span-64-70><a id=__codelineno-64-70 name=__codelineno-64-70 href=#__codelineno-64-70></a><span class=go>ETHUSDT    4</span>
</span><span id=__span-64-71><a id=__codelineno-64-71 name=__codelineno-64-71 href=#__codelineno-64-71></a><span class=go>dtype: int64</span>
</span><span id=__span-64-72><a id=__codelineno-64-72 name=__codelineno-64-72 href=#__codelineno-64-72></a>
</span><span id=__span-64-73><a id=__codelineno-64-73 name=__codelineno-64-73 href=#__codelineno-64-73></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fill_price</span> <span class=o>=</span> <span class=n>chain_generator</span><span class=o>.</span><span class=n>fill_price_out</span>  <span class=c1># (10)!</span>
</span><span id=__span-64-74><a id=__codelineno-64-74 name=__codelineno-64-74 href=#__codelineno-64-74></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fill_price</span><span class=p>[</span><span class=n>fill_mask</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-64-75><a id=__codelineno-64-75 name=__codelineno-64-75 href=#__codelineno-64-75></a><span class=go>symbol                       BTCUSDT   ETHUSDT</span>
</span><span id=__span-64-76><a id=__codelineno-64-76 name=__codelineno-64-76 href=#__codelineno-64-76></a><span class=go>Open time                                     </span>
</span><span id=__span-64-77><a id=__codelineno-64-77 name=__codelineno-64-77 href=#__codelineno-64-77></a><span class=go>2021-03-24 00:00:00+00:00        NaN  1643.202</span>
</span><span id=__span-64-78><a id=__codelineno-64-78 name=__codelineno-64-78 href=#__codelineno-64-78></a><span class=go>2021-05-19 00:00:00+00:00  33242.994  1920.321</span>
</span><span id=__span-64-79><a id=__codelineno-64-79 name=__codelineno-64-79 href=#__codelineno-64-79></a><span class=go>2021-06-08 00:00:00+00:00        NaN  2332.845</span>
</span><span id=__span-64-80><a id=__codelineno-64-80 name=__codelineno-64-80 href=#__codelineno-64-80></a><span class=go>2021-06-18 00:00:00+00:00  36129.636       NaN</span>
</span><span id=__span-64-81><a id=__codelineno-64-81 name=__codelineno-64-81 href=#__codelineno-64-81></a><span class=go>2021-07-13 00:00:00+00:00        NaN  1976.877</span>
</span><span id=__span-64-82><a id=__codelineno-64-82 name=__codelineno-64-82 href=#__codelineno-64-82></a><span class=go>2021-07-19 00:00:00+00:00  30798.009       NaN</span>
</span></code></pre></div> <ol> <li>Get the limit price defined at the entry</li> <li>Check if that price has been hit, and if yes, write the signal and the fill price</li> <li>Entry function and its accompanying information are already filled by vectorbt</li> <li>Without a default, vectorbt will create the in-output array using <code>np.empty</code>. With a default, vectorbt will create the array using <code>np.full</code> and fill it with the default value. We need the second option since our function does not override each element.</li> <li>Generate a signal array for limit order requests based on moving average crossovers</li> <li>Use 10% below the close price as the limit order price</li> <li>New entries contain cleaned order request signals. Many signals were ignored because they come before the limit price of some previous signals could be hit.</li> <li>This is the input array we passed as the limit order price. We can use the request mask to get the price of each request order.</li> <li>Exits contain to-be-filled order signals generated by our exit placement function. Each of such signals has a request counterpart.</li> <li>This is the output array with the order fill price. We can use the fill mask to get the price of each to-be-filled order.</li> </ol> <p>For example, the first limit order for <code>BTCUSDT</code> was placed on <code>2021-02-04</code> and filled on <code>2021-05-19</code>. The first limit order for <code>ETHUSDT</code> was placed on <code>2021-03-11</code> and filled on <code>2021-03-24</code>. To simulate this data, we can pass <code>fill_mask</code> as entries/order size and <code>fill_mask</code> as order price.</p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>If you want to replace any pending limit order with a new one instead of ignoring it, use <code>FactoryMode.Exits</code> and then select the last input signal before each output signal.</p> </div> <h2 id=preset-generators>Preset generators<a class=headerlink href=#preset-generators title="Permanent link">&para;</a></h2> <p>There is an entire range of preset signal generators - <a href=../../../api/signals/generators/index.html >here</a> - that are using the modes we discussed above. Preset indicators were set up for one particular task and are ready to be used without having to provide any custom placement function. The naming of those indicators follows a well-defined schema:</p> <ul> <li>Plain generator have no suffix</li> <li>Exit generators have the suffix <code>X</code></li> <li>Both generators have the suffix <code>NX</code></li> <li>Chain exit generators have the suffix <code>CX</code></li> </ul> <h3 id=random>Random<a class=headerlink href=#random title="Permanent link">&para;</a></h3> <p>You hate randomness in trading? Well, there is one particular use case where randomness is heartily welcomed: trading strategy benchmarking. For instance, comparing one configuration of RSI to another one isn't representative at all since both strategy instances may be inherently bad, and deciding for one is like picking a lesser evil. Random signals, on the other hand, give us an entire new universe of strategies yet to be discovered. Generating a sufficient number of such random signal permutations on a market can reveal the underlying structure and behavior of the market and may answer whether our trading strategy is driven by an edge or pure randomness.</p> <p>There are two types of random signal generation: count-based and probability-based. The former takes a target number of signals <code>n</code> to place during a certain period of time, and guarantees to fulfill this number unless the time period is too small. The latter takes a probability <code>prob</code> of placing a signal at each timestamp; if the probability is too high, it may place a signal at each single timestamp; if the probability is too low, it may place nothing. Both types can be run using the same accessor method: <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_random>SignalsAccessor.generate_random</a> to spread entry signals across the entire column, <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_random_exits>SignalsAccessor.generate_random_exits</a> to spread exit signals after each entry and before the next entry, and <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_random_both>SignalsAccessor.generate_random_both</a> to spread entry and exit signals one after another in a chain.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Generating a specific number of signals may introduce the look-ahead bias because it incorporates the knowledge about the next opposite signal or the column end. Use it with caution, and only when the position of the last to-be-placed signal is known in advance, such as when trading on the per-month basis.</p> </div> <p>Let's generate a signal once in 10 timestamps on average:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>btcusdt_wrapper</span> <span class=o>=</span> <span class=n>symbol_wrapper</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_random</span><span class=p>(</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=gp>... </span>    <span class=n>btcusdt_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=gp>... </span>    <span class=n>prob</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>btcusdt_wrapper</span><span class=p>,</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span>  <span class=c1># (1)!</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_index</span> <span class=o>=</span> <span class=n>mask</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>mask</span><span class=p>]</span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=gp>&gt;&gt;&gt; </span><span class=p>(</span><span class=n>mask_index</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=o>-</span> <span class=n>mask_index</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=go>Timedelta(&#39;8 days 03:20:55.813953488&#39;)</span>
</span></code></pre></div> <ol> <li>Make the calculation deterministic</li> <li>Compute the average distance between two neighboring signals in the mask</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The more signals we generate, the closer is the average neighbor distance to the target average.</p> </div> <p>Now, let's generate exactly one signal each week. To achieve that, we'll generate an "entry" signal on each Monday, and an "exit" signal acting as our target signal. This won't cause the look-ahead bias because we have defined the bounds of the generation space in advance.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>monday_mask</span> <span class=o>=</span> <span class=n>btcusdt_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>monday_mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;W-MON&quot;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>monday_mask</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_random_exits</span><span class=p>(</span><span class=n>wait</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_index</span> <span class=o>=</span> <span class=n>mask</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>mask</span><span class=p>]</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask_index</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%W %A&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a><span class=go>Index([&#39;01 Tuesday&#39;, &#39;02 Wednesday&#39;, &#39;03 Wednesday&#39;, &#39;04 Friday&#39;, &#39;05 Friday&#39;,</span>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a><span class=go>       &#39;06 Tuesday&#39;, &#39;07 Thursday&#39;, &#39;08 Tuesday&#39;, &#39;09 Friday&#39;, &#39;10 Saturday&#39;,</span>
</span><span id=__span-66-8><a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a><span class=go>       &#39;11 Friday&#39;, &#39;12 Saturday&#39;, &#39;13 Monday&#39;, &#39;14 Friday&#39;, &#39;15 Monday&#39;,</span>
</span><span id=__span-66-9><a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=go>       ...</span>
</span><span id=__span-66-10><a id=__codelineno-66-10 name=__codelineno-66-10 href=#__codelineno-66-10></a><span class=go>       &#39;41 Wednesday&#39;, &#39;42 Friday&#39;, &#39;43 Thursday&#39;, &#39;44 Sunday&#39;, &#39;45 Sunday&#39;,</span>
</span><span id=__span-66-11><a id=__codelineno-66-11 name=__codelineno-66-11 href=#__codelineno-66-11></a><span class=go>       &#39;46 Sunday&#39;, &#39;47 Saturday&#39;, &#39;48 Saturday&#39;, &#39;49 Tuesday&#39;, &#39;50 Thursday&#39;,</span>
</span><span id=__span-66-12><a id=__codelineno-66-12 name=__codelineno-66-12 href=#__codelineno-66-12></a><span class=go>       &#39;51 Sunday&#39;, &#39;52 Tuesday&#39;],</span>
</span><span id=__span-66-13><a id=__codelineno-66-13 name=__codelineno-66-13 href=#__codelineno-66-13></a><span class=go>      dtype=&#39;object&#39;, name=&#39;Open time&#39;)</span>
</span></code></pre></div> <ol> <li>Set <code>True</code> on each Monday using <a href=../../../api/base/accessors/index.html#vectorbtpro.base.accessors.BaseAccessor.set>BaseAccessor.set</a></li> <li>Generate exactly one signal after the previous Monday and before the next one. Using <code>wait=0</code>, we're allowing to place a signal right after Monday midnight.</li> <li>Print out the week number and the weekday of each signal</li> </ol> <p>To parametrize the number of signals and the probability, we have at our disposal the indicators starting with the prefix <code>RAND</code> and <code>RPROB</code> respectively. A powerful feature of those indicators is their ability to take both parameters as array-like objects! In particular, we can provide <code>n</code> per column, and <code>prob</code> per column, row, or even element in the target shape. </p> <p>Let's gradually generate more signals with time using <a href=../../../api/signals/generators/rprob/index.html#vectorbtpro.signals.generators.rprob.RPROB>RPROB</a>! We'll start with the probability of 0% and end with the probability of 100% of placing a signal at each timestamp:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>prob</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>))</span>  <span class=c1># (1)!</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rprob</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RPROB</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_pr_array</span><span class=p>(</span><span class=n>prob</span><span class=p>)),</span>  <span class=c1># (3)!</span>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
</span><span id=__span-67-6><a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a><span class=gp>... </span>    <span class=n>input_index</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-67-7><a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a><span class=gp>... </span>    <span class=n>input_columns</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-67-8><a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-67-9><a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rprob</span><span class=o>.</span><span class=n>entries</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>ts_heatmap</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (4)!</span>
</span></code></pre></div> <ol> <li>Use <a href=https://numpy.org/doc/stable/reference/generated/numpy.linspace.html>numpy.linspace</a> to fill the probability values between two extremes</li> <li>We need to provide the input shape since the indicator doesn't take any input arrays</li> <li>Use <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.to_2d_pr_array>to_2d_pr_array</a> to expand the array to two dimensions such that each value corresponds to a row rather than a column (refer to broadcasting rules). Wrap it with <a href=../../../api/base/reshaping/index.html#vectorbtpro.base.reshaping.Default>Default</a> to hide the parameter.</li> <li>Plot the final distribution</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/rprob.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/rprob.dark.svg#only-dark></p> <p>To test multiple values, we can provide them as a list. Let's prove that the fixed probability of 50% yields the same number of signals on average as the one ranging from 0% to 100% (but both are still totally different distributions!):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rprob</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RPROB</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=gp>... </span>    <span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=gp>... </span>    <span class=p>[</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_pr_array</span><span class=p>(</span><span class=n>prob</span><span class=p>)],</span>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=gp>... </span>    <span class=n>input_index</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=gp>... </span>    <span class=n>input_columns</span><span class=o>=</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rprob</span><span class=o>.</span><span class=n>entries</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=go>rprob_prob  symbol </span>
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a><span class=go>0.5         BTCUSDT    176</span>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=go>            ETHUSDT    187</span>
</span><span id=__span-68-12><a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=go>array_0     BTCUSDT    183</span>
</span><span id=__span-68-13><a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a><span class=go>            ETHUSDT    178</span>
</span><span id=__span-68-14><a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a><span class=go>dtype: int64</span>
</span></code></pre></div> <h3 id=stops>Stops<a class=headerlink href=#stops title="Permanent link">&para;</a></h3> <p>Stop signals are an essential part of signal development because they allow us to propagate a stop condition throughout time. There are two main stop signal generators offered by vectorbt: a basic one that compares a single time series against any stop condition, and a specialized one that compares candlestick data against stop order conditions common in trading.</p> <p>The first type can be run using the Numba-compiled function <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.stop_place_nb>stop_place_nb</a> and its accessor instance method <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_stop_exits>SignalsAccessor.generate_stop_exits</a>. Additionally, there are indicator classes <a href=../../../api/signals/generators/stx/index.html#vectorbtpro.signals.generators.stx.STX>STX</a> and <a href=../../../api/signals/generators/stcx/index.html#vectorbtpro.signals.generators.stcx.STCX>STCX</a> that make the stop parametrizable. Let's use the accessor method to generate take profit (TP) signals. For this, we need four inputs: entry signals (<code>entries</code>), the entry price to apply the stop on (<code>entry_ts</code>), the high price (<code>ts</code>), and the actual stop(s) in % to compare the high price against (<code>stop</code>). We'll use the crossover entries generated previously. We'll also run the method in the chained exits mode to force vectorbt to wait for an exit and remove any entry signals that appear before.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_stop_exits</span><span class=p>(</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-69-4><a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=gp>... </span>    <span class=n>stop</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span><span id=__span-69-5><a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=gp>... </span>    <span class=n>chain</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-69-6><a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-69-7><a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_entries</span><span class=p>[</span><span class=n>new_entries</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-69-8><a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a><span class=go>symbol                     BTCUSDT  ETHUSDT</span>
</span><span id=__span-69-9><a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a><span class=go>Open time                                  </span>
</span><span id=__span-69-10><a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a><span class=go>2021-02-04 00:00:00+00:00     True    False</span>
</span><span id=__span-69-11><a id=__codelineno-69-11 name=__codelineno-69-11 href=#__codelineno-69-11></a><span class=go>2021-03-10 00:00:00+00:00     True    False</span>
</span><span id=__span-69-12><a id=__codelineno-69-12 name=__codelineno-69-12 href=#__codelineno-69-12></a><span class=go>...</span>
</span><span id=__span-69-13><a id=__codelineno-69-13 name=__codelineno-69-13 href=#__codelineno-69-13></a><span class=go>2021-11-07 00:00:00+00:00     True    False</span>
</span><span id=__span-69-14><a id=__codelineno-69-14 name=__codelineno-69-14 href=#__codelineno-69-14></a><span class=go>2021-12-02 00:00:00+00:00    False     True</span>
</span><span id=__span-69-15><a id=__codelineno-69-15 name=__codelineno-69-15 href=#__codelineno-69-15></a>
</span><span id=__span-69-16><a id=__codelineno-69-16 name=__codelineno-69-16 href=#__codelineno-69-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=p>[</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-69-17><a id=__codelineno-69-17 name=__codelineno-69-17 href=#__codelineno-69-17></a><span class=go>symbol                     BTCUSDT  ETHUSDT</span>
</span><span id=__span-69-18><a id=__codelineno-69-18 name=__codelineno-69-18 href=#__codelineno-69-18></a><span class=go>Open time                                  </span>
</span><span id=__span-69-19><a id=__codelineno-69-19 name=__codelineno-69-19 href=#__codelineno-69-19></a><span class=go>2021-02-06 00:00:00+00:00     True    False</span>
</span><span id=__span-69-20><a id=__codelineno-69-20 name=__codelineno-69-20 href=#__codelineno-69-20></a><span class=go>2021-03-13 00:00:00+00:00     True    False</span>
</span><span id=__span-69-21><a id=__codelineno-69-21 name=__codelineno-69-21 href=#__codelineno-69-21></a><span class=go>...</span>
</span><span id=__span-69-22><a id=__codelineno-69-22 name=__codelineno-69-22 href=#__codelineno-69-22></a><span class=go>2021-10-15 00:00:00+00:00    False     True</span>
</span><span id=__span-69-23><a id=__codelineno-69-23 name=__codelineno-69-23 href=#__codelineno-69-23></a><span class=go>2021-10-19 00:00:00+00:00     True    False</span>
</span></code></pre></div> <p>But how do we determine the stop price? Gladly, the Numba-compiled function also accepts a (required) in-output array <code>stop_ts</code> that is being written with the stop price of each exit. By default, vectorbt assumes that we're not interested in this array, and to avoid consuming much memory, it creates an empty (uninitialized) array, passes it to Numba, and deletes it afterwards. To make it return the array, we need to pass an empty dictionary <code>out_dict</code> where the accessor method can put the array. Whenever the <code>out_dict</code> is detected, vectorbt will create a full (initialized) array with <code>np.nan</code>, pass it to Numba, and put it back into the dictionary:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>out_dict</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_stop_exits</span><span class=p>(</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=gp>... </span>    <span class=n>stop</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=gp>... </span>    <span class=n>chain</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=gp>... </span>    <span class=n>out_dict</span><span class=o>=</span><span class=n>out_dict</span>
</span><span id=__span-70-8><a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-70-9><a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>out_dict</span><span class=p>[</span><span class=s2>&quot;stop_ts&quot;</span><span class=p>][</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-70-10><a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a><span class=go>symbol                       BTCUSDT   ETHUSDT</span>
</span><span id=__span-70-11><a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=go>Open time                                     </span>
</span><span id=__span-70-12><a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=go>2021-02-06 00:00:00+00:00  40630.326       NaN</span>
</span><span id=__span-70-13><a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a><span class=go>2021-03-13 00:00:00+00:00  61436.749       NaN</span>
</span><span id=__span-70-14><a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a><span class=go>...</span>
</span><span id=__span-70-15><a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a><span class=go>2021-10-15 00:00:00+00:00        NaN  3866.797</span>
</span><span id=__span-70-16><a id=__codelineno-70-16 name=__codelineno-70-16 href=#__codelineno-70-16></a><span class=go>2021-10-19 00:00:00+00:00  63179.721       NaN</span>
</span></code></pre></div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>We could have also passed our own (already created) <code>stop_ts</code> inside <code>out_dict</code> and vectorbt would override only those elements that correspond to exits!</p> </div> <p>The same can be done with the corresponding indicator class. But let's do something completely different: test two trailing stop loss (TSL) parameters instead, where the condition is following the high price upwards and is met once the low price crosses the stop value downwards. The high price can be specified with the argument <code>follow_ts</code>. The entry price will be the open price (even though we generated them using the close price, let's assume this scenario for a second), and thus we'll also allow placing the first signal at the entry bar by making <code>wait</code> zero:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stcx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>STCX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>),</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=gp>... </span>    <span class=n>ts</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=gp>... </span>    <span class=n>follow_ts</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=gp>... </span>    <span class=n>stop</span><span class=o>=-</span><span class=mf>0.1</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=gp>... </span>    <span class=n>trailing</span><span class=o>=</span><span class=p>[</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>],</span>  <span class=c1># (3)!</span>
</span><span id=__span-71-8><a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a><span class=gp>... </span>    <span class=n>wait</span><span class=o>=</span><span class=mi>0</span>  <span class=c1># (4)!</span>
</span><span id=__span-71-9><a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-71-10><a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-71-11><a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a><span class=gp>... </span>    <span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> 
</span><span id=__span-71-12><a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a><span class=gp>... </span>    <span class=n>ohlc_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>opacity</span><span class=o>=</span><span class=mf>0.5</span><span class=p>),</span> 
</span><span id=__span-71-13><a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a><span class=gp>... </span>    <span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-71-14><a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-71-15><a id=__codelineno-71-15 name=__codelineno-71-15 href=#__codelineno-71-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stcx</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-71-16><a id=__codelineno-71-16 name=__codelineno-71-16 href=#__codelineno-71-16></a><span class=gp>... </span>    <span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>),</span> 
</span><span id=__span-71-17><a id=__codelineno-71-17 name=__codelineno-71-17 href=#__codelineno-71-17></a><span class=gp>... </span>    <span class=n>entry_y</span><span class=o>=</span><span class=s2>&quot;entry_ts&quot;</span><span class=p>,</span>  <span class=c1># (5)!</span>
</span><span id=__span-71-18><a id=__codelineno-71-18 name=__codelineno-71-18 href=#__codelineno-71-18></a><span class=gp>... </span>    <span class=n>exit_y</span><span class=o>=</span><span class=s2>&quot;stop_ts&quot;</span><span class=p>,</span> 
</span><span id=__span-71-19><a id=__codelineno-71-19 name=__codelineno-71-19 href=#__codelineno-71-19></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-71-20><a id=__codelineno-71-20 name=__codelineno-71-20 href=#__codelineno-71-20></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-71-21><a id=__codelineno-71-21 name=__codelineno-71-21 href=#__codelineno-71-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Indicators usually assume that we're interested in all optional arrays, so we don't need to pass anything. If you're not interested though, pass <code>stop_ts=None</code> to free up a bit of RAM.</li> <li>For a downward crossover condition, specify a negative stop value</li> <li>Test SL and TSL</li> <li>Waiting time of zero should only be specified when the entry price is the open price!</li> <li>When plotting, we can provide <code>y</code> as an attribute of the indicator instance</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/stcx.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/stcx.dark.svg#only-dark></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Waiting time cannot be higher than 1. If waiting time is 0, <code>entry_ts</code> should be the first value in the bar. If waiting time is 1, <code>entry_ts</code> should be the last value in the bar, otherwise the stop could have also been hit at the first bar.</p> <p>Also, by making the waiting time zero, you may get an entry and an exit at the same bar. Multiple orders at the same bar can only be implemented using a flexible order function or by converting the signals directly into order records. When passed directly to <a href=../../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_signals>Portfolio.from_signals</a>, any conflicting signals will be ignored.</p> </div> <p>If we're looking into placing solely SL, TSL, TP, and TTP orders, a more complete approach would be using the full OHLC information, which is utilized by the Numba-compiled function <a href=../../../api/signals/nb/index.html#vectorbtpro.signals.nb.ohlc_stop_place_nb>ohlc_stop_place_nb</a>, the accessor instance method <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.generate_ohlc_stop_exits>SignalsAccessor.generate_ohlc_stop_exits</a>, and the corresponding indicator classes <a href=../../../api/signals/generators/ohlcstx/index.html#vectorbtpro.signals.generators.ohlcstx.OHLCSTX>OHLCSTX</a> and <a href=../../../api/signals/generators/ohlcstcx/index.html#vectorbtpro.signals.generators.ohlcstcx.OHLCSTCX>OHLCSTCX</a>. The key advantage of this approach is the ability to check for all stop order conditions simultaneously!</p> <p>Let's generate signals based on a <a href=https://www.investopedia.com/articles/trading/08/trailing-stop-loss.asp>stop loss and trailing stop loss combo</a> of 10% and 15% respectively:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>OHLCSTCX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-72-6><a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-72-7><a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-72-8><a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.1</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-72-9><a id=__codelineno-72-9 name=__codelineno-72-9 href=#__codelineno-72-9></a><span class=gp>... </span>    <span class=n>tsl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.15</span><span class=p>),</span>
</span><span id=__span-72-10><a id=__codelineno-72-10 name=__codelineno-72-10 href=#__codelineno-72-10></a><span class=gp>... </span>    <span class=n>is_entry_open</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># (4)!</span>
</span><span id=__span-72-11><a id=__codelineno-72-11 name=__codelineno-72-11 href=#__codelineno-72-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-72-12><a id=__codelineno-72-12 name=__codelineno-72-12 href=#__codelineno-72-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (5)!</span>
</span></code></pre></div> <ol> <li>Entry price. Here, we use the close price since we've generated the entry array using it.</li> <li>OHLC</li> <li>Stop parameters</li> <li>Entry price is the close price. Enable this flag if the entry price is the open price.</li> <li>The indicator instance plots the candlestick data automatically!</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx.dark.svg#only-dark></p> <p>Keep in mind that we don't have intra-candle data. If there was a huge price fluctuation in both directions, we wouldn't be able to determine whether SL was triggered before TP and vice versa. So some assumptions need to be made:</p> <ul> <li>If a stop has been hit before the open price, the stop price becomes the current open price. This especially holds for <code>wait=1</code> and <code>is_entry_open=True</code>.</li> <li>Trailing stop can only be based on the previous high/low price, not the current one</li> <li>We pessimistically assume that any SL is triggered before any TP</li> </ul> <p>A common tricky situation is when the entry price is the open price and we're waiting one bar. For instance, what would happen if the condition was met during the waiting time? We cannot place an exit signal at the entry bar. Instead, the function waits until the next bar and checks whether the condition is still valid for the open price. If yes, the signal is placed with the stop price being the open price. If not, the function simply waits until the next opportunity arrives. If the stop is trailing, the target price will update just as usual at the entry timestamp. To avoid any logical bugs, it's advised to use the close price as the entry price when <code>wait</code> is one bar (default).</p> <p>When working with multiple stop types at the same time, we often want to know which exact type was triggered. This information is stored in the array <code>stop_type</code> (machine-readable) and <code>stop_type_readable</code> (human-readable):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span><span class=o>.</span><span class=n>stop_type_readable</span><span class=p>[</span><span class=n>ohlcstcx</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a><span class=go>symbol                    BTCUSDT ETHUSDT</span>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a><span class=go>Open time                                </span>
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a><span class=go>2021-02-22 00:00:00+00:00     TSL    None</span>
</span><span id=__span-73-5><a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a><span class=go>2021-03-23 00:00:00+00:00    None     TSL</span>
</span><span id=__span-73-6><a id=__codelineno-73-6 name=__codelineno-73-6 href=#__codelineno-73-6></a><span class=go>2021-03-24 00:00:00+00:00     TSL    None</span>
</span><span id=__span-73-7><a id=__codelineno-73-7 name=__codelineno-73-7 href=#__codelineno-73-7></a><span class=go>2021-04-18 00:00:00+00:00      SL     TSL</span>
</span><span id=__span-73-8><a id=__codelineno-73-8 name=__codelineno-73-8 href=#__codelineno-73-8></a><span class=go>2021-05-12 00:00:00+00:00      SL    None</span>
</span><span id=__span-73-9><a id=__codelineno-73-9 name=__codelineno-73-9 href=#__codelineno-73-9></a><span class=go>2021-06-08 00:00:00+00:00    None      SL</span>
</span><span id=__span-73-10><a id=__codelineno-73-10 name=__codelineno-73-10 href=#__codelineno-73-10></a><span class=go>2021-06-18 00:00:00+00:00      SL    None</span>
</span><span id=__span-73-11><a id=__codelineno-73-11 name=__codelineno-73-11 href=#__codelineno-73-11></a><span class=go>2021-07-09 00:00:00+00:00    None     TSL</span>
</span><span id=__span-73-12><a id=__codelineno-73-12 name=__codelineno-73-12 href=#__codelineno-73-12></a><span class=go>2021-07-19 00:00:00+00:00      SL    None</span>
</span><span id=__span-73-13><a id=__codelineno-73-13 name=__codelineno-73-13 href=#__codelineno-73-13></a><span class=go>2021-09-07 00:00:00+00:00     TSL     TSL</span>
</span><span id=__span-73-14><a id=__codelineno-73-14 name=__codelineno-73-14 href=#__codelineno-73-14></a><span class=go>2021-11-16 00:00:00+00:00     TSL     TSL</span>
</span><span id=__span-73-15><a id=__codelineno-73-15 name=__codelineno-73-15 href=#__codelineno-73-15></a><span class=go>2021-12-03 00:00:00+00:00    None      SL</span>
</span><span id=__span-73-16><a id=__codelineno-73-16 name=__codelineno-73-16 href=#__codelineno-73-16></a><span class=go>2021-12-29 00:00:00+00:00    None      SL</span>
</span><span id=__span-73-17><a id=__codelineno-73-17 name=__codelineno-73-17 href=#__codelineno-73-17></a><span class=go>2021-12-31 00:00:00+00:00      SL    None</span>
</span></code></pre></div> <p>All the stop types are listed in the enumerated type <a href=../../../api/signals/enums/index.html#vectorbtpro.signals.enums.StopType>StopType</a>.</p> <p>Both stop signal generation modes are very flexible towards inputs. For example, if any element in the arrays <code>ts</code> and <code>follow_ts</code> in the first mode is NaN (default), it will be substituted by the element in <code>entry_ts</code>. If only an element in <code>follow_ts</code> is NaN, it will be substituted by the minimum or maximum (depending on the sign of the stop value) of the element in both other arrays. Similarly, in the second mode, we can provide only <code>entry_price</code> and vectorbt will auto-populate the open price if <code>is_entry_open</code> is enabled and the close price otherwise. Without <code>high</code>, vectorbt will take the maximum out of <code>open</code> and <code>close</code>. Generally, we're not forced to provide every bit of information apart from the entry price, but it's in our best interest to provide as much information as we can to make best decisions and to closely mimic the real world.</p> <p>For example, let's run the same as above but specify the entry price only:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>OHLCSTCX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-74-4><a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.1</span><span class=p>),</span>
</span><span id=__span-74-5><a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a><span class=gp>... </span>    <span class=n>tsl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.15</span><span class=p>),</span>
</span><span id=__span-74-6><a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=gp>... </span>    <span class=n>is_entry_open</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-74-7><a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-74-8><a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx2.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx2.dark.svg#only-dark></p> <p>The same flexibility goes for parameters: similarly to the behavior of the probability parameter in random signal generators, we can pass each parameter as an array, such as one element per row, column, or even element. Let's treat each second entry as a short entry and thus reverse the <a href=https://capitalise.ai/trailing-take-profit-manage-your-risk-while-locking-the-profits/ >trailing take profit</a> (TTP) logic for it:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entry_pos_rank</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>pos_rank</span><span class=p>(</span><span class=n>allow_gaps</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_entries</span> <span class=o>=</span> <span class=p>(</span><span class=n>entry_pos_rank</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>entry_pos_rank</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>OHLCSTCX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>
</span><span id=__span-75-6><a id=__codelineno-75-6 name=__codelineno-75-6 href=#__codelineno-75-6></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-75-7><a id=__codelineno-75-7 name=__codelineno-75-7 href=#__codelineno-75-7></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Open&quot;</span><span class=p>),</span>
</span><span id=__span-75-8><a id=__codelineno-75-8 name=__codelineno-75-8 href=#__codelineno-75-8></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;High&quot;</span><span class=p>),</span>
</span><span id=__span-75-9><a id=__codelineno-75-9 name=__codelineno-75-9 href=#__codelineno-75-9></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Low&quot;</span><span class=p>),</span>
</span><span id=__span-75-10><a id=__codelineno-75-10 name=__codelineno-75-10 href=#__codelineno-75-10></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Close&quot;</span><span class=p>),</span>
</span><span id=__span-75-11><a id=__codelineno-75-11 name=__codelineno-75-11 href=#__codelineno-75-11></a><span class=gp>... </span>    <span class=n>tsl_th</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.2</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-75-12><a id=__codelineno-75-12 name=__codelineno-75-12 href=#__codelineno-75-12></a><span class=gp>... </span>    <span class=n>tsl_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.1</span><span class=p>),</span>
</span><span id=__span-75-13><a id=__codelineno-75-13 name=__codelineno-75-13 href=#__codelineno-75-13></a><span class=gp>... </span>    <span class=n>reverse</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=n>short_entries</span><span class=p>),</span>  <span class=c1># (4)!</span>
</span><span id=__span-75-14><a id=__codelineno-75-14 name=__codelineno-75-14 href=#__codelineno-75-14></a><span class=gp>... </span>    <span class=n>is_entry_open</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-75-15><a id=__codelineno-75-15 name=__codelineno-75-15 href=#__codelineno-75-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-75-16><a id=__codelineno-75-16 name=__codelineno-75-16 href=#__codelineno-75-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcstcx</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Rank each entry signal by its position among all entry signals using <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.pos_rank>SignalsAccessor.pos_rank</a></li> <li>Select only those entries whose position is odd, that is, doesn't divide by 2. Those will become our short entries.</li> <li>TTP information consists of two parts: a take profit threshold (<code>tsl_th</code>) that needs to be crossed upwards, and a trailing stop loss (<code>tsl_stop</code>) that becomes enabled once the threshold has been crossed</li> <li>Short entry mask becomes our reversal mask</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx3.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx3.dark.svg#only-dark></p> <p>We can then split both final arrays into four direction-aware arrays for simulation:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_entries</span> <span class=o>=</span> <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>new_entries</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=p>(</span><span class=o>~</span><span class=n>short_entries</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_exits</span> <span class=o>=</span> <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first_after</span><span class=p>(</span><span class=n>long_entries</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_entries</span> <span class=o>=</span> <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>new_entries</span><span class=o>.</span><span class=n>vbt</span> <span class=o>&amp;</span> <span class=n>short_entries</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_exits</span> <span class=o>=</span> <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first_after</span><span class=p>(</span><span class=n>short_entries</span><span class=p>)</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=gp>... </span>    <span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> 
</span><span id=__span-76-8><a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a><span class=gp>... </span>    <span class=n>ohlc_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>opacity</span><span class=o>=</span><span class=mf>0.5</span><span class=p>),</span> 
</span><span id=__span-76-9><a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a><span class=gp>... </span>    <span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-76-10><a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-76-11><a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_entries</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_entries</span><span class=p>(</span>
</span><span id=__span-76-12><a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a><span class=gp>... </span>    <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>entry_price</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>],</span>
</span><span id=__span-76-13><a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;limegreen&quot;</span><span class=p>),</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Long entries&quot;</span><span class=p>),</span> 
</span><span id=__span-76-14><a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-76-15><a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-76-16><a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_exits</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span>
</span><span id=__span-76-17><a id=__codelineno-76-17 name=__codelineno-76-17 href=#__codelineno-76-17></a><span class=gp>... </span>    <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>stop_price</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>],</span>
</span><span id=__span-76-18><a id=__codelineno-76-18 name=__codelineno-76-18 href=#__codelineno-76-18></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=p>),</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Long exits&quot;</span><span class=p>),</span>
</span><span id=__span-76-19><a id=__codelineno-76-19 name=__codelineno-76-19 href=#__codelineno-76-19></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-76-20><a id=__codelineno-76-20 name=__codelineno-76-20 href=#__codelineno-76-20></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-76-21><a id=__codelineno-76-21 name=__codelineno-76-21 href=#__codelineno-76-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_entries</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_entries</span><span class=p>(</span>
</span><span id=__span-76-22><a id=__codelineno-76-22 name=__codelineno-76-22 href=#__codelineno-76-22></a><span class=gp>... </span>    <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>entry_price</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>],</span>
</span><span id=__span-76-23><a id=__codelineno-76-23 name=__codelineno-76-23 href=#__codelineno-76-23></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;magenta&quot;</span><span class=p>),</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Short entries&quot;</span><span class=p>),</span>
</span><span id=__span-76-24><a id=__codelineno-76-24 name=__codelineno-76-24 href=#__codelineno-76-24></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-76-25><a id=__codelineno-76-25 name=__codelineno-76-25 href=#__codelineno-76-25></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-76-26><a id=__codelineno-76-26 name=__codelineno-76-26 href=#__codelineno-76-26></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_exits</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span>
</span><span id=__span-76-27><a id=__codelineno-76-27 name=__codelineno-76-27 href=#__codelineno-76-27></a><span class=gp>... </span>    <span class=n>ohlcstcx</span><span class=o>.</span><span class=n>stop_price</span><span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>],</span>
</span><span id=__span-76-28><a id=__codelineno-76-28 name=__codelineno-76-28 href=#__codelineno-76-28></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s2>&quot;red&quot;</span><span class=p>),</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Short exits&quot;</span><span class=p>),</span>
</span><span id=__span-76-29><a id=__codelineno-76-29 name=__codelineno-76-29 href=#__codelineno-76-29></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-76-30><a id=__codelineno-76-30 name=__codelineno-76-30 href=#__codelineno-76-30></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-76-31><a id=__codelineno-76-31 name=__codelineno-76-31 href=#__codelineno-76-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>We cannot use our original <code>entries</code> array here since the generator ignored some entries coming too early. But since new entries retain their positions, we can easily identify long signals by inverting the short array and combining it with the new entry array via the <em>AND</em> rule.</li> <li>A nice property of the chained exits mode is that each exit is guaranteed to come right after its entry - there are no other entries in-between, thus we can use <a href=../../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.first_after>SignalsAccessor.first_after</a> for this job</li> </ol> <p><img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx4.light.svg#only-light> <img alt class=iimg loading=lazy src=../../../assets/images/tutorials/signal-dev/ohlcstcx4.dark.svg#only-dark></p> <p>Seems like all trades are winning, thanks to a range-bound but still volatile market <img alt= class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f340.svg title=:four_leaf_clover:></p> <p><a class=md-button href=../../../assets/jupytext/tutorials/signal-development/generation.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5h1.18m-4.28 11.79c-.4 0-.72.3-.72.89 0 .59.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68H4.86M9.14 5.71c.4 0 .72-.3.72-.89 0-.59-.32-.71-.72-.71-.39 0-.71.12-.71.71s.32.89.71.89Z"/></svg></span> Python code</a> <a class=md-button href=https://github.com/polakowo/vectorbt.pro/blob/main/notebooks/SignalDevelopment.ipynb target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2Z"/></svg></span> Notebook</a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../superfast-supertrend/pipelines/index.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Pipelines"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Pipelines </div> </div> </a> <a href=../pre-analysis/index.html class="md-footer__link md-footer__link--next" aria-label="Next: Pre-analysis"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Pre-analysis </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2024 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.sections", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.8e8db93a.min.js></script> <script src=../../../assets/javascripts/extra.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_321460c7/tutorials/signal-development/generation/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 05 Mar 2024 10:50:02 GMT -->
</html>