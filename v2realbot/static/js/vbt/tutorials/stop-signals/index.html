<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/tutorials/stop-signals/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:54:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn how to analyze and apply stop signals"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/tutorials/stop-signals/ rel=canonical><link href=../signal-development/pre-analysis/index.html rel=prev><link href=../mtf-analysis/index.html rel=next><link rel=icon href=../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.18+insiders-4.53.6"><title>Stop signals - VectorBT PRO</title><link rel=stylesheet href=../../assets/stylesheets/main.d5b5f0fd.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><link rel=stylesheet href=../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0C5VNYCFHL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=robots content=noindex><meta property=og:title content="Stop signals"><meta property=og:type content=website><meta content=https://vectorbt.pro/tutorials/stop-signals/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_54404668/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Learn how to analyze and apply stop signals"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=../../assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=../../assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=../../assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../assets/logo/favicon-16x16.png><link rel=manifest href=../../assets/logo/site.webmanifest><link rel=mask-icon href=../../assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=../../assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_54404668/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#stop-signals class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <i>New</i>: Smart Money Concepts, Hurst exponent, tasks, iterated decorator, and <a href=../../features/index.html><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.2c0 13.1 5.4 25.7 14.9 34.7l84.7 80.8c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9z"/></svg></span> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=../../index.html title="VectorBT PRO" class="md-header__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT PRO <span class=md-version> v2024.6.19 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224 64c-44.2 0-80 35.8-80 80v48h240c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16v-48C80 64.5 144.5 0 224 0c57.5 0 107 33.7 130.1 82.3 7.6 16 .8 35.1-15.2 42.6s-35.1.8-42.6-15.2C283.4 82.6 255.9 64 224 64zm32 320c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32s14.3 32 32 32h64z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Stop signals </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=../../features/overview/index.html class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../overview/index.html class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../documentation/overview/index.html class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../api/index.html class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../cookbook/overview/index.html class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=../../terms/terms-of-use/index.html class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title="VectorBT PRO" class="md-nav__button md-logo" aria-label="VectorBT PRO" data-md-component=logo> <img src=../../assets/logo/logo.svg alt=logo class=logo> </a> VectorBT PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../index.html class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../features/overview/index.html class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../basic-rsi/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.5 18.5 6-6 4 4L22 6.92 20.59 5.5l-7.09 8-4-4L2 17l1.5 1.5Z"/></svg> <span class=md-ellipsis> Basic RSI strategy </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> SuperFast SuperTrend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> SuperFast SuperTrend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../superfast-supertrend/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> SuperFast SuperTrend </span> </a> </li> <li class=md-nav__item> <a href=../superfast-supertrend/streaming/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Streaming </span> </a> </li> <li class=md-nav__item> <a href=../superfast-supertrend/multithreading/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Multithreading </span> </a> </li> <li class=md-nav__item> <a href=../superfast-supertrend/pipelines/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M11 9.47V11h3.76L13 14.53V13H9.24L11 9.47M13 1 6 15h5v8l7-14h-5V1Z"/></svg> <span class=md-ellipsis> Pipelines </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Signal development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Signal development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../signal-development/generation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Generation </span> </a> </li> <li class=md-nav__item> <a href=../signal-development/pre-analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 2c0-3.3-2.7-6-6-6s-6 2.7-6 6c0 2.2 1.2 4.1 3 5.2l1-1.7c-1.2-.7-2-2-2-3.4 0-2.2 1.8-4 4-4s4 1.8 4 4c0 1.5-.8 2.8-2 3.4l1 1.7c1.8-1 3-3 3-5.2M12 2C6.5 2 2 6.5 2 12c0 3.7 2 6.9 5 8.6l1-1.7c-2.4-1.4-4-4-4-6.9 0-4.4 3.6-8 8-8s8 3.6 8 8c0 3-1.6 5.5-4 6.9l1 1.7c3-1.7 5-4.9 5-8.6 0-5.5-4.5-10-10-10Z"/></svg> <span class=md-ellipsis> Pre-analysis </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2v22m-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4v-2M19 7v2h2V7h-2m0-2h2a2 2 0 0 0-2-2v2m2 10h-2v2h2v-2m-2-4v2h2v-2h-2m-2-8h-2v2h2V3m2 18c1.11 0 2-.89 2-2h-2v2m-2-2h-2v2h2v-2Z"/></svg> <span class=md-ellipsis> Stop signals </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2v22m-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4v-2M19 7v2h2V7h-2m0-2h2a2 2 0 0 0-2-2v2m2 10h-2v2h2v-2m-2-4v2h2v-2h-2m-2-8h-2v2h2V3m2 18c1.11 0 2-.89 2-2h-2v2m-2-2h-2v2h2v-2Z"/></svg> <span class=md-ellipsis> Stop signals </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#parameters class=md-nav__link> <span class=md-ellipsis> Parameters </span> </a> </li> <li class=md-nav__item> <a href=#time-windows class=md-nav__link> <span class=md-ellipsis> Time windows </span> </a> </li> <li class=md-nav__item> <a href=#entry-signals class=md-nav__link> <span class=md-ellipsis> Entry signals </span> </a> </li> <li class=md-nav__item> <a href=#exit-signals class=md-nav__link> <span class=md-ellipsis> Exit signals </span> </a> </li> <li class=md-nav__item> <a href=#simulation class=md-nav__link> <span class=md-ellipsis> Simulation </span> </a> </li> <li class=md-nav__item> <a href=#performance class=md-nav__link> <span class=md-ellipsis> Performance </span> </a> </li> <li class=md-nav__item> <a href=#bonus-dashboard class=md-nav__link> <span class=md-ellipsis> Bonus: Dashboard </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> MTF analysis </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> MTF analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../mtf-analysis/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> MTF analysis </span> </a> </li> <li class=md-nav__item> <a href=../mtf-analysis/alignment/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> Alignment </span> </a> </li> <li class=md-nav__item> <a href=../mtf-analysis/aggregation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 2h2v18h18v2H2V2m5 8h10v3H7v-3m4 5h10v3H11v-3M6 4h16v4h-2V6H8v2H6V4Z"/></svg> <span class=md-ellipsis> Aggregation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Portfolio optimization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Portfolio optimization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../portfolio-optimization/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Portfolio optimization </span> </a> </li> <li class=md-nav__item> <a href=../portfolio-optimization/integrations/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Integrations </span> </a> </li> <li class=md-nav__item> <a href=../portfolio-optimization/dynamic/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 21H2V3h2v16h2v-2h4v2h2v-3h4v3h2v-2h4v4m-4-7h4v2h-4v-2m-6-8h4v3h-4V6m4 9h-4v-5h4v5M6 10h4v2H6v-2m4 6H6v-3h4v3Z"/></svg> <span class=md-ellipsis> Dynamic </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../pairs-trading/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 6.92 20.59 5.5l-2.85 3.22C15.68 6.4 12.83 5 9.61 5 6.72 5 4.07 6.16 2 8l1.42 1.42C5.12 7.93 7.27 7 9.61 7c2.74 0 5.09 1.26 6.77 3.24L13.5 13.5l-4-4L2 17l1.5 1.5 6-6 4 4 4.05-4.57c.75 1.35 1.25 2.9 1.45 4.57h2c-.22-2.32-.95-4.41-2.04-6.16L22 6.92Z"/></svg> <span class=md-ellipsis> Pairs trading </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Patterns and projections </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Patterns and projections </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../patterns-and-projections/patterns/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg> <span class=md-ellipsis> Patterns </span> </a> </li> <li class=md-nav__item> <a href=../patterns-and-projections/projections/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg> <span class=md-ellipsis> Projections </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10 id=__nav_3_10_label tabindex> <span class=md-ellipsis> Cross-validation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Cross-validation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cross-validation/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Cross-validation </span> </a> </li> <li class=md-nav__item> <a href=../cross-validation/splitter/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Splitter </span> </a> </li> <li class=md-nav__item> <a href=../cross-validation/applications/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41L18 7Z"/></svg> <span class=md-ellipsis> Applications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../more-tutorials/index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.6 13.4a1 1 0 0 1-1.4 1.4 4.8 4.8 0 0 1 0-7l3.5-3.6a5.1 5.1 0 0 1 7.1 0 5.1 5.1 0 0 1 0 7.1l-1.5 1.5a6.4 6.4 0 0 0-.4-2.4l.5-.5a3.2 3.2 0 0 0 0-4.3 3.2 3.2 0 0 0-4.3 0l-3.5 3.6a2.9 2.9 0 0 0 0 4.2M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3m-3.8-4.3a4.8 4.8 0 0 0-1.4-4.5 1 1 0 0 0-1.4 1.4 2.9 2.9 0 0 1 0 4.2l-3.5 3.6a3.2 3.2 0 0 1-4.3 0 3.2 3.2 0 0 1 0-4.3l.5-.4a7.3 7.3 0 0 1-.4-2.5l-1.5 1.5a5.1 5.1 0 0 0 0 7.1 5.1 5.1 0 0 0 7.1 0l1.8-1.8a6 6 0 0 1 3.1-4.3Z"/></svg> <span class=md-ellipsis> More tutorials </span> </a> </li> <li class=md-nav__item> <a href=../to-be-continued/index.html class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../documentation/overview/index.html class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../api/index.html class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../cookbook/overview/index.html class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../terms/terms-of-use/index.html class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=stop-signals><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2v22m-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4v-2M19 7v2h2V7h-2m0-2h2a2 2 0 0 0-2-2v2m2 10h-2v2h2v-2m-2-4v2h2v-2h-2m-2-8h-2v2h2V3m2 18c1.11 0 2-.89 2-2h-2v2m-2-2h-2v2h2v-2Z"/></svg></span> Stop signals<a class=headerlink href=#stop-signals title="Permanent link">&para;</a></h1> <p>Our goal is to utilize large-scale backtesting to compare the performance of trading with and without stop loss (SL), trailing stop (TS), and take profit (TP) signals. To make this attempt representative, we will run a huge number of experiments across three different dimensions: instruments, time, and parameters.</p> <p>First, we will pick 10 cryptocurrencies by market capitalization (except stablecoins such as USDT) and fetch 3 years of their daily pricing data. In particular, we aim at backtesting the time period from 2018 to 2021 as it contains periods of sharp price drops (e.g., corrections due to ATH in December 2017 and coronavirus in March 2020) as well as surges (ATH in December 2020) — this keeps things balanced. For each instrument, we will split this time period into 400 smaller (and overlapping) time windows, each 6 months long. We will run our tests on each of these windows to account for different market regimes. For each instrument and time window, we will then generate an entry signal at the very first bar and find an exit signal according to the stop configuration. We will test 100 stop values with a 1% increment and compare the performance of each one to that of trading randomly and holding within this particular time window. In total, we will conduct 2,000,000 tests.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Make sure that you have at least 16 GB of free RAM available, or memory swapping enabled.</p> </div> <h2 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">&para;</a></h2> <p>The first step is to define the parameters of the analysis pipeline. As discussed above, we will backtest 3 years of pricing data, 400 time windows, 10 cryptocurrencies, and 100 stop values. We will also set fees and slippage both to 0.25% and initial capital to $100 (the amount per se doesn't matter, but it must be the same for all assets to be comparable). Feel free to change any parameter of interest.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbtpro</span> <span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>ipywidgets</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>seed</span> <span class=o>=</span> <span class=mi>42</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>symbols</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>... </span>    <span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;ETH-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;XRP-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;BCH-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;LTC-USD&quot;</span><span class=p>,</span> 
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gp>... </span>    <span class=s2>&quot;BNB-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;EOS-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;XLM-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;XMR-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;ADA-USD&quot;</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=gp>... </span><span class=p>]</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>start_date</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>utc_timestamp</span><span class=p>(</span><span class=s2>&quot;2018-01-01&quot;</span><span class=p>)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>end_date</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>utc_timestamp</span><span class=p>(</span><span class=s2>&quot;2021-01-01&quot;</span><span class=p>)</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>time_delta</span> <span class=o>=</span> <span class=n>end_date</span> <span class=o>-</span> <span class=n>start_date</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>window_len</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=s2>&quot;180d&quot;</span><span class=p>)</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>window_cnt</span> <span class=o>=</span> <span class=mi>400</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exit_types</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;SL&quot;</span><span class=p>,</span> <span class=s2>&quot;TS&quot;</span><span class=p>,</span> <span class=s2>&quot;TP&quot;</span><span class=p>,</span> <span class=s2>&quot;Random&quot;</span><span class=p>,</span> <span class=s2>&quot;Holding&quot;</span><span class=p>]</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>step</span> <span class=o>=</span> <span class=mf>0.01</span>  <span class=c1># (1)!</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stops</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>step</span><span class=p>,</span> <span class=mi>1</span> <span class=o>+</span> <span class=n>step</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>wrapping</span><span class=p>[</span><span class=s2>&quot;freq&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;d&quot;</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>plotting</span><span class=p>[</span><span class=s2>&quot;layout&quot;</span><span class=p>][</span><span class=s2>&quot;template&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;vbt_dark&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;init_cash&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>100.</span>  <span class=c1># (2)!</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;fees&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.0025</span>  <span class=c1># (3)!</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;slippage&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.0025</span>  <span class=c1># (4)!</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>({</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=gp>... </span>    <span class=s2>&quot;Start date&quot;</span><span class=p>:</span> <span class=n>start_date</span><span class=p>,</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=gp>... </span>    <span class=s2>&quot;End date&quot;</span><span class=p>:</span> <span class=n>end_date</span><span class=p>,</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=gp>... </span>    <span class=s2>&quot;Time period (days)&quot;</span><span class=p>:</span> <span class=n>time_delta</span><span class=o>.</span><span class=n>days</span><span class=p>,</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=gp>... </span>    <span class=s2>&quot;Assets&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>symbols</span><span class=p>),</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=gp>... </span>    <span class=s2>&quot;Window length&quot;</span><span class=p>:</span> <span class=n>window_len</span><span class=p>,</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=gp>... </span>    <span class=s2>&quot;Windows&quot;</span><span class=p>:</span> <span class=n>window_cnt</span><span class=p>,</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=gp>... </span>    <span class=s2>&quot;Exit types&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>exit_types</span><span class=p>),</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=gp>... </span>    <span class=s2>&quot;Stop values&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>stops</span><span class=p>),</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=gp>... </span>    <span class=s2>&quot;Tests per asset&quot;</span><span class=p>:</span> <span class=n>window_cnt</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>stops</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>exit_types</span><span class=p>),</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=gp>... </span>    <span class=s2>&quot;Tests per window&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>symbols</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>stops</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>exit_types</span><span class=p>),</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=gp>... </span>    <span class=s2>&quot;Tests per exit type&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>symbols</span><span class=p>)</span> <span class=o>*</span> <span class=n>window_cnt</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>stops</span><span class=p>),</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=gp>... </span>    <span class=s2>&quot;Tests per stop type and value&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>symbols</span><span class=p>)</span> <span class=o>*</span> <span class=n>window_cnt</span><span class=p>,</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=gp>... </span>    <span class=s2>&quot;Tests total&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>symbols</span><span class=p>)</span> <span class=o>*</span> <span class=n>window_cnt</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>stops</span><span class=p>)</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>exit_types</span><span class=p>)</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=gp>... </span><span class=p>})</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=go>Start date                       2018-01-01 00:00:00+00:00</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=go>End date                         2021-01-01 00:00:00+00:00</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=go>Time period (days)                                    1096</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=go>Assets                                                  10</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=go>Window length                            180 days, 0:00:00</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=go>Windows                                                400</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=go>Exit types                                               5</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=go>Stop values                                            100</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=go>Tests per asset                                     200000</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=go>Tests per window                                      5000</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=go>Tests per exit type                                 400000</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=go>Tests per stop type and value                         4000</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a><span class=go>Tests total                                        2000000</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=go>dtype: object</span>
</span></code></pre></div> <ol> <li>1%</li> <li>100$</li> <li>0.25%</li> <li>0.25%</li> </ol> <p>Our configuration yields sample sizes with enough statistical power to analyze four variables: assets (200k tests per asset), time (5k tests per time window), exit types (400k tests per exit type), and stop values (4k tests per stop type and value). Similar to how Tableau handles dimensions and measures, we will be able to group our performance by each of these variables, but we will mainly focus on 5 exit types: SL exits, TS exits, TP exits, random exits, and holding exits (placed at the last bar).</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cols</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>,</span> <span class=s2>&quot;Low&quot;</span><span class=p>,</span> <span class=s2>&quot;High&quot;</span><span class=p>,</span> <span class=s2>&quot;Close&quot;</span><span class=p>,</span> <span class=s2>&quot;Volume&quot;</span><span class=p>]</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>yfdata</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=n>end_date</span><span class=p>)</span>
</span></code></pre></div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Symbol 10/10</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>yfdata</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=go>dict_keys([&#39;BTC-USD&#39;, &#39;ETH-USD&#39;, &#39;XRP-USD&#39;, &#39;BCH-USD&#39;, &#39;LTC-USD&#39;, </span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=go>           &#39;BNB-USD&#39;, &#39;EOS-USD&#39;, &#39;XLM-USD&#39;, &#39;XMR-USD&#39;, &#39;ADA-USD&#39;])</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>yfdata</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=go>(1096, 7)</span>
</span></code></pre></div> <p>The data instance <code>yfdata</code> contains a dictionary with the OHLCV data by cryptocurrency name. Each DataFrame has 1096 rows (days) and 5 columns (O, H, L, C, and V). You can plot the DataFrame as follows:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>yfdata</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span></code></pre></div> <ol> <li>Only one symbol can be plotted at a time</li> </ol> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/yfdata.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/yfdata.dark.svg#only-dark></p> <p>Since assets are one of the dimensions we want to analyze, vectorbt expects us to pack them as columns into a single DataFrame and label them accordingly. To do so, we simply swap assets and features to get a dictionary of DataFrames (with assets now as columns) keyed by feature name, such as "Open".</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcv</span> <span class=o>=</span> <span class=n>yfdata</span><span class=o>.</span><span class=n>concat</span><span class=p>()</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcv</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=go>dict_keys([&#39;Open&#39;, &#39;High&#39;, &#39;Low&#39;, &#39;Close&#39;, </span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=go>           &#39;Volume&#39;, &#39;Dividends&#39;, &#39;Stock Splits&#39;])</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ohlcv</span><span class=p>[</span><span class=s1>&#39;Open&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=go>(1096, 10)</span>
</span></code></pre></div> <h2 id=time-windows>Time windows<a class=headerlink href=#time-windows title="Permanent link">&para;</a></h2> <p>Next, we will move a 6-month sliding window over the whole time period and take 400 "snapshots" of each price DataFrame within this window. Each snapshot will correspond to a subset of data that should be independently backtested. As with assets and other variables, snapshots also need to be stacked horizontally as columns. As a result, we will get 180 rows (window length in days) and 4000 columns (10 assets x 400 windows); that is, one column will correspond to the price of one asset within one particular time window.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_rolling</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>... </span>    <span class=n>ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=n>window_cnt</span><span class=p>,</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=n>window_len</span><span class=o>.</span><span class=n>days</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>split_ohlcv</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>ohlcv</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>  <span class=c1># (2)!</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=gp>... </span>    <span class=n>split_ohlcv</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>into</span><span class=o>=</span><span class=s2>&quot;reset_stacked&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=go>(180, 4000)</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>split_indexes</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>split_indexes</span><span class=p>)</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=go>split</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=go>0      DatetimeIndex([&#39;2018-01-01 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=go>1      DatetimeIndex([&#39;2018-01-03 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=go>2      DatetimeIndex([&#39;2018-01-06 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=go>3      DatetimeIndex([&#39;2018-01-08 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=go>4      DatetimeIndex([&#39;2018-01-10 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=go>                             ...                        </span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=go>395    DatetimeIndex([&#39;2020-06-26 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=go>396    DatetimeIndex([&#39;2020-06-28 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=go>397    DatetimeIndex([&#39;2020-06-30 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=go>398    DatetimeIndex([&#39;2020-07-03 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=go>399    DatetimeIndex([&#39;2020-07-05 00:00:00+00:00&#39;, &#39;2...</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=go>Length: 400, dtype: object</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>split_indexes</span><span class=p>[</span><span class=mi>10</span><span class=p>])</span>  <span class=c1># (5)!</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=go>DatetimeIndex([&#39;2018-01-24 00:00:00+00:00&#39;, &#39;2018-01-25 00:00:00+00:00&#39;,</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=go>               &#39;2018-01-26 00:00:00+00:00&#39;, &#39;2018-01-27 00:00:00+00:00&#39;,</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=go>               &#39;2018-01-28 00:00:00+00:00&#39;, &#39;2018-01-29 00:00:00+00:00&#39;,</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=go>               ...</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=go>               &#39;2018-07-17 00:00:00+00:00&#39;, &#39;2018-07-18 00:00:00+00:00&#39;,</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=go>               &#39;2018-07-19 00:00:00+00:00&#39;, &#39;2018-07-20 00:00:00+00:00&#39;,</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=go>               &#39;2018-07-21 00:00:00+00:00&#39;, &#39;2018-07-22 00:00:00+00:00&#39;],</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=go>              dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Date&#39;, length=180, freq=&#39;D&#39;)</span>
</span></code></pre></div> <ol> <li>Create an instance of <a href=../../api/generic/splitting/base/index.html#vectorbtpro.generic.splitting.base.Splitter>Splitter</a></li> <li>For each DataFrame with symbols in <code>ohlcv</code>...</li> <li>Split the DataFrame into chunks and stack those chunks into one DataFrame by resetting its index. We reset the index because otherwise the operation would produce many NaNs.</li> <li>We also want to know the index of each split. Thus, split it in the same way as we did above, but instead of stacking, store it in a Series indexed by split label.</li> <li>Here's the index of the split with the label <code>10</code></li> </ol> <p>A nice feature of vectorbt is that it makes use of <a href=https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html>hierarchical indexing</a> to store valuable information on each backtest. It also ensures that this column hierarchy is preserved across the whole backtesting pipeline — from signal generation to performance modeling — and can be extended easily. Currently, our columns have the following hierarchy:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=go>MultiIndex([(  0, &#39;BTC-USD&#39;),</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=go>            (  0, &#39;ETH-USD&#39;),</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=go>            (  0, &#39;XRP-USD&#39;),</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=go>            ...</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=go>            (399, &#39;XLM-USD&#39;),</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=go>            (399, &#39;XMR-USD&#39;),</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=go>            (399, &#39;ADA-USD&#39;)],</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=go>           names=[&#39;split&#39;, &#39;symbol&#39;], length=4000)</span>
</span></code></pre></div> <p>This multi-index captures three parameters: the symbol, the start date of the time window, and its end date. Later, we will extend this multi-index with exit types and stop values such that each of the 2 million tests has its own price series.</p> <h2 id=entry-signals>Entry signals<a class=headerlink href=#entry-signals title="Permanent link">&para;</a></h2> <p>In contrast to most other backtesting libraries, signals are not stored as a signed integer array, but they are split into two boolean arrays: entries and exits, which makes manipulation a lot easier. At the beginning of each time window, let's generate an entry signal indicating a buy order. The data frame will have the same shape, index, and columns as that of price so that vectorbt can link their elements together.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>empty_like</span><span class=p>(</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>])</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=go>(180, 4000)</span>
</span></code></pre></div> <h2 id=exit-signals>Exit signals<a class=headerlink href=#exit-signals title="Permanent link">&para;</a></h2> <p>For each of the entry signals we generated, we will find an exit signal according to our 5 exit types: SL, TS, TP, random, and holding. We will also concatenate their DataFrames into a single (huge) DataFrame with 180 rows and 2,000,000 columns, each representing a separate backtest. Since exit signals are boolean, their memory footprint is tolerable.</p> <p>Let's generate exit signals according to stop conditions first. We want to test 100 different stop values with a 1% increment, starting from 1% and ending with 100% (i.e., find a timestamp where the price exceeds the entry price by 100%). When OHLC data is checked against such conditions, the position is closed at (or shortly after) the time of hitting the particular stop.</p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>We use <a href=../../api/signals/generators/ohlcstx/index.html#vectorbtpro.signals.generators.ohlcstx.OHLCSTX>OHLCSTX</a> instead of built-in stop-loss in <a href=../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_signals>Portfolio.from_signals</a> because we want to analyze signals before simulation. Also, it's easier to construct param grids. For reality check, run the same setup using <a href=../../api/portfolio/base/index.html#vectorbtpro.portfolio.base.Portfolio.from_signals>Portfolio.from_signals</a> alone.</p> </div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_ohlcstx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>OHLCSTX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=gp>... </span>    <span class=n>entry_price</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span>  <span class=c1># (2)!</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=gp>... </span>    <span class=nb>open</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>],</span> 
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;High&quot;</span><span class=p>],</span> 
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Low&quot;</span><span class=p>],</span> 
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> 
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=nb>list</span><span class=p>(</span><span class=n>stops</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=gp>... </span>    <span class=n>stop_type</span><span class=o>=</span><span class=kc>None</span>  <span class=c1># (4)!</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_exits</span> <span class=o>=</span> <span class=n>sl_ohlcstx</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>  <span class=c1># (5)!</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_price</span> <span class=o>=</span> <span class=n>sl_ohlcstx</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>  <span class=c1># (6)!</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_price</span><span class=p>[</span><span class=n>sl_exits</span><span class=p>]</span> <span class=o>=</span> <span class=n>sl_ohlcstx</span><span class=o>.</span><span class=n>stop_price</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>sl_ohlcstx</span>  <span class=c1># (7)!</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_exits</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=go>(180, 400000)</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_ohlcstx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>OHLCSTX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span> 
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=gp>... </span>    <span class=n>entry_price</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> 
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=gp>... </span>    <span class=nb>open</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>],</span> 
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;High&quot;</span><span class=p>],</span> 
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Low&quot;</span><span class=p>],</span> 
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> 
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=gp>... </span>    <span class=n>tsl_stop</span><span class=o>=</span><span class=nb>list</span><span class=p>(</span><span class=n>stops</span><span class=p>),</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=gp>... </span>    <span class=n>stop_type</span><span class=o>=</span><span class=kc>None</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_exits</span> <span class=o>=</span> <span class=n>tsl_ohlcstx</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_price</span> <span class=o>=</span> <span class=n>tsl_ohlcstx</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_price</span><span class=p>[</span><span class=n>tsl_exits</span><span class=p>]</span> <span class=o>=</span> <span class=n>tsl_ohlcstx</span><span class=o>.</span><span class=n>stop_price</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>tsl_ohlcstx</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_exits</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=go>(180, 400000)</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_ohlcstx</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>OHLCSTX</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span> 
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=gp>... </span>    <span class=n>entry_price</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> 
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=gp>... </span>    <span class=nb>open</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Open&quot;</span><span class=p>],</span> 
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;High&quot;</span><span class=p>],</span> 
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Low&quot;</span><span class=p>],</span> 
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> 
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=nb>list</span><span class=p>(</span><span class=n>stops</span><span class=p>),</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a><span class=gp>... </span>    <span class=n>stop_type</span><span class=o>=</span><span class=kc>None</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-8-47><a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_exits</span> <span class=o>=</span> <span class=n>tp_ohlcstx</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-8-48><a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_price</span> <span class=o>=</span> <span class=n>tp_ohlcstx</span><span class=o>.</span><span class=n>close</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-8-49><a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_price</span><span class=p>[</span><span class=n>tp_exits</span><span class=p>]</span> <span class=o>=</span> <span class=n>tp_ohlcstx</span><span class=o>.</span><span class=n>stop_price</span>
</span><span id=__span-8-50><a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>tp_ohlcstx</span>
</span><span id=__span-8-51><a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a>
</span><span id=__span-8-52><a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_exits</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-8-53><a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a><span class=go>(180, 400000)</span>
</span></code></pre></div> <ol> <li>The indicator <a href=../../api/signals/generators/ohlcstx/index.html#vectorbtpro.signals.generators.ohlcstx.OHLCSTX>OHLCSTX</a> is an exit generator and thus the first input array is always an entry mask</li> <li>The second input array is an entry price, which is the closing price since we cannot execute the stop at same bar as the entry signal anyway</li> <li>Providing a parameter as a list will test each value in that list on the entire input</li> <li>Argument <code>stop_type</code> is a so-called "in-place output", which is filled with various useful information, but since we only need the exits and stop price arrays, let's set it to <code>None</code> to not waste memory</li> <li>Assign output arrays to variables. Copy them to later be able to destroy the indicator instance.</li> <li>Order price is the stop price at the time of an exit and the closing price otherwise</li> <li>Destroy the indicator instance to free up memory</li> </ol> <p>This also extended our column hierarchy with a new column level indicating the stop value, we only have to make it consistent across all DataFrames:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>rename_stop_level</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>df</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rename_levels</span><span class=p>({</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>... </span>        <span class=s2>&quot;ohlcstx_sl_stop&quot;</span><span class=p>:</span> <span class=s2>&quot;stop_value&quot;</span><span class=p>,</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>... </span>        <span class=s2>&quot;ohlcstx_tsl_stop&quot;</span><span class=p>:</span> <span class=s2>&quot;stop_value&quot;</span><span class=p>,</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=gp>... </span>        <span class=s2>&quot;ohlcstx_tp_stop&quot;</span><span class=p>:</span> <span class=s2>&quot;stop_value&quot;</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=gp>... </span>    <span class=p>},</span> <span class=n>strict</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_exits</span> <span class=o>=</span> <span class=n>rename_stop_level</span><span class=p>(</span><span class=n>sl_exits</span><span class=p>)</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_exits</span> <span class=o>=</span> <span class=n>rename_stop_level</span><span class=p>(</span><span class=n>tsl_exits</span><span class=p>)</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_exits</span> <span class=o>=</span> <span class=n>rename_stop_level</span><span class=p>(</span><span class=n>tp_exits</span><span class=p>)</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_price</span> <span class=o>=</span> <span class=n>rename_stop_level</span><span class=p>(</span><span class=n>sl_price</span><span class=p>)</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_price</span> <span class=o>=</span> <span class=n>rename_stop_level</span><span class=p>(</span><span class=n>tsl_price</span><span class=p>)</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_price</span> <span class=o>=</span> <span class=n>rename_stop_level</span><span class=p>(</span><span class=n>tp_price</span><span class=p>)</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_exits</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=go>MultiIndex([(0.01,   0, &#39;BTC-USD&#39;),</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=go>            (0.01,   0, &#39;ETH-USD&#39;),</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=go>            (0.01,   0, &#39;XRP-USD&#39;),</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=go>            ...</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=go>            ( 1.0, 399, &#39;XLM-USD&#39;),</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=go>            ( 1.0, 399, &#39;XMR-USD&#39;),</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=go>            ( 1.0, 399, &#39;ADA-USD&#39;)],</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=go>           names=[&#39;stop_value&#39;, &#39;split&#39;, &#39;symbol&#39;], length=400000)</span>
</span></code></pre></div> <p>One major feature of vectorbt is that it places a strong focus on data science, and so it allows us to apply popular analysis tools to almost any part of the backtesting pipeline. For example, let's explore how the number of exit signals depends upon the stop type and value:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>({</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>... </span>    <span class=s2>&quot;SL&quot;</span><span class=p>:</span> <span class=n>sl_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>... </span>    <span class=s2>&quot;TS&quot;</span><span class=p>:</span> <span class=n>tsl_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=gp>... </span>    <span class=s2>&quot;TP&quot;</span><span class=p>:</span> <span class=n>tp_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=gp>... </span><span class=p>},</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;avg_num_signals&quot;</span><span class=p>)</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=go>SL    0.428585</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=go>TS    0.587100</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=go>TP    0.520042</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=go>Name: avg_num_signals, dtype: float64</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>groupby_stop_value</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>df</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;stop_value&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=gp>... </span>    <span class=s2>&quot;Stop Loss&quot;</span><span class=p>:</span> <span class=n>groupby_stop_value</span><span class=p>(</span><span class=n>sl_exits</span><span class=p>),</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=gp>... </span>    <span class=s2>&quot;Trailing Stop&quot;</span><span class=p>:</span> <span class=n>groupby_stop_value</span><span class=p>(</span><span class=n>tsl_exits</span><span class=p>),</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=gp>... </span>    <span class=s2>&quot;Take Profit&quot;</span><span class=p>:</span> <span class=n>groupby_stop_value</span><span class=p>(</span><span class=n>tp_exits</span><span class=p>)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=gp>... </span><span class=p>})</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Stop value&quot;</span><span class=p>,</span> 
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Avg number of signals&quot;</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/avg_num_signals.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/avg_num_signals.dark.svg#only-dark></p> <p>We see that TS is by far the most occurring exit signal. The SL and TP curves come hand in hand up to the stop value of 50% and then diverge in favor of TP. While it might seem that bulls are mostly in charge, especially for bigger price movements, remember that it is much easier to post a 50% profit than a 50% loss because the latter requires a 100% profit to recover; thus, negative downward spikes seem to dominate small to medium price movements (and shake out weak hands potentially). These are well-known cryptocurrency dynamics.</p> <p>To simplify the analysis that follows, we should ensure that each column has at least one exit signal to close the position, which means that if a column has no exit signal now, it should get one at the last timestamp. This is done by combining the stop exits with the last-bar exit using the <em>OR</em> rule and selecting the one that comes first:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_exits</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_exits</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_exits</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_exits</span> <span class=o>=</span> <span class=n>sl_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first_after</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tsl_exits</span> <span class=o>=</span> <span class=n>tsl_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first_after</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>tp_exits</span> <span class=o>=</span> <span class=n>tp_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>first_after</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>({</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=gp>... </span>    <span class=s2>&quot;SL&quot;</span><span class=p>:</span> <span class=n>sl_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=gp>... </span>    <span class=s2>&quot;TS&quot;</span><span class=p>:</span> <span class=n>tsl_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=gp>... </span>    <span class=s2>&quot;TP&quot;</span><span class=p>:</span> <span class=n>tp_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>total</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=gp>... </span><span class=p>},</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;avg_num_signals&quot;</span><span class=p>)</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=go>SL    1.0</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=go>TS    1.0</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=go>TP    1.0</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=go>Name: avg_num_signals, dtype: float64</span>
</span></code></pre></div> <ol> <li>Select the first exit between each two entries using <a href=../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.first_after>SignalsAccessor.first_after</a></li> </ol> <p>Next, we will generate signals of the two remaining exit types: random and holding — they will act as benchmarks to compare SL, TS, and TP against.</p> <p>"Holding" exit signals are signals placed at the very last bar of each time series. On most occasions, we shouldn't bother ourselves with placing them, since we can simply assess open positions. The reason we do it anyway is consistency — we want to ensure that each column has (exactly) one signal. The other consideration is shape and columns: they should match that of stop signals, so we can concatenate all DataFrames later.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_exits</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>empty_like</span><span class=p>(</span><span class=n>sl_exits</span><span class=p>)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_exits</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_price</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast_to</span><span class=p>(</span><span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> <span class=n>sl_price</span><span class=p>)</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hold_exits</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=go>(180, 400000)</span>
</span></code></pre></div> <p>To generate random exit signals, just shuffle any signal array. The only requirement is that each column should contain exactly one signal.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rand_exits</span> <span class=o>=</span> <span class=n>hold_exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=n>seed</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rand_price</span> <span class=o>=</span> <span class=n>hold_price</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rand_exits</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=go>(180, 400000)</span>
</span></code></pre></div> <ol> <li>This operation returns a new array</li> </ol> <p>The last step is the concatenation of all DataFrames along the column axis and labeling them using a new column level <code>exit_type</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>... </span>    <span class=n>sl_exits</span><span class=p>,</span> 
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>... </span>    <span class=n>tsl_exits</span><span class=p>,</span> 
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=n>tp_exits</span><span class=p>,</span> 
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=gp>... </span>    <span class=n>rand_exits</span><span class=p>,</span> 
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>... </span>    <span class=n>hold_exits</span><span class=p>,</span> 
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=gp>... </span>    <span class=n>keys</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>exit_types</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;exit_type&quot;</span><span class=p>)</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>sl_exits</span>  <span class=c1># (1)!</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>tsl_exits</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>tp_exits</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>rand_exits</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>hold_exits</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=go>(180, 2000000)</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=gp>... </span>    <span class=n>sl_price</span><span class=p>,</span> 
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=gp>... </span>    <span class=n>tsl_price</span><span class=p>,</span> 
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=gp>... </span>    <span class=n>tp_price</span><span class=p>,</span> 
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=gp>... </span>    <span class=n>rand_price</span><span class=p>,</span> 
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=gp>... </span>    <span class=n>hold_price</span><span class=p>,</span> 
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=gp>... </span>    <span class=n>keys</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>exit_types</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;exit_type&quot;</span><span class=p>)</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>sl_price</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>tsl_price</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>tp_price</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>rand_price</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>hold_price</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span><span class=o>.</span><span class=n>shape</span>
</span></code></pre></div> <ol> <li>Destroy DataFrames to release memory</li> </ol> <p>The <code>exits</code> array now contains 2,000,000 columns — one per backtest. The column hierarchy is also complete — one tuple of parameters per backtest.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=go>MultiIndex([(     &#39;SL&#39;, 0.01,   0, &#39;BTC-USD&#39;),</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=go>            (     &#39;SL&#39;, 0.01,   0, &#39;ETH-USD&#39;),</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=go>            (     &#39;SL&#39;, 0.01,   0, &#39;XRP-USD&#39;),</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=go>            ...</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=go>            (&#39;Holding&#39;,  1.0, 399, &#39;XLM-USD&#39;),</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=go>            (&#39;Holding&#39;,  1.0, 399, &#39;XMR-USD&#39;),</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=go>            (&#39;Holding&#39;,  1.0, 399, &#39;ADA-USD&#39;)],</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=go>           names=[&#39;exit_type&#39;, &#39;stop_value&#39;, &#39;split&#39;, &#39;symbol&#39;], </span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=go>           length=2000000)</span>
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>One boolean array takes roughly 400 MB of RAM:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>getsize</span><span class=p>())</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=go>390.0 MB</span>
</span></code></pre></div> <p>One floating array takes roughly 3 GB of RAM:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>getsize</span><span class=p>())</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=go>2.9 GB</span>
</span></code></pre></div> </div> <p>This allows us to group signals by one or multiple levels and conveniently analyze them in one go. For example, let's compare different exit types and stop values by an average distance of exit signal to entry signal (in days):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>avg_distance</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>between_ranges</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>exits</span><span class=p>)</span>\  <span class=c1># (1)!</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>... </span>    <span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>\
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=gp>... </span>    <span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s2>&quot;exit_type&quot;</span><span class=p>,</span> <span class=s2>&quot;stop_value&quot;</span><span class=p>])</span>\
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=gp>... </span>    <span class=o>.</span><span class=n>mean</span><span class=p>()</span>\
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=gp>... </span>    <span class=o>.</span><span class=n>unstack</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=s2>&quot;exit_type&quot;</span><span class=p>)</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>avg_distance</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=go>exit_type</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=go>Holding    179.000000</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=go>Random      89.432010</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=go>SL         124.686960</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=go>TP         113.887502</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=go>TS         104.159855</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=go>dtype: float64</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>avg_distance</span><span class=p>[</span><span class=n>exit_types</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Stop value&quot;</span><span class=p>,</span> 
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Avg distance to entry&quot;</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Using <a href=../../api/signals/accessors/index.html#vectorbtpro.signals.accessors.SignalsAccessor.between_ranges>SignalsAccessor.between_ranges</a></li> </ol> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/avg_distance.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/avg_distance.dark.svg#only-dark></p> <p>This scatterplot gives us a more detailed view of the distribution of exit signals. As expected, exit signals of plain holding have an exact distance of 179 days after entry (maximum possible), while random exit signals are evenly distributed over the time window and are not dependent upon any stop value. But we are more interested in stop curves, which are flat and thus hint at high volatility of price movements within our timeframe — the lower the curve, the higher is the chance of hitting a stop. To give an example, a TS of 20% is hit after just 30 days on average, while it would take 72 days for SL and 81 days for TP. But does an early exit any good?</p> <h2 id=simulation>Simulation<a class=headerlink href=#simulation title="Permanent link">&para;</a></h2> <p>Here comes the actual backtesting part:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>time</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=gp>... </span>    <span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span>  <span class=c1># (1)!</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>,</span> 
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=gp>... </span>    <span class=n>exits</span><span class=p>,</span> 
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>price</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>len</span><span class=p>(</span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=p>)</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=go>3995570</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=go>CPU times: user 21.2 s, sys: 9.11 s, total: 30.3 s</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=go>Wall time: 51.5 s</span>
</span></code></pre></div> <ol> <li>Usually we want to provide not only the closing price but OHLC, but since OHLC was already used to generate the signal arrays, the closing price suffices here</li> </ol> <p>Fairly easy, right?</p> <p>The simulation took roughly 50 seconds on my Apple M1 to finish and generated in total 3,995,570 orders that are ready to be analyzed (should be 4 million, but some price data points seem to be missing). Notice, however, that any floating array produced by the portfolio object of the same shape as our exit signals, such as portfolio value or returns, requires 8 * 180 * 2000000 bytes or almost 3GB of RAM. We can analyze anything from trades to Sharpe ratio, but given the amount of data, we will stick to a fast-to-calculate metric — total return.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_return</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>total_return</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>pf</span>  <span class=c1># (1)!</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_return</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=go>(2000000,)</span>
</span></code></pre></div> <ol> <li>Destroy the portfolio instance to release memory</li> </ol> <p>If your computer takes a substantial amount of time to simulate, you have several options:</p> <ul> <li>Use <a href=https://colab.research.google.com/ >Google Colab</a></li> <li>Reduce the parameter space (e.g., lower the stop value granularity from 1% to 2%)</li> <li>Use random search (e.g., pick a subset of columns randomly)</li> <li>Cast to <code>np.float32</code> or even below (if supported)</li> <li>Split the exit signal array into chunks and simulate per chunk. Just make sure each chunk has a shape compatible with that of the price and entries (remember to delete the previous portfolio if simulated):</li> </ul> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_returns</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ProgressBar</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>exit_types</span><span class=p>))):</span>  <span class=c1># (1)!</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>... </span>    <span class=n>exit_type_columns</span> <span class=o>=</span> <span class=n>exits</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;exit_type&quot;</span><span class=p>)</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>... </span>    <span class=n>chunk_mask</span> <span class=o>=</span> <span class=n>exit_type_columns</span> <span class=o>==</span> <span class=n>exit_types</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>... </span>    <span class=n>chunk_pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=gp>... </span>        <span class=n>split_ohlcv</span><span class=p>[</span><span class=s2>&quot;Close&quot;</span><span class=p>],</span> 
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=gp>... </span>        <span class=n>entries</span><span class=p>,</span> 
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=gp>... </span>        <span class=n>exits</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>chunk_mask</span><span class=p>],</span>  <span class=c1># (2)!</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=gp>... </span>        <span class=n>price</span><span class=o>=</span><span class=n>price</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>chunk_mask</span><span class=p>]</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=gp>... </span>    <span class=n>total_returns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>chunk_pf</span><span class=o>.</span><span class=n>total_return</span><span class=p>)</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=gp>... </span>    
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=gp>... </span>    <span class=k>del</span> <span class=n>chunk_pf</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>  <span class=c1># (3)!</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_return</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>total_returns</span><span class=p>)</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_return</span><span class=o>.</span><span class=n>shape</span>
</span></code></pre></div> <ol> <li>Iterate over stop types</li> <li>Select the columns that correspond to the current stop type</li> <li>Destroy the portfolio instance and force-collect any garbage</li> </ol> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Chunk 5/5</p> </div> </div> </p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_return</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>total_returns</span><span class=p>)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>total_return</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=go>(2000000,)</span>
</span></code></pre></div> <p>This approach has a similar execution time but is much healthier for memory.</p> <h2 id=performance>Performance<a class=headerlink href=#performance title="Permanent link">&para;</a></h2> <p>The first step is always taking a look at the distribution of the baseline:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>return_by_type</span> <span class=o>=</span> <span class=n>total_return</span><span class=o>.</span><span class=n>unstack</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=s2>&quot;exit_type&quot;</span><span class=p>)[</span><span class=n>exit_types</span><span class=p>]</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>return_by_type</span><span class=p>[</span><span class=s2>&quot;Holding&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>describe</span><span class=p>(</span><span class=n>percentiles</span><span class=o>=</span><span class=p>[])</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=go>count    400000.000000</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=go>mean          0.096940</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=go>std           0.833088</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=go>min          -0.909251</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=go>50%          -0.130475</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=go>max           6.565380</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=go>Name: Holding, dtype: float64</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>purple_color</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=p>[</span><span class=s2>&quot;plotting&quot;</span><span class=p>][</span><span class=s2>&quot;color_schema&quot;</span><span class=p>][</span><span class=s2>&quot;purple&quot;</span><span class=p>]</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>return_by_type</span><span class=p>[</span><span class=s2>&quot;Holding&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>histplot</span><span class=p>(</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Total return&quot;</span><span class=p>,</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=gp>... </span>    <span class=n>xaxis_tickformat</span><span class=o>=</span><span class=s2>&quot;.2%&quot;</span><span class=p>,</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Count&quot;</span><span class=p>,</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>marker_color</span><span class=o>=</span><span class=n>purple_color</span><span class=p>)</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/holding_histplot.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/holding_histplot.dark.svg#only-dark></p> <p>The distribution of holding performance across time windows is highly left-skewed. On the one hand, this indicates prolonged sideways and bearish regimes within our timeframe. On the other hand, the price of any asset can climb to infinity but is limited by 0 — making the distribution denser on the left and more sparse on the right by nature. Every second return is a loss of more than 6%, but thanks to bull runs the strategy still manages to post an average profit of 9%.</p> <p>Let's include other strategies into the analysis:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>... </span>    <span class=s2>&quot;Mean&quot;</span><span class=p>:</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=gp>... </span>    <span class=s2>&quot;Median&quot;</span><span class=p>:</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>median</span><span class=p>(),</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=gp>... </span>    <span class=s2>&quot;Std&quot;</span><span class=p>:</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>std</span><span class=p>(),</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=gp>... </span><span class=p>})</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=go>               Mean    Median       Std</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=go>exit_type                              </span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=go>SL         0.064957 -0.150000  0.771851</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=go>TS         0.068242 -0.084071  0.699093</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=go>TP         0.047264  0.088279  0.470234</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=go>Random     0.035533 -0.064302  0.581179</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=go>Holding    0.096940 -0.130475  0.833088</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>return_by_type</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>boxplot</span><span class=p>(</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>boxpoints</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Total return&quot;</span><span class=p>,</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=gp>... </span>    <span class=n>yaxis_tickformat</span><span class=o>=</span><span class=s2>&quot;.2%&quot;</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Plotly may be slow drawing a huge number of outlier points</li> </ol> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/return_by_type.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/return_by_type.dark.svg#only-dark></p> <p>None of the strategies beat the average return of the baseline. The TP strategy is the most consistent one though — although it introduces an upper bound that limits huge profits (see missing outliers), its trade returns are less volatile and mostly positive. The reason why SL and TS are unbounded at the top is that some stops haven't been hit, and so their columns fall back to plain holding. The random strategy is also interesting: while it's inferior in terms of average return, it finishes second after TP in terms of median return and returns volatility.</p> <p>To confirm the picture above, let's calculate the win rate of each strategy:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=p>(</span><span class=n>return_by_type</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;win_rate&quot;</span><span class=p>)</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=go>exit_type</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=go>SL         0.311065</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=go>TS         0.375567</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=go>TP         0.598395</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=go>Random     0.417915</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=go>Holding    0.410250</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=go>Name: win_rate, dtype: float64</span>
</span></code></pre></div> <p>Almost 60% of trades with TP are profitable — a high contrast to other strategies. But having a high win ratio doesn't necessarily guarantee longer-term trading success if your winning trades are often much smaller than your losing trades. Thus, let's aggregate by stop type and value and compute the <a href=https://www.icmarkets.com/blog/reward-to-risk-win-ratio-and-expectancy/ >expectancy</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>init_cash</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>portfolio</span><span class=p>[</span><span class=s2>&quot;init_cash&quot;</span><span class=p>]</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>get_expectancy</span><span class=p>(</span><span class=n>return_by_type</span><span class=p>,</span> <span class=n>level_name</span><span class=p>):</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span>    <span class=n>grouped</span> <span class=o>=</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>level_name</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>... </span>    <span class=n>win_rate</span> <span class=o>=</span> <span class=n>grouped</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=gp>... </span>    <span class=n>avg_win</span> <span class=o>=</span> <span class=n>grouped</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>init_cash</span> <span class=o>*</span> <span class=n>x</span><span class=p>[</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=gp>... </span>    <span class=n>avg_win</span> <span class=o>=</span> <span class=n>avg_win</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=gp>... </span>    <span class=n>avg_loss</span> <span class=o>=</span> <span class=n>grouped</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>init_cash</span> <span class=o>*</span> <span class=n>x</span><span class=p>[</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=gp>... </span>    <span class=n>avg_loss</span> <span class=o>=</span> <span class=n>avg_loss</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>win_rate</span> <span class=o>*</span> <span class=n>avg_win</span> <span class=o>-</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>win_rate</span><span class=p>)</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>avg_loss</span><span class=p>)</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>expectancy_by_stop</span> <span class=o>=</span> <span class=n>get_expectancy</span><span class=p>(</span><span class=n>return_by_type</span><span class=p>,</span> <span class=s2>&quot;stop_value&quot;</span><span class=p>)</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>expectancy_by_stop</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=go>exit_type</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=go>SL         6.495740</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=go>TS         6.824201</span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=go>TP         4.726418</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=go>Random     3.388083</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=go>Holding    9.693974</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=go>dtype: float64</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>expectancy_by_stop</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Stop value&quot;</span><span class=p>,</span> 
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Expectancy&quot;</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/expectancy_by_stop.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/expectancy_by_stop.dark.svg#only-dark></p> <p>Each strategy is able to add gradually to our account in the long run, with the holding strategy being the clear winner here — we can expect to add to our account an average of almost $9 out of $100 invested after every 6 months of holding. The only configuration that beats the baseline is TS with stop values ranging from 20% to 40%. The worst-performing configuration is SL and TS with stop values around 45% and 60% respectively; both seem to get triggered once most corrections find the bottom, which is even worse than exiting randomly. The TP strategy, on the other hand, beats the random exit strategy after the stop value of 30%. Generally, waiting seems to pay off for cryptocurrencies.</p> <p>Finally, let’s take a look at how our strategies perform under different market conditions. We will consider a simplified form of regime classification that divides holding returns into 20 bins and calculates the expectancy of each strategy within the boundaries of each bin (we leave out the latest bin for the sake of chart readability). Note that due to the highly skewed distribution of holding returns, we need to take into account the density of observations and make bins equally-sized.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>return_values</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>return_by_type</span><span class=p>[</span><span class=s2>&quot;Holding&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>idxs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ceil</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>return_values</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>21</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bins</span> <span class=o>=</span> <span class=n>return_values</span><span class=p>[</span><span class=n>idxs</span><span class=p>][:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>bin_return</span><span class=p>(</span><span class=n>return_by_type</span><span class=p>):</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=gp>... </span>    <span class=n>classes</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>return_by_type</span><span class=p>[</span><span class=s2>&quot;Holding&quot;</span><span class=p>],</span> <span class=n>bins</span><span class=o>=</span><span class=n>bins</span><span class=p>,</span> <span class=n>right</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=gp>... </span>    <span class=n>new_level</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>classes</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>right</span><span class=p>))</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=gp>... </span>    <span class=n>new_level</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>new_level</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;bin_right&quot;</span><span class=p>)</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>add_levels</span><span class=p>(</span><span class=n>new_level</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>binned_return_by_type</span> <span class=o>=</span> <span class=n>bin_return</span><span class=p>(</span><span class=n>return_by_type</span><span class=p>)</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>expectancy_by_bin</span> <span class=o>=</span> <span class=n>get_expectancy</span><span class=p>(</span><span class=n>binned_return_by_type</span><span class=p>,</span> <span class=s2>&quot;bin_right&quot;</span><span class=p>)</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>expectancy_by_bin</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>mode</span><span class=o>=</span><span class=s2>&quot;lines&quot;</span><span class=p>),</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Total return of holding&quot;</span><span class=p>,</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=gp>... </span>    <span class=n>xaxis_tickformat</span><span class=o>=</span><span class=s2>&quot;.2%&quot;</span><span class=p>,</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Expectancy&quot;</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/expectancy_by_bin.light.svg#only-light> <img alt class=iimg loading=lazy src=../../assets/images/tutorials/stop-signals/expectancy_by_bin.dark.svg#only-dark></p> <p>The chart above confirms the general intuition behind the behavior of stop orders: SL and TS limit the trader’s loss during downtrends, TP is beneficial for short-term traders interested in profiting from a quick bump in price, and holding performs best in top-growth markets. Surprisingly, while random exits perform poorly in sideways and bull markets, they match and often outperform stop exits in bear markets.</p> <h2 id=bonus-dashboard>Bonus: Dashboard<a class=headerlink href=#bonus-dashboard title="Permanent link">&para;</a></h2> <p>Dashboards can be a really powerful way of interacting with the data.</p> <p>First, let’s define the components of our dashboard. We have two types of components: controls, such as asset dropdown, and graphs. Controls define parameters and trigger updates for graphs.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_starts</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DatetimeIndex</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>split_indexes</span><span class=p>)))</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_ends</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DatetimeIndex</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>split_indexes</span><span class=p>)))</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>symbol_lvl</span> <span class=o>=</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;symbol&quot;</span><span class=p>)</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>split_lvl</span> <span class=o>=</span> <span class=n>return_by_type</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=s2>&quot;split&quot;</span><span class=p>)</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_start_lvl</span> <span class=o>=</span> <span class=n>range_starts</span><span class=p>[</span><span class=n>split_lvl</span><span class=p>]</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_end_lvl</span> <span class=o>=</span> <span class=n>range_ends</span><span class=p>[</span><span class=n>split_lvl</span><span class=p>]</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>asset_multi_select</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>SelectMultiple</span><span class=p>(</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=gp>... </span>    <span class=n>options</span><span class=o>=</span><span class=n>symbols</span><span class=p>,</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=gp>... </span>    <span class=n>value</span><span class=o>=</span><span class=n>symbols</span><span class=p>,</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=gp>... </span>    <span class=n>rows</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>symbols</span><span class=p>),</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=gp>... </span>    <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Symbols&quot;</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dates</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>yfdata</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>date_range_slider</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>SelectionRangeSlider</span><span class=p>(</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=gp>... </span>    <span class=n>options</span><span class=o>=</span><span class=n>dates</span><span class=p>,</span>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>dates</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=gp>... </span>    <span class=n>orientation</span><span class=o>=</span><span class=s2>&quot;horizontal&quot;</span><span class=p>,</span>
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=gp>... </span>    <span class=n>readout</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=gp>... </span>    <span class=n>continuous_update</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_start_label</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>Label</span><span class=p>()</span>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_end_label</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>Label</span><span class=p>()</span>
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>metric_dropdown</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>Dropdown</span><span class=p>(</span>
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=gp>... </span>    <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;Mean&quot;</span><span class=p>,</span> <span class=s2>&quot;Median&quot;</span><span class=p>,</span> <span class=s2>&quot;Win Rate&quot;</span><span class=p>,</span> <span class=s2>&quot;Expectancy&quot;</span><span class=p>],</span>
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=gp>... </span>    <span class=n>value</span><span class=o>=</span><span class=s2>&quot;Expectancy&quot;</span>
</span><span id=__span-28-28><a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-29><a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stop_scatter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Scatter</span><span class=p>(</span>
</span><span id=__span-28-30><a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a><span class=gp>... </span>    <span class=n>trace_names</span><span class=o>=</span><span class=n>exit_types</span><span class=p>,</span>
</span><span id=__span-28-31><a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a><span class=gp>... </span>    <span class=n>x_labels</span><span class=o>=</span><span class=n>stops</span><span class=p>,</span> 
</span><span id=__span-28-32><a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Stop value&quot;</span><span class=p>,</span> 
</span><span id=__span-28-33><a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Expectancy&quot;</span>
</span><span id=__span-28-34><a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-35><a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a><span class=gp>&gt;&gt;&gt; </span><span class=n>stop_scatter_img</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>Image</span><span class=p>(</span>
</span><span id=__span-28-36><a id=__codelineno-28-36 name=__codelineno-28-36 href=#__codelineno-28-36></a><span class=gp>... </span>    <span class=nb>format</span><span class=o>=</span><span class=s2>&quot;png&quot;</span><span class=p>,</span>
</span><span id=__span-28-37><a id=__codelineno-28-37 name=__codelineno-28-37 href=#__codelineno-28-37></a><span class=gp>... </span>    <span class=n>width</span><span class=o>=</span><span class=n>stop_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>layout</span><span class=o>.</span><span class=n>width</span><span class=p>,</span>
</span><span id=__span-28-38><a id=__codelineno-28-38 name=__codelineno-28-38 href=#__codelineno-28-38></a><span class=gp>... </span>    <span class=n>height</span><span class=o>=</span><span class=n>stop_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>layout</span><span class=o>.</span><span class=n>height</span>
</span><span id=__span-28-39><a id=__codelineno-28-39 name=__codelineno-28-39 href=#__codelineno-28-39></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-40><a id=__codelineno-28-40 name=__codelineno-28-40 href=#__codelineno-28-40></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bin_scatter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Scatter</span><span class=p>(</span>
</span><span id=__span-28-41><a id=__codelineno-28-41 name=__codelineno-28-41 href=#__codelineno-28-41></a><span class=gp>... </span>    <span class=n>trace_names</span><span class=o>=</span><span class=n>exit_types</span><span class=p>,</span>
</span><span id=__span-28-42><a id=__codelineno-28-42 name=__codelineno-28-42 href=#__codelineno-28-42></a><span class=gp>... </span>    <span class=n>x_labels</span><span class=o>=</span><span class=n>expectancy_by_bin</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-28-43><a id=__codelineno-28-43 name=__codelineno-28-43 href=#__codelineno-28-43></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>mode</span><span class=o>=</span><span class=s2>&quot;lines&quot;</span><span class=p>),</span>
</span><span id=__span-28-44><a id=__codelineno-28-44 name=__codelineno-28-44 href=#__codelineno-28-44></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Total return of holding&quot;</span><span class=p>,</span>
</span><span id=__span-28-45><a id=__codelineno-28-45 name=__codelineno-28-45 href=#__codelineno-28-45></a><span class=gp>... </span>    <span class=n>xaxis_tickformat</span><span class=o>=</span><span class=s2>&quot;%&quot;</span><span class=p>,</span>
</span><span id=__span-28-46><a id=__codelineno-28-46 name=__codelineno-28-46 href=#__codelineno-28-46></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Expectancy&quot;</span>
</span><span id=__span-28-47><a id=__codelineno-28-47 name=__codelineno-28-47 href=#__codelineno-28-47></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-48><a id=__codelineno-28-48 name=__codelineno-28-48 href=#__codelineno-28-48></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bin_scatter_img</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>Image</span><span class=p>(</span>
</span><span id=__span-28-49><a id=__codelineno-28-49 name=__codelineno-28-49 href=#__codelineno-28-49></a><span class=gp>... </span>    <span class=nb>format</span><span class=o>=</span><span class=s2>&quot;png&quot;</span><span class=p>,</span>
</span><span id=__span-28-50><a id=__codelineno-28-50 name=__codelineno-28-50 href=#__codelineno-28-50></a><span class=gp>... </span>    <span class=n>width</span><span class=o>=</span><span class=n>bin_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>layout</span><span class=o>.</span><span class=n>width</span><span class=p>,</span>
</span><span id=__span-28-51><a id=__codelineno-28-51 name=__codelineno-28-51 href=#__codelineno-28-51></a><span class=gp>... </span>    <span class=n>height</span><span class=o>=</span><span class=n>bin_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>layout</span><span class=o>.</span><span class=n>height</span>
</span><span id=__span-28-52><a id=__codelineno-28-52 name=__codelineno-28-52 href=#__codelineno-28-52></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p>The second step is the definition of the update function, which is triggered once any control has been changed. We also manually call this function to initialize the graphs with default parameters.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>update_scatter</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=n>_symbols</span> <span class=o>=</span> <span class=n>asset_multi_select</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>    <span class=n>_from</span> <span class=o>=</span> <span class=n>date_range_slider</span><span class=o>.</span><span class=n>value</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span>    <span class=n>_to</span> <span class=o>=</span> <span class=n>date_range_slider</span><span class=o>.</span><span class=n>value</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>... </span>    <span class=n>_metric_name</span> <span class=o>=</span> <span class=n>metric_dropdown</span><span class=o>.</span><span class=n>value</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=gp>... </span>    
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=gp>... </span>    <span class=n>range_mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>range_start_lvl</span> <span class=o>&gt;=</span> <span class=n>_from</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>range_end_lvl</span> <span class=o>&lt;=</span> <span class=n>_to</span><span class=p>)</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=gp>... </span>    <span class=n>asset_mask</span> <span class=o>=</span> <span class=n>symbol_lvl</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>_symbols</span><span class=p>)</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=gp>... </span>    <span class=n>filt</span> <span class=o>=</span> <span class=n>return_by_type</span><span class=p>[</span><span class=n>range_mask</span> <span class=o>&amp;</span> <span class=n>asset_mask</span><span class=p>]</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=gp>... </span>    
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=gp>... </span>    <span class=n>filt_binned</span> <span class=o>=</span> <span class=n>bin_return</span><span class=p>(</span><span class=n>filt</span><span class=p>)</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>_metric_name</span> <span class=o>==</span> <span class=s2>&quot;Mean&quot;</span><span class=p>:</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=gp>... </span>        <span class=n>filt_metric</span> <span class=o>=</span> <span class=n>filt</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;stop_value&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=gp>... </span>        <span class=n>filt_bin_metric</span> <span class=o>=</span> <span class=n>filt_binned</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;bin_right&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=gp>... </span>    <span class=k>elif</span> <span class=n>_metric_name</span> <span class=o>==</span> <span class=s2>&quot;Median&quot;</span><span class=p>:</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=gp>... </span>        <span class=n>filt_metric</span> <span class=o>=</span> <span class=n>filt</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;stop_value&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>median</span><span class=p>()</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=gp>... </span>        <span class=n>filt_bin_metric</span> <span class=o>=</span> <span class=n>filt_binned</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;bin_right&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>median</span><span class=p>()</span>
</span><span id=__span-29-18><a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=gp>... </span>    <span class=k>elif</span> <span class=n>_metric_name</span> <span class=o>==</span> <span class=s2>&quot;Win Rate&quot;</span><span class=p>:</span>
</span><span id=__span-29-19><a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=gp>... </span>        <span class=n>filt_metric</span> <span class=o>=</span> <span class=p>(</span><span class=n>filt</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;stop_value&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-29-20><a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=gp>... </span>        <span class=n>filt_bin_metric</span> <span class=o>=</span> <span class=p>(</span><span class=n>filt_binned</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&quot;bin_right&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-29-21><a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=gp>... </span>    <span class=k>elif</span> <span class=n>_metric_name</span> <span class=o>==</span> <span class=s2>&quot;Expectancy&quot;</span><span class=p>:</span>
</span><span id=__span-29-22><a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=gp>... </span>        <span class=n>filt_metric</span> <span class=o>=</span> <span class=n>get_expectancy</span><span class=p>(</span><span class=n>filt</span><span class=p>,</span> <span class=s2>&quot;stop_value&quot;</span><span class=p>)</span>
</span><span id=__span-29-23><a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=gp>... </span>        <span class=n>filt_bin_metric</span> <span class=o>=</span> <span class=n>get_expectancy</span><span class=p>(</span><span class=n>filt_binned</span><span class=p>,</span> <span class=s2>&quot;bin_right&quot;</span><span class=p>)</span>
</span><span id=__span-29-24><a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=gp>... </span>        
</span><span id=__span-29-25><a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a><span class=gp>... </span>    <span class=n>stop_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span><span class=n>yaxis_title</span><span class=o>=</span><span class=n>_metric_name</span><span class=p>)</span>
</span><span id=__span-29-26><a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a><span class=gp>... </span>    <span class=n>stop_scatter</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>filt_metric</span><span class=p>)</span>
</span><span id=__span-29-27><a id=__codelineno-29-27 name=__codelineno-29-27 href=#__codelineno-29-27></a><span class=gp>... </span>    <span class=n>stop_scatter_img</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>stop_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>to_image</span><span class=p>(</span><span class=nb>format</span><span class=o>=</span><span class=s2>&quot;png&quot;</span><span class=p>)</span>
</span><span id=__span-29-28><a id=__codelineno-29-28 name=__codelineno-29-28 href=#__codelineno-29-28></a><span class=gp>... </span>    
</span><span id=__span-29-29><a id=__codelineno-29-29 name=__codelineno-29-29 href=#__codelineno-29-29></a><span class=gp>... </span>    <span class=n>bin_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span><span class=n>yaxis_title</span><span class=o>=</span><span class=n>_metric_name</span><span class=p>)</span>
</span><span id=__span-29-30><a id=__codelineno-29-30 name=__codelineno-29-30 href=#__codelineno-29-30></a><span class=gp>... </span>    <span class=n>bin_scatter</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>filt_bin_metric</span><span class=p>)</span>
</span><span id=__span-29-31><a id=__codelineno-29-31 name=__codelineno-29-31 href=#__codelineno-29-31></a><span class=gp>... </span>    <span class=n>bin_scatter_img</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>bin_scatter</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>to_image</span><span class=p>(</span><span class=nb>format</span><span class=o>=</span><span class=s2>&quot;png&quot;</span><span class=p>)</span>
</span><span id=__span-29-32><a id=__codelineno-29-32 name=__codelineno-29-32 href=#__codelineno-29-32></a><span class=gp>... </span>    
</span><span id=__span-29-33><a id=__codelineno-29-33 name=__codelineno-29-33 href=#__codelineno-29-33></a><span class=gp>... </span>    <span class=n>range_start_label</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>datetime_as_string</span><span class=p>(</span>
</span><span id=__span-29-34><a id=__codelineno-29-34 name=__codelineno-29-34 href=#__codelineno-29-34></a><span class=gp>... </span>        <span class=n>_from</span><span class=o>.</span><span class=n>to_datetime64</span><span class=p>(),</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;D&quot;</span><span class=p>)</span>
</span><span id=__span-29-35><a id=__codelineno-29-35 name=__codelineno-29-35 href=#__codelineno-29-35></a><span class=gp>... </span>    <span class=n>range_end_label</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>datetime_as_string</span><span class=p>(</span>
</span><span id=__span-29-36><a id=__codelineno-29-36 name=__codelineno-29-36 href=#__codelineno-29-36></a><span class=gp>... </span>        <span class=n>_to</span><span class=o>.</span><span class=n>to_datetime64</span><span class=p>(),</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;D&quot;</span><span class=p>)</span>
</span><span id=__span-29-37><a id=__codelineno-29-37 name=__codelineno-29-37 href=#__codelineno-29-37></a>
</span><span id=__span-29-38><a id=__codelineno-29-38 name=__codelineno-29-38 href=#__codelineno-29-38></a><span class=gp>&gt;&gt;&gt; </span><span class=n>asset_multi_select</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>update_scatter</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=s2>&quot;value&quot;</span><span class=p>)</span>
</span><span id=__span-29-39><a id=__codelineno-29-39 name=__codelineno-29-39 href=#__codelineno-29-39></a><span class=gp>&gt;&gt;&gt; </span><span class=n>date_range_slider</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>update_scatter</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=s2>&quot;value&quot;</span><span class=p>)</span>
</span><span id=__span-29-40><a id=__codelineno-29-40 name=__codelineno-29-40 href=#__codelineno-29-40></a><span class=gp>&gt;&gt;&gt; </span><span class=n>metric_dropdown</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>update_scatter</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=s2>&quot;value&quot;</span><span class=p>)</span>
</span><span id=__span-29-41><a id=__codelineno-29-41 name=__codelineno-29-41 href=#__codelineno-29-41></a><span class=gp>&gt;&gt;&gt; </span><span class=n>update_scatter</span><span class=p>()</span>
</span></code></pre></div> <p>In the last step, we will define the layout of the dashboard and finally run it:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dashboard</span> <span class=o>=</span> <span class=n>ipywidgets</span><span class=o>.</span><span class=n>VBox</span><span class=p>([</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=gp>... </span>    <span class=n>asset_multi_select</span><span class=p>,</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=gp>... </span>    <span class=n>ipywidgets</span><span class=o>.</span><span class=n>HBox</span><span class=p>([</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=gp>... </span>        <span class=n>range_start_label</span><span class=p>,</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=gp>... </span>        <span class=n>date_range_slider</span><span class=p>,</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=gp>... </span>        <span class=n>range_end_label</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=gp>... </span>    <span class=p>]),</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=gp>... </span>    <span class=n>metric_dropdown</span><span class=p>,</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=gp>... </span>    <span class=n>stop_scatter_img</span><span class=p>,</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=gp>... </span>    <span class=n>bin_scatter_img</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=gp>... </span><span class=p>])</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dashboard</span>
</span></code></pre></div> <div class="grid cards"> <ul> <li> <p><span class="twemoji lg middle"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16V4H3v12h18m0-14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-7v2h2v2H8v-2h2v-2H3a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2h18M5 6h9v5H5V6m10 0h4v2h-4V6m4 3v5h-4V9h4M5 12h4v2H5v-2m5 0h4v2h-4v-2Z"/></svg></span> <strong>Dashboard</strong></p> <hr> <p>Run the notebook to view the dashboard!</p> </li> </ul> </div> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>The use of large-scale backtesting is not limited to hyperparameter optimization, but when properly utilized, it gives us a vehicle to explore complex phenomena related to trading. Especially utilization of multidimensional arrays, dynamic compilation, and integration with pandas, as done by vectorbt, allows us to quickly get new insights by applying popular data science tools to each component of a backtesting pipeline.</p> <p>In this particular example, we conducted 2 million tests to observe how different stop values impact the performance of stop signals and how different stop signals compare to holding and trading randomly. On the one hand, the findings confirm what we already know about the behavior of stop signals under various market conditions. On the other hand, they reveal optimal configurations that might have worked well for the last couple of years of trading cryptocurrencies.</p> <p><a class=md-button href=../../assets/jupytext/tutorials/stop-signals.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5h1.18m-4.28 11.79c-.4 0-.72.3-.72.89 0 .59.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68H4.86M9.14 5.71c.4 0 .72-.3.72-.89 0-.59-.32-.71-.72-.71-.39 0-.71.12-.71.71s.32.89.71.89Z"/></svg></span> Python code</a> <a class=md-button href=https://github.com/polakowo/vectorbt.pro/blob/main/notebooks/StopSignals.ipynb target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2Z"/></svg></span> Notebook</a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../signal-development/pre-analysis/index.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Pre-analysis"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Pre-analysis </div> </div> </a> <a href=../mtf-analysis/index.html class="md-footer__link md-footer__link--next" aria-label="Next: MTF analysis"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> MTF analysis </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2024 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.sections", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.ede584c9.min.js></script> <script src=../../assets/scripts/extra.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_54404668/tutorials/stop-signals/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 20 Jun 2024 15:54:26 GMT -->
</html>